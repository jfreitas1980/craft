Compiling Program: C:\DataFlex Projects\CROSS\WVDF_WS\AppSrc\WebApp.src
Memory Available: 2147483646
1>//-2WA
1>Use AllWebAppClasses.pkg
Using pre-compiled package ALLWEBAPPCLASSES.PKG
Including file: AllWebAppClasses.pkd    (C:\Program Files (x86)\DataFlex 18.2\Pkg\AllWebAppClasses.pkd)
29136>
29136>Register_Object oApplication
29136>Register_Object oWebApp
29136>
29136>Use WinUser.pkg
29136>Use func.pkg
Including file: func.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\func.pkg)
29136>>>// FUNC.PKG
29136>>>// New global DataFlex functions
29136>>>// Doug Goldner  2/25/91
29136>>>
29136>>>//
29136>>>// OBSOLETE - This package is included for backwards compatibility .
29136>>>//            Do not use these for new programs and attempt to replace these
29136>>>//            with your own package as soon as possible.
29136>>>//
29136>>>Use LanguageText.pkg
29136>>>
29136>>>use VDFBase.pkg
29136>>>
29136>>>Object Eng_Month_Name is an Array 
29138>>>    Set value item  1 to "January"  
29139>>>    Set value item  2 to "February" 
29140>>>    Set value item  3 to "March"    
29141>>>    Set value item  4 to "April"    
29142>>>    Set value item  5 to "May"      
29143>>>    Set value item  6 to "June"     
29144>>>    Set value item  7 to "July"     
29145>>>    Set value item  8 to "August"   
29146>>>    Set value item  9 to "September"
29147>>>    Set value item 10 to "October"  
29148>>>    Set value item 11 to "November" 
29149>>>    Set value item 12 to "December" 
29150>>>End_Object // Eng_Month_Name
29151>>>
29151>>>Object Pbr_Month_Name is an Array 
29153>>>    Set value item  1 to "Janeiro"  
29154>>>    Set value item  2 to "Fevereiro" 
29155>>>    Set value item  3 to "Marco"    
29156>>>    Set value item  4 to "Abril"    
29157>>>    Set value item  5 to "Maio"      
29158>>>    Set value item  6 to "Junho"     
29159>>>    Set value item  7 to "Julho"     
29160>>>    Set value item  8 to "Agosto"   
29161>>>    Set value item  9 to "Setembro"
29162>>>    Set value item 10 to "Outubro"  
29163>>>    Set value item 11 to "Novembro" 
29164>>>    Set value item 12 to "Dezembro" 
29165>>>End_Object // Pbr_Month_Name
29166>>>
29166>>>function get_month global string our_date$ returns integer
29168>>>   function_return (left(our_date$,2))
29169>>>end_function
29170>>>
29170>>>function get_day global string our_date$ returns integer
29172>>>   function_return (mid(our_date$,2,4))
29173>>>end_function
29174>>>
29174>>>function get_year global string our_date$ returns integer
29176>>>   function_return (mid(our_date$,4,7))
29177>>>end_function
29178>>>
29178>>>function get_current_hour global returns string
29180>>>   date tdate$
29180>>>   string our_hour$
29180>>>
29180>>>   sysdate tdate$ our_hour$
29182>>>   if our_hour$ lt 10 insert "0" in our_hour$ at 0
29186>>>   function_return our_hour$
29187>>>end_function
29188>>>
29188>>>function get_current_minute global returns string
29190>>>   date tdate$
29190>>>   string our_hour$ our_minute$
29190>>>
29190>>>   sysdate tdate$ our_hour$ our_minute$
29193>>>   if our_minute$ lt 10 insert "0" in our_minute$ at 0
29197>>>   function_return our_minute$
29198>>>end_function
29199>>>
29199>>>function get_current_second global returns string
29201>>>   date tdate$
29201>>>   String our_hour$ our_minute$ our_second$
29201>>>
29201>>>   sysdate tdate$ our_hour$ our_minute$ our_second$
29205>>>   if our_second$ lt 10 insert "0" in our_second$ at 0
29209>>>   function_return our_second$
29210>>>end_function
29211>>>
29211>>>function get_hour global string our_time$ returns string
29213>>>   function_return (left(our_time$,2))
29214>>>end_function
29215>>>
29215>>>function get_minute global string our_time$ returns string
29217>>>   function_return (mid(our_time$,2,4))
29218>>>end_function
29219>>>
29219>>>function get_second global string our_time$ returns string
29221>>>   function_return (mid(our_time$,2,7))
29222>>>end_function
29223>>>
29223>>>function get_time global string hr$ string min$ string sec$ integer am_pm_wanted$ returns string
29225>>>   String am_pm$ time_string$
29225>>>
29225>>>   move C_$AM to am_pm$
29226>>>
29226>>>   if hr$ gt 11 move C_$PM to am_pm$
29229>>>   if hr$ lt 1 begin
29231>>>      move 12 to hr$
29232>>>      move C_$AM to am_pm$
29233>>>   end
29233>>>>
29233>>>   if am_pm_wanted$ eq 1 if hr$ gt 12 move (hr$ - 12) to hr$
29238>>>   if hr$ lt 10 insert "0" in hr$ at 0
29242>>>   if min$ lt 10 insert "0" in min$ at 0
29246>>>   if sec$ lt 10 insert "0" in sec$ at 0
29250>>>   move hr$ to time_string$
29251>>>   append time_string$ ":" min$ ":" sec$
29255>>>   if am_pm_wanted$ eq 1 append time_string$ " " am_pm$
29259>>>   function_return time_string$
29260>>>end_function
29261>>>
29261>>>function get_time_no_sec global string hr$ string min$ integer am_pm_wanted$ returns string
29263>>>   String am_pm$ time_string$
29263>>>
29263>>>   move C_$AM to am_pm$
29264>>>
29264>>>   if hr$ gt 11 move C_$PM to am_pm$
29267>>>   if hr$ lt 1 begin
29269>>>      move 12 to hr$
29270>>>      move C_$AM to am_pm$
29271>>>   end
29271>>>>
29271>>>   if am_pm_wanted$ eq 1 if hr$ gt 12 move (hr$ - 12) to hr$
29276>>>   if hr$ lt 10 insert "0" in hr$ at 0
29280>>>   if min$ lt 10 insert "0" in min$ at 0
29284>>>   move hr$ to time_string$
29285>>>   append time_string$ ":" min$
29287>>>   if am_pm_wanted$ eq 1 append time_string$ " " am_pm$
29291>>>   function_return time_string$
29292>>>end_function
29293>>>
29293>>>function get_current_time global integer am_pm_wanted$ returns string
29295>>>   date tdate$
29295>>>   string hr$ min$ sec$
29295>>>
29295>>>   sysdate tdate$ hr$ min$ sec$
29299>>>   function_return (get_time(hr$,min$,sec$,am_pm_wanted$))
29300>>>end_function
29301>>>
29301>>>
29301>>>
29301>>>function get_current_time_no_sec global integer am_pm_wanted$ returns string
29303>>>   date tdate$
29303>>>   String hr$ min$
29303>>>
29303>>>   sysdate tdate$ hr$ min$
29306>>>   function_return (get_time_no_sec(hr$,min$,am_pm_wanted$))
29307>>>end_function
29308>>>
29308>>>function get_word_date global string our_date$ returns string
29310>>>   integer month$
29310>>>   string month_name$
29310>>>   string total_date$
29310>>>   String our_year$
29310>>>   move (get_month(our_date$)) to month$
29311>>>   if month$ eq 1 move C_$January to month_name$
29314>>>   if month$ eq 2 move C_$February to month_name$
29317>>>   if month$ eq 3 move C_$March to month_name$
29320>>>   if month$ eq 4 move C_$April to month_name$
29323>>>   if month$ eq 5 move C_$May to month_name$
29326>>>   if month$ eq 6 move C_$June to month_name$
29329>>>   if month$ eq 7 move C_$July to month_name$
29332>>>   if month$ eq 8 move C_$August to month_name$
29335>>>   if month$ eq 9 move C_$September to month_name$
29338>>>   if month$ eq 10 move C_$October to month_name$
29341>>>   if month$ eq 11 move C_$November to month_name$
29344>>>   if month$ eq 12 move C_$December to month_name$
29347>>>   move month_name$ to total_date$
29348>>>   append total_date$ " " (get_day(our_date$)) ", "
29351>>>   move (get_year(our_date$)) to our_year$
29352>>>   if (length(our_year$)) lt 2 insert "0" in our_year$ at 0
29356>>>   if (length(our_year$)) lt 4 insert "19" in our_year$ at 0
29360>>>   append total_date$ our_year$
29361>>>   function_return total_date$
29362>>>
29362>>>end_function
29363>>>
29363>>>function get_title global string our_word$ returns string
29365>>>   integer lvar$
29365>>>   string title_word$
29365>>>   integer upper_next$
29365>>>   String our_letter$
29365>>>
29365>>>   move 1 to upper_next$
29366>>>   move "" to title_word$
29367>>>
29367>>>   for lvar$ from 1 to (length(our_word$))
29373>>>>
29373>>>      mid our_word$ to our_letter$ 1 lvar$
29376>>>>
29376>>>      if our_letter$ eq " " begin
29378>>>         append title_word$ " "
29379>>>         move 1 to upper_next$
29380>>>      end
29380>>>>
29380>>>      else begin
29381>>>         if upper_next$ eq 1 append title_word$ (uppercase(our_letter$))
29384>>>         else append title_word$ our_letter$
29386>>>         move 0 to upper_next$
29387>>>      end
29387>>>>
29387>>>   loop
29388>>>>
29388>>>   function_return title_word$
29389>>>end_function
29390>>>
29390>>>function get_file_exists global string filename$ returns integer
29392>>>   Integer exists$
29392>>>   direct_input channel 9 filename$
29394>>>   [seqeof] move 0 to exists$
29395>>>   [not seqeof] move 1 to exists$
29396>>>   close_input channel 9
29398>>>   function_return exists$
29399>>>end_function
29400>>>
29400>>>function get_time_difference_no_sec global integer hr1$ integer min1$ integer hr2$ integer min2$ ;                                    returns string
29402>>>
29402>>>   function_return (get_time_no_sec(abs(hr1$ - hr2$),abs(min1$ - min2$),0))
29403>>>end_function
29404>>>
29404>>>function get_time_difference global integer hr1$ integer min1$ integer sec1$ integer hr2$ integer min2$ integer sec2$ returns string
29406>>>
29406>>>   function_return (get_time(abs(hr1$ - hr2$),abs(min1$ - min2$),abs(sec1$ - sec2$),0))
29407>>>end_function // get_time_difference
29408>>>
29408>>>//  Set date to current window if the window is blank
29408>>>// this is very, very obsolete. Avoid!
29408>>>procedure default_date for cUIObject integer item#
29410>>>  String dte
29410>>>  if ( (not(item_changed_state(self,item#)) and ;       value(self,item#)=0)) begin
29412>>>     sysdate dte
29413>>>     set value item item# to dte
29414>>>     set item_changed_state item item# to true
29415>>>  end
29415>>>>
29415>>>End_Procedure // default_date
29416>>>
29416>>>Function get_SysDate Global Integer iNone Returns Date
29418>>>    Date dDte
29418>>>    Sysdate dDte
29419>>>    Function_Return dDte
29420>>>End_Function // Get_SysDate    
29421>>>
29421>>>
29421>
29421>Set_Argument_Size 1024000
29422>Define Week_Length for |CI7
29422>Define Day_Length  for |CI1440
29422>Define Hour_Length for |CI60
29422>
29422>Use cApplication.pkg
29422>Use cWebApp.pkg
29422>Use vWin32fh.pkg
Including file: vWin32fh.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\vWin32fh.pkg)
29422>>>//-2WA
29422>>>// This code is part of VDF GUIdance
29422>>>// Visit us @ http://www.vdf-guidance.com
29422>>>// e-Mail us @ info@vdf-guidance.com
29422>>>// VDF GUIdance is a mutual project of
29422>>>// Frank Vandervelpen - Vandervelpen Systems and
29422>>>// Wil van Antwerpen  - Antwise Solutions
29422>>>// All software source code should be used <<AS IS>> without any warranty.
29422>>>//
29422>>>//
29422>>>// *** Windows 32bit file handling wrapper class ***
29422>>>//
29422>>>
29422>>>// 05-09-2000 **WvA: Changed namingconvention of all classes and methods to new standard
29422>>>//                   This may be painfull for some of you, but it was really needed as it was
29422>>>//                   getting messy. The "vs" -prefix we used before was confusing and could
29422>>>//                   unintentionally have been interpreted as "Vdf-GUIdance String".
29422>>>//
29422>>>// The used naming-convention is:
29422>>>//     - a prefix of "vWin32_" for every external function declaration
29422>>>//     - a prefix of the letter "v" for the full API name for the vdf-wrapper function.
29422>>>//
29422>>>// By using this we are guarding ourselves for conflicts with variable declarations
29422>>>// of DataAccess in the future.
29422>>>// Or at least almost as the letter "v" is now also synonym for variant (duh~!)
29422>>>//
29422>>>// mm-dd-yyyy Author Description
29422>>>//
29422>>>//                   vSHGetFolderPath added to retrieve the new shell folders
29422>>>//                   vGetWindowsDirectory
29422>>>//
29422>>>//                   vGetTempFileName
29422>>>//                   vGetTempPath
29422>>>// 11-17-2001 **WvA: Removed User Interface Error popups such as Error handling.
29422>>>//                   This is an absolute need for WebApp. We expect you to handle the
29422>>>//                   error in your application anyways. Changed this for:
29422>>>//                   vDeleteFile, vCopyFile, vMoveFile and vRenameFile
29422>>>// 03-02-2002 **WvA: vRemoveDirectory added
29422>>>// 03-11-2002 **WvA: The parameter lpdword in the external function declaration for
29422>>>//                   vWin32_SHBrowsForFolder can cause compiler errors.
29422>>>//                   It is renamed too avoid this.
29422>>>// 11-11-2002 **WvA: Codecleanup, vcSelectFile_Dialog is now cvSelectFile_Dialog, its
29422>>>//                   function vSelectedFileName is now just SelectedFileName
29422>>>//                   Removed the local keyword in the variable declarations
29422>>>// 10-17-2003 **WvA: Cleaned up function vSelect_File and added code to destroy the dynamically 
29422>>>//                   created file-open dialog
29422>>>// 02-12-2004 **WvA: Allan Ankerstjeme pointed me into a bug for the vCreateTempFileInPath
29422>>>//                   in that it didn't exactly return the correct filename of the file created.
29422>>>//                   This has now been taken care of.
29422>>>// 02-19-2004 **WvA: Removed all API declarations from the package itself to improve readability
29422>>>//                   These declarations are now included from the vWin32fh header file.
29422>>>// 02-19-2004 **WvA: Changed the default way in which the standard file handling works
29422>>>//                   Before today one could always undo the operation, as of now you cannot as
29422>>>//                   the default was a silly one using unnecessary resources (mainly diskspace)
29422>>>//                   Since i don't really expect someone to use that feature it has been removed.
29422>>>//                   One can however restore to the old way of handling by simply calling the
29422>>>//                   vWin32fhCompatibilityMode procedure ONE time before accessing any of the 
29422>>>//                   filehandling operations
29422>>>// 02-19-2004 **WvA: The functions ParseFolderName, ParseFileName and ParseFileExtenstion added
29422>>>//                   as well as the StringFromRightOfChar function.
29422>>>// 02-19-2004 **WvA: sfoFormatDisk function added which can use to format a floppydisk
29422>>>//                   DISABLED now as testing shows that it does not work as advertised...
29422>>>// 02-20-2004 **WvA: The function vDDE_Error_Handler didn't pass the errornumber on to the DDE_Error_To_String function
29422>>>//                   Moved the hardcoded strings from vDDE_Error_Handler to define declarations for easier translation later on.
29422>>>// 09-10-2004 **WvA: Added the ToAnsi function to the fileoperations method so that
29422>>>//                   extended characters are treated ok too.
29422>>>//                   Reported by Flemming from
29422>>>// 12-17-2004 **WvA: Changed vFilePathExists to be global, reported by Peter van Mil
29422>>>// 12-28-2004 **WvA: WebApp compatibility added by introducing compiler directives
29422>>>// 03-10-2006 **WvA: Added more CSIDL types to our header file for use with the vSHGetFolderPath function
29422>>>// 01-02-2007 **WvA: Set NoChangeDir_State on vSelect_File and vSelectSaveFile to True but changed it back due to side effects.
29422>>>//                   Added vSelectSavefile function to create a file save dialog
29422>>>//                   Fixed ParseFolderName which was horribly broken (thanks for the reports)
29422>>>//                   Added vParentPath function to retrieve the parent "node" of a path
29422>>>//                   
29422>>>Use Case.mac
29422>>>Use Seq_chnl.pkg
29422>>>
29422>>>Use windows
29422>>>Use Dferror
29422>>>Use Dll
29422>>>Use vWin32fh.h       // Header file with WinAPI declarations
Including file: vwin32fh.h    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\vwin32fh.h)
29422>>>>>//-2WA
29422>>>>>//TH-Header
29422>>>>>//*****************************************************************************************
29422>>>>>// Copyright (c)  2004 KURANT Project
29422>>>>>// All rights reserved.
29422>>>>>//
29422>>>>>// $FileName    : G:\Projects\vWin32fh\vWin32fh.h
29422>>>>>// $ProjectName : Windows 32 bits file handling
29422>>>>>// $Authors     : Wil van Antwerpen
29422>>>>>// $Created     : 19.02.2004  19:25
29422>>>>>// $Type        : BSD (as in do with it whatever you like)
29422>>>>>//
29422>>>>>// Contents:
29422>>>>>//  This file contains the Windows API external function call definitions and
29422>>>>>//  constants as they are used in the vWin32fh package.
29422>>>>>//*****************************************************************************************
29422>>>>>//TH-RevisionStart
29422>>>>>//TH-RevisionEnd
29422>>>>>
29422>>>>>Define CS_DDE_ERR_FILE_NOT_FOUND  For "The specified file was not found.\n"
29422>>>>>Define CS_DDE_ERR_PATH_NOT_FOUND  For "The specified path was not found.\n"
29422>>>>>Define CS_DDE_ERR_BAD_FORMAT      For "The .EXE file is invalid.\n"
29422>>>>>Define CS_DDE_ERR_ACCESSDENIED    For "The operating system denied access to the specified file.\n"
29422>>>>>Define CS_DDE_ERR_ASSOCINCOMPLETE For "The filename association is incomplete or invalid.\n"
29422>>>>>Define CS_DDE_ERR_DDEBUSY         For "The DDE transaction could not be completed because other DDE\ntransactions were being processed.\n"
29422>>>>>Define CS_DDE_ERR_DDEFAIL         For "The DDE transaction failed.\n"
29422>>>>>Define CS_DDE_ERR_DDETIMEOUT      For "The DDE transaction could not be completed,\nbecause the request timed out.\n"
29422>>>>>Define CS_DDE_ERR_DLLNOTFOUND     For "The specified dynamic-link library was not found.\n"
29422>>>>>Define CS_DDE_ERR_NOASSOC         For "There is no application associated with the given filename extension.\n"
29422>>>>>Define CS_DDE_ERR_OOM             For "There is not enough free memory available to complete the operation.\n"
29422>>>>>Define CS_DDE_ERR_PNF             For "The specified path was not found.\n"
29422>>>>>Define CS_DDE_ERR_SHARE           For "A sharing violation occurred.\n"
29422>>>>>Define CS_DDE_ERR_UNKNOWN_LINE1   For "Unknown DDE-error occurred.\nErrornumber"
29422>>>>>Define CS_DDE_ERR_UNKNOWN_LINE2   For ".\n"
29422>>>>>Define CS_DDE_ERR_HANDL_PAKTC     For "\nPress a key to continue...\n\n"
29422>>>>>Define CS_DDE_ERR_HANDL_CAPTION   For "a DDE-error occured"
29422>>>>>
29422>>>>>
29422>>>>>Define vMax_Path     For |CI260
29422>>>>>Define vMinChar      For |CI$80
29422>>>>>Define vMaxChar      For |CI$7F
29422>>>>>Define vMinShort     For |CI$8000
29422>>>>>Define vMaxShort     For |CI$7FFF
29422>>>>>Define vMinLong      For |CI$80000000
29422>>>>>Define vMaxLong      For |CI$7FFFFFFF
29422>>>>>Define vMaxByte      For |CI$FF
29422>>>>>Define vMaxWord      For |CI$FFFF
29422>>>>>Define vMaxDword     For |CI$FFFFFFFF
29422>>>>>
29422>>>>>
29422>>>>>
29422>>>>>// For FindFirstFile
29422>>>>>Define vINVALID_HANDLE_VALUE   For |CI-1
29422>>>>>Define vINVALID_FILE_SIZE      For |CI$FFFFFFFF
29422>>>>>Define vERROR_NO_MORE_FILES    For |CI18
29422>>>>>
29422>>>>>// The defines below can be used to find out what kind of error has occured if
29422>>>>>// the API-call ShellExecute is used.
29422>>>>>Define vERROR_FILE_NOT_FOUND   For |CI0002
29422>>>>>Define vERROR_PATH_NOT_FOUND   For |CI0003
29422>>>>>Define vERROR_BAD_FORMAT       For |CI0011
29422>>>>>Define vSE_ERR_ACCESSDENIED    For |CI0005
29422>>>>>Define vSE_ERR_ASSOCINCOMPLETE For |CI0027
29422>>>>>Define vSE_ERR_DDEBUSY         For |CI0030
29422>>>>>Define vSE_ERR_DDEFAIL         For |CI0029
29422>>>>>Define vSE_ERR_DDETIMEOUT      For |CI0028
29422>>>>>Define vSE_ERR_DLLNOTFOUND     For |CI0032
29422>>>>>Define vSE_ERR_FNF             For |CI0002
29422>>>>>Define vSE_ERR_NOASSOC         For |CI0031
29422>>>>>Define vSE_ERR_OOM             For |CI0008
29422>>>>>Define vSE_ERR_PNF             For |CI0003
29422>>>>>Define vSE_ERR_SHARE           For |CI0026
29422>>>>>
29422>>>>>
29422>>>>>// C-Structure
29422>>>>>//typedef struct _browseinfo {
29422>>>>>//    HWND hwndOwner;
29422>>>>>//    LPCITEMIDLIST pidlRoot;
29422>>>>>//    LPSTR pszDisplayName;
29422>>>>>//    LPCSTR lpszTitle;
29422>>>>>//    UINT ulFlags;
29422>>>>>//    BFFCALLBACK lpfn;
29422>>>>>//    LPARAM lParam;
29422>>>>>//    int iImage;
29422>>>>>//} BROWSEINFO, *PBROWSEINFO, *LPBROWSEINFO;
29422>>>>>
29422>>>>>//declare C structure struct_browseinfo
29422>>>>>//as documented in MSDN under Windows Shell API
29422>>>>>Type vtBrowseInfo
29422>>>>>  Field vtBrowseInfo.hWndOwner      as Handle
29422>>>>>  Field vtBrowseInfo.pIDLRoot       as Pointer
29422>>>>>  Field vtBrowseInfo.pszDisplayName as Pointer
29422>>>>>  Field vtBrowseInfo.lpszTitle      as Pointer
29422>>>>>  Field vtBrowseInfo.ulFlags        as dWord
29422>>>>>  Field vtBrowseInfo.lpfnCallback   as Pointer
29422>>>>>  Field vtBrowseInfo.lParam         as dWord
29422>>>>>  Field vtBrowseInfo.iImage         as dWord
29422>>>>>End_Type // tBrowseInfo
29422>>>>>
29422>>>>>// Browsing for directory.
29422>>>>>Define vBIF_RETURNONLYFSDIRS   For |CI$0001  // For finding a folder to start document searching
29422>>>>>Define vBIF_DONTGOBELOWDOMAIN  For |CI$0002  // For starting the Find Computer
29422>>>>>Define vBIF_STATUSTEXT         For |CI$0004  // Includes a status area in the dialog box.
29422>>>>>                                            // The callback function can set the status text by
29422>>>>>                                            // sending messages to the dialog box.
29422>>>>>Define vBIF_RETURNFSANCESTORS  For |CI$0008  // Only returns file system ancestors.
29422>>>>>
29422>>>>>Define vBIF_BROWSEFORCOMPUTER  For |CI$1000  // Browsing for Computers.
29422>>>>>Define vBIF_BROWSEFORPRINTER   For |CI$2000  // Browsing for Printers
29422>>>>>
29422>>>>>// message from browser
29422>>>>>//Define BFFM_INITIALIZED        1
29422>>>>>//Define BFFM_SELCHANGED         2
29422>>>>>
29422>>>>>// messages to browser
29422>>>>>//Define BFFM_SETSTATUSTEXT      (WM_USER + 100)
29422>>>>>//Define BFFM_ENABLEOK           (WM_USER + 101)
29422>>>>>//Define BFFM_SETSELECTION       (WM_USER + 102)
29422>>>>>
29422>>>>>
29422>>>>>External_function vWin32_SHBrowseForFolder "SHBrowseForFolder" shell32.dll ;  Pointer lpsBrowseInfo Returns dWord
29423>>>>>
29423>>>>>External_function vWin32_SHGetPathFromIDList "SHGetPathFromIDList" shell32.dll ;  Pointer pidList Pointer lpBuffer Returns dWord
29424>>>>>
29424>>>>>External_function vWin32_CoTaskMemFree "CoTaskMemFree" ole32.dll Pointer pV Returns Integer
29425>>>>>
29425>>>>>
29425>>>>>
29425>>>>>
29425>>>>>Type vtSecurity_attributes
29425>>>>>  Field vtSecurity_attributes.nLength        as dWord
29425>>>>>  Field vtSecurity_attributes.lpDescriptor   as Pointer
29425>>>>>  Field vtSecurity_attributes.bInheritHandle as Integer
29425>>>>>End_Type // vtSecurity_attributes
29425>>>>>
29425>>>>>//nLength:
29425>>>>>// Specifies the size, in bytes, of this structure. Set this value to the size of the
29425>>>>>// SECURITY_ATTRIBUTES structure.
29425>>>>>// Windows NT: Some functions that use the SECURITY_ATTRIBUTES structure do not verify the
29425>>>>>// value of the nLength member. However, an application should still set it properly.
29425>>>>>// That ensures current, future, and cross-platform compatibility.
29425>>>>>//
29425>>>>>//lpSecurityDescriptor:
29425>>>>>// Points to a security descriptor for the object that controls the sharing of it.
29425>>>>>// If NULL is specified for this member, the object may be assigned the default security
29425>>>>>// descriptor of the calling process.
29425>>>>>//
29425>>>>>//bInheritHandle:
29425>>>>>// Specifies whether the returned handle is inherited when a new process is created.
29425>>>>>// If this member is TRUE, the new process inherits the handle.
29425>>>>>
29425>>>>>
29425>>>>>// BOOL CreateDirectory(
29425>>>>>//    LPCTSTR lpPathName,
29425>>>>>//    LPSECURITY_ATTRIBUTES lpSecurityAttributes  // pointer to a security descriptor
29425>>>>>//   );
29425>>>>>//
29425>>>>>// lpPathName
29425>>>>>//  Points to a null-terminated string that specifies the path of the directory
29425>>>>>//  to be created.
29425>>>>>//  There is a default string size limit for paths of MAX_PATH characters.
29425>>>>>//  This limit is related to how the CreateDirectory function parses paths.
29425>>>>>// lpSecurityAttributes
29425>>>>>//  Pointer to a SECURITY_ATTRIBUTES structure als called a security descriptor that
29425>>>>>//  determines whether the returned handle can be inherited by child processes.
29425>>>>>//  If lpSecurityAttributes is NULL, the handle cannot be inherited.
29425>>>>>// Returns:
29425>>>>>//  If the function succeeds, the return value is nonzero.
29425>>>>>//  If the function fails, the return value is zero. To get extended error information, call GetLastError.
29425>>>>>External_function vWin32_CreateDirectory "CreateDirectoryA" kernel32.dll ;  Pointer lpPathName Pointer lpSecurity_Attributes Returns Integer
29426>>>>>
29426>>>>>
29426>>>>>// lpPathName
29426>>>>>//  Points to a null-terminated string that specifies the path of the directory
29426>>>>>//  to be removed.
29426>>>>>//  There is a default string size limit for paths of MAX_PATH characters.
29426>>>>>// Returns:
29426>>>>>//  If the function succeeds, the return value is nonzero.
29426>>>>>//  If the function fails, the return value is zero. To get extended error information, call GetLastError.
29426>>>>>External_function vWin32_RemoveDirectory "RemoveDirectoryA" kernel32.dll ;  Pointer lpPathName Returns Integer
29427>>>>>
29427>>>>>
29427>>>>>
29427>>>>>// The ShellExecute function opens or prints a specified file. The file can be an
29427>>>>>// executable file or a document file.
29427>>>>>//
29427>>>>>// Operation can be one of the following:
29427>>>>>//    "OPEN"  The function opens the file specified by lpFile.
29427>>>>>//            The file can be an executable file or a document file.
29427>>>>>//            The file can be a folder to open.
29427>>>>>//    "PRINT" The function prints the file specified by lpFile.
29427>>>>>//            The file should be a document file. If the file is an executable file,
29427>>>>>//            the function opens the file, as if  open  had been specified.
29427>>>>>//  "EXPLORE" The function explores the folder specified by lpFile.
29427>>>>>//
29427>>>>>// Return Values:
29427>>>>>//
29427>>>>>// If the function succeeds, the return value is the instance handle of the application that
29427>>>>>// was run, or the handle of a dynamic data exchange (DDE) server application.
29427>>>>>// If the function fails, the return value is an error value that is less than or equal to 32.
29427>>>>>//
29427>>>>>// The following table lists these error values:
29427>>>>>// Public Const ERROR_FILE_NOT_FOUND = 2&
29427>>>>>// Public Const ERROR_PATH_NOT_FOUND = 3&
29427>>>>>// Public Const ERROR_BAD_FORMAT = 11&
29427>>>>>// Public Const SE_ERR_ACCESSDENIED = 5
29427>>>>>// Public Const SE_ERR_ASSOCINCOMPLETE = 27
29427>>>>>// Public Const SE_ERR_DDEBUSY = 30
29427>>>>>// Public Const SE_ERR_DDEFAIL = 29
29427>>>>>// Public Const SE_ERR_DDETIMEOUT = 28
29427>>>>>// Public Const SE_ERR_DLLNOTFOUND = 32
29427>>>>>// Public Const SE_ERR_FNF = 2
29427>>>>>// Public Const SE_ERR_NOASSOC = 31
29427>>>>>// Public Const SE_ERR_OOM = 8
29427>>>>>// Public Const SE_ERR_PNF = 3
29427>>>>>// Public Const SE_ERR_SHARE = 26
29427>>>>>
29427>>>>>
29427>>>>>
29427>>>>>// Code to open the program that is associated with the selected file.
29427>>>>>//
29427>>>>>// External function call used in Procedure DoStartDocument
29427>>>>>External_function vWin32_ShellExecute "ShellExecuteA" shell32.dll ;  Handle hWnd ;  Pointer lpOperation ;  Pointer lpFile ;  Pointer lpParameters ;  Pointer lpDirectory ;  Dword iShowCmd Returns Handle
29428>>>>>
29428>>>>>
29428>>>>>
29428>>>>>
29428>>>>>
29428>>>>>                                          // Must be freed using SHFreeNameMappings
29428>>>>>
29428>>>>>Type vtShFileOpStruct
29428>>>>>  Field vtShFileOpStruct.hWnd                   as Handle
29428>>>>>  Field vtShFileOpStruct.wFunc                  as Integer
29428>>>>>  Field vtShFileOpStruct.pFrom                  as Pointer
29428>>>>>  Field vtShFileOpStruct.pTo                    as Pointer
29428>>>>>  Field vtShFileOpStruct.fFlags                 as Short
29428>>>>>  Field vtShFileOpStruct.fAnyOperationsAborted  as Short
29428>>>>>  Field vtShFileOpStruct.hNameMappings          as Pointer
29428>>>>>  Field vtShFileOpStruct.lpszProgressTitle      as Pointer // only used if FOF_SIMPLEPROGRESS
29428>>>>>End_Type // tShFileOpStruct
29428>>>>>
29428>>>>>// hwnd
29428>>>>>//   Handle of the dialog box to use to display information about the status of the operation.
29428>>>>>
29428>>>>>// wFunc
29428>>>>>//   Operation to perform. This member can be one of the following values:
29428>>>>>//     FO_COPY     Copies the files specified by pFrom to the location specified by pTo.
29428>>>>>//     FO_DELETE   Deletes the files specified by pFrom (pTo is ignored).
29428>>>>>//     FO_MOVE     Moves the files specified by pFrom to the location specified by pTo.
29428>>>>>//     FO_RENAME   Renames the files specified by pFrom.
29428>>>>>
29428>>>>>// pFrom
29428>>>>>//   Pointer to a buffer that specifies one or more source file names. Multiple names must
29428>>>>>//   be null-separated. The list of names must be double null-terminated.
29428>>>>>
29428>>>>>// pTo
29428>>>>>//   Pointer to a buffer that contains the name of the destination file or directory. The
29428>>>>>//   buffer can contain mutiple destination file names if the fFlags member specifies
29428>>>>>//   FOF_MULTIDESTFILES. Multiple names must be null-separated. The list of names must be
29428>>>>>//   double null-terminated.
29428>>>>>
29428>>>>>// fAnyOperationsAborted
29428>>>>>//   Value that receives TRUE if the user aborted any file operations before they
29428>>>>>//   were completed or FALSE otherwise.
29428>>>>>
29428>>>>>
29428>>>>>// Performs a copy, move, rename, or delete operation on a file system object.
29428>>>>>// This can be a file or a folder.
29428>>>>>// With thanks to Andrew S Kaplan
29428>>>>>External_function vWin32_SHFileOperation "SHFileOperationA" Shell32.dll ;        Pointer lpFileOp Returns Integer
29429>>>>>
29429>>>>>
29429>>>>>// Thanks To Oliver Nelson for posting this code on the newsgroups
29429>>>>>External_function vWin32_GetWindowsDirectory "GetWindowsDirectoryA" kernel32.dll ;                           Pointer lpBuffer Integer nSize Returns Integer
29430>>>>>
29430>>>>>
29430>>>>>
29430>>>>>// Courtesy Of Vincent Oorsprong
29430>>>>>//External_Function vWin32_GetTempFileName "GetTempFileNameA" Kernel32.Dll ;
29430>>>>>//   Pointer lpPathName ;
29430>>>>>//   Pointer lpPrefixString ;
29430>>>>>//   Integer uUnique ;
29430>>>>>//   Pointer lpTempFileName ;
29430>>>>>//   Returns Integer
29430>>>>>// **WvA: 28-04-2005 Changed string parameter type into pointers
29430>>>>>External_function vWin32_GetTempFileName "GetTempFileNameA" kernel32.dll Pointer lpsPath ;        Pointer lpsPrefix Integer iUnique Pointer pLoad Returns Integer
29431>>>>>
29431>>>>>External_function vWin32_GetTempPath "GetTempPathA" Kernel32.Dll ;   Dword nBufferLength ;   Pointer lpBuffer ;   Returns Integer
29432>>>>>
29432>>>>>External_function vWin32_DeleteFile "DeleteFileA" Kernel32.Dll ;   Pointer lpFileName ;   Returns Integer
29433>>>>>                  
29433>>>>>// from:
29433>>>>>// http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/shell/reference/enums/csidl.asp
29433>>>>>//
29433>>>>>Define vCSIDL_FLAG_CREATE       For |CI$8000 // IE5+, use this to create a special folder
29433>>>>>Define vCSIDL_ADMIN_TOOLS       For |CI$0030 // IE5+, The file system directory that is used to store administrative tools for an individual user
29433>>>>>Define vCSIDL_ALT_STARTUP       For |CI$001D // The file system directory that corresponds to the user's nonlocalized Startup program group
29433>>>>>Define vCSIDL_APPDATA           For |CI$001A // Version 4.71. The file system directory that serves as a common repository for application-specific data. A typical path is C:\Documents and Settings\<username>\Application Data
29433>>>>>Define vCSIDL_BITBUCKET         For |CI$000A // The virtual folder containing the objects in the user's Recycle Bin
29433>>>>>Define vCSIDL_CDBURN_AREA       For |CI$003B // IE6+ The file system directory acting as a staging area for files waiting to be written to CD. A typical path is C:\Documents and Settings\<username>\Local Settings\Application Data\Microsoft\CD Burning
29433>>>>>Define vCSIDL_COMMON_ADMINTOOLS For |CI$002F // IE5+ The file system directory containing administrative tools for all users of the computer
29433>>>>>Define vCSIDL_COMMON_ALTSTARTUP For |CI$001E // The file system directory that corresponds to the nonlocalized Startup program group for all users
29433>>>>>Define vCSIDL_COMMON_APPDATA    For |CI$0023 // IE5+ The file system directory containing application data for all users. A typical path is C:\Documents and Settings\All Users\Application Data
29433>>>>>Define vCSIDL_COMMON_DESKTOPDIRECTORY for |CI$0019 // WinNT+ Only, The file system directory that contains files and folders that appear on the desktop for all users. A typical path is C:\Documents and Settings\All Users\Desktop
29433>>>>>Define vCSIDL_COMMON_DOCUMENTS  For |CI$002E // IE5+ The file system directory that contains documents that are common to all users. A typical paths is C:\Documents and Settings\All Users\Documents
29433>>>>>Define vCSIDL_COMMON_FAVORITES  For |CI$001F // The file system directory that serves as a common repository for favorite items common to all users
29433>>>>>Define vCSIDL_COMMON_MUSIC      For |CI$0035 // IE6+ The file system directory that serves as a repository for music files common to all users. A typical path is C:\Documents and Settings\All Users\Documents\My Music
29433>>>>>Define vCSIDL_COMMON_PICTURES   For |CI$0036 // The file system directory that serves as a repository for image files common to all users. A typical path is C:\Documents and Settings\All Users\Documents\My Pictures
29433>>>>>Define vCSIDL_COMMON_PROGRAMS   For |CI$0017 // WinNT+ The file system directory that contains the directories for the common program groups that appear on the Start menu for all users. A typical path is C:\Documents and Settings\All Users\Start Menu\Programs
29433>>>>>Define vCSIDL_COMMON_STARTMENU  For |CI$0016 // WinNT+ The file system directory that contains the programs and folders that appear on the Start menu for all users. A typical path is C:\Documents and Settings\All Users\Start Menu
29433>>>>>Define vCSIDL_COMMON_STARTUP    For |CI$0018 // WinNT+ The file system directory that contains the programs that appear in the Startup folder for all users. A typical path is C:\Documents and Settings\All Users\Start Menu\Programs\Startup
29433>>>>>Define vCSIDL_COMMON_TEMPLATES  For |CI$002D // WinNT+ The file system directory that contains the templates that are available to all users. A typical path is C:\Documents and Settings\All Users\Templates
29433>>>>>Define vCSIDL_COMMON_VIDEO      For |CI$0037 // IE6+ The file system directory that serves as a repository for video files common to all users. A typical path is C:\Documents and Settings\All Users\Documents\My Videos
29433>>>>>Define vCSIDL_COMPUTERSNEARME   For |CI$003D // The folder representing other machines in your workgroup
29433>>>>>Define vCSIDL_CONNECTIONS       For |CI$0031 // The virtual folder representing Network Connections, containing network and dial-up connections
29433>>>>>Define vCSIDL_CONTROLS          For |CI$0003 // The virtual folder containing icons for the Control Panel applications
29433>>>>>Define vCSIDL_COOKIES           For |CI$0021 // The file system directory that serves as a common repository for Internet cookies. A typical path is C:\Documents and Settings\username\Cookies
29433>>>>>Define vCSIDL_DESKTOP           For |CI$0000 // The virtual folder representing the Windows desktop, the root of the namespace
29433>>>>>Define vCSIDL_DESKTOPDIRECTORY  For |CI$0010 // The file system directory used to physically store file objects on the desktop (not to be confused with the desktop folder itself). A typical path is C:\Documents and Settings\username\Desktop
29433>>>>>Define vCSIDL_DRIVES            For |CI$0011 // The virtual folder representing My Computer, containing everything on the local computer: storage devices, printers, and Control Panel. The folder may also contain mapped network drives
29433>>>>>Define vCSIDL_FAVORITES         For |CI$0006 // The file system directory that serves as a common repository for the user's favorite items. A typical path is C:\Documents and Settings\username\Favorites
29433>>>>>Define vCSIDL_FONTS             For |CI$0014 // A virtual folder containing fonts. A typical path is C:\Windows\Fonts
29433>>>>>Define vCSIDL_HISTORY           For |CI$0022 // The file system directory that serves as a common repository for Internet history items
29433>>>>>Define vCSIDL_INTERNET          For |CI$0001 // A virtual folder representing the Internet
29433>>>>>Define vCSIDL_INTERNET_CACHE    For |CI$0020 // Comctl4.72+, The file system directory that serves as a common repository for temporary Internet files. A typical path is C:\Documents and Settings\username\Local Settings\Temporary Internet Files
29433>>>>>Define vCSIDL_LOCAL_APPDATA     For |CI$001C // IE5+ The file system directory that serves as a data repository for local (nonroaming) applications. A typical path is C:\Documents and Settings\username\Local Settings\Application Data
29433>>>>>Define vCSIDL_MYDOCUMENTS       For |CI$000C // IE6+ The virtual folder representing the My Documents desktop item
29433>>>>>Define vCSIDL_MYMUSIC           For |CI$000D // The file system directory that serves as a common repository for music files. A typical path is C:\Documents and Settings\User\My Documents\My Music
29433>>>>>Define vCSIDL_MYPICTURES        For |CI$0027 // IE5+ The file system directory that serves as a common repository for image files. A typical path is C:\Documents and Settings\username\My Documents\My Pictures
29433>>>>>Define vCSIDL_MYVIDEO           For |CI$000E // IE6+ The file system directory that serves as a common repository for video files. A typical path is C:\Documents and Settings\username\My Documents\My Videos
29433>>>>>Define vCSIDL_NETHOOD           For |CI$0013 // A file system directory containing the link objects that may exist in the My Network Places virtual folder. It is not the same as CSIDL_NETWORK, which represents the network namespace root. A typical path is C:\Documents and Settings\username\NetHood
29433>>>>>Define vCSIDL_NETWORK           For |CI$0012 // A virtual folder representing Network Neighborhood, the root of the network namespace hierarchy
29433>>>>>Define vCSIDL_PERSONAL          For |CI$0005 // (Documents folder) IE6 The virtual folder representing the My Documents desktop item. 
29433>>>>>                                             // This is equivalent to CSIDL_MYDOCUMENTS. Previous to Version 6.0. The file system directory used to physically store a user's common repository of documents. A typical path is C:\Documents and Settings\username\My Documents
29433>>>>>Define vCSIDL_PHOTOALBUMS       For |CI$0045 // Vista+ The virtual folder used to store photo albums, typically username\My Pictures\Photo Albums
29433>>>>>Define vCSIDL_PLAYLISTS         For |CI$003F // Vista+ The virtual folder used to store play albums, typically username\My Music\Playlists                                             
29433>>>>>Define vCSIDL_PRINTERS          For |CI$0004 // The virtual folder containing installed printers
29433>>>>>Define vCSIDL_PRINTHOOD         For |CI$001B // The file system directory that contains the link objects that can exist in the Printers virtual folder. A typical path is C:\Documents and Settings\username\PrintHood
29433>>>>>Define vCSIDL_PROFILE           For |CI$0028 // IE5+ The user's profile folder. A typical path is C:\Documents and Settings\username
29433>>>>>Define vCSIDL_PROGRAM_FILES     For |CI$0026 // IE5+ The Program Files folder. A typical path is C:\Program Files
29433>>>>>Define vCSIDL_PROGRAM_FILES_COMMON For |CI$002B // IE5+, WinNT+ A folder for components that are shared across applications. A typical path is C:\Program Files\Common
29433>>>>>Define vCSIDL_PROGRAMS          For |CI$0002 // The file system directory that contains the user's program groups (which are themselves file system directories). A typical path is C:\Documents and Settings\username\Start Menu\Programs
29433>>>>>Define vCSIDL_RECENT            For |CI$0008 // The file system directory that contains shortcuts to the user's most recently used documents. A typical path is C:\Documents and Settings\username\My Recent Documents
29433>>>>>Define vCSIDL_RESOURCES         For |CI$0038 // undocumented
29433>>>>>Define vCSIDL_SAMPLE_MUSIC      For |CI$0040 // Vista+, The file system directory that contains sample music. A typical path is C:\Documents and Settings\username\My Documents\My Music\Sample Music
29433>>>>>Define vCSIDL_SAMPLE_PLAYLISTS  For |CI$0041 // Vista+, The file system directory that contains sample playlists. A typical path is C:\Documents and Settings\username\My Documents\My Music\Sample Playlists
29433>>>>>Define vCSIDL_SAMPLE_PICTURES   For |CI$0042 // Vista+, The file system directory that contains sample pictures. A typical path is C:\Documents and Settings\username\My Documents\My Pictures\Sample Pictures
29433>>>>>Define vCSIDL_SAMPLE_VIDEOS     For |CI$0043 // Vista+, The file system directory that contains sample videos. A typical path is C:\Documents and Settings\username\My Documents\My Videos\Sample Videos
29433>>>>>Define vCSIDL_SENDTO            For |CI$0009 // The file system directory that contains Send To menu items. A typical path is C:\Documents and Settings\username\SendTo
29433>>>>>Define vCSIDL_STARTMENU         For |CI$000B // The file system directory containing Start menu items. A typical path is C:\Documents and Settings\username\Start Menu
29433>>>>>Define vCSIDL_STARTUP           For |CI$0007 // The file system directory that corresponds to the user's Startup program group. The system starts these programs whenever any user logs onto Windows NT or starts Windows 95. A typical path is C:\Documents and Settings\username\Start Menu\Programs\Startup
29433>>>>>Define vCSIDL_SYSTEM            For |CI$0025 // The Windows System folder. A typical path is C:\Windows\System32
29433>>>>>Define vCSIDL_TEMPLATES         For |CI$0015 // The file system directory that serves as a common repository for document templates. A typical path is C:\Documents and Settings\username\Templates
29433>>>>>Define vCSIDL_WINDOWS           For |CI$0024 // The Windows directory or SYSROOT. This corresponds to the %windir% or %SYSTEMROOT% environment variables. A typical path is C:\Windows
29433>>>>>
29433>>>>>
29433>>>>>//HRESULT SHGetFolderPath(
29433>>>>>//    HWND hwndOwner,
29433>>>>>//    int nFolder,
29433>>>>>//    HANDLE hToken,
29433>>>>>//    DWORD dwFlags,
29433>>>>>//    LPTSTR pszPath
29433>>>>>//);
29433>>>>>// This function is a superset of SHGetSpecialFolderPath, included with earlier versions of
29433>>>>>// the shell. It is implemented in a redistributable DLL, SHFolder.dll, that also simulates
29433>>>>>// many of the new shell folders on older platforms such as Windows 95, Windows 98, and
29433>>>>>// Windows NT 4.0. This DLL always calls the current platform's version of this function.
29433>>>>>// If that fails, it will try to simulate the appropriate behavior.
29433>>>>>//
29433>>>>>External_function vWin32_SHGetFolderPath "SHGetFolderPathA" SHFolder.Dll ;   Pointer hWnd ;   Integer nFolder ;   Pointer hToken ;   DWord   dwFlags ;   Pointer lpszPath ;   Returns Integer
29434>>>>>
29434>>>>>
29434>>>>>
29434>>>>>Type vWin32_Find_Data
29434>>>>>  Field vWin32_Find_Data.dwFileAttributes As Dword
29434>>>>>  Field vWin32_Find_Data.ftCreationLowDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.ftCreationHighDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.ftLastAccessLowDateTime As dword
29434>>>>>  Field vWin32_Find_Data.ftLastAccessHighDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.ftLastWriteLowDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.ftLastWriteHighDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.nFileSizeHigh As Dword
29434>>>>>  Field vWin32_Find_Data.nFileSizeLow As Dword
29434>>>>>  Field vWin32_Find_Data.dwReserved0 As Dword
29434>>>>>  Field vWin32_Find_Data.dwReserved1 As Dword
29434>>>>>  Field vWin32_Find_Data.cFileName As Char vMax_Path
29434>>>>>  Field vWin32_Find_Data.cAlternateFileName As Char 14
29434>>>>>End_Type // vWin32_Find_Data
29434>>>>>
29434>>>>>// Courtesy Of Vincent Oorsprong
29434>>>>>// lpFileName      : address of name of file to search for
29434>>>>>// lpFindFileData  : address of returned information
29434>>>>>External_function vWin32_FindFirstFile "FindFirstFileA"  Kernel32.dll Pointer lpFileName ;          Pointer lpFindFileData Returns Handle
29435>>>>>
29435>>>>>// Courtesy Of Vincent Oorsprong
29435>>>>>// hFindFile       : handle of search
29435>>>>>// lpFindFileData  : address of structure for data on found file
29435>>>>>External_function vWin32_FindNextFile "FindNextFileA" Kernel32.dll Handle hFindFile ;          Pointer lpFindFileData Returns Integer
29436>>>>>
29436>>>>>// Courtesy Of Vincent Oorsprong
29436>>>>>//  hFindFile      : file search handle
29436>>>>>External_function vWin32_FindClose "FindClose" Kernel32.dll Handle hFindFile Returns Integer
29437>>>>>
29437>>>>>
29437>>>>>
29437>>>>>Type vFileTime
29437>>>>>  Field vFileTime.dwLowDateTime As Dword
29437>>>>>  Field vFileTime.dwHighDateTime As Dword
29437>>>>>End_Type // vFileTime
29437>>>>>
29437>>>>>
29437>>>>>Type vSystemTime
29437>>>>>  Field vSystemTime.wYear As Word
29437>>>>>  Field vSystemTime.wMonth As Word
29437>>>>>  Field vSystemTime.wDayOfWeek As Word
29437>>>>>  Field vSystemTime.wDay As Word
29437>>>>>  Field vSystemTime.wHour As Word
29437>>>>>  Field vSystemTime.wMinute As Word
29437>>>>>  Field vSystemTime.wSecond As Word
29437>>>>>  Field vSystemTime.wMilliSeconds As Word
29437>>>>>End_Type // vSystemTime
29437>>>>>
29437>>>>>
29437>>>>>// Courtesy Of Vincent Oorsprong
29437>>>>>//  lpFileTime     : pointer to file time to convert
29437>>>>>//  lpSystemTime   : pointer to structure to receive system time
29437>>>>>External_function vWin32_FileTimeToSystemTime "FileTimeToSystemTime" Kernel32.Dll ;          Pointer lpFileTime Pointer lpsystemTime Returns Integer
29438>>>>>
29438>>>>>// Courtesy Of Vincent Oorsprong
29438>>>>>// This function formats the time in a picture-string passed
29438>>>>>//
29438>>>>>// Picture      Meaning
29438>>>>>//    h         Hours with no leading zero for single-digit hours; 12-hour clock
29438>>>>>//    hh        Hours with leading zero for single-digit hours; 12-hour clock
29438>>>>>//    H         Hours with no leading zero for single-digit hours; 24-hour clock
29438>>>>>//    HH        Hours with leading zero for single-digit hours; 24-hour clock
29438>>>>>//    m         Minutes with no leading zero for single-digit minutes
29438>>>>>//    mm        Minutes with leading zero for single-digit minutes
29438>>>>>//    s         Seconds with no leading zero for single-digit seconds
29438>>>>>//    ss        Seconds with leading zero for single-digit seconds
29438>>>>>//    t         One character time marker string, such as A or P
29438>>>>>//    tt        Multicharacter time marker string, such as AM or PM
29438>>>>>//
29438>>>>>// For example, to get the time string  "11:29:40 PM"
29438>>>>>//    use the following picture string: "hh" : "mm" : "ss tt"
29438>>>>>
29438>>>>>External_function vWin32_GetTimeFormat "GetTimeFormatA" Kernel32.Dll ;  Dword LCID Dword dwFlags Pointer lpsSystemTime Pointer lpFormat Pointer lpTimeStr ;  Integer cchTime Returns Integer
29439>>>>>
29439>>>>>
29439>>>>>// Courtesy Of Vincent Oorsprong
29439>>>>>// This function formats the date in a picture-string passed
29439>>>>>//
29439>>>>>// Picture      Meaning
29439>>>>>//    d         Day of month as digits with no leading zero for single-digit days.
29439>>>>>//    dd        Day of month as digits with leading zero for single-digit days.
29439>>>>>//    ddd       Day of week as a three-letter abbreviation. The function uses the
29439>>>>>//              LOCALE_SABBREVOAYMAME value associated with the specified locale.
29439>>>>>//    dddd      Day of week as its full name. The function uses the LOCALE_SDAYNAME
29439>>>>>//              value associated with the specified locale.
29439>>>>>//    M         Month as digits with no leading zero for single-digit months.
29439>>>>>//    MM        Month as digits with leading zero for single-digit months.
29439>>>>>//    MMM       Month as a three-letter abbreviation. The function uses the
29439>>>>>//              LOCALE_SABBREVMONTHNAME value associated with the specified locale.
29439>>>>>//    MMMM      Month as its full name. The function uses the LOCALE_SMONTHNAME value
29439>>>>>//              associated with the specified locale.
29439>>>>>//    y         Year as last two digits, but with no leading zero for years less than 10.
29439>>>>>//    yy        Year as last two digits, but with leading zero for years less than 10.
29439>>>>>//    yyyy      Year represented hy full four digits.
29439>>>>>//    gg        Period/era string. The function uses the CAL_SERASTRING value associated
29439>>>>>//              with the specified locale. This element is ignored if the date to be formatted
29439>>>>>//              does not have an associated era or period string.
29439>>>>>// For example, to get the date string  "Wed, Aug 31 94"
29439>>>>>// use the following picture string:    "ddd","MMM dd yy"
29439>>>>>
29439>>>>>External_function vWin32_GetDateFormat "GetDateFormatA" Kernel32.Dll ;  Dword LCID Dword dwFlags Pointer lpsSystemTime Pointer lpFormat Pointer lpDateStr ;  Integer cchDate Returns Integer
29440>>>>>
29440>>>>>Define LOCALE_NOUSEROVERRIDE    For |CI$80000000  //  do not use user overrides
29440>>>>>Define TIME_NOMIHUTESORSECONDS  For |CI$0000000l  //  do not use minutes or seconds
29440>>>>>Define TIME_NOSECONDS           For |CI$00000002  //  do not use seconds
29440>>>>>Define TIME_NOTIMEMARKER        For |CI$00000004  //  do not use time marker
29440>>>>>Define TIME_FORCE24HOURFORMAT   For |CI$00000008  //  always use 24 hour format
29440>>>>>
29440>>>>>//  Date Flags for GetDateFormatW.
29440>>>>>//
29440>>>>>Define DATE_SHORTDATE           For |CI$0000000l  //  use short date picture
29440>>>>>Define DATE_LONGDATE            For |CI$00000002  //  use long date picture
29440>>>>>Define DATE_USE_ALT_CALENDAR    For |CI$00000004  //  use alternate calendar (if any)
29440>>>>>
29440>>>>>
29440>>>>>External_function vWin32_SetLastError "SetLastError" Kernel32.Dll Dword dwLastError Returns Integer
29441>>>>>
29441>>>>>
29441>>>>>// **WvA: 20-02-2004
29441>>>>>// While i was testing the format capabilities i stumbled over a very
29441>>>>>// weird problem where it looks like that the integer value gets somehow translated
29441>>>>>// incorrectly into an unsigned integer.
29441>>>>>// I don't have the time to dive into this.. so added a workaround (and removed it again)
29441>>>>>// It does smell a bit fishy though
29441>>>>>// Tested it with the same results on both VDF7 and VDF9.1
29441>>>>>
29441>>>>>Define SHFMT_ID_DEFAULT        For |CI$0000FFFF // The default format ID
29441>>>>>Define SHFMT_OPT_DEFAULT       For |CI$00000000 // The default "Quick Format" option.
29441>>>>>Define SHFMT_OPT_FULL          For |CI$00000001 // Deselects the "Quick Format" option, providing a full format instead. This is useful when an unformatted disk is detected.
29441>>>>>Define SHFMT_OPT_SYSONLY       For |CI$00000002 // Selects the "Create an MS-DOS startup disk" option, creating a system boot disk.
29441>>>>>
29441>>>>>// Possible errors that can be returned by the shellformat function
29441>>>>>Define SHFMT_ERROR             For (|CI$FFFFFFFF+1) // An error occurred during the last format or no drive parameter passed. This does not indicate that the disk is unformatable.
29441>>>>>Define SHFMT_CANCEL            For (|CI$FFFFFFFE+1) // The last format was canceled.
29441>>>>>Define SHFMT_NOFORMAT          For (|CI$FFFFFFFD+1) // The drive cannot be formatted.
29441>>>>>                                                
29441>>>>>
29441>>>>> // Courtesy Of Steve Walter,
29441>>>>> // USA Software, Inc
29441>>>>> // Format a disk
29441>>>>> // Called By:  Move (vWin32_ShFormatDrive(hWnd,0,$FFFF,1)) To dwReturn
29441>>>>>External_function vWin32_ShFormatDrive "SHFormatDrive" shell32.dll Handle hWnd ;         Integer iDrive Integer iFormatID Integer iOptions Returns DWORD
29442>>>>>                  
29442>>>
29442>>>
29442>>>
29442>>>
29442>>>
29442>>>//            
29442>>>// Gets the string from the right of the last sStopChar in sFrom
29442>>>// If sStopChar has no occurences in the string an empty string is
29442>>>// returned.
29442>>>Function StringFromRightOfChar Global String sFrom String sStopChar Returns String
29444>>>  String  sRetVal
29444>>>  String  sChar
29444>>>  Integer iLength
29444>>>  Integer iPos
29444>>>  Boolean bStopChar
29444>>>  Move "" To sRetval
29445>>>  Move (Length(sFrom)) To iLength
29446>>>  If ((iLength>0) And (Pos(sStopChar,sFrom) <> 0)) Begin
29448>>>    Move iLength   To iPos
29449>>>    Move (False)   To bStopChar
29450>>>    While Not bStopChar
29454>>>      Move (Mid(sFrom,1,iPos)) To sChar
29455>>>      Decrement iPos
29456>>>      If ((sChar=sStopChar) Or (iPos<1)) Begin
29458>>>        Move (True) To bStopChar
29459>>>      End
29459>>>>
29459>>>      Else Begin
29460>>>        Move (sChar+sRetVal) To sRetVal
29461>>>      End
29461>>>>
29461>>>    Loop 
29462>>>>
29462>>>  End
29462>>>>
29462>>>  Function_Return sRetVal
29463>>>End_Function // StringFromRightOfChar
29464>>>
29464>>>
29464>>>// Pre:  sFileName contains the complete path of the file.
29464>>>// Post: returns the complete path of the file.
29464>>>// This function is inspired on function SEQ_ExtractPathFromFileName of Sture Andersen.
29464>>>Function ParseFolderName Global String sFileName Returns String
29466>>>  String sFile
29466>>>  String sFolderName
29466>>>  String sDirSep // this is "\" for windows, or "/" for unix
29466>>>  MOve "" To sFolderName
29467>>>  Move (sysconf(SYSCONF_DIR_SEPARATOR)) To sDirSep
29468>>>  If sDirSep In sFileName Begin
29470>>>    Move (StringFromRightOfChar(sFileName,sDirSep)) To sFile
29471>>>    Move (Replace(sFile,sFileName,"")) To sFolderName
29472>>>  End  
29472>>>>
29472>>>  Else If ":" In sFileName Begin
29475>>>    Move (StringFromRightOfChar(sFileName,":")) To sFile
29476>>>    Move (Replace(sFile,sFileName,"")) To sFolderName
29477>>>  End  
29477>>>>
29477>>>  Function_Return sFolderName
29478>>>End_Function // ParseFolderName
29479>>>
29479>>>
29479>>>// Pre:  sFileName contains the complete path of the file.
29479>>>// post: The returned filename has it's path removed, but will have a extension
29479>>>Function ParseFileName Global String sFileName Returns String
29481>>>  String sFolderName
29481>>>  String sDirSep // this is "\" for windows, or "/" for unix
29481>>>  Move (sysconf(SYSCONF_DIR_SEPARATOR)) To sDirSep
29482>>>  Get ParseFolderName sFileName To sFolderName
29483>>>  If (sFolderName <> "") Move (Replace(sFolderName,sFileName,"")) To sFileName
29486>>>  Move (Replace(sDirSep,sFileName,"")) To sFileName
29487>>>  Function_Return sFilename
29488>>>End_Function // ParseFileName
29489>>>
29489>>>
29489>>>// Pre:  sFileName may contain the complete path of the file.
29489>>>//       or contain multiple dots in the filename, so temp.gif.bak will
29489>>>//       return "bak" as the extension and not "gif"
29489>>>// Post: returns the extension only, this extension can be a valid unixlike extension
29489>>>//       such as "html" or "java"
29489>>>Function ParseFileExtension Global String sFileName Returns String
29491>>>  String  sFileExtension
29491>>>  Get StringFromRightOfChar sFileName "." To sFileExtension
29492>>>  Function_Return sFileExtension
29493>>>End_Function // ParseFileExtension
29494>>>
29494>>>
29494>>>Define CS_DDE_ERR_UNKNOWN_LINE2   For ".\n"
29494>>>
29494>>>
29494>>>Function DDE_Error_To_String Integer iErrorID Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29496>>>  String sMessage
29496>>>  Case Begin
29496>>>    Case (iErrorID = vERROR_FILE_NOT_FOUND)
29498>>>      Move CS_DDE_ERR_FILE_NOT_FOUND To sMessage
29499>>>      Case Break
29500>>>    Case (iErrorID = vERROR_PATH_NOT_FOUND)
29503>>>      Move CS_DDE_ERR_PATH_NOT_FOUND To sMessage
29504>>>      Case Break
29505>>>    Case (iErrorID = vERROR_BAD_FORMAT)
29508>>>      Move CS_DDE_ERR_BAD_FORMAT To sMessage 
29509>>>      Case Break
29510>>>    Case (iErrorID = vSE_ERR_ACCESSDENIED)
29513>>>      Move CS_DDE_ERR_ACCESSDENIED To sMessage
29514>>>      Case Break
29515>>>    Case (iErrorID = vSE_ERR_ASSOCINCOMPLETE)
29518>>>      Move CS_DDE_ERR_ASSOCINCOMPLETE To sMessage
29519>>>      Case Break
29520>>>    Case (iErrorID = vSE_ERR_DDEBUSY)
29523>>>      Move CS_DDE_ERR_DDEBUSY To sMessage
29524>>>      Case Break
29525>>>    Case (iErrorID = vSE_ERR_DDEFAIL)
29528>>>      Move CS_DDE_ERR_DDEFAIL To sMessage
29529>>>      Case Break
29530>>>    Case (iErrorID = vSE_ERR_DDETIMEOUT)
29533>>>      Move CS_DDE_ERR_DDETIMEOUT To sMessage
29534>>>      Case Break
29535>>>    Case (iErrorID = vSE_ERR_DLLNOTFOUND)
29538>>>      Move CS_DDE_ERR_DLLNOTFOUND To sMessage
29539>>>      Case Break
29540>>>    Case (iErrorID = vSE_ERR_NOASSOC)
29543>>>      Move CS_DDE_ERR_NOASSOC To sMessage
29544>>>      Case Break
29545>>>    Case ((iErrorID = vSE_ERR_OOM) Or (iErrorID = 0))
29548>>>      Move CS_DDE_ERR_OOM To sMessage
29549>>>      Case Break
29550>>>    Case (iErrorID = vSE_ERR_PNF)
29553>>>      Move CS_DDE_ERR_PNF To sMessage
29554>>>      Case Break
29555>>>    Case (iErrorID = vSE_ERR_SHARE)
29558>>>      Move CS_DDE_ERR_SHARE To sMessage
29559>>>      Case Break
29560>>>    Case Else
29560>>>      Move CS_DDE_ERR_UNKNOWN_LINE1 To sMessage
29561>>>      Move (sMessage*Trim(iErrorID)*CS_DDE_ERR_UNKNOWN_LINE2) To sMessage
29562>>>      Case Break
29563>>>  Case End
29563>>>  Function_Return sMessage
29564>>>End_Function // DDE_Error_To_String
29565>>>
29565>>>
29565>>>Procedure vDDE_Error_Handler Integer iErrorID
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29567>>>  String sMessage
29567>>>  Get DDE_Error_To_String iErrorID To sMessage
29568>>>  Append sMessage CS_DDE_ERR_HANDL_PAKTC //  "Press a key to continue..."
29569>>>  Send Stop_Box sMessage CS_DDE_ERR_HANDL_CAPTION
29570>>>End_Procedure // vDDE_Error_Handler hInstance
29571>>>
29571>>>
29571>>>// Does the directory exist? - No = 0, Yes = 1
29571>>>// This also works with UNC path encoding and wildcards
29571>>>Function vFolderExists Global String sFolderName Returns Integer
29573>>>  String  sFolder sTmp
29573>>>  Integer bFolderExists iCh
29573>>>
29573>>>  Move dfTrue To bFolderExists
29574>>>  Move "dir:" To sFolder
29575>>>  Append sFolder sFolderName
29576>>>  Get Seq_New_Channel To iCh  // get free channel for input
29577>>>  Direct_Input Channel iCh sFolder
29579>>>    Repeat
29579>>>>
29579>>>      Readln Channel iCh sTmp
29581>>>      If (Trim(sTmp)="") Move dfFalse To bFolderExists
29584>>>      Else Begin
29585>>>        Move dfTrue To bFolderExists
29586>>>        Indicate seqeof True  // end loop
29587>>>        End
29587>>>>
29587>>>    Until (seqeof)
29589>>>  Close_Input Channel iCh
29591>>>  Send Seq_Release_Channel iCh
29592>>>  Function_Return bFolderExists
29593>>>End_Function  // vFolderExists
29594>>>
29594>>>
29594>>>// returns folder name if a folder was selected, otherwise returns ""
29594>>>Function vSHBrowseForFolder Global String sDialogTitle Returns String
29596>>>  String sFolder sBrowseInfo sTitle
29596>>>  Pointer lpItemIdList lpsFolder lpsBrowseInfo lpsTitle
29596>>>  Integer iFolderSelected iRetval
29596>>>
29596>>>  // fill string variable with null characters
29596>>>  ZeroType vtBrowseInfo To sBrowseInfo
29597>>>
29597>>>  If (sDialogTitle<>"") Begin
29599>>>    Move sDialogTitle To sTitle
29600>>>    // Torben Lund suggested converting the string with toansi. Doing it like that
29600>>>    // disables showing some commonly used ascii characters like ascii 137 ( )
29600>>>    // These chars are correctly shown if no toansi is used.
29600>>>    // I can imagine that he wanted to path to be ANSI, but as long as it isa just
29600>>>    // selected it will always be valid.
29600>>>    GetAddress Of sTitle To lpsTitle
29601>>>    Put lpsTitle To sBrowseInfo At vtBrowseInfo.lpszTitle
29602>>>  End
29602>>>>
29602>>>
29602>>>  Put vBIF_RETURNONLYFSDIRS To sBrowseInfo At vtBrowseInfo.ulFlags
29603>>>
29603>>>  // Torben Lund added line below. Move handle of focus object to structure before
29603>>>  // calling function. Otherwise, the folderdialog will be started as a seperate task.
29603>>>  Put (window_handle(focus(desktop))) To sBrowseInfo At vtBrowseInfo.hWndOwner
29604>>>
29604>>>  GetAddress Of sBrowseInfo To lpsBrowseInfo
29605>>>
29605>>>  // null 128 chars into var (make space)
29605>>>  Move (Repeat(Character(0), vMAX_PATH)) To sFolder
29606>>>  GetAddress Of sFolder To lpsFolder
29607>>>
29607>>>  // select folder
29607>>>  Move (vWin32_SHBrowseForFolder(lpsBrowseInfo)) To lpItemIdList
29608>>>  // get selected folder name
29608>>>  Move (vWin32_SHGetPathFromIDList(lpItemIdList, lpsFolder)) To iFolderSelected
29609>>>
29609>>>  // release memory resources that are used by the ItemIdList
29609>>>  Move (vWin32_CoTaskMemFree(lpItemIdList)) To iRetval
29610>>>
29610>>>  If (iFolderSelected<>0) Function_Return (CString(sFolder))
29613>>>  Else Function_Return ""
29615>>>End_Function // vSHBrowseForFolder
29616>>>
29616>>>
29616>>>// returns 0 if the folder is created.
29616>>>//         1 if the API-call returned an error.
29616>>>Function vCreateDirectory Global String sNewFolder Returns Integer
29618>>>  String  sFolder sSA
29618>>>  Pointer lpsFolder lpsSecurity_Attributes lpDescriptor
29618>>>  Integer iRetval bFolderCreated bInheritHandle
29618>>>
29618>>>  Move (False) To bFolderCreated
29619>>>  // fill string variable with null characters
29619>>>  ZeroType vtSecurity_attributes To sSA
29620>>>
29620>>>  // null MAX_PATH chars into var (make space)
29620>>>  Move (Repeat(Character(0), vMAX_PATH)) To sFolder
29621>>>
29621>>>  If (sNewFolder <> "") Begin
29623>>>
29623>>>    Move dfTrue To  bInheritHandle
29624>>>    // Setting this to NULL is already done by the zerotype command
29624>>>    // Move NULL   To  lpDescriptor
29624>>>    Put (length(sSA))   To sSA At vtSecurity_attributes.nLength
29625>>>    //Put lpDescriptor To sSA at vtSecurity_attributes.lpDescriptor
29625>>>    Put bInheritHandle To sSA At vtSecurity_attributes.bInheritHandle
29626>>>
29626>>>    GetAddress Of sSA To lpsSecurity_Attributes
29627>>>
29627>>>    //
29627>>>    Move sNewFolder To sFolder
29628>>>    GetAddress Of sFolder To lpsFolder
29629>>>    Move (vWin32_CreateDirectory(lpsFolder, lpsSecurity_Attributes)) To bFolderCreated
29630>>>  End
29630>>>>
29630>>>
29630>>>  Ifnot bFolderCreated Move 1 To iRetVal
29633>>>  Function_Return iRetVal
29634>>>End_Function // vCreateDirectory
29635>>>
29635>>>
29635>>>// **WvA: 03-02-2002 Function created.
29635>>>// With this function one can remove a directory.
29635>>>// returns 0 if the folder is removed.
29635>>>//         1 if the API-call returned an error (Use GetLastError API to get the details)
29635>>>//         2 if the folder did not exist
29635>>>//         3 if the sFolder parameter passed is equal to ""
29635>>>Function vRemoveDirectory Global String sFolder Returns Integer
29637>>>  String  sPath
29637>>>  Pointer lpsPath
29637>>>  Integer iRetval bRemoved bExists
29637>>>
29637>>>  Move (False) To bRemoved
29638>>>  Move 0 To iRetVal
29639>>>  Move (Trim(sFolder)) To sFolder
29640>>>  If (sFolder="") Begin
29642>>>    Move 3 To iRetVal
29643>>>  End
29643>>>>
29643>>>  If (vFolderExists(sFolder)=False) Begin
29645>>>    Move 2 To iRetVal
29646>>>  End
29646>>>>
29646>>>  If (iRetVal=0) Begin
29648>>>    // null MAX_PATH chars into var (make space)
29648>>>    Move (Repeat(Character(0), vMAX_PATH)) To sPath
29649>>>    //
29649>>>    Move (Insert(sFolder,sPath,1)) To sPath
29650>>>    GetAddress Of sPath To lpsPath
29651>>>    Move (vWin32_RemoveDirectory(lpsPath)) To bRemoved
29652>>>  End
29652>>>>
29652>>>
29652>>>  If ((iRetVal=0) And (bRemoved=False)) Begin
29654>>>    Move 1 To iRetVal
29655>>>  End
29655>>>>
29655>>>  Function_Return iRetVal
29656>>>End_Function // vRemoveDirectory
29657>>>
29657>>>
29657>>>
29657>>>// This function informs the user that he entered a yet unknown folder and
29657>>>// asks if he/she wants to create the folder (Yes/No)
29657>>>// Choice: "Yes" - this creates the folder
29657>>>//                 if successful, the function returns false
29657>>>//                 else it will be true.
29657>>>// Choice: "No"  - returns TRUE, This allows the programmer to take action
29657>>>//                 For example: to stop a save
29657>>>// Precondition: A foldername must be entered. We do not check for empty paths
29657>>>// This function returns a non-zero value if the folder isn't created afterwards
29657>>>Function vVerifyNewFolder Global String sFolderName Returns Integer
29659>>>  Integer bIsNotValid
29659>>>  Integer iUsers_Choice
29659>>>  String  sMessage
29659>>>
29659>>>  If (vFolderExists(sFolderName) Eq 0) Begin
29661>>>    Move "The folder '" To sMessage
29662>>>    Append sMessage sFolderName
29663>>>    Append sMessage "' does not yet exist,\n"
29664>>>    Append sMessage "Do you want to create it now?"
29665>>>    Get YesNo_Box sMessage "Confirm" MB_DefButton1 To iUsers_Choice
29666>>>    Case Begin
29666>>>      Case (iUsers_Choice = MBR_Yes)
29668>>>        Move (vCreateDirectory(sFolderName)) To bIsNotValid
29669>>>        If bIsNotValid Begin
29671>>>          Move "An error occurred while trying to create folder '" To sMessage
29672>>>          Append sMessage sFolderName "'.\n\n"
29674>>>          Send Info_Box sMessage "Info"
29675>>>          End
29675>>>>
29675>>>        Case Break
29676>>>      Case (iUsers_Choice = MBR_No)
29679>>>        Move dfTrue To bIsNotValid // Cancel the save
29680>>>        Case Break
29681>>>    Case End
29681>>>  End
29681>>>>
29681>>>  Function_Return bIsNotValid
29682>>>End_Function // vVerifyNewFolder
29683>>>
29683>>>
29683>>>// This will perform an operation on a file (e.g. open) with the application
29683>>>// registered in the Windows Registry to open that type of file (via its extension)
29683>>>// sOperation would be "OPEN" (it could also be "PRINT" etc).
29683>>>Procedure vShellExecute global String sOperation String sDocument String sParameters String sPath
29685>>>  Handle  hInstance hWnd
29685>>>  Pointer lpsOperation
29685>>>  Pointer lpsDocument
29685>>>  Pointer lpsParameters
29685>>>  Pointer lpsPath
29685>>>  // remove any leading/trailing spaces in the string
29685>>>  Move (Trim(sDocument)) To sDocument
29686>>>  Move (Trim(sPath))     To sPath
29687>>>  // Make the strings readable for windows API, by converting them to null-terminated
29687>>>  Append sOperation   (Character(0))
29688>>>  Append sDocument    (Character(0))
29689>>>  Append sParameters  (Character(0))
29690>>>  Append sPath        (Character(0))
29691>>>  // Connect the corresponding pointers to the strings
29691>>>  GetAddress Of sOperation  To lpsOperation
29692>>>  GetAddress Of sDocument   To lpsDocument
29693>>>  GetAddress Of sParameters To lpsParameters
29694>>>  GetAddress Of sPath       To lpsPath
29695>>>
29695>>>  Get Window_Handle To hWnd
29696>>>  Move (vWin32_ShellExecute (hWnd, lpsOperation, lpsDocument, lpsParameters, lpsPath, 1)) To hInstance
29697>>>  If (hInstance <= 32) Begin
29699>>>    Send vDDE_Error_Handler hInstance
29700>>>  End
29700>>>>
29700>>>End_Procedure // vShellExecute
29701>>>
29701>>>
29701>>>Class cShellFileOperations Is a Array
29702>>>
29702>>>  Procedure Construct_Object
29704>>>    Forward Send Construct_Object
29706>>>    Property Integer piDeleteFlags        Public 0
29707>>>    Property Integer piCopyFlags          Public 0
29708>>>    Property Integer piMoveFlags          Public 0
29709>>>    Property Integer piRenameFlags        Public 0
29710>>>    
29710>>>    Set piCopyFlags   To (vFOF_NOCONFIRMMKDIR Ior vFOF_NOCONFIRMATION)
29711>>>    Set piMoveFlags   To (vFOF_NOCONFIRMMKDIR Ior vFOF_NOCONFIRMATION)
29712>>>    Set piDeleteFlags To (vFOF_SILENT Ior vFOF_NOCONFIRMATION)
29713>>>    Set piRenameFlags To (vFOF_SILENT Ior vFOF_NOCONFIRMATION)
29714>>>  End_Procedure // Construct_Object
29715>>>  
29715>>>  
29715>>>  // This function uses the shell API to perform a file operation on the
29715>>>  // files supplied.
29715>>>  //
29715>>>  Function FileOperation String sSource String sDestination Integer iOperation Integer iFlags Returns Integer
29717>>>    String   sShFileOp
29717>>>    Pointer  lpShFileOp
29717>>>    Pointer  lpsSource
29717>>>    Pointer  lpsDestination
29717>>>    Integer  iRetVal
29717>>>    Integer  bUserAbort
29717>>>             
29717>>>    ZeroType vtShFileOpStruct To sShFileOp
29718>>>    Move (ToAnsi(sSource)+Character(0)+Character(0))      To sSource
29719>>>    Move (ToAnsi(sDestination)+Character(0)+Character(0)) To sDestination
29720>>>    GetAddress Of sSource    To lpsSource
29721>>>    If iOperation Ne vFO_DELETE Begin
29723>>>      GetAddress Of sDestination      To lpsDestination
29724>>>      Put lpsDestination To sShFileOp At vtShFileOpStruct.pTo
29725>>>    End  
29725>>>>
29725>>>  
29725>>>    Put iOperation     To sShFileOp At vtShFileOpStruct.wFunc
29726>>>    Put lpsSource      To sShFileOp At vtShFileOpStruct.pFrom
29727>>>    Put iFlags         To sShFileOp At vtShFileOpStruct.fFlags
29728>>>  
29728>>>    GetAddress Of sShFileOp To lpShFileOp
29729>>>  
29729>>>    Move (vWin32_SHFileOperation(lpShFileOp)) To iRetVal
29730>>>    GetBuff From sShFileOp At vtShFileOpStruct.fAnyOperationsAborted To bUserAbort
29731>>>    If (bUserAbort <> 0) Begin
29733>>>      Move 80 To iRetVal  // file Operation Aborted by USER
29734>>>    End
29734>>>>
29734>>>    Function_Return (iRetVal)
29735>>>  End_Function // FileOperation
29736>>>    
29736>>>  
29736>>>  Function sfoDeleteFile String sFileName Returns Integer
29738>>>    Integer  iRetVal
29738>>>    Integer  iFlags
29738>>>    
29738>>>    Get piDeleteFlags To iFlags
29739>>>    Get FileOperation sFileName "" vFO_DELETE iFlags To iRetVal
29740>>>    Function_Return iRetVal
29741>>>  End_Function // sfoDeleteFile
29742>>>  
29742>>>  
29742>>>  Function sfoCopyFile String sSource String sDestination Returns Integer
29744>>>    Integer  iRetVal
29744>>>    Integer  iFlags
29744>>>    
29744>>>    Get piCopyFlags To iFlags
29745>>>    Get FileOperation sSource sDestination vFO_COPY iFlags To iRetVal
29746>>>    Function_Return iRetVal
29747>>>  End_Function // sfoCopyFile
29748>>>  
29748>>>  
29748>>>  Function sfoMoveFile String sSource String sDestination Returns Integer
29750>>>    Integer  iRetVal
29750>>>    Integer  iFlags
29750>>>    
29750>>>    Get piMoveFlags To iFlags
29751>>>    Get FileOperation sSource sDestination vFO_MOVE iFlags To iRetVal
29752>>>    Function_Return iRetVal
29753>>>  End_Function // sfoMoveFile
29754>>>  
29754>>>  
29754>>>  // Rename a file or folder
29754>>>  // Returns a nonzero value if the operation failed.
29754>>>  Function sfoRenameFile String sSource String sDestination Returns Integer
29756>>>    Integer  iRetVal
29756>>>    Integer  iFlags
29756>>>    
29756>>>    Get piRenameFlags To iFlags
29757>>>    Get FileOperation sSource sDestination vFO_RENAME iFlags To iRetVal
29758>>>    Function_Return iRetVal
29759>>>  End_Function // sfoRenameFile
29760>>>
29760>>>  // Courtesy Of Steve Walter
29760>>>  // Requires Windows 2000 and up according to msdn but it was
29760>>>  //  in fact available before that as an unpublished API call
29760>>>  //  a little google search shows that this was already available
29760>>>  //  in windows 95 and NT
29760>>>  //
29760>>>  // The format is controlled by the dialog interface. 
29760>>>  // That is, the user must click the OK button To actually Begin the format
29760>>>  // the format cannot be started programmatically.
29760>>>  // An alternative to this functionality would be to use a controlpanel
29760>>>  //  http://www.vdf-guidance.com/ContribPage.asp?Page=PKGCLSDFCPLAPP&ContribRecId=93
29760>>>  //
29760>>>  // hWnd = The windows handle of the object from which the format Function
29760>>>  //        is called.
29760>>>  // To Get this,
29760>>>  //          use:  Get Window_Handle Of <object>
29760>>>  //          For instance, in this app, we're going to use the Report_Panel:
29760>>>  //                  Get Window_Handle Of (Report_Panel(Main(Self))) To hWind
29760>>>  //
29760>>>  // sDrive = The drive letter. At this moment only A and B are valid
29760>>>  //
29760>>>  // iOptions = Format options.  
29760>>>  //  SHFMT_OPT_DEFAULT = Quick format
29760>>>  //  SHFMT_OPT_FULL    = Full Format
29760>>>  //  SHFMT_OPT_SYSONLY = System only
29760>>>  //  3                 = Full format with system. (unsupported)
29760>>>  //
29760>>>  // Return Values:
29760>>>  //  SHFMT_ERROR    = Error on format or no drive specified.
29760>>>  //  SHFMT_CANCEL   = Format cancelled by user.
29760>>>  //  SHFMT_NOFORMAT = Drive is not formatable.
29760>>>  //                 
29760>>>  //
29760>>>  // *** ATTENTION: This function has been disabled as it doesn't
29760>>>  //                seem to work, i must have made a silly mistake 
29760>>>  //                somewhere.
29760>>>  //
29760>>>  Function sfoFormatDisk String sDrive Integer iOptions Returns DWORD
29762>>>    Handle   hWnd
29762>>>    Integer  iObj
29762>>>    DWORD    dwReturnVal
29762>>>    Integer iDrive
29762>>>
29762>>>    Function_Return (1) // STOP HERE
29763>>>    
29763>>>    Move (Trim(sDrive)) To sDrive
29764>>>    If ( sDrive <> '' ) Begin
29766>>>      If ( sDrive Contains ':' ) Move (Replace(':',sDrive,'')) To sDrive
29769>>>      If (Not( 'AB' Contains sDrive )) Function_Return (SHFMT_NOFORMAT)
29772>>>      If ( sDrive = 'A' ) Move 0 To iDrive
29775>>>      Else If ( sDrive = 'B' ) Move 1 To iDrive
29779>>>      // Window_Handle Of Desktop equals to 0
29779>>>      
29779>>>      Get focus Of desktop To iObj
29780>>>      If (iObj>desktop) ;          Get Container_Handle Of iObj To hWnd
29783>>>      While (hWnd=0 And iObj<>Desktop)
29787>>>          Get Parent Of iObj To iObj
29788>>>          Get Container_Handle Of iObj To hWnd
29789>>>      End
29790>>>>
29790>>>                      
29790>>>      //Showln "hWnd = " hWnd " iDrive " iDrive " iOptions " iOptions
29790>>>      Move (vWin32_ShFormatDrive(hWnd, iDrive, SHFMT_ID_DEFAULT, iOptions)) To dwReturnVal
29791>>>    End
29791>>>>
29791>>>    Else Begin
29792>>>      Move (SHFMT_ERROR) To dwReturnVal
29793>>>    End  
29793>>>>
29793>>>    Function_Return dwReturnVal
29794>>>  End_Function // sfoFormatDisk
29795>>> 
29795>>>  //Example:
29795>>>  // Get sfoFormatDisk 'A' 0 To dReturnVal    // Formats drive A in QuickFormat
29795>>>  //                                          mode.
29795>>>  
29795>>>End_Class // cShellFileOperations 
29796>>>
29796>>>
29796>>>Object oShellFileOperations Is a cShellFileOperations
29798>>>End_Object // oShellFileOperations
29799>>>  
29799>>>                                                     
29799>>>// Restore to the old way of working with the shell file operations.
29799>>>// or.. to put lay man terms, allow any of the operations vDeleteFile
29799>>>// vCopyFile/vMoveFile/vRenameFile to have an UNDO                                                     
29799>>>Procedure vWin32fhCompatibilityMode 
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29801>>>  Integer hoSFO
29801>>>  Integer iFlags
29801>>>  
29801>>>  Move (vFOF_SILENT Ior vFOF_NOCONFIRMATION Ior vFOF_ALLOWUNDO) To iFlags
29802>>>  Move (oShellFileOperations(Self)) To hoSFO
29803>>>  
29803>>>  Set piDeleteFlags Of hoSFO To iFlags
29804>>>  Set piCopyFlags   Of hoSFO To iFlags
29805>>>  Set piMoveFlags   Of hoSFO To iFlags
29806>>>  Set piRenameFlags Of hoSFO To iFlags
29807>>>End_Procedure // vWin32fhCompatibilityMode 
29808>>>
29808>>>
29808>>>Function vDeleteFile Global String sFileName Returns Integer
29810>>>  Integer  iRetVal
29810>>>
29810>>>  Get sfoDeleteFile Of (oShellFileOperations(Self)) sFileName To iRetVal
29811>>>  Function_Return iRetVal
29812>>>End_Function // vDeleteFile
29813>>>
29813>>>
29813>>>Function vCopyFile Global String sSource String sDestination Returns Integer
29815>>>  Integer  iRetVal
29815>>>  
29815>>>  Get sfoCopyFile Of (oShellFileOperations(Self)) sSource sDestination To iRetVal
29816>>>  Function_Return iRetVal
29817>>>End_Function // vCopyFile
29818>>>
29818>>>
29818>>>Function vMoveFile Global String sSource String sDestination Returns Integer
29820>>>  Integer  iRetVal
29820>>>  
29820>>>  Get sfoMoveFile Of (oShellFileOperations(Self)) sSource sDestination To iRetVal
29821>>>  Function_Return iRetVal
29822>>>End_Function // vMoveFile
29823>>>
29823>>>
29823>>>// Rename a file or folder
29823>>>// Returns a nonzero value if the operation failed.
29823>>>Function vRenameFile Global String sSource String sDestination Returns Integer
29825>>>  Integer  iRetVal
29825>>>  
29825>>>  Get sfoRenameFile Of (oShellFileOperations(Self)) sSource sDestination To iRetVal
29826>>>  Function_Return iRetVal
29827>>>End_Function // vRenameFile
29828>>>
29828>>>
29828>>>
29828>>>Function vGetWindowsDirectory Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29830>>>  String  sDirectory
29830>>>  Pointer lpDirectory
29830>>>  Integer iVoid
29830>>>
29830>>>  ZeroString vMAX_PATH To sDirectory
29831>>>  GetAddress Of sDirectory To lpDirectory
29832>>>
29832>>>  Move (vWin32_GetWindowsDirectory(lpDirectory, vMAX_PATH)) To iVoid
29833>>>  Function_Return (CString(sDirectory))  // **WvA: Changed to CString()
29834>>>End_Function // vGetWindowsDirectory
29835>>>
29835>>>
29835>>>
29835>>>
29835>>>// Courtesy of Marco Kuipers
29835>>>Function vMakeTempFile Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29837>>>    Integer iRetval
29837>>>    String  sTempPath sTempFileName sPrefixString
29837>>>    Pointer lpTempPath lpTempFileName lpPrefixString
29837>>>
29837>>>    Move (Repeat (Character (0), 255)) To sTempPath
29838>>>    GetAddress Of sTempPath To lpTempPath
29839>>>    Move (vWin32_GetTempPath (255, lpTempPath)) To iRetVal
29840>>>
29840>>>    If (sTempPath = "") Begin
29842>>>       Get_Current_Directory To sTempPath
29843>>>    End
29843>>>>
29843>>>    Move (pad(sTempPath,vMax_Path-14)) To sTempPath // *WvA: 28-04-2005 Quote from msdn: The string cannot be longer than MAX_PATH-14 characters.
29844>>>    Move (Repeat (Character (0), 255)) To sTempFileName
29845>>>    GetAddress Of sTempFileName To lpTempFileName
29846>>>    Move ("tmp"+character(0)) To sPrefixString // **WvA: 28-04-2005 Added a null
29847>>>    GetAddress Of sPrefixString To lpPrefixString
29848>>>    GetAddress Of sTempPath To lpTempPath
29849>>>    Move (vWin32_GetTempFileName (lpTempPath, lpPrefixString, 0, lpTempFileName)) To iRetval
29850>>>    If (iRetval = 0) Begin  // **WvA: 28-04-2005 Changed condition, the api call returns 0 if an error occurs
29852>>>        Move "" To sTempFileName
29853>>>    End
29853>>>>
29853>>>
29853>>>    Function_Return (Cstring(sTempFileName)) // **WvA: 28-04-2005 Cstring added
29854>>>End_Function // vMakeTempFile
29855>>>
29855>>>
29855>>>// This function creates a uniquely named temporary file in folder sPath
29855>>>// The file created will have a prefix based on the first 3 characters in sPrefix
29855>>>// Note that you will have to cleanup the tempfile yourself as the function
29855>>>// does not take care of that.
29855>>>Function vCreateTempFileInPath String sPath String sPrefix Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29857>>>    String sTempFileName
29857>>>    Integer iCnt iRetVal
29857>>>    Pointer lpTempFileName
29857>>>
29857>>>    Move (ToAnsi(sPath)+Character(0))   To sPath
29858>>>    Move (ToAnsi(sPrefix)+Character(0)) To sPrefix
29859>>>    Move (pad("", vMAX_PATH)) To sTempFileName
29860>>>    GetAddress Of sTempFileName To lpTempFileName
29861>>>
29861>>>    Move (vWin32_GetTempFileName(sPath, sPrefix, 0, lpTempFileName)) To iRetVal
29862>>>    Move (Trim(Cstring(sTempFileName))) To sTempFileName
29863>>>    Function_Return sTempFileName
29864>>>End_Function // vCreateTempFileInPath
29865>>>
29865>>>//
29865>>>// Get a specific shell folder for example to get the desktop folder
29865>>>// simply call this function and pass it vCSIDL_DESKTOP
29865>>>//
29865>>>Function vSHGetFolderPath Integer eFolder Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29867>>>  String  sFolder
29867>>>  Integer iVoid
29867>>>  Pointer lpsFolder
29867>>>  Handle  hWnd
29867>>>  Move (Window_Handle(focus(desktop))) To hWnd
29868>>>
29868>>>  Move (Repeat(Character(0), vMAX_PATH)) To sFolder
29869>>>  GetAddress Of sFolder To lpsFolder
29870>>>
29870>>>  Move (vWin32_SHGetFolderPath(hWnd,eFolder, 0, 0,lpsFolder)) To iVoid
29871>>>  Function_Return (CString(sFolder))
29872>>>End_Function // vSHGetFolderPath
29873>>>
29873>>>
29873>>>
29873>>>// Courtesy Of Vincent Oorsprong
29873>>>Function vConvertFileDateTime Global Dword dwLowDateTime Dword dwHighDateTime Returns String
29875>>>  String  sftTime sSystemTime sFormattedTime sFormattedDate
29875>>>  Pointer lpsftTime lpsSystemTime lpsFormattedTime lpsFormattedDate
29875>>>  Integer iSuccess iLenCcTime iDataLength iLenCcDate
29875>>>
29875>>>  ZeroType vFileTime  To sftTime
29876>>>  Put dwLowDateTime  To sftTime At vFileTime.dwLowDateTime
29877>>>  Put dwHighDateTime To sftTime At vFileTime.dwHighDateTime
29878>>>  GetAddress Of sftTime To lpsftTime
29879>>>
29879>>>  ZeroType vSystemTime To sSystemTime
29880>>>  GetAddress Of sSystemTime To lpsSystemTime
29881>>>
29881>>>  Moveint (vWin32_FileTimeToSystemTime (lpsftTime, lpsSystemTime)) To iSuccess
29882>>>>
29882>>>  If iSuccess Eq DfTrue Begin
29884>>>    ZeroString 255 To sFormattedTime
29885>>>    GetAddress Of sFormattedTime To lpsFormattedTime
29886>>>    Length sFormattedTime To iLenCcTime
29887>>>>
29887>>>    Moveint (vWin32_GetTimeFormat (LOCALE_USER_DEFAULT, 0, lpsSystemTime, 0, ;                             lpsFormattedTime, iLenCcTime)) To iDataLength
29888>>>>
29888>>>    ZeroString 255 To sFormattedDate
29889>>>    GetAddress Of sFormattedDate To lpsFormattedDate
29890>>>    Length sFormattedDate To iLenCcDate
29891>>>>
29891>>>    Moveint (vWin32_GetDateFormat (LOCALE_USER_DEFAULT, 0, lpsSystemTime, 0, ;                             lpsFormattedDate, iLenCcDate)) To iDataLength
29892>>>>
29892>>>    Function_Return (Cstring (sFormattedDate)  * Cstring (sFormattedTime))
29893>>>  End // iSuccess
29893>>>>
29893>>>End_Function // vConvertFileDateTime
29894>>>
29894>>>
29894>>>// **WvA Removed, See the cFileSet class for an alternative
29894>>>//Procedure DoBrowseDir String sFilePath
29894>>>//End_Procedure // DoBrowseDir
29894>>>
29894>>>// **WvA:
29894>>>// A windows replacement for the standard function FileExists.
29894>>>// This version will also return (true) for a file when it is open by an application.
29894>>>// Note that you can apply normal windows mask-signs in the filename such as * and ?
29894>>>// Example: Get vFilePathExists "C:\config.sy?"
29894>>>// This will return true if you have a file matching these conditions. (aka config.sys)
29894>>>Function vFilePathExists Global String sFilePathMask Returns Integer
29896>>>  String  sWin32FindData
29896>>>  String  sLongFileName
29896>>>  Pointer lpsFilePathMask lpsWin32FindData
29896>>>  Handle  hFindFile
29896>>>  Integer iVoid iRetval bFound
29896>>>
29896>>>  GetAddress Of sFilePathMask To lpsFilePathMask
29897>>>  ZeroType vWin32_Find_Data To sWin32FindData
29898>>>  GetAddress Of sWin32FindData To lpswin32FindData
29899>>>  Move (vWin32_FindFirstFile (lpsFilePathMask, lpsWin32FindData)) To hFindFile
29900>>>  Move (vWin32_FindClose (hFindFile)) To iVoid
29901>>>  Function_Return (hFindFile <> vINVALID_HANDLE_VALUE)
29902>>>End_Function // vFilePathExists
29903>>>
29903>>>
29903>>>// **WvA
29903>>>// Formats a foldername by first trimming it and after that by sticking a
29903>>>// directory separator (/\) to the end if it doesn't have one there already.
29903>>>// The folder may contain a drive letter or UNC encoding.
29903>>>Function vFolderFormat Global String sFolderName Returns String
29905>>>  String sDirSep
29905>>>  Move (sysconf(SYSCONF_DIR_SEPARATOR)) To sDirSep  // normally \ (backslash)
29906>>>  Move (Trim(sFolderName)) To sFolderName
29907>>>  If (Right(sFolderName,1)<>sDirSep) Begin
29909>>>    Move (sFolderName+sDirSep) To sFolderName
29910>>>  End
29910>>>>
29910>>>  Function_Return sFolderName
29911>>>End_Function // vFolderFormat   
29912>>>
29912>>>//
29912>>>// Gets the parent path of the currently supplied path
29912>>>// Returns "" when we are at the root folder.
29912>>>//
29912>>>Function vParentPath Global String sPath Returns String 
29914>>>  String sStrip
29914>>>  
29914>>>  If (Right(sPath,1)="\") Begin
29916>>>    Move (Left(sPath,Length(sPath)-1)) To sPath
29917>>>  End
29917>>>>
29917>>>  If (Pos("\",sPath)) Begin
29919>>>    Move (StringFromRightOfChar(sPath,"\")) To sStrip
29920>>>    Move (Replace(sStrip,sPath,"")) To sPath
29921>>>  End
29921>>>>
29921>>>  Else Begin
29922>>>    Move "" To sPath
29923>>>  End
29923>>>>
29923>>>  Function_Return sPath
29924>>>End_Function // vParentPath
29925>>>
29925>Use seq_chnl.pkg
29925>
29925>Use MSSQLDRV.pkg
Including file: MSSqldrv.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\MSSqldrv.pkg)
29925>>>//*****************************************************************************
29925>>>//*** MSSQLDRV.PKG                                                          ***
29925>>>//***                                                                       ***
29925>>>//*** Author: Ben Weijers                                                   ***
29925>>>//***         Data Access Nederland                                         ***
29925>>>//***         29 June 1998                                                  ***
29925>>>//***                                                                       ***
29925>>>//***                                                                       ***
29925>>>//*** Purpose:                                                              ***
29925>>>//***   Package that declares MS SQL driver constants and functions.        ***
29925>>>//****                                                                      ***
29925>>>//***   This package can be used by developers who want to add Data Access  ***
29925>>>//***   MS SQL Client specific code to a DataFlex application.              ***
29925>>>//***   Updated:  June 4th 2012 (Current CK build: 5.1.0.96)                ***
29925>>>//***             Changed EnumerateServers function to use the highest      ***
29925>>>//***             available SQL Server client driver.                       ***
29925>>>//***             Moved SQL Server client constants from cli.pkg to         ***
29925>>>//***             mssqldrv.pkg                                              ***
29925>>>//***   Updated:  November 6th 2013 (Current CK build: 6.0.0.19)            ***
29925>>>//***             Added constants for SQL Server specific native types      ***
29925>>>//***             ( var...(max) types, money types, datetime types)         ***
29925>>>//*****************************************************************************
29925>>>
29925>>>Use Cli.pkg
29925>>>Use SQL.pkg
29925>>>
29925>>>//*** Driver Indentification
29925>>>
29925>>>//*** Error number constants
29925>>>
29925>>>
29925>>>//*** Possible DF_DRIVER_SQLSERVER_CLIENT_VERSION values
29925>>>
29925>>>
29925>>>
29925>>>
29925>>>// SQL Server spcific types. 
29925>>>Define SQL_SS_TIMESTAMPOFFSET   for   (-155) //SQL server datetimeoffset type */
29925>>>Define SQL_SS_TIME2             for   (-154) //SQL server time type */
29925>>>Define SQL_SS_XML               for   (-152) //SQL server xml type */
29925>>>Define SQL_SS_VARIANT           for   (-150) //SQL server variant type */
29925>>>
29925>>>// SQL Server spcific types. 
29925>>>Define SQL_TYPE_TIMESTAMP2      for   (-200) //SQL server datetime2 type */
29925>>>Define SQL_VARCHARMAX           for   (-201) //SQL server varchar(max) type */
29925>>>Define SQL_WVARCHARMAX          for   (-202) //SQL server wvarchar(max) type */
29925>>>Define SQL_VARBINARYMAX         for   (-203) //SQL server varbinary(max) type */
29925>>>Define SQL_TYPE_MONEY           for   (-204) //SQL server money type */
29925>>>Define SQL_TYPE_SMALLMONEY      for   (-205) //SQL server smallmoney type */
29925>>>Define SQL_TYPE_SMALLDATETIME   for   (-206) //SQL server smalldatetype type */
29925>>>
29925>>>
29925>>>//*****************************************************************************
29925>>>//*** MSSQL_SetConstraint <FileNum> <ConstraintText>                        ***
29925>>>//***                                                                       ***
29925>>>//***   Setup a constraint for a file.                                      ***
29925>>>//*****************************************************************************
29925>>>
29925>>>
29925>>>
29925>>>Class cMSSQLHandler Is A cCLIHandler
29926>>>
29926>>>    Procedure Construct_Object
29928>>>        Forward Send Construct_Object
29930>>>
29930>>>        Set psDriverID To MSSQLDRV_ID
29931>>>    End_Procedure // Construct_Object
29932>>>
29932>>>
29932>>>
29932>>>    //***
29932>>>    //*** Function: ExtractList
29932>>>    //*** Purpose : Extract the list from the out connect string.
29932>>>    //***
29932>>>
29932>>>    Function ExtractList String sOutConnStr Integer hoStore Returns Integer
29934>>>        Local String  sItem
29934>>>        Local Integer iStart
29934>>>        Local Integer iEnd
29934>>>
29934>>>        If (hoStore = 0) ;            Move Current_object To hoStore
29937>>>
29937>>>        Send Delete_Data To hoStore
29938>>>        Move (Pos("{", sOutConnStr)) To iStart
29939>>>        While (iStart > 0)
29943>>>            Move (Right(sOutConnStr, Length(sOutConnStr) - iStart)) To sOutConnStr
29944>>>            If (Left(sOutConnStr, 1) = "}") ;                Move 0 To iStart
29947>>>            Else Begin
29948>>>                Move (Pos(",", sOutConnStr)) To iStart
29949>>>                Move (Pos("}", sOutConnStr)) To iEnd
29950>>>                If ((iStart = 0) Or (iEnd < iStart)) ;                    Move iEnd To iStart
29953>>>
29953>>>                If (iStart > 0) ;                    Set Value Of hoStore Item (Item_Count(Current_Object)) To (Left(sOutConnStr, iStart - 1))
29956>>>
29956>>>                If (iStart = iEnd) ;                    Move 0 To iStart
29959>>>            End
29959>>>>
29959>>>        Loop
29960>>>>
29960>>>
29960>>>        Function_Return (Item_Count(hoStore))
29961>>>    End_Procedure // ExtractList
29962>>>
29962>>>
29962>>>
29962>>>    //***
29962>>>    //*** Function: BrowseConnect
29962>>>    //*** Purpose : Call the driver's browse connect function
29962>>>    //***
29962>>>
29962>>>    Function BrowseConnect String sInConnStr Returns String
29964>>>        Local String  sDriver
29964>>>        Local String  sOutConnStr
29964>>>        Local Integer iArg
29964>>>        Local Integer iRetval
29964>>>
29964>>>        Get psDriverID To sDriver
29965>>>        If (sDriver <> "") Begin
29967>>>            Move (Repeat(" ", 8192)) To sOutConnStr
29968>>>            Call_Driver 0 sDRiver Function CLI_BROWSECONNECT Callback 0 Passing sInConnStr sOutConnStr iArg Result iRetval
29973>>>        End
29973>>>>
29973>>>
29973>>>        Function_Return sOutConnStr
29974>>>    End_Function// BrowseConnect
29975>>>
29975>>>    Function DriverIndex String sDriver Returns Integer
29977>>>    
29977>>>        Local String  sCurrentDriver
29977>>>        Local Integer iNumberOfDrivers iDriver iCount
29977>>>    
29977>>>        Move 0 to iDriver
29978>>>    
29978>>>        Get_Attribute DF_NUMBER_DRIVERS to iNumberOfDrivers
29981>>>        For iCount from 1 to iNumberOfDrivers
29987>>>>
29987>>>    
29987>>>            Get_Attribute DF_DRIVER_NAME of iCount to sCurrentDriver
29990>>>            If ( Uppercase(sCurrentDriver) = Uppercase(sDriver) ) Begin
29992>>>                Move iCount to iDriver
29993>>>            End
29993>>>>
29993>>>        Loop
29994>>>>
29994>>>    
29994>>>        Function_Return iDriver
29995>>>    
29995>>>    End_Function 
29996>>>
29996>>>    //***
29996>>>    //*** Procedure: EnumerateServers
29996>>>    //*** Purpose  : Enumerate the available SQL Server database servers
29996>>>    //***
29996>>>    Function EnumerateServers Returns Integer
29998>>>        Local String  sServerList
29998>>>        Local Integer iNumServers
29998>>>        Local Integer iDriver
29998>>>        Local Integer iClientVersion
29998>>>        Local String  sDriver
29998>>>        
29998>>>        Get DriverIndex MSSQLDRV_ID to iDriver
29999>>>        
29999>>>        Get_Attribute DF_DRIVER_SQLSERVER_CLIENT_VERSION of iDriver to iClientVersion
30002>>>        
30002>>>        If (iClientVersion = SQLSERVER2012CLIENT) Begin
30004>>>            Move SQLSERVER2012DRVRSTR to sDriver
30005>>>        End
30005>>>>
30005>>>        Else Begin
30006>>>            If (iClientVersion = SQLSERVER2008CLIENT) Begin
30008>>>                Move SQLSERVER2008DRVRSTR to sDriver
30009>>>            End  
30009>>>>
30009>>>            Else Begin
30010>>>                If (iClientVersion = SQLSERVER2005CLIENT) Begin
30012>>>                    Move SQLSERVER2005DRVRSTR to sDriver
30013>>>                End  
30013>>>>
30013>>>                Else Begin
30014>>>                    Move SQLSERVER2000DRVRSTR to sDriver 
30015>>>                End
30015>>>>
30015>>>            End
30015>>>>
30015>>>        End
30015>>>>
30015>>>
30015>>>        Move ("DRIVER={" + sDriver + "};") to sDriver
30016>>>        Get BrowseConnect sDriver to sServerList
30017>>>        Get ExtractList sServerList Current_object To iNumServers
30018>>>        Function_Return iNumServers
30019>>>    End_Function // EnumerateServers
30020>>>
30020>>>    //***
30020>>>    //*** Function: EnumerateDatabases
30020>>>    //*** Purpose : Enumerate database in a given server.
30020>>>    //***
30020>>>
30020>>>    Function EnumerateDatabases String sServer String sUser String sPassWord Returns Integer
30022>>>        Local Integer hoSQL
30022>>>        Local String  sConnect
30022>>>        Local String  sDatabase
30022>>>        Local Integer hdbc
30022>>>        Local Integer hstmt
30022>>>        Local Integer iFetchResult
30022>>>
30022>>>        If (Num_Arguments < 3) ;            Move "" To sPassWord
30025>>>        If (Num_Arguments < 2) ;            Move "" To sUser
30028>>>
30028>>>        If (sUser <> "") ;            Move ("SERVER=" + Trim(sServer) + ";UID=" + Trim(sUser) + ";PWD=" + Trim(sPassword) + ";") To sConnect
30031>>>        Else ;            Move ("SERVER=" + Trim(sServer) + ";Trusted_Connection=yes") To sConnect
30033>>>
30033>>>        Object oEnumDBSQLmanager Is A cSQLHandleManager
30035>>>            Move Current_Object To hoSQL
30036>>>        End_Object // oEnumDBSQLManager
30037>>>
30037>>>        If (hoSQL <> 0) Begin
30039>>>            Get SQLConnect Of hoSQL "MSSQLDRV" sConnect To hdbc
30040>>>            If (hdbc <> 0) Begin
30042>>>                Get SQLOpen Of hdbc To hstmt
30043>>>                If (hstmt <> 0) Begin
30045>>>                    //*** We could do a direct select on the sysdatabases table but we use
30045>>>                    //*** the stored procedure sp_database instead. SQL Server recommends this
30045>>>                    //*** approach in case meta data might change, the stored procedure will
30045>>>                    //*** stay the same.
30045>>>                    Send SQLSetProcedureName To hstmt "sp_databases"
30046>>>                    Send SQLCall To hstmt
30047>>>                    Repeat
30047>>>>
30047>>>                        Get SQLFetch Of hstmt To iFetchResult
30048>>>                        If (iFetchResult <> 0) Begin
30050>>>                            Get SQLColumnValue Of hstmt 1 To sDatabase
30051>>>                            Set Value Item (Item_Count(Current_Object)) To sDatabase
30052>>>                        End
30052>>>>
30052>>>                    Until (iFetchResult = 0)
30054>>>
30054>>>                    Send SQLClose To hstmt
30055>>>                End
30055>>>>
30055>>>                Send SQLDisconnect To hdbc
30056>>>            End
30056>>>>
30056>>>        End
30056>>>>
30056>>>        Send Destroy_Object To hoSQL
30057>>>
30057>>>        Function_return (Item_Count(Current_Object))
30058>>>    End_Function // EnumerateDatabases
30059>>>
30059>>>End_Class // cMSSQLHandler
30060>>>
30060>Use MSSQL_2WA.pkg
Including file: MSSQL_2WA.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\MSSQL_2WA.pkg)
30060>>>//-2WA
30060>>>//*******************************************************************
30060>>>// 21/03/2012 - Fernando Emiliano David Nunes - Criacao do Pacote
30060>>>//*******************************************************************
30060>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote MS-SQLSERVER
30060>>>//*******************************************************************
30060>>>
30060>>>
30060>>>//****** NO INCLUIR "MAX_ROW_FETCHED" NO .INT
30060>>>//****** SEMPRE APAGAR O .CCH PARA QUALQUER ALTERAO NO .INT
30060>>>//****** Ajudar o Banco de Dados com indices (cabeas de chave)
30060>>>
30060>>>// ***********************************
30060>>>//   EXEMPLO:
30060>>>// ***********************************
30060>>>//Object oDicionario is a c_DataDictionary    
30060>>>//
30060>>>//   FILTER_PREPARE //MANTEM OS RECURSOS DO DICIONARIO DE DADOS
30060>>>//         OR
30060>>>//   FILTER_PREPARE NOSERVER //DESATIVA OS RECURSOS DE DICIONARIO DE DADOS: PODE FICAR UM POUCO + RAPIDO
30060>>>//
30060>>>//   Procedure onFilterConstrain  
30060>>>//       FILTER_CONSTRAIN (SFormat("data BETWEEN %1 and %2"   , ToDB2Date(dDataInicial), toDB2Date(dDataFinal))) 
30060>>>//       FILTER_CONSTRAIN (SFormat("empresa BETWEEN %1 and %2", iEmpInicial, iEmpFinal))) 
30060>>>//       FILTER_CONSTRAIN (SFormat("saldo >= %1"              , ToDB2Number(nSaldo))) 
30060>>>//   End_Procedure // onFilterConstrain 
30060>>>//
30060>>>//End_Object // oDicionario
30060>>>//
30060>>>
30060>>>//EXEMPLO COM cWebReport:
30060>>>//
30060>>>//Object oRelatorio is a cWebReport_Filter
30060>>>//End_Object // oRelatorio
30060>>>//
30060>>>//
30060>>>
30060>>>//EXEMPLO COM Leitura pelo DD:
30060>>>//
30060>>>//FILTER_DATADICTIONARY_BEGIN hDD
30060>>>//    Send Request_Find of hDD FIRST_RECORD (Main_File(hDD)) iIndex
30060>>>//    Repeat
30060>>>//       If (Found) Begin
30060>>>//            if TemQueAbortarAntesDoFinal begin
30060>>>//               FILTER_DATADICTIONARY_RELEASE hDD //*******<--- IMPORTANTE
30060>>>//               procedure_return
30060>>>//            end   
30060>>>//            :
30060>>>//            : 
30060>>>//            :
30060>>>//            Send Request_Find of hDD NEXT_RECORD (Main_File(hDD)) iIndex
30060>>>//        end
30060>>>//    Until (iSai=1)
30060>>>//    Move 0 to iSai
30060>>>//FILTER_DATADICTIONARY_END hDD
30060>>>//
30060>>>Use MSSQLDRV.pkg
30060>>>//**********************************************************************************
30060>>>//  ADAPTACAO
30060>>>//**********************************************************************************
30060>>>//*** Global object handle for the manager
30060>>>Integer _embsqlghoSQLHandleMngr
30060>>>
30060>>>//***
30060>>>//*** Function: CreateSQLManager
30060>>>//*** Purpose : Create the embedded SQL manager, this is an internal function!
30060>>>//***
30060>>>
30060>>>
30060>>>
30060>>>Function CreateSQLmanager for cDesktop Returns Integer
30062>>>    Local Integer hoSQlMngr
30062>>>
30062>>>    Object oSQLHandleManager is a cSQLHandleManager
30064>>>        Move Current_object to hoSQLMngr
30065>>>    End_Object // oSQLHandleManager
30066>>>
30066>>>    Function_Return hoSQLMngr
30067>>>End_Function // CreateSQLMngr
30068>>>
30068>>>
30068>>>//*** Make sure the object is global by creating it under DESKTOP
30068>>>Get CreateSQLManager of Desktop to _embsqlghoSQLHandleMngr
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLSetConnect                                                ***
30069>>>//*** Purpose: Setup default connection information for embedded SQL.       ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLSetConnect sSDriverId sConnectString                      ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLConnect                                                   ***
30069>>>//*** Purpose: Connect to a server for embedded SQL usage.                  ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLConnect To hdbc                                           ***
30069>>>//***          SQLConnect [sDriverId sConnectString] To hdbc                ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLFileConnect                                               ***
30069>>>//*** Purpsoe: Return the handle to a connection of an open file. This      ***
30069>>>//***          connection is (obviously) already opened. We are just using  ***
30069>>>//***          the same connection for Embedded SQL. This allows the        ***
30069>>>//***          programmer not to know connection details.                   ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLFileConnect Filex To hdbc                                 ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLDisconnect                                                ***
30069>>>//*** Purpose: Connect to a server for embedded SQL usage.                  ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLDisConnect hdbc                                           ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLOpen                                                      ***
30069>>>//*** Purpose: Allocate the memory to stroe statement information.          ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLOpen hdbc To hstmt                                        ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLClose                                                     ***
30069>>>//*** Purpose: Close a statement and free all associated memory.            ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLClose hstmt                                               ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLPrepare                                                   ***
30069>>>//*** Purpose: Prepare a statement for execution.                           ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLPrepare hstmt sStatement                                  ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLExecute                                                   ***
30069>>>//*** Purpose: Execute a prepared statement                                 ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLExecute hstmt                                             ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLExecDirect                                                ***
30069>>>//*** Purpose: Prepare and execute a statement.                             ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLExecDirect hstmt sStatement                               ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLFileFetch                                                 ***
30069>>>//*** Purpose: Get a row from a statement result set.                       ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLFileFetch hstmt [To File1 [File2 ...]]                    ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLBindFetchFile                                             ***
30069>>>//*** Purpose: Binds a file number to a statement so it can be used for     ***
30069>>>//***          fetching data. Only needed in non fileconnect. Note that     ***
30069>>>//***          can be assigned to the connection or the statement handle    ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLBindFileForFetch hstmt|hdbc FileName|FileNumber           ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLFetch                                                     ***
30069>>>//*** Purpose: Get a row from a statement result set.                       ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLFetch hstmt [To Var1 [Var2 ...]]                          ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLGetData                                                   ***
30069>>>//*** Purpose: Get a column's data.                                         ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLGetData hstmt iColumnNUmber [Length iLen] To Var          ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLColumnMap                                                 ***
30069>>>//*** Purpose: Determine the column number based on the column name.        ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLColumnMap hstmt sColName To iColNumber                    ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLColAttribute                                              ***
30069>>>//*** Purpose: Get an attribute of a column in a statements result set.     ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLColAttribute hstmt iCol iAttrId To sAttrib                ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLStmtAttribute                                             ***
30069>>>//*** Purpose: Get an atribute of a statement.                              ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLStmtAttribute hstmt iAttribId To sAttrib                  ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLCall                                                      ***
30069>>>//*** Purpose: Call a stored procedure.                                     ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLCall hstmt ProcedureName SchemaName [Arg1 ...] [To Var]   ***
30069>>>//***          You can pass "" for SchemaName.                              ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLGetArguments                                              ***
30069>>>//*** Purpsoe: Get the arguments of a stored procedure. This command should ***
30069>>>//***          be used when a procedure has multiple result sets. Some      ***
30069>>>//***          backends (SQL SErver for example) will return these as the   ***
30069>>>//***          last result set. This emans you first process all other      ***
30069>>>//***          result sets and then get the arguments and return value.     ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLGetArguments hstmt [Arg1...] [To Var]                     ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLNextResultSet                                             ***
30069>>>//*** Purpose: Go the the next result set. This command should be used when ***
30069>>>//***          a procedure call results in multiple result sets. Processing ***
30069>>>//***          such procedures can be done by loping through the result     ***
30069>>>//***          sets.                                                        ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLNextResultSet hstmt                                       ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLFetchActivatesBuffer                                      ***
30069>>>//*** Purpose: Setup fetch behavior for a file. When set to true a          ***
30069>>>//***          succesfull fetch of the statement resutl set will            ***
30069>>>//***          automatically set the status of the file's bufer to          ***
30069>>>//***          DF_FILE_ACTIVE.                                              ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLFetchActivatesBuffer hstmt FileNUmber|FileName sState     ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>// *********************************************************************************
30069>>>//                         FUNCOES PARA CONVERSAO DE VALORES
30069>>>// *********************************************************************************
30069>>>Use Utils.pkg
Including file: Utils.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\Utils.pkg)
30069>>>>>//*****************************************************************
30069>>>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote
30069>>>>>//*****************************************************************
30069>>>>>//-2WA
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>    
30069>>>Use DBConvTypesMSSQL.pkg
Including file: DBConvTypesMSSQL.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\DBConvTypesMSSQL.pkg)
30069>>>>>//*****************************************************************
30069>>>>>// 21/03/2012 - Fernando Emiliano David Nunes - Criacao do Pacote
30069>>>>>//*****************************************************************
30069>>>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote
30069>>>>>//********************************************************************
30069>>>>>
30069>>>>>
30069>>>>>// *********************************************************************************
30069>>>>>//                    FUNCOES PARA CONVERSAO DE VALORES MS-SQLSERVER
30069>>>>>// *********************************************************************************
30069>>>>>
30069>>>>>Define DRIVER_DEFAULT_DATE for '1753-01-01'
30069>>>>>    
30069>>>>>Function ToSQLDate Global Date dData Returns String
30071>>>>>    If (dData = 0) Function_Return (SFormat("'%1'",DRIVER_DEFAULT_DATE))
30074>>>>>    //
30074>>>>>    String sData
30074>>>>>    Move dData to sData
30075>>>>>    //
30075>>>>>    Function_Return ("'" + mid(sData, 4, 7) + "-" +  mid(sData, 2, 4) + "-" + mid(sData, 2, 1) + "'")
30076>>>>>End_Function // ToSQLDate
30077>>>>>
30077>>>>>Function ToSQLInteger Global Integer iInteger Returns String
30079>>>>>    //
30079>>>>>    If (iInteger = 0) Function_Return "0"
30082>>>>>    Else Function_Return iInteger
30084>>>>>    //
30084>>>>>End_Function // ToSQLInteger
30085>>>>>
30085>>>>>Function ToSQLNumber Global Number nNumber Returns String
30087>>>>>    //
30087>>>>>    If (nNumber = 0) Function_Return "0"
30090>>>>>    Else Function_Return (Replaces(",",nNumber,"."))
30092>>>>>    //
30092>>>>>End_Function // ToSQLNumber
30093>>>>>
30093>>>>>
30093>>>>>Function SQLToDfDate Global String sData Returns Date
30095>>>>>    If (trim(sData = "") or sData = DRIVER_DEFAULT_DATE) Function_Return 0
30098>>>>>    else begin
30099>>>>>        If (mid(trim(sData),1,5) = "-") ; //Formato ISO,              Function_return (mid(sData, 2,9) + "/" + mid(sData, 2,6) + "/" + mid(sData, 4,1))
30102>>>>>        else ; //Formato DataFlex           Function_return sData
30104>>>>>    end    
30104>>>>>>
30104>>>>>End_Function // SQLToDfDate
30105>>>>>
30105>>>>>Function SQLToDfNum Global String sNum Returns Number
30107>>>>>    function_return (Replaces(".",sNum,","))
30108>>>>>End_Function // SQLToDfNum
30109>>>Use SqlFind.pkg
Including file: SqlFind.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\SqlFind.pkg)
30109>>>>>//*****************************************************************
30109>>>>>// 21/03/2012 - Fernando Emiliano David Nunes - Criacao do Pacote
30109>>>>>//*****************************************************************
30109>>>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote
30109>>>>>//********************************************************************
30109>>>>>
30109>>>>>//CREATE_MAIN_CONNECTION BYFILE PARAMETER    //<<<-- nao use conectar dentro do loops, ficar muito lento
30109>>>>>//       ou
30109>>>>>//CREATE_MAIN_CONNECTION "ODBC_DRV" "DSN..." //<<<-- nao use conectar dentro do loops, ficar muito lento
30109>>>>>//
30109>>>>>//  SQL_FIND_BEGIN hStmt1 "SELECT RECNUM FROM CLIENTE where qualquer coisa e ordem limit 10 "
30109>>>>>//     Clear cliente
30109>>>>>//     SQL_FIND_VALUE hStmt1 1 to cliente.recnum
30109>>>>>//     find eq cliente by recnum
30109>>>>>//    
30109>>>>>//     if (found) begin
30109>>>>>//        SQL_FIND_BEGIN hStmt2 "SELECT SUM(VALOR) FROM VENDAS where VENDA DO CLIENTE"
30109>>>>>//
30109>>>>>//           SQL_FIND_VALUE hStmt2 1 to nTotalVendas
30109>>>>>//                  ou
30109>>>>>//           move (SqlFindValue(hStmt2,1)) to nTotalVendas
30109>>>>>//
30109>>>>>//           if TemQueAbortarESairDoProcedimento begin
30109>>>>>//              SQL_FIND_RELEASE hStmt2
30109>>>>>//              procedure_Return ou function_return
30109>>>>>//           end
30109>>>>>// 
30109>>>>>//        SQL_FIND_END hstmt2
30109>>>>>//     end
30109>>>>>//  SQL_FIND_END hStmt1  
30109>>>>>//
30109>>>>>//  if (SQL_FIND_ERR) send stop_box "ERRO" 
30109>>>>>//  else send stop_box "OK"
30109>>>>>//
30109>>>>>//      ou
30109>>>>>//  
30109>>>>>//  SQL_EXECUTE hStmt1  "INSERT INTO...."
30109>>>>>//
30109>>>>>//  if (ERR) send stop_box "ERRO"
30109>>>>>//  else send stop_box "OK"
30109>>>>>//
30109>>>>>//CLOSE_MAIN_CONNECTION 
30109>>>>>
30109>>>>>
30109>>>>>//EXEMPLO loop com SQL_FIND_TABLE_BEGIN
30109>>>>>//
30109>>>>>//SQL_FIND_TABLE_BEGIN PEDIDO by 9 WHERE ;
30109>>>>>//    (SFormat("CD_EMPRESA2 = %1 and SIGLA_PEDIDO = '%2' and SEQ_PEDIDO = %3 and ANO_PEDIDO = %4 and FLAG_LIBERADO <> 'L'", ;
30109>>>>>//            ROTEIRO.CD_EMPRESA, ROTEIRO.SIGLA_ROTEIRO, ROTEIRO.SEQ_ROTEIRO, ROTEIRO.ANO_ROTEIRO)) //LIMIT 1 - Opcional
30109>>>>>//
30109>>>>>//    :
30109>>>>>//    :
30109>>>>>//    :
30109>>>>>//    if TemQueAbortarESairDoProcedimento begin
30109>>>>>//        SQL_FIND_TABLE_RELEASE PEDIDO
30109>>>>>//        procedure_Return
30109>>>>>//    end
30109>>>>>//    :
30109>>>>>//    :
30109>>>>>//    if TemQuePararLoop SQL_FIND_TABLE_BREAK PEDIDO
30109>>>>>//    
30109>>>>>//    
30109>>>>>//SQL_FIND_TABLE_END PEDIDO
30109>>>>>//
30109>>>>>
30109>>>>>
30109>>>>>Use Utils.pkg
30109>>>>>Use Sql.pkg
30109>>>>>Use DBConvTypesMSSQL.pkg
30109>>>>>Use DebugLog.pkg
Including file: DebugLog.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\DebugLog.pkg)
30109>>>>>>>//-2WA
30109>>>>>>>//********************************************************************
30109>>>>>>>// 21/03/2012 - Fernando Emiliano David Nunes - Criacao do Pacote
30109>>>>>>>//********************************************************************
30109>>>>>>>// 03/04/2013 - Fernando Emiliano David Nunes - Atualizacao do Pacote
30109>>>>>>>//********************************************************************
30109>>>>>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote
30109>>>>>>>//********************************************************************
30109>>>>>>>
30109>>>>>>>Use seq_chnl.pkg
30109>>>>>>>Declare_Datafile TSMG800
Including file: TSMG800.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\TSMG800.fd)
30109>>>>>>>
30109>>>>>>>Function InDebug Returns Boolean
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30111>>>>>>>    Open TSMG800
30113>>>>>>>    Function_Return (TSMG800.LOGQUERY_YN = "D") //(D)EBUG
30114>>>>>>>End_Function // InDebug
30115>>>>>>>
30115>>>>>>>Function DebugLogFileName Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30117>>>>>>>   String sApplicationFileName
30117>>>>>>>   
30117>>>>>>>   Register_Object oApplication
30117>>>>>>>   Get GetApplicationFileName of oApplication to sApplicationFileName
30118>>>>>>>   Move (Replaces(".exe", sApplicationFileName, "")) to sApplicationFileName
30119>>>>>>>   
30119>>>>>>>   Function_Return (sApplicationFileName+"_DEBUG.log")    
30120>>>>>>>End_Function // DebugLogFileName
30121>>>>>>> 
30121>>>>>>>Procedure WriteDebugLogTrim Handle hoSender String sTextLog //Fernando Nunes, 02/04/2013
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30123>>>>>>>    Integer iChOut
30123>>>>>>>    String sApplicationFileName
30123>>>>>>>    
30123>>>>>>>    Register_Object oApplication
30123>>>>>>>    Get GetApplicationFileName of oApplication to sApplicationFileName
30124>>>>>>>    
30124>>>>>>>    Move (Seq_New_Channel()) to iChOut
30125>>>>>>>    
30125>>>>>>>    //Vou Gerar um log com a STATEMENT utilizada no filtro dentro da pasta PROGRAMS da Workspace.
30125>>>>>>>    Append_Output channel iChOut (Replaces("_DEBUG.", DebugLogFileName(Self), "_DEBUG_RevomeTrim."))
30127>>>>>>>       Writeln channel iChOut (SFormat('[%1] %2.%3', CurrentDateTime(), Name(hoSender), sTextLog))
30130>>>>>>>    Close_Output channel iChOut  
30132>>>>>>>    
30132>>>>>>>    Send Seq_Release_Channel iChOut 
30133>>>>>>>    
30133>>>>>>>End_Procedure // WriteDebugLogTrim
30134>>>>>>>
30134>>>>>>>Procedure WriteDebugLog Overloaded Handle hoSender String sTextLog Boolean bWriteHTML //Fernando Nunes, 02/04/2013
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30137>>>>>>>    Integer iChOut
30137>>>>>>>    String sApplicationFileName
30137>>>>>>>    
30137>>>>>>>    If (not(InDebug(Self))) Procedure_Return
30140>>>>>>>    
30140>>>>>>>    Register_Object oApplication
30140>>>>>>>    Get GetApplicationFileName of oApplication to sApplicationFileName
30141>>>>>>>    
30141>>>>>>>    Move (Seq_New_Channel()) to iChOut
30142>>>>>>>    
30142>>>>>>>    //Vou Gerar um log com a STATEMENT utilizada no filtro dentro da pasta PROGRAMS da Workspace.
30142>>>>>>>    Append_Output channel iChOut (DebugLogFileName(Self))
30144>>>>>>>       Writeln channel iChOut (SFormat('[%1] %2.%3', CurrentDateTime(), Name(hoSender), sTextLog))
30147>>>>>>>    Close_Output channel iChOut  
30149>>>>>>>    
30149>>>>>>>    Send Seq_Release_Channel iChOut 
30150>>>>>>>    
30150>>>>>>>    If (bWriteHTML) Send WriteHtml (SFormat('[%1] %2.%3<BR>', DebugLogFileName(Self), Name(hoSender), sTextLog ))   
30153>>>>>>>End_Procedure // WriteDebugLog
30154>>>>>>>
30154>>>>>>>Procedure WriteDebugLog Overloaded Handle hoSender String sTextLog  //Fernando Nunes, 02/04/2013
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30157>>>>>>>    Send WriteDebugLog hoSender sTextLog False
30158>>>>>>>End_Procedure // WriteDebugLog
30159>>>>>>>
30159>>>>>>>//Procedure WriteDebugLogToHTML Handle hoSender String sTextLog
30159>>>>>>>//   Send WriteHtml (SFormat('<BR>[%1] %2.%3<BR><BR>', DebugLogFileName(), Name(hoSender), sTextLog ))
30159>>>>>>>//End_Procedure // WriteDebugLogToHTML
30159>>>>>>>//
30159>>>>>>>//Procedure WriteDebugLog Handle hoSender String sTextLog
30159>>>>>>>//    Send WriteDebugLogToHTML hoSender sTextLog
30159>>>>>>>//    Send WriteDebugLogToFile hoSender sTextLog
30159>>>>>>>//End_Procedure // WriteDebugLog
30159>>>>>>>
30159>>>>>>>
30159>>>>>>>Function SQLRemoveTrim  String sStmt Boolean bOnlyAfterWhere Handle hoSender Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30161>>>>>>>    String sResult sParteWhere
30161>>>>>>>    Integer iPosWhere iPosRisco iPosTrim
30161>>>>>>>    Date dData 
30161>>>>>>>    Integer iHora iMinuto
30161>>>>>>>    Boolean bAtivar
30161>>>>>>>    
30161>>>>>>>    Sysdate dData iHora iMinuto
30164>>>>>>>    
30164>>>>>>>    
30164>>>>>>>    //Move ((dData >= Date("05/04/2013") and dData <= Date("09/04/2013"))  and (iHora = 16)) to bAtivar
30164>>>>>>>    
30164>>>>>>>    //---  LOG DESLIGADO
30164>>>>>>>    Move (False) to bAtivar
30165>>>>>>>    
30165>>>>>>>    If (bOnlyAfterWhere) ;        Move (Pos("WHERE", Uppercase(sStmt))) to iPosWhere
30168>>>>>>>    Else ;        Move 1 to iPosWhere
30170>>>>>>>    
30170>>>>>>>    If (iPosWhere > 0 or not(bOnlyAfterWhere)) Begin
30172>>>>>>>       If (bOnlyAfterWhere) ;          Move (Mid(sStmt, iPosWhere-1, 1)) to sResult
30175>>>>>>>       Else ;          Move "" to sResult
30177>>>>>>>             
30177>>>>>>>       Move (Mid(sStmt, (length(sStmt) - iPosWhere)+1, iPosWhere)) to sParteWhere
30178>>>>>>>
30178>>>>>>>       Move (Pos("TRIM", Uppercase(sParteWhere))) to iPosTrim
30179>>>>>>>       
30179>>>>>>>       If (iPosTrim > 0) Begin
30181>>>>>>>           //Send WriteDebugLogTrim Self (SFormat('SQLRemoveTrim.%2.Original="%1"',sStmt, If(bAtivar, "ATIVADO", "DESATIVADO")))
30181>>>>>>>           
30181>>>>>>>           If (bAtivar) Begin
30183>>>>>>>                                  Move (Pos("LIKE", Uppercase(sStmt))) to iPosRisco
30184>>>>>>>               If (iPosRisco = 0) Move (Pos("||", Uppercase(sStmt)))   to iPosRisco
30187>>>>>>>            
30187>>>>>>>               If (iPosRisco = 0) Begin
30189>>>>>>>                   Move (Replaces("LTRIM(",sParteWhere,"(")) to sParteWhere
30190>>>>>>>                   Move (Replaces("LTrim(",sParteWhere,"(")) to sParteWhere
30191>>>>>>>                   Move (Replaces("Ltrim(",sParteWhere,"(")) to sParteWhere
30192>>>>>>>                   Move (Replaces("ltrim(",sParteWhere,"(")) to sParteWhere
30193>>>>>>>                   
30193>>>>>>>                   Move (Replaces("RTRIM(",sParteWhere,"(")) to sParteWhere
30194>>>>>>>                   Move (Replaces("RTrim(",sParteWhere,"(")) to sParteWhere
30195>>>>>>>                   Move (Replaces("Rtrim(",sParteWhere,"(")) to sParteWhere
30196>>>>>>>                   Move (Replaces("rtrim(",sParteWhere,"(")) to sParteWhere
30197>>>>>>>                   
30197>>>>>>>                   Move (Replaces("TRIM(",sParteWhere,"(")) to sParteWhere
30198>>>>>>>                   Move (Replaces("Trim(",sParteWhere,"(")) to sParteWhere
30199>>>>>>>                   Move (Replaces("trim(",sParteWhere,"(")) to sParteWhere
30200>>>>>>>                   
30200>>>>>>>                   Move (sResult + sParteWhere) to sResult
30201>>>>>>>                   
30201>>>>>>>                   Send WriteDebugLogTrim Self (SFormat('SQLRemoveTrim.%2.Modificado="%1"',sResult, If(bAtivar, "ATIVADO", "DESATIVADO")))                   
30202>>>>>>>                   Function_Return sResult
30203>>>>>>>               End
30203>>>>>>>>
30203>>>>>>>           End
30203>>>>>>>>
30203>>>>>>>       End
30203>>>>>>>>
30203>>>>>>>    End
30203>>>>>>>>
30203>>>>>>>    
30203>>>>>>>    Function_Return sStmt 
30204>>>>>>>    
30204>>>>>>>End_Function // SQLRemoveTrim
30205>>>>>
30205>>>>>Handle ghMainConnection //Global
30205>>>>>Integer giOldFetch
30205>>>>>
30205>>>>>Boolean SQL_FIND_ERR
30205>>>>>Boolean SQL_STATEMENT_ERR
30205>>>>>
30205>>>>>
30205>>>>>//
30205>>>>>//*******************************************************************************************************************
30205>>>>>//--- ALTEREI ESSA MACRO PARA NO FORAR O FECHAMENTO DA CONEXO DEVIDO A PROBLEMAS QUE PODERIAM SER CAUSADOS       *
30205>>>>>//--- PELAS INCLUDES. UM EXEMPLO SERIA UMA PROCEDURE COM CREATE E CLOSE MAIN CONNECTION QUE FOSSE CHAMADA DENTRO DE *
30205>>>>>//--- UM SQL_FIND_BEGIN, AO TERMINAR AO TENTAR ABRIR A CONEXO DA PROCEDURE FORARIA O FECHAMENTO DA CONEXO ATUAL  *
30205>>>>>//--- QUE  A DO SQL_FIND, CAUSANDO UMA PERDA DESSA PRIMEIRA CONEXO. DANIEL. 09/04/2012                            *
30205>>>>>//*******************************************************************************************************************
30205>>>>>//                                                                                                                  
30205>>>>>//#COMMAND CREATE_MAIN_CONNECTION //"BYFILE" ""
30205>>>>>//    If (ghMainConnection <> 0) Begin
30205>>>>>//       CLOSE_MAIN_CONNECTION
30205>>>>>//    End
30205>>>>>//    //
30205>>>>>//    #IFSAME !1 BYFILE
30205>>>>>//        Open !2
30205>>>>>//        Get SQLFileConnect of _embsqlghoSQLHandleMngr !2.file_number to ghMainConnection
30205>>>>>//    #ELSE
30205>>>>>//        Get SQLConnect of _embsqlghoSQLHandleMngr !1 !2 to ghMainConnection
30205>>>>>//    #ENDIF
30205>>>>>//#ENDCOMMAND
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>    
30205>>>>>
30205>>>>>    
30205>>>>>
30205>>>>>
30205>>>>>//#COMMAND SQL_FIND_BEGIN R R "BUFFER_TO"""
30205>>>>>
30205>>>>>//#COMMAND SQL_FIND_BREAK R  
30205>>>>>//    Move (True) to bBreak!1
30205>>>>>//#ENDCOMMAND
30205>>>>>
30205>>>>>
30205>>>>>Function SqlFind_ConvertToDFType Integer iDFType String sValor Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30207>>>>>    
30207>>>>>    If (iDFType = DF_Date) Begin
30209>>>>>       Move (SQLToDfDate(sValor)) to sValor
30210>>>>>    End
30210>>>>>>
30210>>>>>     
30210>>>>>    If (iDFType = DF_BCD) Begin
30212>>>>>       Move (SQLToDfNum(sValor)) to sValor
30213>>>>>    End
30213>>>>>>
30213>>>>>     
30213>>>>>    Function_Return sValor
30214>>>>>End_Function // SqlFind_ConvertToDFType 
30215>>>>>
30215>>>>>Function SqlFindValue Global Handle hStmt Integer iColumn Returns String
30217>>>>>    String sResult
30217>>>>>    //
30217>>>>>    Get SqlFind_ConvertToDFType (SQLColAttribute(hStmt, iColumn, SQLCOLATTRIB_DFTYPE)) (SQLColumnValue(hStmt,iColumn)) to sResult
30218>>>>>    //
30218>>>>>    Function_Return sResult
30219>>>>>End_Function // SqlFindValue
30220>>>>>
30220>>>>>Function SqlFindValueByName Global Handle hStmt String sColumnName Returns String
30222>>>>>    Function_Return (SqlFindValue(hStmt, SQLColumnMap(hStmt, sColumnName))) 
30223>>>>>End_Function // SqlFindValueByName
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>//**#COMMAND SAVE_SQL R
30224>>>>>//**    API_SAVERECORD !1 !2 !3 !4 !5 !6 !7 !8 !9    
30224>>>>>//**#ENDCOMMAND 
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>Use DebugLog.pkg
30224>>>
30224>>>// *********************************************************************************
30224>>>//   MACRO PARA SEREM USADAS NA CLASSE TDICTIONARY DOS RELATORIO QUE USAM CONSTRAIN 
30224>>>// *********************************************************************************
30224>>>
30224>>>register_Procedure BackupFilterState
30224>>>register_Procedure RestoreFilterState
30224>>>register_Procedure Set pbFilter_ACTIVE Boolean bON
30224>>>Register_Function isFilter_No_Server Returns Boolean  
30224>>>
30224>>>
30224>>>
30224>>>//Inicio da Instancia do DD do cWebReport
30224>>>
30224>>>
30224>>>
30224>>>//Dentro de onContrain
30224>>>
30224>>>
30224>>>
30224>>>
30224>>>
30224>>>
30224>>>
30224>>>// *********************************************************************************
30224>>>//   CLASSE EXTENDIDAS PARA USO DO FILTER_CONTRAIN 
30224>>>// *********************************************************************************
30224>>>// 
30224>>>
30224>>>//#COMMAND DoRunReport_REDEFINE
30224>>>//    Function DoRunReport Returns Integer
30224>>>//        Integer iResult
30224>>>//        Handle hDD
30224>>>//        Integer iBkp 
30224>>>//        Boolean bFilterNoServer
30224>>>//        //
30224>>>//        Get Server to hDD
30224>>>//        //
30224>>>//        If hDD Set pbFilter_ACTIVE of (Server(Self)) to True
30224>>>//        //   
30224>>>//        Get pbFilter_No_Server of (Server(Self)) to bFilterNoServer
30224>>>//        //
30224>>>//        If bFilterNoServer Begin
30224>>>//           Get No_Constrained_Find_State to iBkp
30224>>>//           Set No_Constrained_Find_State to False
30224>>>//           //  
30224>>>//           Set Server to 0 //A classe reportDS, trabalhar direto com o buffer
30224>>>//        End
30224>>>//        //
30224>>>//        Forward Get DoRunReport to iResult
30224>>>//        //  
30224>>>//        If bFilterNoServer Begin
30224>>>//           Set Server to hDD //A classe reportDS, volta a trabalhar conectado com DD
30224>>>//           Set No_Constrained_Find_State to iBkp
30224>>>//        End
30224>>>//        //
30224>>>//        If hDD Set pbFilter_ACTIVE of (Server(Self)) to False
30224>>>//        //
30224>>>//        Function_Return iResult
30224>>>//    End_Function //DoRunReport
30224>>>//#ENDCOMMAND
30224>>>
30224>>>
30224>>>Use cReportDS.pkg
30224>>>Use cHtmlReport.pkg
30224>>>Use cWebReport.pkg
30224>>>Use cAutoWebReport.pkg
Including file: cAutoWebreport.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\cAutoWebreport.pkg)
30224>>>>>//****************************************************************************//
30224>>>>>//                                                                            //
30224>>>>>// $File name  : cAutoWebReport.PKG                                           //
30224>>>>>// $File title : cAutoWebreport class                                         //
30224>>>>>// $Author     : John Tuohy                                                   //
30224>>>>>//                                                                            //
30224>>>>>// Confidential Trade Secret.                                                 //
30224>>>>>// Copyright 1999 Data Access Corporation, Miami FL, USA                      //
30224>>>>>// All Rights reserved                                                        //
30224>>>>>// DataFlex is a registered trademark of Data Access Corporation.             //
30224>>>>>//                                                                            //
30224>>>>>//                                                                            //
30224>>>>>// $Rev History                                                               //
30224>>>>>//   8/12/98 jjt - created                                                    //
30224>>>>>//                                                                            //
30224>>>>>//****************************************************************************//
30224>>>>>Use cWebReport.pkg
30224>>>>>
30224>>>>>Class cAutoWebReport is a cWebReport
30225>>>>>
30225>>>>>    Procedure Construct_Object
30227>>>>>        Forward send construct_object
30229>>>>>        Delegate Set phAutoWebReport to self
30231>>>>>        Property Boolean pbUseRowIds True
30232>>>>>        // If an auto-report is created, register it in its parent WBO
30232>>>>>        Send RegisterInterface get_AutoReport "get_AutoReport" "string sTable integer iIndex String hRef Integer iMax Integer iStart returns integer" ;                                              "Obsolete (use AutoReport1). Create an auto-report for every field in the DD"
30233>>>>>    End_Procedure
30234>>>>>
30234>>>>>    Procedure OnPageTop
30236>>>>>        integer iFile iFields iField iType
30236>>>>>        integer hDD
30236>>>>>        string sValue sAlign
30236>>>>>        Get server to hDD
30237>>>>>        Get Main_file of hDD to iFile
30238>>>>>        Get_Attribute DF_FILE_NUMBER_FIELDS of iFile to iFields
30241>>>>>
30241>>>>>        Send WriteHtmlTableBegin 'Class="ReportTable"'
30242>>>>>
30242>>>>>        Send WriteHtmlRowBegin
30243>>>>>        For iField from 1 to iFields
30249>>>>>>
30249>>>>>            Get_Attribute DF_FIELD_TYPE of iFile iField to iType
30252>>>>>            If (iType<>DF_OVERLAP and iType<>DF_BINARY) Begin
30254>>>>>                Case Begin
30254>>>>>                    Case (iType=DF_BCD)  move '"right"' to sAlign
30257>>>>>                    Case (iType=DF_TEXT) Move '"left" width="40%"' to sAlign
30261>>>>>                    Case (iType=DF_Date or iType=DF_DateTime) Move '"center"' to sAlign
30265>>>>>                    Case else            Move '"left"' to sAlign
30267>>>>>                Case End
30267>>>>>                Move ('align='-sAlign * 'vAlign="top" bgcolor="Silver" Class="Header"') to sAlign
30268>>>>>                Get File_Field_Label of hDD iFile iField DD_LABEL_SHORT to sValue
30269>>>>>                Send WriteHtmlCellHeader (HtmlEncode(sValue)) sAlign
30270>>>>>            End
30270>>>>>>
30270>>>>>        Loop
30271>>>>>>
30271>>>>>        Send WriteHtmlRowEnd
30272>>>>>    End_Procedure
30273>>>>>
30273>>>>>    Procedure OnBody
30275>>>>>        integer iFile iFields iField iType iPoints
30275>>>>>        integer hDD
30275>>>>>        string sValue sAlign
30275>>>>>        Boolean bUseRowIds
30275>>>>>        Get server to hDD
30276>>>>>        Get Main_file of hDD to iFile
30277>>>>>        Get_Attribute DF_FILE_NUMBER_FIELDS of iFile to iFields
30280>>>>>        Get pbUseRowIds to bUseRowIds
30281>>>>>
30281>>>>>        Send WriteHtmlRowBegin
30282>>>>>        For iField from 1 to iFields
30288>>>>>>
30288>>>>>            Get_Attribute DF_FIELD_TYPE of iFile iField to iType
30291>>>>>            If (iType<>DF_OVERLAP and iType<>DF_BINARY) Begin
30293>>>>>                Case Begin
30293>>>>>                    Case (iType=DF_BCD)  move '"right"' to sAlign
30296>>>>>                    Case (iType=DF_TEXT) Move '"left" width="40%"' to sAlign
30300>>>>>                    Case (iType=DF_Date or iType=DF_Datetime) Move '"center"' to sAlign
30304>>>>>                    Case else            Move '"left"' to sAlign
30306>>>>>                Case End
30306>>>>>                Move ('align='-sAlign * 'vAlign="top" Class="Data"')  to sAlign
30307>>>>>                If (iType<>DF_Text) ;                    Get File_Field_Current_Description of hDD iFile iField to sValue
30310>>>>>                Else ;                    Get File_Field_Current_Value of hDD iFile iField to sValue
30312>>>>>
30312>>>>>                If (iType=DF_BCD) Begin
30314>>>>>                    Get_Attribute DF_FIELD_PRECISION of iFile iField to iPoints
30317>>>>>                    Move (FormatNumber(sValue,iPoints)) to sValue
30318>>>>>                end
30318>>>>>>
30318>>>>>                else ;                    get HtmlEncode sValue to sValue
30320>>>>>                //
30320>>>>>                If (iField=1) Begin
30322>>>>>                    If bUseRowIds begin
30324>>>>>                        Get AddRowIdLink sValue to sValue //
30325>>>>>                    end
30325>>>>>>
30325>>>>>                    else begin                             // we must support old because pages may be
30326>>>>>                        Get AddRecordLink sValue to sValue // created that need recnum
30327>>>>>                    end
30327>>>>>>
30327>>>>>                end
30327>>>>>>
30327>>>>>                //
30327>>>>>                Send WriteHtmlCell  sValue sAlign
30328>>>>>            End
30328>>>>>>
30328>>>>>        Loop
30329>>>>>>
30329>>>>>        Send WriteHtmlRowEnd
30330>>>>>    End_Procedure
30331>>>>>
30331>>>>>    Procedure OnPageBottom
30333>>>>>        Send WriteHtmlTableEnd
30334>>>>>    End_Procedure
30335>>>>>
30335>>>>>    Function DoAutoReport integer iIndex string sHref integer iMax integer iStart Returns integer
30337>>>>>        boolean bUseRowIdsOld
30337>>>>>        If (Server(self)=0) Begin
30339>>>>>            Error DFERR_PROGRAM C_$NoDDOForReport
30340>>>>>>
30340>>>>>            Function_return 0
30341>>>>>        end
30341>>>>>>
30341>>>>>        Get pbUseRowIds to bUseRowIdsOld
30342>>>>>        Set pbUseRowIds to False
30343>>>>>        Set piMaxCount to iMax
30344>>>>>        Set priStartRowId to (NullRowId())
30345>>>>>        Set piStartRecord to iStart
30346>>>>>        Set piOrdering to iIndex
30347>>>>>        set psHRefName to sHref
30348>>>>>        Send Run_Report
30349>>>>>        Set pbUseRowIds to bUseRowIdsOld
30350>>>>>        Function_return (piLastRecord(self))
30351>>>>>    End_Function
30352>>>>>
30352>>>>>    Function DoAutoReport1 integer iIndex string sHref integer iMax String sStart Returns string
30354>>>>>        boolean bUseRowIdsOld
30354>>>>>        RowId riLast
30354>>>>>        string sLast
30354>>>>>        If (Server(self)=0) Begin
30356>>>>>            Error DFERR_PROGRAM C_$NoDDOForReport
30357>>>>>>
30357>>>>>            Function_return ""
30358>>>>>        end
30358>>>>>>
30358>>>>>        Get pbUseRowIds to bUseRowIdsOld
30359>>>>>        Set pbUseRowIds to True
30360>>>>>        Set piMaxCount to iMax
30361>>>>>        Set priStartRowId to (if(sStart="", NullRowId(), DeserializeRowId(sStart)))
30362>>>>>        Set piStartRecord to 0
30363>>>>>        Set piOrdering to iIndex
30364>>>>>        set psHRefName to sHref
30365>>>>>        Send Run_Report
30366>>>>>        Get priLastRowId to riLast
30367>>>>>        Move (if(isNullRowId(riLast), "", SerializeRowId(riLast) )) to sLast
30368>>>>>        Set pbUseRowIds to bUseRowIdsOld
30369>>>>>        Function_return sLast
30370>>>>>    End_Function
30371>>>>>
30371>>>>>
30371>>>>>End_Class
30372>>>//
30372>>>Class cReportDS_Filter is a cReportDS
30373>>>    DoRunReport_REDEFINE
30398>>>End_Class // cReportDS_Filter
30399>>>
30399>>>Class cHtmlReport_Filter is a cHtmlReport
30400>>>    DoRunReport_REDEFINE
30425>>>End_Class // cHtmlReport_Filter
30426>>>
30426>>>Class cWebReport_Filter is a cWebReport
30427>>>    DoRunReport_REDEFINE
30452>>>End_Class // cWebReport_Filter
30453>>>
30453>>>Class cAutoWebReport_Filter is a cAutoWebReport
30454>>>    DoRunReport_REDEFINE
30479>>>End_Class // cAutoWebReport_Filter
30480>>>
30480>
30480>Use btGlobal.pkg
Including file: btGlobal.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\btGlobal.pkg)
30480>>>//-2WA
30480>>>//------------------------------------------------------------------------
30480>>>// Estruturas utilizadas pelo sistema
30480>>>//------------------------------------------------------------------------
30480>>>    Struct stDefaultValues
30480>>>        String id
30480>>>        String label
30480>>>        String value
30480>>>        String recId
30480>>>    End_Struct //stDefaultValues
30480>>>
30480>>>    Struct stDefaultMessage
30480>>>        Boolean hasError
30480>>>         String msgError
30480>>>         String msgInfo
30480>>>         String msgSession
30480>>>         String msgStep
30480>>>    End_Struct //stDefaultMessage
30480>>>
30480>>>    Struct stCampos
30480>>>        String  id
30480>>>        String  data
30480>>>        String  title
30480>>>        Boolean sortable
30480>>>        Boolean visible
30480>>>    End_Struct // stCampos
30480>>>    
30480>>>    Struct stIdValueClasse
30480>>>        String id
30480>>>        String value
30480>>>        String classe
30480>>>    End_Struct //stIdValueClasse
30480>>>
30480>>>    Struct stIdValue
30480>>>        String id
30480>>>        String value
30480>>>    End_Struct //stIdValue
30480>>>    
30480>>>    Struct stIdValue_I
30480>>>        Integer id
30480>>>        String value
30480>>>    End_Struct //stIdValue
30480>>>    
30480>>>    Struct stIdValueURL
30480>>>        stDefaultMessage msg
30480>>>        stDefaultMessage msg
30480>>>        Integer id
30480>>>         String value
30480>>>         String url
30480>>>         String size
30480>>>         String tipoDoc
30480>>>    End_Struct //stIdValueURL
30480>>>
30480>>>    Struct stCombo
30480>>>        String ID
30480>>>        String DS
30480>>>        String DS2
30480>>>    End_Struct //stCombo
30480>>>    
30480>>>    Struct stDate
30480>>>        Date value
30480>>>        String type //'date'
30480>>>    End_Struct //stDate
30480>>>
30480>>>    Struct stValueType
30480>>>        String value
30480>>>        String type //'ico'
30480>>>    End_Struct //stValueType
30480>>>
30480>>>    Struct stDefaultMsgRecId
30480>>>        stDefaultMessage defaultMessage
30480>>>        stDefaultMessage defaultMessage
30480>>>                  String recId
30480>>>    End_Struct //stDefaultMsgRecId
30480>>>
30480>>>    Struct stTaxas
30480>>>        String id
30480>>>        String value
30480>>>        String value2
30480>>>        String classe
30480>>>    End_Struct //stTaxas
30480>>>
30480>>>    Struct stTaxasPorProduto
30480>>>        String id
30480>>>        String value
30480>>>        String classe
30480>>>        String produto
30480>>>    End_Struct //stTaxasPorProduto
30480>>>    
30480>>>    Struct st_TABELA
30480>>>        String  ID
30480>>>        String  DS
30480>>>        Integer SEL
30480>>>    End_Struct //st_TABELA
30480>>>    
30480>>>    Struct stPesquisaTABELA
30480>>>        st_TABELA[] dados
30480>>>        st_TABELA[] dados
30480>>>        Number qtdLinhas
30480>>>    End_Struct //stPesquisaTABELA
30480>>>    
30480>>>    Struct st_negociation
30480>>>        String aTaxas
30480>>>        Number aValor
30480>>>        String aMoeda
30480>>>        String aObs
30480>>>        String aRecnum
30480>>>        String aMoeda_DS
30480>>>        String aModPagto
30480>>>        String venda
30480>>>        String classe
30480>>>        Number aValorMin
30480>>>        Number aValorMax
30480>>>    End_Struct //st_negociation
30480>>>    
30480>>>    //- Negociacao de Taxas Aereo
30480>>>    Struct st_ngtTaxAir
30480>>>       stCombo moeda
30480>>>       stCombo moeda
30480>>>        Number valor
30480>>>        Number vlMin
30480>>>        Number vlMax
30480>>>       stCombo tpCalculo
30480>>>       stCombo tpCalculo
30480>>>       stTaxas taxa
30480>>>       stTaxas taxa
30480>>>     stIdValue modPagamento
30480>>>     stIdValue modPagamento
30480>>>       stCombo tpMotivo
30480>>>       stCombo tpMotivo
30480>>>       stCombo infoCompl
30480>>>       stCombo infoCompl
30480>>>    End_Struct //st_ngtTaxAir
30480>>>
30480>>>    Struct st_negociationAir
30480>>>        String recId
30480>>>  st_ngtTaxAir venda      
30480>>>  st_ngtTaxAir venda      
30480>>>        String classe
30480>>>        String DS_T
30480>>>        String N_Note
30480>>>        String edit
30480>>>    End_Struct //st_negociationAir
30480>>>    
30480>>>    //- Negociacao de Taxas FCL
30480>>>    Struct st_ngtTaxFcl
30480>>>       stCombo equipamento
30480>>>       stCombo equipamento
30480>>>       stCombo moeda
30480>>>       stCombo moeda
30480>>>        Number valor
30480>>>        Number vlMin
30480>>>        Number vlMax
30480>>>       stCombo tpCalculo
30480>>>       stCombo tpCalculo
30480>>>       stTaxas taxa
30480>>>       stTaxas taxa
30480>>>     stIdValue modPagamento
30480>>>     stIdValue modPagamento
30480>>>    End_Struct //st_ngtTaxFcl
30480>>>
30480>>>    Struct st_negociationFcl
30480>>>        String recId
30480>>>  st_ngtTaxFcl venda      
30480>>>  st_ngtTaxFcl venda      
30480>>>        String classe
30480>>>        String DS_T
30480>>>        String N_Note
30480>>>        String edit
30480>>>    End_Struct //st_negociationFcl
30480>>>    
30480>>>    Struct stSchedule
30480>>>        String armador            
30480>>>        String nomeAgente         
30480>>>        String nomeNavio          
30480>>>        String numeroViagem       
30480>>>        String eta                
30480>>>        String deadlineCraft      
30480>>>        String horaDeadlineCraft  
30480>>>        String numeroConsolidada  
30480>>>        String prev               
30480>>>        String dlimo              
30480>>>        String dldta              
30480>>>        String dl      
30480>>>        String dlvgm
30480>>>        String dldraft   
30480>>>        String dlcliente   
30480>>>        //FCL 
30480>>>        String book_armador   
30480>>>        String obsconsol
30480>>>        String terminal
30480>>>        String agmaritima
30480>>>        String agemissaobl
30480>>>        String margem
30480>>>        String supervisor
30480>>>        String dtchegada  
30480>>>        String ftarmador   
30480>>>        String ftcliente   
30480>>>        String documentacao
30480>>>        String master_armador
30480>>>        
30480>>>        String dlhr        
30480>>>        String dldrafthr   
30480>>>        String dlimohr     
30480>>>        String dlvgmhr    
30480>>>        String dlclientehr 
30480>>>        
30480>>>    End_Struct //stSchedule
30480>>>    
30480>>>    Struct stScheduleTruck
30480>>>        String dataDeadline
30480>>>        String dataSaida
30480>>>        String dataChegada
30480>>>        String numConhecimento
30480>>>        String consolidadaTruck
30480>>>    End_Struct //stScheduleTruck
30480>>>    
30480>>>    Struct stTarifarioGravacao
30480>>>        String sCONTAINER
30480>>>        String sCARRIER_ID
30480>>>        String sCCGS202_ID
30480>>>        String sCSAG308_ID
30480>>>        String sTAXA_CLASSE
30480>>>        String sTAXA_ID
30480>>>        String sOBSERVACOES
30480>>>        String sVENDA_MODPGTO
30480>>>        String sVENDA_MOEDA
30480>>>        Integer sVENDA_TPCALC
30480>>>        String sVENDA_VLMIN
30480>>>        String sVENDA_VLMAX
30480>>>        String sVENDA_VALOR
30480>>>        String sCOMPRA_MODPGTO
30480>>>        String sCOMPRA_MOEDA
30480>>>        Integer sCOMPRA_TPCALC
30480>>>        String sCOMPRA_VLMIN
30480>>>        String sCOMPRA_VLMAX
30480>>>        String sCOMPRA_VALOR
30480>>>        String sDESCRICAO
30480>>>        String sTRANSIT_TIME
30480>>>        String sCSAG345_ID_ORIGEM
30480>>>        String sCSAG345_ID_DESTINO
30480>>>        String sCSAG346_ID_ORIGEM
30480>>>        String sCSAG346_ID_DESTINO
30480>>>        
30480>>>        String sPERCENTUAL_TIPO_V
30480>>>        String sPERCENTUAL_APLICA_V 
30480>>>        String sPESO_FAIXA_V
30480>>>        String sPESO_UNIDADE_V
30480>>>        
30480>>>        String sPERCENTUAL_TIPO_C
30480>>>        String sPERCENTUAL_APLICA_C 
30480>>>        String sPESO_FAIXA_C
30480>>>        String sPESO_UNIDADE_C
30480>>>        
30480>>>        String sDT_FINAL
30480>>>        String sFREQUENCIA
30480>>>        String sWEIGHT     
30480>>>        String sWEIGHT_TYPE
30480>>>        String sVOLUME     
30480>>>        String sVOLUME_TYPE
30480>>>        String sCSAG325_DESTINO
30480>>>        String sCSAG325_ORIGEM 
30480>>>        String sCSAG325_VIA    
30480>>>        String sCSAG329_DESTINO
30480>>>        String sCSAG329_ORIGEM 
30480>>>        String sINCOTERM
30480>>>        String sTABELA
30480>>>        String STABELA_ID
30480>>>        String sFREETIME
30480>>>        String sFORNECEDOR
30480>>>        String sRATIO_CBMKG_DENSIDADE
30480>>>        String sVENDA_TPCALC_DSC
30480>>>        String sVENDA_VALOR_OBS
30480>>>        String sCOMPRA_TPCALC_DSC
30480>>>        String sCOMPRA_VALOR_OBS
30480>>>End_Struct //stTarifarioGravacao
30480>>>
30480>>>Struct st_ValorPorEquipamento
30480>>>   Integer iTP_CALCULO_V
30480>>>    Number nVL_VENDA    
30480>>>    Number nVL_MINIMO_V 
30480>>>    Number nVL_MAXIMO_V 
30480>>>    Number nVL_FRETE_V
30480>>>    String sCONTAINER   
30480>>>    String sAux1        
30480>>>    String sAux2        
30480>>>    String sAux3        
30480>>>End_Struct //st_ValorPorEquipamento
30480>>>
30480>>>Struct stCityCountryTrade
30480>>>    String id
30480>>>    String value
30480>>>    String pais
30480>>>    String uf
30480>>>    String trade
30480>>>    String icao
30480>>>    String iata
30480>>>    String port
30480>>>End_Struct //stCityCountryTrade
30480>>>
30480>>>Struct stCityCountryTradeMsg
30480>>>   stCityCountryTrade[] aCityCountryTrade
30480>>>   stCityCountryTrade[] aCityCountryTrade
30480>>>   stDefaultMessage aMessage
30480>>>   stDefaultMessage aMessage
30480>>>End_Struct
30480>>>
30480>>>Struct stReportTitle
30480>>>    String sTitle
30480>>>    String sICO
30480>>>    String sCampo
30480>>>End_Struct //stReportTitle
30480>>>
30480>>>Struct stLogMail
30480>>>    String   fromMail             //Type:ASC, Size:200  
30480>>>    String   replaytoMail         //Type:ASC, Size:200  
30480>>>    String   toMail               //Type:ASC, Size:1024  
30480>>>    String   ccMail               //Type:ASC, Size:1024  
30480>>>    String   bccMail              //Type:ASC, Size:1024  
30480>>>    String   subjectMail          //Type:ASC, Size:250  
30480>>>    String   msgMail              //Type:TEX, Size:2048  
30480>>>    String   ipusuarioMail        //Type:ASC, Size:20   
30480>>>    String   idenviadoMail        //Type:ASC, Size:1    
30480>>>    DateTime dthrenviadoMail      //Type:DTM, Size:26   
30480>>>    String   anexoMail            //Type:ASC, Size:250      
30480>>>    Integer  idanexoMail          //Type:NUM, Size:14.0  
30480>>>    String   htmlbodyMaIL         //Type:ASC, Size:250      
30480>>>End_Struct //stLogMail
30480>>>
30480>>>
30480>>>//ESTRUTURAS PARA A NOVA PROPOSTA -- INICIO
30480>>>
30480>>>Struct stDoor
30480>>>    String pais
30480>>>    Integer cidade
30480>>>    String cep
30480>>>    String endereco
30480>>>End_Struct
30480>>>
30480>>>Struct stOrigemDestino
30480>>>    String pais
30480>>>    Integer cidade
30480>>>    stDoor door
30480>>>    stDoor door
30480>>>End_Struct
30480>>>
30480>>>Struct stDimensao
30480>>>    Number L
30480>>>    Number W
30480>>>    Number H
30480>>>    String un
30480>>>End_Struct
30480>>>
30480>>>Struct stValorUn
30480>>>    Number valor
30480>>>    String un
30480>>>End_Struct
30480>>>
30480>>>Struct stOutros
30480>>>    Boolean status
30480>>>    String texto
30480>>>End_Struct
30480>>>
30480>>>Struct stMercadorias    
30480>>>    Integer id
30480>>>    Integer     mercadoria
30480>>>    String      descricao
30480>>>    String      ncm
30480>>>    String      un
30480>>>    String      pkg
30480>>>    String      classe
30480>>>    String      subrisk
30480>>>End_Struct
30480>>>
30480>>>Struct stContainer
30480>>>    Integer id
30480>>>    Integer pcs
30480>>>    Integer package
30480>>>    stValorUn weight
30480>>>    stValorUn weight
30480>>>    stDimensao dimensoes
30480>>>    stDimensao dimensoes
30480>>>    stValorUn grossWeight
30480>>>    stValorUn grossWeight
30480>>>    stValorUn volume
30480>>>    stValorUn volume
30480>>>    Boolean imo
30480>>>    Boolean bagagem
30480>>>    Boolean consumoHumano
30480>>>    Boolean nonEmpilhavel
30480>>>    Boolean consumoAnimal
30480>>>    stOutros outros
30480>>>    stOutros outros
30480>>>    stMercadorias[] mercadorias  
30480>>>    stMercadorias[] mercadorias  
30480>>>End_Struct
30480>>>
30480>>>Struct stInfoGeral
30480>>>    Integer id
30480>>>    Integer cliente
30480>>>    Integer marca
30480>>>    Integer operacao
30480>>>    String incoterm
30480>>>    Integer embarque
30480>>>    String modalidade
30480>>>    stOrigemDestino origem
30480>>>    stOrigemDestino origem
30480>>>    stOrigemDestino destino
30480>>>    stOrigemDestino destino
30480>>>        Integer clienteFinal
30480>>>        stContainer[] containers
30480>>>        stContainer[] containers
30480>>>        String aUsuarioSessao
30480>>>End_Struct
30480>>>
30480>>>Struct stLiteralValor
30480>>>    String literal
30480>>>    String valor
30480>>>End_Struct
30480>>>
30480>>>Struct tOAuth2Response
30480>>>    String access_token
30480>>>   Integer expires_in
30480>>>    String token_type
30480>>>End_Struct
30480>>>
30480>>>Struct tError
30480>>>    Integer code
30480>>>    String message
30480>>>End_Struct
30480>>>
30480>>>Struct tInfos
30480>>>   Integer proposta
30480>>>    String incoterms
30480>>>    String pol
30480>>>    String pod
30480>>>    String operacao
30480>>>    String caracEmbarque
30480>>>   Integer cliente
30480>>>    String clienteFantasia
30480>>>   Integer agenteOrigem
30480>>>    String agenteOrigemFantasia
30480>>>End_Struct
30480>>>
30480>>>Struct stReportCCGS250
30480>>>    String sRecnum
30480>>>    String referenciaId
30480>>>    String referenciaDs
30480>>>    String texto
30480>>>End_Struct //stReportCCGS250
30480>>>
30480>>>Struct stSaveCCGS250
30480>>>    stDefaultMessage aDefaultMessage
30480>>>    stDefaultMessage aDefaultMessage
30480>>>    stReportCCGS250[] aReportCCGS250
30480>>>    stReportCCGS250[] aReportCCGS250
30480>>>End_Struct
30480>>>
30480>>>//FIM
30480>
30480>Object oApplication is a cApplication        
30482>    Use ..\..\WVDF_CAC\PkgSrc\ApplicationMessages.pkg
Including file: ..\..\WVDF_CAC\PkgSrc\ApplicationMessages.pkg    (C:\DataFlex Projects\CROSS\WVDF_WS\AppSrc\..\..\WVDF_CAC\PkgSrc\ApplicationMessages.pkg)
30482>>>//-2WA
30482>>>//- deve estar dentro do objeto da classe cApplication do WebApp.
30482>>>//- 32-character base32-encoded string, allowed chars: A-Z and 2-7
30482>>>    Property String psOneTimePasswordSecret "5OCORRO3U5UBINUMONIBU53MMARROCO5" 
30484>>>    Property String ppTimeStamp 
30486>>>    Property String ppUrl 
30488>>>    Property String ppHashdata 
30490>>>    Property String ppHashcode 
30492>>>
30492>>>    Function f_Decode_Period String slCode Returns Integer
30495>>>        Move (Uppercase(slCode)) to slCode
30496>>>    
30496>>>        If (slCode='M') Function_Return 1
30499>>>        If (slCode='H') Function_Return Hour_Length
30502>>>        If (slCode='D') Function_Return Day_Length
30505>>>        If (slCode='W') Function_Return (Week_Length*Day_Length)
30508>>>    
30508>>>    End_Function // f_Decode_Period
30509>>>    
30509>>>    Function f_Decode_Day String slDay Returns Integer
30512>>>        Move (Uppercase(slDay)) to slDay
30513>>>    
30513>>>        If (slDay='SU') Function_Return 0
30516>>>        If (slDay='MO') Function_Return 1
30519>>>        If (slDay='TU') Function_Return 2
30522>>>        If (slDay='WD') Function_Return 3
30525>>>        If (slDay='TH') Function_Return 4
30528>>>        If (slDay='FR') Function_Return 5
30531>>>        If (slDay='SA') Function_Return 6
30534>>>    
30534>>>    End_Function// f_Decode_Day
30535>>>    
30535>>>//- Purpose: Translate an integer between 0 and 15 
30535>>>//           into a hexadecimal format.
30535>>>    Function Integer2Hex Integer iInput Returns String
30538>>>        String sOutStr
30538>>>        
30538>>>        Move "0" to sOutStr
30539>>>        If (iInput=1) Move "1" to sOutStr
30542>>>        Else If (iInput=2) Move "2" to sOutStr
30546>>>        Else If (iInput=3) Move "3" to sOutStr
30550>>>        Else If (iInput=4) Move "4" to sOutStr
30554>>>        Else If (iInput=5) Move "5" to sOutStr
30558>>>        Else If (iInput=6) Move "6" to sOutStr
30562>>>        Else If (iInput=7) Move "7" to sOutStr
30566>>>        Else If (iInput=8) Move "8" to sOutStr
30570>>>        Else If (iInput=9) Move "9" to sOutStr
30574>>>        Else If (iInput=10) Move "A" to sOutStr
30578>>>        Else If (iInput=11) Move "B" to sOutStr
30582>>>        Else If (iInput=12) Move "C" to sOutStr
30586>>>        Else If (iInput=13) Move "D" to sOutStr
30590>>>        Else If (iInput=14) Move "E" to sOutStr
30594>>>        Else If (iInput=15) Move "F" to sOutStr
30598>>>        Function_Return sOutStr
30599>>>    End_Function
30600>>>
30600>>>//- Purpose: Translate a character into a hexadecimal format.
30600>>>    Function Ascii2Hex String sInStr Returns String
30603>>>        String  sFirstChar
30603>>>        String  sSecondChar
30603>>>        Integer iAscii
30603>>>        Integer iFirstNumber
30603>>>        Integer iSecondNumber
30603>>>        
30603>>>        Move (Ascii(sInStr)) to iAscii
30604>>>        Move (Mod(iAscii, 16)) to iSecondNumber
30605>>>        Move ((iAscii-iSecondNumber)/16) to iFirstNumber
30606>>>        Move (Integer2Hex(Self,iFirstNumber)) to sFirstChar
30607>>>        Move (Integer2Hex(Self,iSecondNumber)) to sSecondChar
30608>>>        Function_Return (Append(sFirstChar, sSecondChar))
30609>>>    End_Function
30610>>>
30610>>>//- Purpose: Convert a string into a string consisting of Hexadecimal characters.
30610>>>    Function DaiEncode String sInStr Returns String
30613>>>        String  sChar
30613>>>        String  sOutStr
30613>>>        String  sHexStr
30613>>>        Integer iCounter
30613>>>        Integer iLength
30613>>>
30613>>>        Move (Length(sInStr)) to iLength
30614>>>        Move "" to sOutStr
30615>>>        For iCounter from 1 to iLength
30621>>>>
30621>>>            Move (Mid(sInStr, 1, iCounter)) to sChar
30622>>>            Move (Ascii2Hex(Self,sChar)) to sHexStr
30623>>>            Move (Append(sOutStr, sHexStr)) to sOutStr
30624>>>        Loop
30625>>>>
30625>>>        Function_Return sOutStr
30626>>>    End_Function
30627>>>    
30627>>>//- Purpose: Returns a string of two digits so 7 is returned 
30627>>>//           as "07" and 14 is returned as "14". 213 would be returned
30627>>>//           as "13".
30627>>>    Function TwoDigits Integer iNumber Returns String
30630>>>        String sResult
30630>>>        
30630>>>        Move (Append("00", String(iNumber))) to sResult
30631>>>        Move (Right(sResult, 2)) to sResult
30632>>>        Function_Return sResult
30633>>>    End_Function
30634>>>
30634>>>//- Purpose: Creates a timestamp Returns a string formatted as "YYYY-MM-DDTHH:MM:SS"
30634>>>    Function CreateTimestamp Returns String
30637>>>        DateTime dtCurrentDateTime
30637>>>        Integer  iYear
30637>>>        Integer  iMonth
30637>>>        Integer  iDay
30637>>>        Integer  iHour
30637>>>        Integer  iMinute
30637>>>        Integer  iSecond
30637>>>        String   sResult
30637>>>        
30637>>>        Move (CurrentDateTime()) to dtCurrentDateTime
30638>>>        
30638>>>        Move (DateGetYear  (dtCurrentDateTime)) to iYear
30639>>>        Move (DateGetMonth (dtCurrentDateTime)) to iMonth
30640>>>        Move (DateGetDay   (dtCurrentDateTime)) to iDay
30641>>>        Move (DateGetHour  (dtCurrentDateTime)) to iHour
30642>>>        Move (DateGetMinute(dtCurrentDateTime)) to iMinute
30643>>>        Move (DateGetSecond(dtCurrentDateTime)) to iSecond
30644>>>
30644>>>        Move  "%1-%2-%3T%4:%5:%6" to sResult
30645>>>        Move (SFormat(sResult, iYear, TwoDigits(Self,iMonth);                                    , TwoDigits(Self,iDay);                                    , TwoDigits(Self,iHour);                                    , TwoDigits(Self,iMinute);                                    , TwoDigits(Self,iSecond))) to sResult
30646>>>        
30646>>>        Function_Return sResult
30647>>>    End_Function //CreateTimestamp
30648>>>
30648>>>//- Generates a timestamp and stores it in a private property.
30648>>>    Procedure Generate_Timestamp
30651>>>        String sTimeStamp
30651>>>        Get CreateTimestamp to sTimeStamp
30652>>>        Set ppTimeStamp to sTimeStamp
30653>>>    End_Procedure //Generate_Timestamp
30654>>>    
30654>>>//- AR20170531 - Insert left zeroes
30654>>>    Function InsertLeftZeroes String sValue Integer iLength Returns String
30657>>>        Move (Rtrim(sValue)) to sValue
30658>>>        While (Length(sValue) < iLength)
30662>>>            Move ("0" + sValue) to sValue
30663>>>        Loop    
30664>>>>
30664>>>        Function_Return sValue
30665>>>    End_Function //InsertLeftZeroes
30666>>>    
30666>>>//- AR20170531 - Remove spaces and punctuation
30666>>>    Function RemoveSpacesAndPunctuation String sValue Returns String
30669>>>        Move (Replaces(" ", sValue, "")) to sValue
30670>>>        Move (Replaces(".", sValue, "")) to sValue
30671>>>        Move (Replaces("&", sValue, "")) to sValue
30672>>>        Move (Replaces("-", sValue, "")) to sValue
30673>>>        Move (Replaces("_", sValue, "")) to sValue
30674>>>        Move (Replaces(",", sValue, "")) to sValue
30675>>>        Move (Replaces(":", sValue, "")) to sValue
30676>>>        Move (Replaces("?", sValue, "")) to sValue
30677>>>        Move (Replaces("/", sValue, "")) to sValue
30678>>>        Move (Replaces("'", sValue, "")) to sValue
30679>>>        Move (Replaces("%", sValue, "")) to sValue
30680>>>        Move (Replaces("$", sValue, "")) to sValue
30681>>>        Move (Replaces("#", sValue, "")) to sValue
30682>>>        Move (Replaces("!", sValue, "")) to sValue
30683>>>        Move (Replaces("+", sValue, "")) to sValue
30684>>>        Move (Replaces("=", sValue, "")) to sValue
30685>>>        Move (Replaces(";", sValue, "")) to sValue
30686>>>        Move (Replaces("|", sValue, "")) to sValue
30687>>>        Move (Replaces("\", sValue, "")) to sValue
30688>>>        //
30688>>>        Function_Return sValue
30689>>>    End_Function //RemoveSpacesAndPunctuation
30690>>>
30690>>>//- AR20170531 - Verify/Create the WebAppOut folder
30690>>>//  Folder location for saving any/all PDF output from web order entry application.
30690>>>//  a subfolder named: WebAppOut located directly under whatever is the data folder for the workspace
30690>>>    Function ReportOutPutPath Returns String
30693>>>        String  sDataPath sReportOutPutPath
30693>>>        Integer iHasFolder iHasError
30693>>>        Get psDataPath  of (phoWorkspace(ghoApplication)) to sDataPath
30694>>>        Get PathAtIndex of (phoWorkspace(ghoApplication)) sDataPath 1 to sReportOutPutPath
30695>>>        Move (sReportOutPutPath + "\WebAppOut") to sReportOutPutPath
30696>>>        //Does the directory exist? - No = 0, Yes = 1
30696>>>        Move (vFolderExists(sReportOutPutPath)) to iHasFolder
30697>>>        If (not(iHasFolder)) Begin
30699>>>            // 0 if the folder is created.
30699>>>            // 1 if the API-call returned an error.
30699>>>            Move (vCreateDirectory(sReportOutPutPath)) to iHasError
30700>>>            If (iHasError) Move "" to sReportOutPutPath
30703>>>        End
30703>>>>
30703>>>        If (not(iHasError) and iHasFolder) Begin
30705>>>            Send RegisterDownloadFolder of ghoWebResourceManager sReportOutPutPath
30706>>>        End
30706>>>>
30706>>>        Function_Return sReportOutPutPath
30707>>>    End_Function //ReportOutPutPath
30708>>>
30708>>>    Function ValidarSessaoUsuario String aUsuarioSessao String aFingerPrint Returns stDefaultMessage
30711>>>        stDefaultMessage stDefaultMsg
30711>>>        stDefaultMessage stDefaultMsg
30711>>>        String aUsuarioIP
30711>>>        String aRemoteAddress
30711>>>        //-
30711>>>        Clear CSAG311
Including file: CSAG311.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG311.fd)
30712>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
30713>>>        Find EQ CSAG311 by 1
30714>>>>
30714>>>        If (not(Found)) Begin
30716>>>            Move True to stDefaultMsg.hasError
30717>>>            Move 'SESSAO INVALIDA/INVALID SESSION.' to stDefaultMsg.msgError
30718>>>            Function_Return stDefaultMsg
30719>>>        End
30719>>>>
30719>>>
30719>>>        //- VALIDACAO DO IP
30719>>>        //Get ServerVariable  of ghoWebServiceDispatcher "REMOTE_ADDR" to aRemoteAddress
30719>>>        //Move (Rtrim(CSAG311.USUARIOIP)) to aUsuarioIP
30719>>>        //If (aUsuarioIP <> aRemoteAddress) Begin
30719>>>        //    Move True to stDefaultMsg.hasError
30719>>>        //    Move 'IP INVALIDO' to stDefaultMsg.msgError
30719>>>        //    Function_Return stDefaultMsg
30719>>>        //End
30719>>>
30719>>>        //- VALIDACAO DO FINGERPRINT
30719>>>        Clear HSAG300
Including file: HSAG300.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HSAG300.fd)
30720>>>        Move CSAG311.USUARIONUMERO  to HSAG300.USUARIONUMERO
30721>>>        Move aFingerPrint           to HSAG300.FINGERPRINT
30722>>>        Find Eq HSAG300 by 1
30723>>>>
30723>>>        If (not(Found)) Begin
30725>>>            Move True to stDefaultMsg.hasError
30726>>>            Move 'FINGERPRINT NAO ENCONTRADO' to stDefaultMsg.msgError
30727>>>            Function_Return stDefaultMsg
30728>>>        End
30728>>>>
30728>>>        
30728>>>        If (Rtrim(CSAG311.FINGERPRINT) <> aFingerPrint) Begin
30730>>>            Move True to stDefaultMsg.hasError
30731>>>            Move 'FINGERPRINT INVALIDO' to stDefaultMsg.msgError
30732>>>            Function_Return stDefaultMsg
30733>>>        End
30733>>>>
30733>>>        
30733>>>
30733>>>    //- variables ------
30733>>>        DateTime dtVar
30733>>>        Date     dlToday
30733>>>        Date     dDtLastRun
30733>>>        String   slTime
30733>>>        String   slHH slMM
30733>>>        String   sHrLastRun
30733>>>        String   slPeriodType
30733>>>        String   slDay
30733>>>        Integer  ilTodayDay
30733>>>        Integer  ilMultiplier
30733>>>        Integer  ilSchedDay
30733>>>        Integer  idTime
30733>>>        Integer  ilPeriod
30733>>>        Handle   hObj
30733>>>        Boolean  bError
30733>>>        
30733>>>        Sysdate dlToday slHH slMM
30736>>>    
30736>>>        If (Integer(slMM)<10) Move (Insert('0', slMM, 1)) to slMM
30739>>>        If (Integer(slHH)<10) Move (Insert('0', slHH, 1)) to slHH
30742>>>    
30742>>>        Move (slHH + slMM) to slTime
30743>>>    
30743>>>        Move dlToday           to dDtLastRun
30744>>>        Move (slHH +':'+ slMM) to sHrLastRun
30745>>>    
30745>>>        //- WE NEED AN INTEGER TO REPRESENT THE TIME OF DAY TO ELIMINATE CROSS MIDNIGHT PROBLEMS.
30745>>>        //  WE CREATED A SINGLE INTEGER FROM THE DATE, HOUR AND MINUTES THAT DOES NOT HAVE TO GO
30745>>>        //  BACK TO 0 AT THE BEGINNING OF THE DAY OR HOUR.
30745>>>        Move (Integer(dlToday)*1440 + (Integer(slHH)*60) + Integer(slMM)) to idTime
30746>>>
30746>>>        //- WE NEED THE DAY OF THE WEEK. 1=SUNDAY, 2=MONDAY, ETC.
30746>>>        Move (CurrentDateTime())       to dtVar
30747>>>        Move (DateGetDayOfWeek(dtVar)) to ilTodayDay
30748>>>
30748>>>        Clear TSMG800
30749>>>        Smart_Find GE TSMG800 by 0
30760>>>        
30760>>>        Move (Rtrim(TSMG800.DAY_OF_WEEK)) to slDay
30761>>>        Move (Right(Trim(TSMG800.PERIOD_SESSION_TIMEOUT),1)) to slPeriodType
30762>>>        Move (Replace(slPeriodType,Trim(TSMG800.PERIOD_SESSION_TIMEOUT),'')) to ilMultiplier
30763>>>
30763>>>        //- DAY CODE, SU, MO, ETC.
30763>>>        //  DAY SPECIFIED IN THE SCHEDULE.
30763>>>        If (slDay<>'') Move (f_Decode_Day(Self, Uppercase(slDay))) to ilSchedDay
30766>>>
30766>>>        //- DO SOME ACTION
30766>>>        Move ((f_Decode_Period(Self, slPeriodType))*ilMultiplier) to ilPeriod
30767>>>        If ((idTime <= Integer(CSAG311.LASTRUN)+ilPeriod) or Integer(CSAG311.LASTRUN) = 0) Begin
30769>>>            If (slDay = '' or (slDay <> '' and ilSchedDay = ilTodayDay)) Begin
30771>>>               //- WRITE THE CURRENT DATE/TIME BACK TO THE DATA FILE
30771>>>                Get Create (RefClass(DataDictionary)) to hObj
30772>>>                Set Main_File of hObj to CSAG311.File_Number
30773>>>                Send Request_Assign of hObj
30774>>>                Set Field_Changed_Value of hObj Field CSAG311.LASTRUN to idTime
30775>>>                Set Field_Changed_Value of hObj Field CSAG311.LASTACCESSDATE to dDtLastRun
30776>>>                Set Field_Changed_Value of hObj Field CSAG311.LASTACCESSTIME to sHrLastRun
30777>>>                Get Request_Validate of hObj to bError
30778>>>                If (not(bError)) Send Request_Save of hObj
30781>>>                Send Destroy of hObj
30782>>>            End
30782>>>>
30782>>>        End
30782>>>>
30782>>>        Else Begin
30783>>>            //- DO SOME ACTION. USE OF DTIME HERE IS CRITICAL AS IT PREVENTS THE REPETITIVE CALLING
30783>>>            //  OF THE PROCESS WITHIN THE SAME MINUTE.
30783>>>            If (TSMG800.PERIOD_SESSION_TIMEOUT <> '' and idTime > (Integer(CSAG311.LASTRUN)+ilPeriod)) Begin
30785>>>                If (slDay = '' or (slDay <> '' and ilSchedDay = ilTodayDay)) Begin
30787>>>                    Get Create (RefClass(DataDictionary)) to hObj
30788>>>                    Set Main_File of hObj to CSAG311.File_Number
30789>>>                    Send Request_Assign of hObj
30790>>>                    Send Request_Delete of hObj
30791>>>                    Send Destroy of hObj
30792>>>                    //-
30792>>>                    Move True to stDefaultMsg.hasError
30793>>>                    Move 'SESSAO EXPIRADA' to stDefaultMsg.msgError
30794>>>                End
30794>>>>
30794>>>            End
30794>>>>
30794>>>        End
30794>>>>
30794>>>        
30794>>>        Function_Return stDefaultMsg
30795>>>    End_Function //ValidarSessaoUsuario
30796>>>    
30796>>>    Function KillSessaoUsuario String aUsuarioSessao String aFingerPrint Returns stDefaultMessage
30799>>>        stDefaultMessage stDefaultMsg
30799>>>        stDefaultMessage stDefaultMsg
30799>>>        String aUsuarioIP
30799>>>        String aRemoteAddress
30799>>>        //-
30799>>>        Clear CSAG311
30800>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
30801>>>        Find EQ CSAG311 by 1
30802>>>>
30802>>>        If (not(Found)) Begin
30804>>>            Move True to stDefaultMsg.hasError
30805>>>            Move 'SESSAO INVALIDA/INVALID SESSION.' to stDefaultMsg.msgError
30806>>>            Function_Return stDefaultMsg
30807>>>        End
30807>>>>
30807>>>
30807>>>        //- VALIDACAO DO IP
30807>>>        //Get ServerVariable  of ghoWebServiceDispatcher "REMOTE_ADDR" to aRemoteAddress
30807>>>        //Move (Rtrim(CSAG311.USUARIOIP)) to aUsuarioIP
30807>>>        //If (aUsuarioIP <> aRemoteAddress) Begin
30807>>>        //    Move True to stDefaultMsg.hasError
30807>>>        //    Move 'IP INVALIDO' to stDefaultMsg.msgError
30807>>>        //    Function_Return stDefaultMsg
30807>>>        //End
30807>>>
30807>>>        //- VALIDACAO DO FINGERPRINT
30807>>>        Clear HSAG300
30808>>>        Move CSAG311.USUARIONUMERO  to HSAG300.USUARIONUMERO
30809>>>        Move aFingerPrint           to HSAG300.FINGERPRINT
30810>>>        Find Eq HSAG300 by 1
30811>>>>
30811>>>        If (not(Found)) Begin
30813>>>            Move True to stDefaultMsg.hasError
30814>>>            Move 'FINGERPRINT NAO ENCONTRADO' to stDefaultMsg.msgError
30815>>>            Function_Return stDefaultMsg
30816>>>        End
30816>>>>
30816>>>        
30816>>>        If (Rtrim(CSAG311.FINGERPRINT) <> aFingerPrint) Begin
30818>>>            Move True to stDefaultMsg.hasError
30819>>>            Move 'FINGERPRINT INVALIDO' to stDefaultMsg.msgError
30820>>>            Function_Return stDefaultMsg
30821>>>        End
30821>>>>
30821>>>        
30821>>>
30821>>>    //- variables ------
30821>>>        DateTime dtVar
30821>>>        Date     dlToday
30821>>>        Date     dDtLastRun
30821>>>        String   slTime
30821>>>        String   slHH slMM
30821>>>        String   sHrLastRun
30821>>>        String   slPeriodType
30821>>>        String   slDay
30821>>>        Integer  ilTodayDay
30821>>>        Integer  ilMultiplier
30821>>>        Integer  ilSchedDay
30821>>>        Integer  idTime
30821>>>        Integer  ilPeriod
30821>>>        Handle   hObj
30821>>>        Boolean  bError
30821>>>        
30821>>>        Sysdate dlToday slHH slMM
30824>>>    
30824>>>        If (Integer(slMM)<10) Move (Insert('0', slMM, 1)) to slMM
30827>>>        If (Integer(slHH)<10) Move (Insert('0', slHH, 1)) to slHH
30830>>>    
30830>>>        Move (slHH + slMM) to slTime
30831>>>    
30831>>>        Move dlToday           to dDtLastRun
30832>>>        Move (slHH +':'+ slMM) to sHrLastRun
30833>>>    
30833>>>        //- WE NEED AN INTEGER TO REPRESENT THE TIME OF DAY TO ELIMINATE CROSS MIDNIGHT PROBLEMS.
30833>>>        //  WE CREATED A SINGLE INTEGER FROM THE DATE, HOUR AND MINUTES THAT DOES NOT HAVE TO GO
30833>>>        //  BACK TO 0 AT THE BEGINNING OF THE DAY OR HOUR.
30833>>>        Move (Integer(dlToday)*1440 + (Integer(slHH)*60) + Integer(slMM)) to idTime
30834>>>
30834>>>        //- WE NEED THE DAY OF THE WEEK. 1=SUNDAY, 2=MONDAY, ETC.
30834>>>        Move (CurrentDateTime())       to dtVar
30835>>>        Move (DateGetDayOfWeek(dtVar)) to ilTodayDay
30836>>>
30836>>>        Clear TSMG800
30837>>>        Smart_Find GE TSMG800 by 0
30848>>>        
30848>>>        Move (Rtrim(TSMG800.DAY_OF_WEEK)) to slDay
30849>>>        Move (Right(Trim(TSMG800.PERIOD_SESSION_TIMEOUT),1)) to slPeriodType
30850>>>        Move (Replace(slPeriodType,Trim(TSMG800.PERIOD_SESSION_TIMEOUT),'')) to ilMultiplier
30851>>>
30851>>>        //- DAY CODE, SU, MO, ETC.
30851>>>        //  DAY SPECIFIED IN THE SCHEDULE.
30851>>>        If (slDay<>'') Move (f_Decode_Day(Self, Uppercase(slDay))) to ilSchedDay
30854>>>
30854>>>        //- DO SOME ACTION
30854>>>        Move ((f_Decode_Period(Self, slPeriodType))*ilMultiplier) to ilPeriod
30855>>>        If (not((idTime <= Integer(CSAG311.LASTRUN)+ilPeriod) or Integer(CSAG311.LASTRUN) = 0)) Begin
30857>>>            //- DO SOME ACTION. USE OF DTIME HERE IS CRITICAL AS IT PREVENTS THE REPETITIVE CALLING
30857>>>            //  OF THE PROCESS WITHIN THE SAME MINUTE.
30857>>>            If (TSMG800.PERIOD_SESSION_TIMEOUT <> '' and idTime > (Integer(CSAG311.LASTRUN)+ilPeriod)) Begin
30859>>>                If (slDay = '' or (slDay <> '' and ilSchedDay = ilTodayDay)) Begin
30861>>>                    Get Create (RefClass(DataDictionary)) to hObj
30862>>>                    Set Main_File of hObj to CSAG311.File_Number
30863>>>                    Send Request_Assign of hObj
30864>>>                    Send Request_Delete of hObj
30865>>>                    Send Destroy of hObj
30866>>>                    //-
30866>>>                    Move True to stDefaultMsg.hasError
30867>>>                    Move 'SESSAO EXPIRADA' to stDefaultMsg.msgError
30868>>>                End
30868>>>>
30868>>>            End
30868>>>>
30868>>>        End
30868>>>>
30868>>>        Else Begin
30869>>>            Move False to stDefaultMsg.hasError
30870>>>            Move ((Trim(Integer(CSAG311.LASTRUN)+ilPeriod))-idTime) to stDefaultMsg.msgInfo
30871>>>        End
30871>>>>
30871>>>        
30871>>>        Function_Return stDefaultMsg
30872>>>    End_Function //KillSessaoUsuario
30873>>>    
30873>>>    Procedure pLogSQLCROSS String sIndeficador String sQuery
30876>>>        Handle  hoWorkspace
30876>>>        Integer iChnOut
30876>>>        String  logPath
30876>>>        
30876>>>        Get phoWorkspace of ghoApplication to hoWorkspace
30877>>>        Get psProgramPath of hoWorkspace to logPath
30878>>>        Get PathAtIndex of hoWorkspace logPath 1 to logPath
30879>>>        
30879>>>        Move (logPath + "\SQL-CROSS.log" ) to logPath
30880>>>
30880>>>        If (TSMG800.LOGQUERY_YN = "Y") Begin
30882>>>           Move (Seq_New_Channel()) to iChnOut
30883>>>           Append_Output channel iChnOut logPath
30885>>>               Writeln   channel iChnOut ("/*[" + String(CurrentDateTime()) + "]" * Trim(sIndeficador) + "*/")
30888>>>               Writeln   channel iChnOut  "--[bgn]-----------------------------------"
30891>>>               Writeln   channel iChnOut  sQuery
30894>>>               Writeln   channel iChnOut  "--[end]-----------------------------------"
30897>>>           Close_Output  channel iChnOut
30899>>>           Send Seq_Release_Channel iChnOut 
30900>>>        End
30900>>>>
30900>>>    End_Procedure //pLogSQLCROSS
30901>>>
30901>
30901>    Property tOAuth2Response pOAuth2Response
30903>    Property tError          pOAuth2Error
30905>        
30905>End_Object
30906>
30906>Use Dferror.pkg
30906>
30906>    Global_Variable Integer giIdUsuario
30906>
30906>    Global_Variable String gsIPComputer
30906>
30906>Object oWebApp is a cWebApp
30908>    // Register all objects
30908>    Register_Object oPAG800_01
30908>    Open TSMG800
30910>    Open LOGMAIL
Including file: LOGMAIL.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\LOGMAIL.fd)
30912>    Open LOGFILE
Including file: LOGFILE.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\LOGFILE.fd)
30914>    Open HSAG300
30916>        Open CSAG336                    
Including file: CSAG336.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG336.fd)
30918>    
30918>    Use AllSets.pkg
Including file: AllSets.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\AllSets.pkg)
30918>>>//-2WA
30918>>>Property String  pnUsuarioNumero      ""
30920>>>Property String  pnUsuarioSenha       ""
30922>>>Property Integer piUsuarioIdioma      0
30924>>>Property String  psUsuarioModoSeguro  ""
30926>>>
30926>>>Property String   psUsuarioSessao
30928>>>Property String   psPrograma
30930>>>Property String   psPARAMETRO
30932>>>
30932>>>Property String  psASC_PRINCIPAL      ""
30934>>>Property String  psADS_DESKTOPSIS     ""
30936>>>Property String  psABA_01             ""
30938>>>Property String  psABA_02             ""
30940>>>Property String  psABA_03             ""
30942>>>Property String  psABA_04             ""
30944>>>Property String  psABA_05             ""
30946>>>Property String  psABA_06             ""
30948>>>Property String  psABA_07             ""
30950>>>Property String  psABA_08             ""
30952>>>Property String  psABA_09             ""
30954>>>Property String  psABA_10             ""
30956>>>
30956>>>Property String  psUSUARIOCLASSE      ""
30958>>>Property Date    pdULTIMOACESSO_DATA  ""
30960>>>Property String  psULTIMOACESSO_HORA  ""
30962>>>
30962>>>Property String  psGERAIS_PAG300_00   ""
30964>>>Property String  psGERAIS_PAG301_00   ""
30966>>>Property String  psGERAIS_PAG305_00   ""
30968>>>Property String  psGERAIS_PAG332_00   ""
30970>>>Property String  psGERAIS_PAG333_00   ""
30972>>>Property String  psGERAIS_PAG334_00   ""
30974>>>
30974>>>Property String  psEMPRESA_Logo       ""
30976>>>Property String  psEMPRESA_LogoCor    ""
30978>>>Property String  psEMPRESA_LogoSite   ""
30980>>>Property String  psEMPRESA_Fundo      ""
30982>>>Property String  psVIRGULAPONTO       ""
30984>>>
30984>>>Property String psDecimalSeparator ","    // The decimal separator character to us on the client when formating numeric masks. 
30988>>>//(see DF_DECIMAL_SEPARATOR)
30988>>>Property String psThousandsSeparator "."  // The thousands separator character to us on the client when formating numeric masks.
30992>>>// (see DF_THOUSANDS_SEPARATOR)
30992>>>        
30992>>>Use LoadHTML_CSAG344.pkg
Including file: LoadHTML_CSAG344.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\LoadHTML_CSAG344.pkg)
30992>>>>>//-2WA
30992>>>>>//--- ANDERSON RODRIGUES - 06.04.2014 - 13:08
30992>>>>>//--- STRUCT GLOBAL CSAG344
30992>>>>>Open CSAG344
Including file: CSAG344.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG344.fd)
30994>>>>>
30994>>>>>Struct tgRegistroSQL_344
30994>>>>>    Number  ngSQL_CSAG344RECNUM
30994>>>>>End_Struct // tgRegistroSQL_344
30994>>>>>
30994>>>>>//--- ANDERSON RODRIGUES - 06.04.2014 - 13:08
30994>>>>>Function fLoadHTML_CSAG344 Global String sCSAG308_NR String sPROGRAMA String sSEQUENCIA Returns String
30996>>>>>    String  sQuery
30996>>>>>    String  sCSAG344RECNUM
30996>>>>>    String  sCSAG344CONTEUDO
30996>>>>>    
30996>>>>>    Integer iIndex
30996>>>>>    Integer iSEQUENCIA
30996>>>>>    
30996>>>>>    Move sSEQUENCIA to iSEQUENCIA
30997>>>>>    
30997>>>>>    tgRegistroSQL_344[] vtRegistroSQL_344
30997>>>>>    tgRegistroSQL_344[] vtRegistroSQL_344
30998>>>>>    
30998>>>>>    Move "" to sQuery
30999>>>>>    Move (ResizeArray(vtRegistroSQL_344, 0)) to vtRegistroSQL_344
31000>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG344
31005>>>>>>
31005>>>>>    //--- MONTADO A QUERY
31005>>>>>    Move "select RECNUM from dbo.CSAG344 where CSAG308_NR=%1 and PROGRAMA='%2'" to sQuery
31006>>>>>    If (iSEQUENCIA>0) Begin
31008>>>>>        Move (sQuery*'and SEQUENCIA='+ToSQLNumber(iSEQUENCIA)) to sQuery
31009>>>>>    End
31009>>>>>>
31009>>>>>    Move (sQuery*'order by CSAG308_NR, PROGRAMA, SEQUENCIA') to sQuery
31010>>>>>    
31010>>>>>    Move (SFormat (sQuery, ToSQLNumber(sCSAG308_NR), Trim(sPROGRAMA))) to sQuery
31011>>>>>    SQL_FIND_BEGIN hStmt_CSAG344_99 sQuery
Including file: CSAG300.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG300.fd)
31030>>>>>>
31030>>>>>        //SqlFindValueByName
31030>>>>>        Move (SizeOfArray(vtRegistroSQL_344))          to iIndex
31031>>>>>        Move      (SqlFindValue(hStmt_CSAG344_99,1))   to vtRegistroSQL_344[iIndex].ngSQL_CSAG344RECNUM
31032>>>>>    SQL_FIND_END hStmt_CSAG344_99
31039>>>>>>
31039>>>>>    
31039>>>>>    //--- MONTADO AS MATRIZES
31039>>>>>    For iIndex from 0 to (SizeOfArray(vtRegistroSQL_344)-1)
31045>>>>>>
31045>>>>>            
31045>>>>>        //--- OBTER O RECNUM DO CSAG325
31045>>>>>        Move vtRegistroSQL_344[iIndex].ngSQL_CSAG344RECNUM to sCSAG344RECNUM
31046>>>>>       //--- CARREGAR O CONTEUDO DO HTML -------------------------------
31046>>>>>       Clear   CSAG344
31047>>>>>       Move sCSAG344RECNUM  to CSAG344.RECNUM
31048>>>>>       Find Eq CSAG344      by 0
31049>>>>>>
31049>>>>>       If (Found) Begin
31051>>>>>           Move (sCSAG344CONTEUDO + Trim(CSAG344.CONTEUDO)) to sCSAG344CONTEUDO
31052>>>>>       End
31052>>>>>>
31052>>>>>        
31052>>>>>    Loop        
31053>>>>>>
31053>>>>>    
31053>>>>>    Function_Return sCSAG344CONTEUDO
31054>>>>>        
31054>>>>>End_Function // fLoadHTML_CSAG344
31055>>>Use LoadHTML_CSAG339.pkg
Including file: LoadHTML_CSAG339.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\LoadHTML_CSAG339.pkg)
31055>>>>>//-2WA
31055>>>>>//--- ANDERSON RODRIGUES - 27.08.2015 - 23:03
31055>>>>>Open CSAG339
Including file: CSAG339.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG339.fd)
31057>>>>>
31057>>>>>Function fLoadHTML_CSAG339 Global String sPROGRAMAACAO Returns String
31059>>>>>    String sHTML_RETORNO
31059>>>>>    
31059>>>>>    Clear CSAG339
31060>>>>>    Move sPROGRAMAACAO to CSAG339.PROGRAMAACAO
31061>>>>>    Find Eq CSAG339 by 1
31062>>>>>>
31062>>>>>    If (Found and CSAG339.STATUS = 1);        Move (Trim(CSAG339.PROGRAMALINK)) to sHTML_RETORNO
31065>>>>>        
31065>>>>>    Function_Return sHTML_RETORNO
31066>>>>>End_Function //fLoadHTML_CSAG339
31067>>>Use LOADSQL_CSAG367.pkg
Including file: LOADSQL_CSAG367.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\LOADSQL_CSAG367.pkg)
31067>>>>>//-2WA
31067>>>>>//--- ANDERSON RODRIGUES - 10.10.2015
31067>>>>>//--- ANDERSON RODRIGUES - 02.02.2017 
31067>>>>>//    - INDICE 1 ERA PROGRAMA + DATABASE
31067>>>>>//    - AGORA APENAS PROGRAMA
31067>>>>>//    - ESTA FUNCAO FOI SUBSTITUIDA PELA FIND_CODE_DESCRIPTION
31067>>>>>
31067>>>>>Open CSAG367
Including file: CSAG367.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG367.fd)
31069>>>>>CREATE_MAIN_CONNECTION BYFILE CSAG367
31074>>>>>>
31074>>>>>Function fLoadSQL_CSAG367 Global String sPROGRAM_ID String sDATABASE_ID Returns String
31076>>>>>    String sQUERY
31076>>>>>    
31076>>>>>    Clear   CSAG367
31077>>>>>    Move sPROGRAM_ID    to CSAG367.PROGRAMA
31078>>>>>  //Move sDATABASE_ID   to CSAG367.DATABASE
31078>>>>>    Find Eq CSAG367 by 1
31079>>>>>>
31079>>>>>    If (Found) Begin
31081>>>>>        Move (Trim(CSAG367.CONTEUDO)) to sQUERY
31082>>>>>    End
31082>>>>>>
31082>>>>>    Function_Return sQUERY
31083>>>>>End_Function //fLoadSQL_CSAG367
31084>>>
31084>>>//Object oMensagem is an Edit
31084>>>//End_Object // oMensagem
31084>>>
31084>>>
31084>>>//****************************************************************************
31084>>>// Description
31084>>>//    This function will use the Windows API function to copy the data from
31084>>>//    the editor window into a DataFlex string.
31084>>>//
31084>>>// $Rev History
31084>>>//    04/25/00 VO Module header created
31084>>>//****************************************************************************
31084>>>//Function EditWindowText Returns String
31084>>>//   Integer iTextLen iRetval
31084>>>//   Handle hWnd
31084>>>//   String sFullText
31084>>>//   Pointer lpsFullText
31084>>>
31084>>>//   Get Window_Handle of (oMensagem(Self)) To hWnd
31084>>>//   If (hWnd <> 0) Begin
31084>>>//      Move (SendMessage (hWnd, WM_GETTEXTLENGTH, 0, 0)) To iTextLen
31084>>>//      If (iTextLen <> 0) Begin
31084>>>//         Increment iTextLen
31084>>>//         ZeroString iTextLen To sFullText
31084>>>//         GetAddress Of sFullText To lpsFullText
31084>>>//         Move (SendMessage (hWnd, WM_GETTEXT, iTextLen, lpsFullText)) To iRetval
31084>>>//      End
31084>>>//   End
31084>>>
31084>>>//   Function_Return sFullText
31084>>>//End_Function // EditWindowText
31084>>>
31084>>>USE      CSAG300.DD
Including file: CSAG300.DD    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG300.DD)
31084>>>>>//-2WA
31084>>>>>// Class Name: Csag300_DataDictionary
31084>>>>>// Revision  : 101
31084>>>>>// Version   : 2
31084>>>>>
31084>>>>>Use CtrlData.PKG
Including file: CtrlData.PKG    (C:\Program Files (x86)\DataFlex 18.2\Pkg\CtrlData.PKG)
31084>>>>>>>//-----------------------------------------------------------------
31084>>>>>>>// 2WA TECNOLOGIA DA INFORMACAO
31084>>>>>>>//-----------------------------------------------------------------
31084>>>>>>>// Author: Anderson Rodrigues - 21.01.2014
31084>>>>>>>// Comments: Esta classe tem o objetivo de registrar/controlar os
31084>>>>>>>//           modulos de Inclusao/Altercao/Exclusao. Foi modificada
31084>>>>>>>//           com base na classe anterior DATACTRL.PKG
31084>>>>>>>//-----------------------------------------------------------------
31084>>>>>>>// Author: Anderson Rodrigues - 22.01.2014
31084>>>>>>>// Comments: Trabalhar com uma Array com duas dimensoes
31084>>>>>>>//           Formula Generica: Pos = (((x-1)*dim_1)+y)
31084>>>>>>>//     Onde:
31084>>>>>>>//           Pos = Posicao absoluta dentro da matriz sequencial
31084>>>>>>>//             x = Numero da linha a ser manipulada
31084>>>>>>>//             y = Numero da coluna a der manipulada
31084>>>>>>>//         Dim_1 = Maximo de colunas
31084>>>>>>>//-----------------------------------------------------------------
31084>>>>>>>//-2WA
31084>>>>>>>Use Func.pkg
31084>>>>>>>Use WebEdit.pkg
Including file: WEBEDIT.PKG    (C:\Program Files (x86)\DataFlex 18.2\Pkg\WEBEDIT.PKG)
31084>>>>>>>>>// ANDERSON RODRIGUES 27.07.2004 17:31
31084>>>>>>>>>
31084>>>>>>>>>// Class: Edit
31084>>>>>>>>>//
31084>>>>>>>>>//  1. Add Standard entry support
31084>>>>>>>>>//
31084>>>>>>>>>
31084>>>>>>>>>Use Dfbase.pkg
31084>>>>>>>>>
31084>>>>>>>>>Class c_Edit Is A DfBaseEdit
31085>>>>>>>>>
31085>>>>>>>>>    Procedure Construct_Object
31087>>>>>>>>>        Forward Send Construct_Object
31089>>>>>>>>>        Send Define_Standard_Object_Mixin
31090>>>>>>>>>        Send Define_Dflabel_Mixin
31091>>>>>>>>>        set file_name to ""
31092>>>>>>>>>    End_Procedure // Construct_Object
31093>>>>>>>>>
31093>>>>>>>>>    Import_Class_Protocol Standard_Object_Mixin
31094>>>>>>>>>    Import_Class_Protocol Dflabel_Mixin
31095>>>>>>>>>    Import_Class_Protocol Shadow_Mixin
31096>>>>>>>>>
31096>>>>>>>>>End_Class // Edit
31097>>>>>>>Use DataDict.pkg 
31097>>>>>>>Use SqlFind.pkg
31097>>>>>>>
31097>>>>>>>// LOGDATA.fd - CTRL DAS TRANSACOES
31097>>>>>>>
31097>>>>>>>
31097>>>>>>>//LOGTEXT - CTRL DE LOG TRANS TXT
31097>>>>>>>
31097>>>>>>>Struct tFieldTypeofGrid      
31097>>>>>>>    Integer igridFieldNum        
31097>>>>>>>    String  sgridFieldType       
31097>>>>>>>    String  sgridFieldParam      
31097>>>>>>>End_Struct //tFieldTypeofGrid
31097>>>>>>>
31097>>>>>>>Class c_DataDictionary is a DataDictionary
31098>>>>>>>
31098>>>>>>>    Procedure Construct_Object
31100>>>>>>>
31100>>>>>>>        String[] saDDValue
31101>>>>>>>        Forward Send Construct_Object
31103>>>>>>>             
31103>>>>>>>        Property String[] psaDDValue
31104>>>>>>>        Property String   psProgramName
31105>>>>>>>
31105>>>>>>>        Object oChgd_Fld_A is an Array
31107>>>>>>>        // Array com duas dimensoes
31107>>>>>>>        // Formula: (((x-1)*dim_1)+y)
31107>>>>>>>        End_Object  // oChgd_Fld_A
31108>>>>>>>
31108>>>>>>>        Object oChgd_Fld_B is an Array
31110>>>>>>>        // Array com duas dimensoes
31110>>>>>>>        // Formula: (((x-1)*dim_1)+y)
31110>>>>>>>        End_Object  // oChgd_Fld_B
31111>>>>>>>    
31111>>>>>>>        Object oChgd_Fld_C is an Array
31113>>>>>>>        // Array com duas dimensoes
31113>>>>>>>        // Formula: (((x-1)*dim_1)+y)
31113>>>>>>>        End_Object  // oChgd_Fld_C
31114>>>>>>>    
31114>>>>>>>        Object oChgd_Fld_D is an Array
31116>>>>>>>        // Array com duas dimensoes
31116>>>>>>>        // Formula: (((x-1)*dim_1)+y)
31116>>>>>>>        End_Object  // oChgd_Fld_D
31117>>>>>>>    
31117>>>>>>>//        Object oRascunho is a c_Edit
31117>>>>>>>//        End_Object // oRascunho
31117>>>>>>>    
31117>>>>>>>        Move "" to saDDValue[0]
31118>>>>>>>        Move "" to saDDValue[1]
31119>>>>>>>        Move "" to saDDValue[2]
31120>>>>>>>        Move "" to saDDValue[3]
31121>>>>>>>        Move "" to saDDValue[4]
31122>>>>>>>        Move 0  to saDDValue[5]
31123>>>>>>>        Move 0  to saDDValue[6]
31124>>>>>>>        Move 0  to saDDValue[7]
31125>>>>>>>        Move 0  to saDDValue[8]
31126>>>>>>>        Move 0  to saDDValue[9]
31127>>>>>>>    
31127>>>>>>>        Set psaDDValue to saDDValue
31128>>>>>>>        
31128>>>>>>>        //DEFINE EXTERNAL FILE
31128>>>>>>>        Set Add_System_File to (Eval('LOGDATA.FILE_NUMBER')) DD_LOCK_ON_ALL  
31129>>>>>>>        Set Add_System_File to (Eval('LOGTEXT.FILE_NUMBER')) DD_LOCK_ON_ALL 
31130>>>>>>>        
31130>>>>>>>    End_Procedure // Construct_Object 
31131>>>>>>>    
31131>>>>>>>    Use CtrlOperac.pkg
Including file: CtrlOperac.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\CtrlOperac.pkg)
31131>>>>>>>>>//********************************************************************************************
31131>>>>>>>>>//** Author..: Anderson
31131>>>>>>>>>//** Date....: 21/01/2014
31131>>>>>>>>>//** Revision: 3.0
31131>>>>>>>>>//** Comment.: Esta versao visa atender tambem os campos do tipo texto. 
31131>>>>>>>>>//             Passa a trabalhar com campos do tipo DATETIME.
31131>>>>>>>>>//             Homologada para banco de dados SQLSERVER
31131>>>>>>>>>//********************************************************************************************
31131>>>>>>>>>//** Author..: Anderson Rodrigues
31131>>>>>>>>>//** Date....: 23/01/2014
31131>>>>>>>>>//** Comment.: Trabalhar com uma Array com duas dimensoes
31131>>>>>>>>>//             Formula Generica: Pos = (((x-1)*dim_1)+y)
31131>>>>>>>>>//             Onde:
31131>>>>>>>>>//                  Pos = Posicao absoluta dentro da matriz sequencial
31131>>>>>>>>>//                    x = Numero da linha a ser manipulada
31131>>>>>>>>>//                    y = Numero da coluna a der manipulada
31131>>>>>>>>>//                Dim_1 = Maximo de colunas
31131>>>>>>>>>//********************************************************************************************
31131>>>>>>>>>//** Author..: Anderson Rodrigues
31131>>>>>>>>>//** Date....: 23/01/2014
31131>>>>>>>>>//** Comment.: Chamar a procedure p_FileFieldOperation e passar os seguintes parametros:
31131>>>>>>>>>//              {NUMERO_OPERACAO} - 0 (armazenar o conteudo dos campos numa matriz)
31131>>>>>>>>>//                                     uso: BACKOUT
31131>>>>>>>>>//                                - 1 (ALTERACAO)
31131>>>>>>>>>//                                     uso: SAVE_MAIN_FILE
31131>>>>>>>>>//                                - 2 (INCLUSAO)
31131>>>>>>>>>//                                     uso: SAVE_MAIN_FILE
31131>>>>>>>>>//                                - 3 (EXCLUSAO)
31131>>>>>>>>>//                                     uso: DELETING
31131>>>>>>>>>//             "{NOMEDOPROGRAMA}" - Nome do programa que executou a operacao.
31131>>>>>>>>>//             "{CSAG308_NR}"     - Numero da empresa que administra toda a cadeia.
31131>>>>>>>>>//             "{CSAG308_NM}"     - Nome da empresa que administra toda a cadeia.
31131>>>>>>>>>//             "{CSAG300_ID}"     - Identificador do usuario que executou a operacao.
31131>>>>>>>>>//             "{CSAG300_DS}"     - Descricao do usuario que executou a operacao.
31131>>>>>>>>>//             "{SESSIONID}"      - Identificador da sessao usada pelo usuario para executar a acao.
31131>>>>>>>>>//             "{IPADDRESS}"      - Numero endereco IP usado pelo usuario para executar a acao.
31131>>>>>>>>>//
31131>>>>>>>>>//** Exemplo.:
31131>>>>>>>>>//
31131>>>>>>>>>//            Deleting:
31131>>>>>>>>>//            
31131>>>>>>>>>//            Procedure Deleting
31131>>>>>>>>>//               Forward Send Deleting
31131>>>>>>>>>//               Send p_FileFieldOperation 3 "PCGDI0060_1" "8" "2WA" "114" "JOAQUIM CRUZ" "bc96ddcabbb18be26b3a6fa38ca678afb8112e15182811e3dde5eab8cbb00107" "192:168:1:1"
31131>>>>>>>>>//            End_Procedure   // Deleting
31131>>>>>>>>>//
31131>>>>>>>>>//
31131>>>>>>>>>//            Save_Main_File:
31131>>>>>>>>>//            
31131>>>>>>>>>//            Procedure Save_Main_File
31131>>>>>>>>>//               Integer iRECNUM
31131>>>>>>>>>//               Move TABELA.RECNUM to iRECNUM
31131>>>>>>>>>//               Forward Send Save_Main_File
31131>>>>>>>>>//               If (iRECNUM=0) Begin
31131>>>>>>>>>//                  //--- NOVO REGISTRO
31131>>>>>>>>>//                  Send p_FileFieldOperation 2 "PCGDI0060_1" "8" "2WA" "114" "JOAQUIM CRUZ" "bc96ddcabbb18be26b3a6fa38ca678afb8112e15182811e3dde5eab8cbb00107" "192:168:1:1"
31131>>>>>>>>>//               End
31131>>>>>>>>>//               Else Begin
31131>>>>>>>>>//                  //--- REGISTRO ALTERADO
31131>>>>>>>>>//                  Send p_FileFieldOperation 1 "PCGDI0060_1" "8" "2WA" "114" "JOAQUIM CRUZ" "bc96ddcabbb18be26b3a6fa38ca678afb8112e15182811e3dde5eab8cbb00107" "192:168:1:1"
31131>>>>>>>>>//               End
31131>>>>>>>>>//            End_Procedure   // Save_Main_File
31131>>>>>>>>>//
31131>>>>>>>>>//
31131>>>>>>>>>//            Backout:
31131>>>>>>>>>//            
31131>>>>>>>>>//            Procedure Backout
31131>>>>>>>>>//               Forward Send Backout
31131>>>>>>>>>//                  Send p_FileFieldOperation 0 "PCGDI0060_1" "8" "2WA" "114" "JOAQUIM CRUZ" "bc96ddcabbb18be26b3a6fa38ca678afb8112e15182811e3dde5eab8cbb00107" "192:168:1:1"
31131>>>>>>>>>//            End_Procedure   // Backout
31131>>>>>>>>>//
31131>>>>>>>>>//********************************************************************************************
31131>>>>>>>>>
31131>>>>>>>>>Procedure p_FileFieldOperation Integer iOper ;                                String sProgDS ;                                String sCSAG308NR ;                                String sCSAG308NM ;                                String sUsuarioID ;                                String sUsuarioDS ;                                String sSessionID ;                                String sAddress
31133>>>>>>>>>    
31133>>>>>>>>>    //DECLARACAO DAS VARIAVES LOCAIS
31133>>>>>>>>>    Integer iNrFld 
31133>>>>>>>>>    Integer iTtFld 
31133>>>>>>>>>    Integer iType 
31133>>>>>>>>>    Integer iQtdA
31133>>>>>>>>>    Integer iQtdB
31133>>>>>>>>>    Integer iRecID 
31133>>>>>>>>>
31133>>>>>>>>>    Integer iFileID
31133>>>>>>>>>    Handle  hObjA 
31133>>>>>>>>>    Handle  hObjB 
31133>>>>>>>>>    
31133>>>>>>>>>    String  sFieldA 
31133>>>>>>>>>    String  sFieldB 
31133>>>>>>>>>    String  sFileDS 
31133>>>>>>>>>    String  sFieldD 
31133>>>>>>>>>    String  sLocal 
31133>>>>>>>>>    String  sOperTP
31133>>>>>>>>>    
31133>>>>>>>>>    //--- IDENTIFICAR A TABELA PRINCIPAL DO DICIONARIO DE DADOS
31133>>>>>>>>>    Move (Main_File(Self))       to iFileID
31134>>>>>>>>>    
31134>>>>>>>>>    //--- IDENTIFICAR OS OBJETOS DE ARRAY
31134>>>>>>>>>    Get Object_Id of oChgd_Fld_A to hObjA
31135>>>>>>>>>    Get Object_Id of oChgd_Fld_B to hObjB
31136>>>>>>>>>    
31136>>>>>>>>>    //--- OBTER INFORMACOES SONRE A TABELA PRINCIPAL
31136>>>>>>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS of iFileID to iTtFld
31139>>>>>>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  of iFileID to sFileDS
31142>>>>>>>>>    
31142>>>>>>>>>    //--- UPPERCASE
31142>>>>>>>>>    Move (UpperCase(sProgDS)) to sProgDS
31143>>>>>>>>>    Move (UpperCase(sFileDS)) to sFileDS
31144>>>>>>>>>    
31144>>>>>>>>>    //--- SABER SE A ARRAY CONTEM INFORMACAO
31144>>>>>>>>>    Get Item_Count of hObjA to iQtdA
31145>>>>>>>>>    Get Item_Count of hObjB to iQtdB
31146>>>>>>>>>    
31146>>>>>>>>>    If (iOper=0) Begin
31148>>>>>>>>>        Send Delete_Data of hObjA  
31149>>>>>>>>>        Send Delete_Data of hObjB  
31150>>>>>>>>>        For iNrFld from 1 to iTtFld
31156>>>>>>>>>>
31156>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31159>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31161>>>>>>>>>                
31161>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldB
31164>>>>>>>>>                
31164>>>>>>>>>                Move (Trim(sFieldB)) to sFieldB
31165>>>>>>>>>                
31165>>>>>>>>>                If (iType=DF_TEXT) ;                    Set Value of hObjB item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31168>>>>>>>>>                Else ;                    Set Value of hObjA item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31170>>>>>>>>>            End
31170>>>>>>>>>>
31170>>>>>>>>>        Loop
31171>>>>>>>>>>
31171>>>>>>>>>    End
31171>>>>>>>>>>
31171>>>>>>>>>    Else If (iOper=1 and (iQtdA>0 or iQtdB>0)) Begin
31174>>>>>>>>>        Move "ALTERACAO" to sOperTP
31175>>>>>>>>>        For iNrFld from 1 to iTtFld
31181>>>>>>>>>>
31181>>>>>>>>>            
31181>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31184>>>>>>>>>            
31184>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin 
31186>>>>>>>>>                
31186>>>>>>>>>               Get_Field_Value iFileID iNrFld to sFieldA
31189>>>>>>>>>               Get_Field_Value iFileID 0      to iRecID
31192>>>>>>>>>               
31192>>>>>>>>>               If (iType=DF_TEXT) ;                   Get Value of hObjB item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31195>>>>>>>>>               Else ;                   Get Value of hObjA item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31197>>>>>>>>>               
31197>>>>>>>>>               Move (Trim(sFieldB))           to sFieldB
31198>>>>>>>>>               Move (Trim(sFieldA))           to sFieldA
31199>>>>>>>>>               
31199>>>>>>>>>               If (sFieldA<>sFieldB) Begin
31201>>>>>>>>>                    Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31204>>>>>>>>>                    If (iType=DF_TEXT) ;                        Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31207>>>>>>>>>                    Else ;                        Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31209>>>>>>>>>               End
31209>>>>>>>>>>
31209>>>>>>>>>            End
31209>>>>>>>>>>
31209>>>>>>>>>        Loop
31210>>>>>>>>>>
31210>>>>>>>>>        Send Delete_Data to hObjA
31211>>>>>>>>>        Send Delete_Data to hObjB
31212>>>>>>>>>    End
31212>>>>>>>>>>
31212>>>>>>>>>    Else If (iOper=2) Begin
31215>>>>>>>>>        Move "INCLUSAO" to sOperTP
31216>>>>>>>>>        For iNrFld from 1 to iTtFld
31222>>>>>>>>>>
31222>>>>>>>>>            
31222>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31225>>>>>>>>>            
31225>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31227>>>>>>>>>                
31227>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldA       
31230>>>>>>>>>                Get_Field_Value iFileID 0      to iRecID
31233>>>>>>>>>                
31233>>>>>>>>>                Move ""                        to sFieldB
31234>>>>>>>>>                Move (Trim(sFieldA))           to sFieldA
31235>>>>>>>>>                
31235>>>>>>>>>                Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31238>>>>>>>>>                If (iType=DF_TEXT) ;                    Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31241>>>>>>>>>                Else ;                    Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31243>>>>>>>>>            End
31243>>>>>>>>>>
31243>>>>>>>>>        Loop
31244>>>>>>>>>>
31244>>>>>>>>>        Send Delete_Data to hObjA
31245>>>>>>>>>        Send Delete_Data to hObjB
31246>>>>>>>>>    End
31246>>>>>>>>>>
31246>>>>>>>>>    Else If (iOper=3) Begin
31249>>>>>>>>>        Move "EXCLUSAO" to sOperTP
31250>>>>>>>>>        For iNrFld from 1 to iTtFld
31256>>>>>>>>>>
31256>>>>>>>>>            
31256>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31259>>>>>>>>>            
31259>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31261>>>>>>>>>        
31261>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldB
31264>>>>>>>>>                Get_Field_Value iFileID 0      to iRecID
31267>>>>>>>>>                
31267>>>>>>>>>                Move (Trim(sFieldB))           to sFieldB
31268>>>>>>>>>                Move ""                        to sFieldA
31269>>>>>>>>>                
31269>>>>>>>>>                Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31272>>>>>>>>>                
31272>>>>>>>>>                If (iType=DF_TEXT) ;                    Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31275>>>>>>>>>                Else ;                    Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31277>>>>>>>>>            End
31277>>>>>>>>>>
31277>>>>>>>>>        Loop
31278>>>>>>>>>>
31278>>>>>>>>>        Send Delete_Data to hObjA
31279>>>>>>>>>        Send Delete_Data to hObjB
31280>>>>>>>>>    End
31280>>>>>>>>>>
31280>>>>>>>>>End_Procedure //p_FFOperation
31281>>>>>>>>>
31281>>>>>>>>>
31281>>>>>>>>>Procedure p_FileFieldOperationTable Integer iFileID;                                    Integer iOper ;                                    String sProgDS ;                                    String sCSAG308NR ;                                    String sCSAG308NM ;                                    String sUsuarioID ;                                    String sUsuarioDS ;                                    String sSessionID ;                                    String sAddress
31283>>>>>>>>>    
31283>>>>>>>>>    //DECLARACAO DAS VARIAVES LOCAIS
31283>>>>>>>>>    Integer iNrFld 
31283>>>>>>>>>    Integer iTtFld 
31283>>>>>>>>>    Integer iType 
31283>>>>>>>>>    Integer iQtdA
31283>>>>>>>>>    Integer iQtdB
31283>>>>>>>>>    Integer iRecID 
31283>>>>>>>>>
31283>>>>>>>>>    Handle  hObjC 
31283>>>>>>>>>    Handle  hObjD 
31283>>>>>>>>>    
31283>>>>>>>>>    String  sFieldA 
31283>>>>>>>>>    String  sFieldB 
31283>>>>>>>>>    String  sFileDS 
31283>>>>>>>>>    String  sFieldD 
31283>>>>>>>>>    String  sLocal 
31283>>>>>>>>>    String  sOperTP
31283>>>>>>>>>    
31283>>>>>>>>>    //--- IDENTIFICAR OS OBJETOS DE ARRAY
31283>>>>>>>>>    Get Object_Id of oChgd_Fld_C to hObjC
31284>>>>>>>>>    Get Object_Id of oChgd_Fld_D to hObjD
31285>>>>>>>>>    
31285>>>>>>>>>    //--- OBTER INFORMACOES SONRE A TABELA PRINCIPAL
31285>>>>>>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS of iFileID to iTtFld
31288>>>>>>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  of iFileID to sFileDS
31291>>>>>>>>>    
31291>>>>>>>>>    //--- UPPERCASE
31291>>>>>>>>>    Move (UpperCase(sProgDS)) to sProgDS
31292>>>>>>>>>    Move (UpperCase(sFileDS)) to sFileDS
31293>>>>>>>>>    
31293>>>>>>>>>    //--- SABER SE A ARRAY CONTEM INFORMACAO
31293>>>>>>>>>    Get Item_Count of hObjC to iQtdA
31294>>>>>>>>>    Get Item_Count of hObjD to iQtdB
31295>>>>>>>>>    
31295>>>>>>>>>    If (iOper=0) Begin
31297>>>>>>>>>        Send Delete_Data of hObjC  
31298>>>>>>>>>        Send Delete_Data of hObjD  
31299>>>>>>>>>        For iNrFld from 1 to iTtFld
31305>>>>>>>>>>
31305>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31308>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31310>>>>>>>>>                
31310>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldB
31313>>>>>>>>>                
31313>>>>>>>>>                Move (Trim(sFieldB)) to sFieldB
31314>>>>>>>>>                
31314>>>>>>>>>                If (iType=DF_TEXT) ;                    Set Value of hObjD item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31317>>>>>>>>>                Else ;                    Set Value of hObjC item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31319>>>>>>>>>            End
31319>>>>>>>>>>
31319>>>>>>>>>        Loop
31320>>>>>>>>>>
31320>>>>>>>>>    End
31320>>>>>>>>>>
31320>>>>>>>>>    Else If (iOper=1 and (iQtdA>0 or iQtdB>0)) Begin
31323>>>>>>>>>        Move "ALTERACAO" to sOperTP
31324>>>>>>>>>        For iNrFld from 1 to iTtFld
31330>>>>>>>>>>
31330>>>>>>>>>            
31330>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31333>>>>>>>>>            
31333>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin 
31335>>>>>>>>>                
31335>>>>>>>>>               Get_Field_Value iFileID iNrFld to sFieldA
31338>>>>>>>>>               Get_Field_Value iFileID 0      to iRecID
31341>>>>>>>>>               
31341>>>>>>>>>               If (iType=DF_TEXT) ;                   Get Value of hObjD item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31344>>>>>>>>>               Else ;                   Get Value of hObjC item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31346>>>>>>>>>               
31346>>>>>>>>>               Move (Trim(sFieldB))           to sFieldB
31347>>>>>>>>>               Move (Trim(sFieldA))           to sFieldA
31348>>>>>>>>>               
31348>>>>>>>>>               If (sFieldA<>sFieldB) Begin
31350>>>>>>>>>                    Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31353>>>>>>>>>                    If (iType=DF_TEXT) ;                        Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31356>>>>>>>>>                    Else ;                        Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31358>>>>>>>>>               End
31358>>>>>>>>>>
31358>>>>>>>>>            End
31358>>>>>>>>>>
31358>>>>>>>>>        Loop
31359>>>>>>>>>>
31359>>>>>>>>>        Send Delete_Data to hObjC
31360>>>>>>>>>        Send Delete_Data to hObjD
31361>>>>>>>>>    End
31361>>>>>>>>>>
31361>>>>>>>>>    Else If (iOper=2) Begin
31364>>>>>>>>>        Move "INCLUSAO" to sOperTP
31365>>>>>>>>>        For iNrFld from 1 to iTtFld
31371>>>>>>>>>>
31371>>>>>>>>>            
31371>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31374>>>>>>>>>            
31374>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31376>>>>>>>>>                
31376>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldA       
31379>>>>>>>>>                Get_Field_Value iFileID 0      to iRecID
31382>>>>>>>>>                
31382>>>>>>>>>                Move ""                        to sFieldB
31383>>>>>>>>>                Move (Trim(sFieldA))           to sFieldA
31384>>>>>>>>>                
31384>>>>>>>>>                Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31387>>>>>>>>>                If (iType=DF_TEXT) ;                    Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31390>>>>>>>>>                Else ;                    Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31392>>>>>>>>>            End
31392>>>>>>>>>>
31392>>>>>>>>>        Loop
31393>>>>>>>>>>
31393>>>>>>>>>        Send Delete_Data to hObjC
31394>>>>>>>>>        Send Delete_Data to hObjD
31395>>>>>>>>>    End
31395>>>>>>>>>>
31395>>>>>>>>>    Else If (iOper=3) Begin
31398>>>>>>>>>        Move "EXCLUSAO" to sOperTP
31399>>>>>>>>>        For iNrFld from 1 to iTtFld
31405>>>>>>>>>>
31405>>>>>>>>>            
31405>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31408>>>>>>>>>            
31408>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31410>>>>>>>>>        
31410>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldB
31413>>>>>>>>>                Get_Field_Value iFileID 0      to iRecID
31416>>>>>>>>>                
31416>>>>>>>>>                Move (Trim(sFieldB))           to sFieldB
31417>>>>>>>>>                Move ""                        to sFieldA
31418>>>>>>>>>                
31418>>>>>>>>>                Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31421>>>>>>>>>                
31421>>>>>>>>>                If (iType=DF_TEXT) ;                    Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31424>>>>>>>>>                Else ;                    Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31426>>>>>>>>>            End
31426>>>>>>>>>>
31426>>>>>>>>>        Loop
31427>>>>>>>>>>
31427>>>>>>>>>        Send Delete_Data to hObjC
31428>>>>>>>>>        Send Delete_Data to hObjD
31429>>>>>>>>>    End
31429>>>>>>>>>>
31429>>>>>>>>>End_Procedure //p_FileFieldOperationTable
31430>>>>>>>>>
31430>>>>>>>>>
31430>>>>>>>>>Procedure p_Log_LOGDATA String sOperTP ;                         String sFileDS ;                         Integer iFileID ;                         Integer iRecID ;                         String sFieldB ;                         String sFieldA ;                         String sFieldD ;                         Integer iNrFld ;                         String sProgDS ;                         String sCSAG308NR ;                         String sCSAG308NM ;                         String sUsuarioID ;                         String sUsuarioDS ;                         String sSessionID ;                         String sAddress
31432>>>>>>>>>    
31432>>>>>>>>>    
31432>>>>>>>>>    //---REGISTRANDO LOG DA INFORMACAO
31432>>>>>>>>>    Clear LOGDATA
31433>>>>>>>>>    Move sCSAG308NR                 to LOGDATA.CSAG308_NR    
31434>>>>>>>>>    Move sCSAG308NM                 to LOGDATA.CSAG308_NM
31435>>>>>>>>>    Move sUsuarioID                 to LOGDATA.CSAG300_ID    
31436>>>>>>>>>    Move sUsuarioDS                 to LOGDATA.CSAG300_DS
31437>>>>>>>>>    Move sProgDS                    to LOGDATA.PROGRAMA_NM
31438>>>>>>>>>    Move (CurrentDateTime())        to LOGDATA.DATE_TIME
31439>>>>>>>>>    Move sOperTP                    to LOGDATA.TIPO 
31440>>>>>>>>>    Move iFileID                    to LOGDATA.FILE_ID
31441>>>>>>>>>    Move sFileDS                    to LOGDATA.FILE_DS
31442>>>>>>>>>    Move iRecID                     to LOGDATA.FILE_RECNUM
31443>>>>>>>>>    Move iNrFld                     to LOGDATA.FIELD_ID
31444>>>>>>>>>    Move sFieldD                    to LOGDATA.FIELD_DS
31445>>>>>>>>>    Move sFieldB                    to LOGDATA.FIELD_BEFORE
31446>>>>>>>>>    Move sFieldA                    to LOGDATA.FIELD_AFTER
31447>>>>>>>>>    Move sAddress                   to LOGDATA.IP_ADDRESS
31448>>>>>>>>>    Move sSessionID                 to LOGDATA.SESSIONID
31449>>>>>>>>>    SaveRecord LOGDATA
31450>>>>>>>>>    
31450>>>>>>>>>End_Procedure //p_Log_LOGDATA       
31451>>>>>>>>>
31451>>>>>>>>>Procedure p_Log_LOGTEXT String sOperTP ;                         String sFileDS ;                         Integer iFileID ;                         Integer iRecID ;                         String sFieldB ;                         String sFieldA ;                         String sFieldD ;                         Integer iNrFld ;                         String sProgDS ;                         String sCSAG308NR ;                         String sCSAG308NM ;                         String sUsuarioID ;                         String sUsuarioDS ;                         String sSessionID ;                         String sAddress
31453>>>>>>>>>    
31453>>>>>>>>>    //---REGISTRANDO LOG DA INFORMACAO
31453>>>>>>>>>    Clear LOGTEXT
31454>>>>>>>>>    Move sCSAG308NR                 to LOGTEXT.CSAG308_NR    
31455>>>>>>>>>    Move sCSAG308NM                 to LOGTEXT.CSAG308_NM
31456>>>>>>>>>    Move sUsuarioID                 to LOGTEXT.CSAG300_ID    
31457>>>>>>>>>    Move sUsuarioDS                 to LOGTEXT.CSAG300_DS
31458>>>>>>>>>    Move sProgDS                    to LOGTEXT.PROGRAMA_NM
31459>>>>>>>>>    Move (CurrentDateTime())        to LOGTEXT.DATE_TIME
31460>>>>>>>>>    Move sOperTP                    to LOGTEXT.TIPO 
31461>>>>>>>>>    Move iFileID                    to LOGTEXT.FILE_ID
31462>>>>>>>>>    Move sFileDS                    to LOGTEXT.FILE_DS
31463>>>>>>>>>    Move iRecID                     to LOGTEXT.FILE_RECNUM
31464>>>>>>>>>    Move iNrFld                     to LOGTEXT.FIELD_ID
31465>>>>>>>>>    Move sFieldD                    to LOGTEXT.FIELD_DS
31466>>>>>>>>>    Move sFieldB                    to LOGTEXT.FIELD_BEFORE
31467>>>>>>>>>    Move sFieldA                    to LOGTEXT.FIELD_AFTER
31468>>>>>>>>>    Move sAddress                   to LOGTEXT.IP_ADDRESS
31469>>>>>>>>>    Move sSessionID                 to LOGTEXT.SESSIONID
31470>>>>>>>>>    SaveRecord LOGTEXT
31471>>>>>>>>>    
31471>>>>>>>>>End_Procedure //p_Log_LOGTEXT       
31472>>>>>>>    Use CtrlUsr.pkg
Including file: CtrlUsr.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\CtrlUsr.pkg)
31472>>>>>>>>>//********************************************************************************************
31472>>>>>>>>>//** Author..: Anderson Rodrigues
31472>>>>>>>>>//** Date....: 02/01/2002
31472>>>>>>>>>//** Revisao.: 2.1
31472>>>>>>>>>//** Comment.: Esta procedure tem por definicao guardar automaticamente
31472>>>>>>>>>//             o nome do usuario que fez qualquer alteracao/inclusao no registro
31472>>>>>>>>>//             a data e a hora da alteracao.
31472>>>>>>>>>//********************************************************************************************
31472>>>>>>>>>//** Author..: Anderson Rodrigues
31472>>>>>>>>>//** Date....: 22/11/2009
31472>>>>>>>>>//** Revisao.: 3.1
31472>>>>>>>>>//********************************************************************************************
31472>>>>>>>>>//** Author..: Anderson Rodrigues
31472>>>>>>>>>//** Date....: 22/01/2014
31472>>>>>>>>>//** Revisao.: 4.1
31472>>>>>>>>>//********************************************************************************************
31472>>>>>>>>>
31472>>>>>>>>>Procedure p_RegistraAcessoUsuario String sField String sUsuario
31474>>>>>>>>>    
31474>>>>>>>>>    Integer  iFile 
31474>>>>>>>>>    Integer  iField
31474>>>>>>>>>    
31474>>>>>>>>>    String   sFile
31474>>>>>>>>>    
31474>>>>>>>>>    DateTime dtCurrentDateTime
31474>>>>>>>>>       
31474>>>>>>>>>    Move (CurrentDateTime())       to dtCurrentDateTime
31475>>>>>>>>>    //Move (CurrentSystemTime())       to dtCurrentDateTime
31475>>>>>>>>>    
31475>>>>>>>>>    // Extrair da variavel sField o "NOME DO ARQUIVO." -----------------
31475>>>>>>>>>    Move (Left(sField,(Pos(".",sField))))   to sFile
31476>>>>>>>>>    
31476>>>>>>>>>    // Remover da variavel sField o "NOME DO ARQUIVO." -----------------
31476>>>>>>>>>    Move (Replace(sFile,sField,""))         to sField
31477>>>>>>>>>    
31477>>>>>>>>>    // Concatenar o NOME DO ARQUIVO. + FILE_NUMBER ---------------------
31477>>>>>>>>>    Move (sFile+"File_Number")              to sFile
31478>>>>>>>>>    
31478>>>>>>>>>    // Pegar o numero do arquivo ---------------------------------------
31478>>>>>>>>>    Move (Eval(sFile))                      to iFile
31479>>>>>>>>>
31479>>>>>>>>>    // Pegar o numero do campo no arquivo ------------------------------
31479>>>>>>>>>    Field_Map iFile sField                  to iField      
31481>>>>>>>>>    
31481>>>>>>>>>    Set_Field_Value iFile  iField           to sUsuario
31484>>>>>>>>>    Set_Field_Value iFile (iField+1)        to dtCurrentDateTime
31487>>>>>>>>>    
31487>>>>>>>>>End_Procedure // p_RegistraAcessoUsuario
31488>>>>>>>>>    
31488>>>>>>>
31488>>>>>>>End_Class // c_DataDictionary
31489>>>>>Use Ddvaltbl.pkg          // Validation Table Class Definitions
31489>>>>>
31489>>>>>Open CSAG300
31491>>>>>Open TSMG801
Including file: TSMG801.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\TSMG801.fd)
31493>>>>>Open TSMG802
Including file: TSMG802.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\TSMG802.fd)
31495>>>>>Open CSAG315
Including file: CSAG315.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG315.fd)
31497>>>>>Open CSAG326
Including file: CSAG326.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG326.fd)
31499>>>>>Open CSAG361
Including file: CSAG361.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG361.fd)
31501>>>>>Open CSAG368
Including file: CSAG368.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG368.fd)
31503>>>>>Open CSAG398
Including file: CSAG398.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG398.fd)
31505>>>>>Open LOGDATA
31507>>>>>Open LOGTEXT
31509>>>>>Open CSAG311
31511>>>>>Open CSAG332
Including file: CSAG332.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG332.fd)
31513>>>>>Open CSAG333
Including file: CSAG333.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG333.fd)
31515>>>>>Open CSAG334
Including file: CSAG334.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG334.fd)
31517>>>>>Open CSAG400
Including file: CSAG400.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG400.fd)
31519>>>>>Open CSAG361
31521>>>>>Open CSAG363
Including file: CSAG363.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG363.fd)
31523>>>>>Open CSAG369
Including file: CSAG369.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG369.fd)
31525>>>>>Open CSAG374
Including file: CSAG374.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG374.fd)
31527>>>>>Open CSAG378
Including file: CSAG378.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG378.fd)
31529>>>>>Open CSAG316
Including file: CSAG316.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG316.fd)
31531>>>>>Open CSAG364
Including file: CSAG364.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG364.fd)
31533>>>>>Open CSAG400
31535>>>>>Open CSAG332
31537>>>>>Open CSAG362
Including file: CSAG362.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG362.fd)
31539>>>>>Open CSAG314
Including file: CSAG314.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG314.fd)
31541>>>>>Open Tgrupo_economico
Including file: Tgrupo_economico.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\Tgrupo_economico.fd)
31543>>>>>Open Tgrupo_economico_pessoas
Including file: Tgrupo_economico_pessoas.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\Tgrupo_economico_pessoas.fd)
31545>>>>>
31545>>>>>Use TabelasdeValidacao.pkg
Including file: TabelasdeValidacao.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\TabelasdeValidacao.pkg)
31545>>>>>>>//-2WA
31545>>>>>>>Use ddvaltbl.pkg
31545>>>>>>>
31545>>>>>>>Open CSAG329
Including file: CSAG329.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG329.fd)
31547>>>>>>>Open CSAG379
Including file: CSAG379.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG379.fd)
31549>>>>>>>Open CSAG331
Including file: CSAG331.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG331.fd)
31551>>>>>>>Open CCGS204
Including file: CCGS204.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS204.fd)
31553>>>>>>>Open CCGS206
Including file: CCGS206.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS206.fd)
31555>>>>>>>Open CCGS221
Including file: CCGS221.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS221.fd)
31557>>>>>>>Open CCGS223
Including file: CCGS223.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS223.fd)
31559>>>>>>>Open CCGS224
Including file: CCGS224.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS224.fd)
31561>>>>>>>Open MSAG362
Including file: MSAG362.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\MSAG362.fd)
31563>>>>>>>Open CCGS225
Including file: CCGS225.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS225.fd)
31565>>>>>>>Open CCGS226
Including file: CCGS226.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS226.fd)
31567>>>>>>>Open CSAG367
31569>>>>>>>Open CSAG325
Including file: CSAG325.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG325.fd)
31571>>>>>>>Open CCGS247
Including file: CCGS247.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS247.fd)
31573>>>>>>>
31573>>>>>>>Register_Object oCLASSES_TAXA_FVT
31573>>>>>>>Register_Object oTRADES_FVT
31573>>>>>>>Register_Object oPAISES_FVT
31573>>>>>>>Register_Object oUF_FVT
31573>>>>>>>Register_Object oCARAC_EMBARQUE_FVT
31573>>>>>>>Register_Object oMODAL_PAGTO_FVT
31573>>>>>>>Register_Object oINCOTERMS_FVT
31573>>>>>>>Register_Object oTYPESOFDATE_FVT
31573>>>>>>>Register_Object oFREQUENCIA_FVT
31573>>>>>>>Register_Object oMSAG362_SISTEMA_FVT
31573>>>>>>>Register_Object oDESCRICOES_TARIFARIO_FVT
31573>>>>>>>Register_Object oHCGS3003_STATUS_VT
31573>>>>>>>Register_Object oCSAG367_FVT
31573>>>>>>>Register_Object oCSAG325_FVT
31573>>>>>>>Register_Object oIMO_PKG_FVT
31573>>>>>>>Register_Object oDensidadeUnit_VT
31573>>>>>>>Register_Object oIMO_PackingGroup_VT
31573>>>>>>>Register_Object oVolumeUnit_VT
31573>>>>>>>Register_Object oGrossUnit_VT
31573>>>>>>>Register_Object oUOMUnit_VT
31573>>>>>>>
31573>>>>>>>Object oCLASSES_TAXA_FVT is a FileValidationTable
31575>>>>>>>    Set Main_File           to CCGS221.File_Number
31576>>>>>>>    Set Code_Field          to 1
31577>>>>>>>    Set Description_Field   to 2
31578>>>>>>>    Set Ordering            to 2
31579>>>>>>>End_Object //oCLASSES_TAXA_FVT
31580>>>>>>>
31580>>>>>>>Object oCSAG367_FVT is a FileValidationTable
31582>>>>>>>    Set Validate_State      to False
31583>>>>>>>    Set Main_File           to CSAG367.File_Number
31584>>>>>>>    Set Code_Field          to 1
31585>>>>>>>    Set Description_Field   to 4
31586>>>>>>>    Set Ordering            to 1
31587>>>>>>>End_Object //oCSAG367_FVT
31588>>>>>>>
31588>>>>>>>Object oPAISES_FVT is a FileValidationTable
31590>>>>>>>    Set Validate_State      to False
31591>>>>>>>    Set Main_File           to CSAG329.File_Number
31592>>>>>>>    Set Code_Field          to 1
31593>>>>>>>    Set Description_Field   to 2
31594>>>>>>>    Set Ordering            to 2
31595>>>>>>>End_Object //oPAISES_FVT
31596>>>>>>>
31596>>>>>>>Object oTRADES_FVT is a FileValidationTable
31598>>>>>>>    Set Validate_State      to False
31599>>>>>>>    Set Main_File           to CSAG379.File_Number
31600>>>>>>>    Set Code_Field          to 1
31601>>>>>>>    Set Description_Field   to 2
31602>>>>>>>    Set Ordering            to 2
31603>>>>>>>End_Object //oTRADES_FVT
31604>>>>>>>
31604>>>>>>>//Object oUF_FVT is a FileValidationTable
31604>>>>>>>//    Set Main_File           to CSAG331.File_Number
31604>>>>>>>//    Set Code_Field          to 1
31604>>>>>>>//    Set Description_Field   to 2
31604>>>>>>>//    Set Ordering            to 2
31604>>>>>>>//End_Object //oUF_FVT
31604>>>>>>>
31604>>>>>>>Object oCARAC_EMBARQUE_FVT is a FileValidationTable
31606>>>>>>>    Set Main_File           to CCGS204.File_Number
31607>>>>>>>    Set Code_Field          to 1
31608>>>>>>>    Set Description_Field   to 2
31609>>>>>>>    Set Ordering            to 2
31610>>>>>>>End_Object //oCARAC_EMBARQUE_FVT
31611>>>>>>>
31611>>>>>>>Object oMODAL_PAGTO_FVT is a FileValidationTable
31613>>>>>>>    Set Main_File           to CCGS206.File_Number
31614>>>>>>>    Set Code_Field          to 1
31615>>>>>>>    Set Description_Field   to 2
31616>>>>>>>    Set Ordering            to 2
31617>>>>>>>End_Object //oMODAL_PAGTO_FVT
31618>>>>>>>
31618>>>>>>>Object oINCOTERMS_FVT is a FileValidationTable
31620>>>>>>>    Set Validate_State      to False
31621>>>>>>>    Set Main_File           to CCGS223.File_Number
31622>>>>>>>    Set Code_Field          to 1
31623>>>>>>>    Set Description_Field   to 2
31624>>>>>>>    Set Ordering            to 2
31625>>>>>>>End_Object //oINCOTERMS_FVT
31626>>>>>>>
31626>>>>>>>Object oTYPESOFDATE_FVT is a FileValidationTable
31628>>>>>>>    Set Validate_State      to False
31629>>>>>>>    Set Main_File           to CCGS224.File_Number
31630>>>>>>>    Set Code_Field          to 1
31631>>>>>>>    Set Description_Field   to 2
31632>>>>>>>    Set Ordering            to 2
31633>>>>>>>End_Object //oTYPESOFDATE_FVT
31634>>>>>>>
31634>>>>>>>Object oFREQUENCIA_FVT is a FileValidationTable
31636>>>>>>>    Set Validate_State      to False
31637>>>>>>>    Set Main_File           to CCGS226.File_Number
31638>>>>>>>    Set Code_Field          to 1
31639>>>>>>>    Set Description_Field   to 2
31640>>>>>>>    Set Ordering            to 2
31641>>>>>>>End_Object //oFREQUENCIA_FVT
31642>>>>>>>
31642>>>>>>>Object oMSAG362_SISTEMA_FVT is a FileValidationTable
31644>>>>>>>    Set Validate_State      to False
31645>>>>>>>    Set Main_File           to MSAG362.File_Number
31646>>>>>>>    Set Code_Field          to 1
31647>>>>>>>    Set Description_Field   to 2
31648>>>>>>>    Set Ordering            to 2
31649>>>>>>>End_Object //oMSAG362_SISTEMA_FVT
31650>>>>>>>
31650>>>>>>>Object oDESCRICOES_TARIFARIO_FVT is a FileValidationTable
31652>>>>>>>    Set Validate_State      to False
31653>>>>>>>    Set Main_File           to CCGS225.File_Number
31654>>>>>>>    Set Code_Field          to 1
31655>>>>>>>    Set Description_Field   to 1
31656>>>>>>>    Set Ordering            to 1
31657>>>>>>>End_Object //oDESCRICOES_TARIFARIO_FVT
31658>>>>>>>
31658>>>>>>>Object oHCGS3003_STATUS_VT is a DescriptionValidationTable
31660>>>>>>>    Procedure Fill_List
31663>>>>>>>        Forward Send Fill_List
31665>>>>>>>        Send Add_Table_Value "A" "Ativo"
31666>>>>>>>        Send Add_Table_Value "I" "Inativo"
31667>>>>>>>    End_Procedure
31668>>>>>>>End_Object //oHCGS3003_STATUS_VT
31669>>>>>>>
31669>>>>>>>Object oCSAG325_FVT is a FileValidationTable
31671>>>>>>>    Set Validate_State      to False
31672>>>>>>>    Set Main_File           to CSAG325.File_Number
31673>>>>>>>    Set Code_Field          to 1
31674>>>>>>>    Set Description_Field   to 2
31675>>>>>>>    Set Ordering            to 2
31676>>>>>>>End_Object //oCSAG325_FVT
31677>>>>>>>
31677>>>>>>>Object oIMO_PKG_FVT is a FileValidationTable
31679>>>>>>>    Set Main_File           to CCGS247.File_Number
31680>>>>>>>    Set Code_Field          to 1
31681>>>>>>>    Set Description_Field   to 2
31682>>>>>>>    Set Ordering            to 1
31683>>>>>>>End_Object //oIMO_PKG_FVT
31684>>>>>>>
31684>>>>>>>Object oDensidadeUnit_VT is a DescriptionValidationTable
31686>>>>>>>    Set Allow_Blank_State to True
31687>>>>>>>    Procedure Fill_List
31690>>>>>>>        Forward Send Fill_List
31692>>>>>>>        Send Add_Table_Value "cbmkg" "CBM/KG"
31693>>>>>>>        Send Add_Table_Value "cbmlb" "CBM/LB"
31694>>>>>>>        Send Add_Table_Value "cftkg" "CFT/KG"
31695>>>>>>>        Send Add_Table_Value "cftlb" "CFT/LB"
31696>>>>>>>    End_Procedure
31697>>>>>>>End_Object
31698>>>>>>>
31698>>>>>>>Object oIMO_PackingGroup_VT is a DescriptionValidationTable
31700>>>>>>>    Set Allow_Blank_State to True
31701>>>>>>>    Procedure Fill_List
31704>>>>>>>        Forward Send Fill_List
31706>>>>>>>        Send Add_Table_Value "1" "Packing Group I"
31707>>>>>>>        Send Add_Table_Value "2" "Packing Group II"
31708>>>>>>>        Send Add_Table_Value "3" "Packing Group III"
31709>>>>>>>    End_Procedure
31710>>>>>>>End_Object
31711>>>>>>>
31711>>>>>>>Object oVolumeUnit_VT is a DescriptionValidationTable
31713>>>>>>>    Set Allow_Blank_State to True
31714>>>>>>>    Procedure Fill_List
31717>>>>>>>        Forward Send Fill_List
31719>>>>>>>        Send Add_Table_Value "CBM" "CBM"
31720>>>>>>>        Send Add_Table_Value "CFT" "CFT"
31721>>>>>>>    End_Procedure
31722>>>>>>>End_Object
31723>>>>>>>
31723>>>>>>>Object oGrossUnit_VT is a DescriptionValidationTable
31725>>>>>>>    Set Allow_Blank_State to True
31726>>>>>>>    Procedure Fill_List
31729>>>>>>>        Forward Send Fill_List
31731>>>>>>>        Send Add_Table_Value "KG" "KG"
31732>>>>>>>        Send Add_Table_Value "LB" "LB"
31733>>>>>>>    End_Procedure
31734>>>>>>>End_Object
31735>>>>>>>
31735>>>>>>>Object oUOMUnit_VT is a DescriptionValidationTable
31737>>>>>>>    Set Allow_Blank_State to True
31738>>>>>>>    Procedure Fill_List
31741>>>>>>>        Forward Send Fill_List
31743>>>>>>>        Send Add_Table_Value "CM" "CM"
31744>>>>>>>        Send Add_Table_Value "Inches" "Inches"
31745>>>>>>>    End_Procedure
31746>>>>>>>End_Object
31747>>>>>>>
31747>>>>>>>Object oEmbalagemColetaRefrigerada_VT is a DescriptionValidationTable
31749>>>>>>>    Set Allow_Blank_State to True
31750>>>>>>>    Procedure Fill_List
31753>>>>>>>        Forward Send Fill_List
31755>>>>>>>        Send Add_Table_Value "GELPACK" "GELPACK"
31756>>>>>>>        Send Add_Table_Value "FRY" "FRY ICE"
31757>>>>>>>        Send Add_Table_Value "MANTA" "MANTA TERMICA"
31758>>>>>>>    End_Procedure
31759>>>>>>>End_Object
31760>>>>>
31760>>>>>Register_Object Csag300_Usuarioclasse_VT
31760>>>>>Register_Object Csag300_Usuariostatus_VT
31760>>>>>Register_Object Csag300_Usuarioslogin_VT
31760>>>>>Register_Object Csag300_Remailconfirma_VT
31760>>>>>Register_Object Csag300_Usuariomodose_VT
31760>>>>>Register_Object Csag300_Usuariomenu_S_VT
31760>>>>>
31760>>>>>Object Csag300_Usuarioclasse_VT  is a DescriptionValidationTable
31762>>>>>    //trocado master para Aplicacao
31762>>>>>    Procedure Fill_List 
31765>>>>>        Forward Send Fill_List
31767>>>>>        Send Add_Table_Value "1" "ADMINISTRADOR"
31768>>>>>        Send Add_Table_Value "2" "SUPERVISOR"
31769>>>>>        Send Add_Table_Value "3" "APLICACAO SEM SESSAO"
31770>>>>>        Send Add_Table_Value "4" "DIRETOR"
31771>>>>>        Send Add_Table_Value "5" "GERENTE"
31772>>>>>        Send Add_Table_Value "6" "OPERADOR COMUM"
31773>>>>>        Send Add_Table_Value "7" "GUEST"
31774>>>>>        Send Add_Table_Value "8" "SEM CLASSIFICACAO"
31775>>>>>        Send Add_Table_Value "9" "GUEST2"
31776>>>>>        Send Add_Table_Value "10" "APLICACAO COM SESSAO"
31777>>>>>    End_Procedure    // Fill_List
31778>>>>>End_Object   // Csag300_Usuarioclasse_VT
31779>>>>>
31779>>>>>Object Csag300_Usuariostatus_VT  is a DescriptionValidationTable
31781>>>>>    Procedure Fill_List
31784>>>>>        Forward Send Fill_List
31786>>>>>        Send Add_Table_Value  "1"  "LIBERADO"
31787>>>>>        Send Add_Table_Value  "2"  "BLOQUEADO"
31788>>>>>//        Send Add_Table_Value  "3"  "INATIVO"
31788>>>>>//        Send Add_Table_Value  "4"  "EXCLUIDO"
31788>>>>>    End_Procedure    // Fill_List
31789>>>>>End_Object   // Csag300_Usuariostatus_VT
31790>>>>>
31790>>>>>Object Csag300_Usuarioslogin_VT  is a DescriptionValidationTable
31792>>>>>    Procedure Fill_List
31795>>>>>        Forward Send Fill_List
31797>>>>>        Send Add_Table_Value  "1"  "On-Line"
31798>>>>>        Send Add_Table_Value  "2"  "Ocupado"
31799>>>>>        Send Add_Table_Value  "3"  "Off-Line"
31800>>>>>        Send Add_Table_Value  "4"  "Volto Logo"
31801>>>>>        Send Add_Table_Value  "5"  "Ausente"
31802>>>>>        Send Add_Table_Value  "6"  "Ao Telefone"
31803>>>>>        Send Add_Table_Value  "7"  "Almocando"
31804>>>>>        Send Add_Table_Value  "8"  "Em Reuniao"
31805>>>>>    End_Procedure    // Fill_List
31806>>>>>End_Object   // Csag300_Usuarioslogin_VT
31807>>>>>
31807>>>>>Object Csag300_Remailconfirma_VT  is a DescriptionValidationTable
31809>>>>>
31809>>>>>    Procedure Fill_List
31812>>>>>        Forward Send Fill_List
31814>>>>>        Send Add_Table_Value  "1"  "Sim"
31815>>>>>        Send Add_Table_Value  "2"  "Nao"
31816>>>>>    End_Procedure    // Fill_List
31817>>>>>End_Object   // Csag300_Remailconfirma_VT
31818>>>>>
31818>>>>>Object Csag300_Usuariomodose_VT  is a DescriptionValidationTable
31820>>>>>
31820>>>>>    Procedure Fill_List
31823>>>>>        Forward Send Fill_List
31825>>>>>        Send Add_Table_Value  "1"  "Nao"
31826>>>>>        Send Add_Table_Value  "2"  "Sim"
31827>>>>>    End_Procedure    // Fill_List
31828>>>>>End_Object   // Csag300_Usuariomodose_VT
31829>>>>>
31829>>>>>Object Csag300_Usuariomenu_S_VT  is a DescriptionValidationTable
31831>>>>>
31831>>>>>    Procedure Fill_List
31834>>>>>        Forward Send Fill_List
31836>>>>>        Send Add_Table_Value  "S"  "Sim"
31837>>>>>        Send Add_Table_Value  "N"  "Nao"
31838>>>>>    End_Procedure    // Fill_List
31839>>>>>    
31839>>>>>End_Object   // Csag300_Usuariomenu_S_VT
31840>>>>>
31840>>>>>Object Csag300_UsuarioSexo_VT is a DescriptionValidationTable
31842>>>>>    Procedure Fill_List
31845>>>>>        Forward Send Fill_List
31847>>>>>        Send Add_Table_Value "F" "FEMININO"
31848>>>>>        Send Add_Table_Value "M" "MASCULINO"
31849>>>>>        Send Add_Table_Value "J" "JURIDICA"
31850>>>>>        Send Add_Table_Value "I" "INDEFINIDO"
31851>>>>>    End_Procedure
31852>>>>>End_Object
31853>>>>>
31853>>>>>Object Csag300_Permiteachalo_VT is a DescriptionValidationTable
31855>>>>>    Procedure Fill_List
31858>>>>>        Forward Send Fill_List
31860>>>>>        Send Add_Table_Value "S" "Sim"
31861>>>>>        Send Add_Table_Value "N" "Nao"
31862>>>>>    End_Procedure
31863>>>>>End_Object
31864>>>>>
31864>>>>>//Object Csag300_Usuariopais_VT is a DescriptionValidationTable
31864>>>>>//    Procedure Fill_List
31864>>>>>//        Forward Send Fill_List
31864>>>>>//        Send Add_Table_Value "BRA" "BRASIL"
31864>>>>>//        Send Add_Table_Value "URY" "URUGUAY"
31864>>>>>//        Send Add_Table_Value "CHL" "CHILE"
31864>>>>>//        Send Add_Table_Value "ARG" "ARGENTINA"
31864>>>>>//        Send Add_Table_Value "COL" "COLOMBIA"
31864>>>>>//        Send Add_Table_Value "PRY" "PARAGUAY"
31864>>>>>//        Send Add_Table_Value "PER" "PERU"
31864>>>>>//    End_Procedure
31864>>>>>//End_Object
31864>>>>>
31864>>>>>Object Csag300_Usuariopais_VT is a FileValidationTable
31866>>>>>    Set Validate_State      to False
31867>>>>>    Set Main_File           to CSAG329.File_Number
31868>>>>>    Set Code_Field          to 1
31869>>>>>    Set Description_Field   to 2
31870>>>>>    Set Ordering            to 2
31871>>>>>End_Object //Csag300_Usuariopais_VT
31872>>>>>
31872>>>>>Class Csag300_DataDictionary is a c_DataDictionary
31873>>>>>
31873>>>>>    // Define_Fields:
31873>>>>>    // This procedure is used to set up all data-dictionary rules.
31873>>>>>
31873>>>>>    Procedure Construct_Object
31875>>>>>        Forward Send Construct_Object
31877>>>>>
31877>>>>>
31877>>>>>        Set Main_File To Csag300.File_Number
31878>>>>>
31878>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
31879>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
31880>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
31881>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
31882>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
31883>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
31884>>>>>
31884>>>>>        // External (System) file structure.............
31884>>>>>        Set Add_System_File to TSMG801.File_Number DD_LOCK_ON_ALL
31885>>>>>        Set Add_System_File to TSMG802.File_Number DD_LOCK_ON_ALL
31886>>>>>        Set Add_System_File to CSAG315.File_Number DD_LOCK_ON_ALL
31887>>>>>        Set Add_System_File to CSAG326.File_Number DD_LOCK_ON_ALL
31888>>>>>        Set Add_System_File to CSAG361.File_Number DD_LOCK_ON_ALL
31889>>>>>        Set Add_System_File to CSAG398.File_Number DD_LOCK_ON_ALL
31890>>>>>        
31890>>>>>
31890>>>>>        Set Field_Auto_Increment Field Csag300.Usuarionumero to File_Field TSMG801.USUARIOS
31891>>>>>
31891>>>>>        // Field-based properties.......................
31891>>>>>
31891>>>>>        Set Field_Label_Long Field Csag300.Usuarioecodigo to "Select Company"
31892>>>>>//        Set Field_Option Field Csag300.Usuarioecodigo DD_RETAINALL to True
31892>>>>>
31892>>>>>        Set Field_Label_Long Field Csag300.Usuarioempresa To "Razao Social"
31893>>>>>//        Set Field_Option Field Csag300.Usuarioempresa DD_RETAINALL to True
31893>>>>>        Set Field_Option Field Csag300.Usuarioempresa DD_CAPSLOCK to True
31894>>>>>
31894>>>>>
31894>>>>>        Set Field_Label_Long Field Csag300.Usuarionumero to "Id"
31895>>>>>//        Set Field_Option Field Csag300.Usuarionumero DD_RETAINALL to True
31895>>>>>
31895>>>>>        Set Field_Label_Long Field Csag300.Usuarioemail to "e-Mail"
31896>>>>>
31896>>>>>        Set Field_Label_Long Field Csag300.Usuariosenha to "Password"
31897>>>>>
31897>>>>>        Set Field_Label_Long Field Csag300.Usuariosenhain to "Password"
31898>>>>>//        Set Field_Option Field Csag300.Usuariosenhain DD_RETAINALL to True
31898>>>>>
31898>>>>>        Set Field_Label_Long Field Csag300.Usuarionome to "Full Name"
31899>>>>>        Set Field_Option Field Csag300.Usuarionome DD_CAPSLOCK to True
31900>>>>>
31900>>>>>        Set Field_Label_Long Field Csag300.Usuarioclasse To "Classe "
31901>>>>>        Set Field_Value_Table Field Csag300.Usuarioclasse to Csag300_Usuarioclasse_VT
31902>>>>>
31902>>>>>        Set Field_Label_Long Field Csag300.Usuariostatus To "Status"
31903>>>>>        Set Field_Value_Table Field Csag300.Usuariostatus to Csag300_Usuariostatus_VT
31904>>>>>
31904>>>>>        Set Field_Label_Long Field Csag300.Usuarioslogin to "Informe o Estado de Conexao -Usuario-"
31905>>>>>        Set Field_Value_Table Field Csag300.Usuarioslogin to Csag300_Usuarioslogin_VT
31906>>>>>
31906>>>>>        Set Field_Label_Long Field Csag300.Usuariochave to "Security Key"
31907>>>>>        Set Field_Option Field Csag300.Usuariochave DD_CAPSLOCK to True
31908>>>>>
31908>>>>>        Set Field_Label_Long Field Csag300.Usuariopnome To "Primeiro Nome"
31909>>>>>        Set Field_Option Field Csag300.Usuariopnome DD_CAPSLOCK to True
31910>>>>>
31910>>>>>        Set Field_Label_Long Field Csag300.Usuarioidioma to "Select Language"
31911>>>>>
31911>>>>>        Set Field_Label_Long Field Csag300.Usuarioidiomanm To "Idioma"
31912>>>>>        Set Field_Option Field Csag300.Usuarioidiomanm DD_CAPSLOCK to True
31913>>>>>
31913>>>>>        Set Field_Label_Long Field Csag300.Usuariocpf to "Social Security Number, RUC, CPF ..."
31914>>>>>        Set Status_Help Field CSAG300.USUARIOCPF to "(Enter your CPF, RUC, Social Security Number...)"
31915>>>>>
31915>>>>>        Set Field_Label_Long Field CSAG300.USUARIODTNASFUN to "Birthday (DD/MM/YYYY)"
31916>>>>>
31916>>>>>        Set Field_Label_Long Field Csag300.Usuariovs To "Vencimento Senha"
31917>>>>>
31917>>>>>        Set Field_Label_Long Field Csag300.Usuariota to "Tempo em Segundos da Ultima Conexao "
31918>>>>>
31918>>>>>        Set Field_Label_Long Field CSAG300.USUARIOCELNR to "Cel. number"
31919>>>>>
31919>>>>>        Set Field_Label_Long Field CSAG300.USUARIOCELID to "Telefone id"
31920>>>>>
31920>>>>>        Set Field_Label_Long Field CSAG300.USUARIOCELTP to "Cel Plataforma (iOS,Android)"
31921>>>>>
31921>>>>>        Set Field_Label_Long Field Csag300.Dtaultlogin to "Dt. Ult. Login"
31922>>>>>
31922>>>>>        Set Field_Label_Long Field Csag300.Horultlogin to "Hr. Ult. Login"
31923>>>>>
31923>>>>>        Set Field_Label_Long Field Csag300.Dtloginanterior to "Dt. Login Anterior"
31924>>>>>
31924>>>>>        Set Field_Label_Long Field Csag300.Hrloginanterior to "Hr. Login Ant."
31925>>>>>
31925>>>>>        Set Field_Label_Long Field Csag300.Dtaultlogout to "Dt. Ult. LOGOUT"
31926>>>>>
31926>>>>>        Set Field_Label_Long Field Csag300.Horultlogout to "HR. Ult. LOGOUT"
31927>>>>>
31927>>>>>        Set Field_Label_Long Field Csag300.Asc_Principal to "Acesso ao Cross"
31928>>>>>
31928>>>>>        Set Field_Label_Long Field Csag300.Ads_Desktopsis to "Acesso ao Dashboard"
31929>>>>>
31929>>>>>        Set Field_Label_Long Field CSAG300.ABA_01 to "01-Acesso"
31930>>>>>        Set Field_Label_Long Field CSAG300.ABA_02 to "02-Acesso"
31931>>>>>        Set Field_Label_Long Field CSAG300.ABA_03 to "03-Acesso"
31932>>>>>        Set Field_Label_Long Field CSAG300.ABA_04 to "04-Acesso"
31933>>>>>        Set Field_Label_Long Field CSAG300.ABA_05 to "05-Acesso"
31934>>>>>        Set Field_Label_Long Field CSAG300.ABA_06 to "06-Acesso"
31935>>>>>        Set Field_Label_Long Field CSAG300.ABA_07 to "07-Acesso"
31936>>>>>        Set Field_Label_Long Field CSAG300.ABA_08 to "08-Acesso"
31937>>>>>        Set Field_Label_Long Field CSAG300.ABA_09 to "09-Acesso"
31938>>>>>        Set Field_Label_Long Field CSAG300.ABA_10 to "10-Acesso"
31939>>>>>
31939>>>>>        Set Field_Label_Long Field Csag300.Recebeemail to "Recebe Email de Confirmacao"
31940>>>>>        Set Field_Value_Table Field Csag300.Recebeemail to Csag300_Remailconfirma_VT
31941>>>>>
31941>>>>>        Set Field_Label_Long Field Csag300.Usuariomodose to "Usuario em Modo de Seguranca"
31942>>>>>        Set Field_Value_Table Field Csag300.Usuariomodose to Csag300_Usuariomodose_VT
31943>>>>>
31943>>>>>        Set Field_Label_Long Field Csag300.Usuariomenu_S To "Ativar Menu Sistema"
31944>>>>>        Set Field_Value_Table Field Csag300.Usuariomenu_S to Csag300_Usuariomenu_S_VT
31945>>>>>
31945>>>>>        Set Field_Value_Table Field CSAG300.USUARIOSEXO to Csag300_UsuarioSexo_VT
31946>>>>>        Set Field_Label_Long Field CSAG300.USUARIOSEXO to "Sexo"
31947>>>>>        Set Field_Option Field CSAG300.USUARIOSEXO DD_CAPSLOCK to True
31948>>>>>
31948>>>>>        Set Field_Value_Table Field CSAG300.PERMITEACHALO to Csag300_Permiteachalo_VT
31949>>>>>        Set Field_Label_Long Field CSAG300.PERMITEACHALO to "Permissao para Visualizar Minha Conta"
31950>>>>>
31950>>>>>        Set Field_Label_Long Field CSAG300.CF_USUARIOFOTO to "Usuario Foto (Caminho Fisico)"
31951>>>>>
31951>>>>>        Set Field_Label_Long Field CSAG300.CL_USUARIOFOTO to "Usuario Foto (Caminho Logico)"
31952>>>>>
31952>>>>>        Set Field_Label_Long Field CSAG300.USUARIOPAIS to "Select Country"
31953>>>>>        Set Field_Value_Table Field CSAG300.USUARIOPAIS to Csag300_Usuariopais_VT
31954>>>>>        Set Field_Option Field CSAG300.USUARIOPAIS DD_CAPSLOCK to True
31955>>>>>
31955>>>>>        Set Field_Label_Long Field CSAG300.USUARIOAPELIDO to "Nick Name"
31956>>>>>
31956>>>>>    End_Procedure    // Construct_Object
31957>>>>>
31957>>>>>    // Field_Defaults:
31957>>>>>    // This procedure is used to establish default field values.
31957>>>>>
31957>>>>>    Procedure Field_Defaults
31959>>>>>        Forward Send Field_Defaults
31961>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOECODIGO to 1
31962>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOCLASSE to 8
31963>>>>>        Set Field_Changed_Value Field CSAG300.RECEBEEMAIL to "2"
31964>>>>>        Set Field_Changed_Value   Field Csag300.Usuariomodose To "1"
31965>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOMENU_S to "N"
31966>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOSEXO to "I"
31967>>>>>        Set Field_Changed_Value Field CSAG300.PERMITEACHALO to "N"
31968>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOPAIS to "BRA"
31969>>>>>    End_Procedure    // Field_Defaults
31970>>>>>
31970>>>>>    Procedure Save_Main_File_Pag300_01
31972>>>>>        Integer iPos
31972>>>>>        String sName sApelido_Name
31972>>>>>        
31972>>>>>        Forward Send Save_Main_File
31974>>>>>        
31974>>>>>        //--Verifica se o Primeiro nome e se o Nick Name est em branco, 
31974>>>>>        //  identifica o primeiro nome e separa
31974>>>>>        //  cria automaticamente um nick, sendo (Primeiro Nome+Codigo)
31974>>>>>        If (CSAG300.USUARIOPNOME = "") Begin
31976>>>>>            Move CSAG300.USUARIONOME to sName
31977>>>>>            Move (Pos (" ", sName)) to iPos
31978>>>>>            If (iPos > 0) Begin
31980>>>>>              Move (Left (sName, iPos - 1)) to CSAG300.USUARIOPNOME
31981>>>>>              SaveRecord CSAG300
31982>>>>>            End
31982>>>>>>
31982>>>>>        End
31982>>>>>>
31982>>>>>        If (CSAG300.USUARIOAPELIDO = "") Begin
31984>>>>>            Move CSAG300.USUARIONOME to sName
31985>>>>>            Move (Pos (" ", sName)) to iPos
31986>>>>>            If (iPos > 0) Begin
31988>>>>>              Move (Left (sName, iPos - 1)) to sApelido_Name
31989>>>>>              Move (sApelido_Name+String(CSAG300.USUARIOECODIGO))to sApelido_Name
31990>>>>>              Move sApelido_Name to CSAG300.USUARIOAPELIDO
31991>>>>>              SaveRecord CSAG300
31992>>>>>            End
31992>>>>>>
31992>>>>>        End
31992>>>>>>
31992>>>>>        
31992>>>>>        //Fim da Verificaao
31992>>>>>        
31992>>>>>    End_Procedure //Save_Main_File_Pag300_01
31993>>>>>
Including file: p_FFOperation.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\p_FFOperation.inc)
31993>>>>>>//ANDERSON RODRIGUES - 02.02.2014 - 13:40
31993>>>>>>//-2WA    
31993>>>>>>    //PROCEDURE USADA PELA TABELA PRINCIPAL DO DICIONARIO DE DADOS
31993>>>>>>    Procedure p_FFOperation Integer iOper
31995>>>>>>
31995>>>>>>        //------------------------------------------------------------
31995>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
31995>>>>>>
31995>>>>>>        Clear   CSAG311
31996>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
31997>>>>>>        Find Eq CSAG311                      by 1
31998>>>>>>>
31998>>>>>>        If (Found) Begin
32000>>>>>>            Send p_FileFieldOperation ;                 iOper ;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
32001>>>>>>        End
32001>>>>>>>
32001>>>>>>    End_Procedure // p_FFOperation
32002>>>>>>
32002>>>>>>    
32002>>>>>>    //PROCEDURE USADA PELA(S) TABELA(S) SECUNDARIA(S) DO DICIONARIO DE DADOS
32002>>>>>>    //UTILIZE ESTA PROCEDURE PARA ARMAZENAR LOG(S) DA(S) TABELA(S) SECUNDARIA(S)
32002>>>>>>    //VIDE EXEMPLO cCSAG371DataDictionary.dd
32002>>>>>>    Procedure p_FFOperationTable Integer iOper Integer iTable
32004>>>>>>
32004>>>>>>        //------------------------------------------------------------
32004>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
32004>>>>>>
32004>>>>>>        Clear   CSAG311
32005>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
32006>>>>>>        Find Eq CSAG311                      by 1
32007>>>>>>>
32007>>>>>>        If (Found) Begin
32009>>>>>>            Send p_FileFieldOperationTable;                 iTable;                 iOper;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
32010>>>>>>        End
32010>>>>>>>
32010>>>>>>    End_Procedure // p_FFOperationTable
32011>>>>>>    
32011>>>>>>
32011>>>>>    
32011>>>>>End_Class
32012>>>>>
32012>>>USE      CSAG304.DD
Including file: CSAG304.DD    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG304.DD)
32012>>>>>// Class Name: Csag304_DataDictionary
32012>>>>>// Revision  : 28
32012>>>>>// Version   : 2
32012>>>>>//-2WA
32012>>>>>Use  Windows           // Basic Definitions
32012>>>>>Use  DataDict.pkg          // DataDictionary Class Definition
32012>>>>>Use  DDvalTbl          // Validation Table Class Definitions
32012>>>>>
32012>>>>>Open Csag304
Including file: CSAG304.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG304.fd)
32014>>>>>
32014>>>>>
32014>>>>>Register_Object Csag304_Tipo_VT
32014>>>>>Register_Object Csag304_Localizacao_VT
32014>>>>>Register_Object Csag304_Status_VT
32014>>>>>Register_Object Csag304_Classe_VT
32014>>>>>
32014>>>>>Object Csag304_Tipo_VT  is a DescriptionValidationTable
32016>>>>>
32016>>>>>    Procedure Fill_List
32019>>>>>        Forward Send Fill_List
32021>>>>>        Send Add_Table_Value  "1"  "PROGRAMA"
32022>>>>>        Send Add_Table_Value  "2"  "MENU"
32023>>>>>        Send Add_Table_Value  "3"  "TITULO"
32024>>>>>        Send Add_Table_Value  "4"  "SUBTITULO"
32025>>>>>    End_Procedure    // Fill_List
32026>>>>>End_Object   // Csag304_Tipo_VT
32027>>>>>
32027>>>>>Object Csag304_Localizacao_VT  is a DescriptionValidationTable
32029>>>>>
32029>>>>>    Procedure Fill_List
32032>>>>>        Forward Send Fill_List
32034>>>>>        Send Add_Table_Value "F" "ABAS"
32035>>>>>        Send Add_Table_Value "W" "WINDOW"
32036>>>>>        Send Add_Table_Value "S" "SITE"
32037>>>>>    End_Procedure    // Fill_List
32038>>>>>End_Object   // Csag304_Localizacao_VT
32039>>>>>
32039>>>>>Object Csag304_Status_VT  is a DescriptionValidationTable
32041>>>>>
32041>>>>>    Procedure Fill_List
32044>>>>>        Forward Send Fill_List
32046>>>>>        Send Add_Table_Value  "1"  "Ativo"
32047>>>>>        Send Add_Table_Value  "2"  "Inativo"
32048>>>>>    End_Procedure    // Fill_List
32049>>>>>End_Object   // Csag304_Status_VT
32050>>>>>
32050>>>>>Object Csag304_Classe_VT  is a DescriptionValidationTable
32052>>>>>
32052>>>>>    Procedure Fill_List
32055>>>>>        Forward Send Fill_List
32057>>>>>        Send Add_Table_Value  "1"  "ADMINISTRADOR"
32058>>>>>        Send Add_Table_Value  "2"  "SUPERVISOR"
32059>>>>>        Send Add_Table_Value  "3"  "MASTER"
32060>>>>>        Send Add_Table_Value  "4"  "DIRETOR"
32061>>>>>        Send Add_Table_Value  "5"  "GERENTE"
32062>>>>>        Send Add_Table_Value  "6"  "OPERADOR COMUM"
32063>>>>>        Send Add_Table_Value  "7"  "CLIENTE"
32064>>>>>        Send Add_Table_Value  "8"  "SEM CLASSIFICACAO"
32065>>>>>    End_Procedure    // Fill_List
32066>>>>>End_Object   // Csag304_Classe_VT
32067>>>>>
32067>>>>>Class Csag304_DataDictionary  is a DataDictionary
32068>>>>>
32068>>>>>    // Define_Fields:
32068>>>>>    // This procedure is used to set up all data-dictionary rules.
32068>>>>>
32068>>>>>    Procedure Construct_Object
32070>>>>>        Forward Send Construct_Object
32072>>>>>
32072>>>>>
32072>>>>>        Set Main_File To Csag304.File_Number
32073>>>>>
32073>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
32074>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
32075>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
32076>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
32077>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
32078>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
32079>>>>>
32079>>>>>        // Field-based properties.......................
32079>>>>>
32079>>>>>        Set Field_Label_Long Field Csag304.Idioma To "Codigo"
32080>>>>>
32080>>>>>        Set Field_Label_Long Field Csag304.Idiomanm To "Idioma"
32081>>>>>        Set Field_Option Field Csag304.Idiomanm DD_CAPSLOCK to True
32082>>>>>
32082>>>>>        Set Field_Label_Long Field Csag304.Menuclasse To "Classe do Menu"
32083>>>>>
32083>>>>>        Set Field_Label_Long Field Csag304.Menunumero To "Numero do Menu"
32084>>>>>
32084>>>>>        Set Field_Label_Long Field Csag304.Titulo To "Titulo"
32085>>>>>
32085>>>>>        Set Field_Label_Long Field Csag304.Tituloidioma To "Titulo Idioma"
32086>>>>>
32086>>>>>        Set Field_Label_Long Field Csag304.Tipo To "Tipo"
32087>>>>>        Set Field_Value_Table Field Csag304.Tipo to Csag304_Tipo_VT
32088>>>>>
32088>>>>>        Set Field_Label_Long Field Csag304.Programa To "Programa"
32089>>>>>
32089>>>>>        Set Field_Label_Long Field Csag304.Localizacao To "Localizacao"
32090>>>>>        Set Field_Value_Table Field Csag304.Localizacao to Csag304_Localizacao_VT
32091>>>>>
32091>>>>>        Set Field_Label_Long Field Csag304.Mcchamada To "Menu de Chamada"
32092>>>>>
32092>>>>>        Set Field_Label_Long Field Csag304.Programacodigo To "Codigo do Programa"
32093>>>>>
32093>>>>>        Set Field_Label_Long Field Csag304.Status To "Status"
32094>>>>>        Set Field_Value_Table Field Csag304.Status to Csag304_Status_VT
32095>>>>>
32095>>>>>        Set Field_Label_Long Field Csag304.Classe To "Classe"
32096>>>>>        Set Field_Value_Table Field Csag304.Classe to Csag304_Classe_VT
32097>>>>>
32097>>>>>        Set Field_Label_Long Field Csag304.Imagem_Fisico To "Imagem Caminho Fisico"
32098>>>>>
32098>>>>>        Set Field_Label_Long Field Csag304.Imagem_Logico To "Imagem Caminho Logico"
32099>>>>>
32099>>>>>        Set Field_Label_Long Field Csag304.Tipomenu To "Tipo de Menu"
32100>>>>>
32100>>>>>        Set Field_Label_Long Field CSAG304.ICONEB00TSP to "Icone Bootstrap"
32101>>>>>
32101>>>>>    End_Procedure    // Construct_Object
32102>>>>>
32102>>>>>    // Field_Defaults:
32102>>>>>    // This procedure is used to establish default field values.
32102>>>>>
32102>>>>>    Procedure Field_Defaults
32104>>>>>        Forward Send Field_Defaults
32106>>>>>    End_Procedure    // Field_Defaults
32107>>>>>
32107>>>>>End_Class    // Csag304_DataDictionary
32108>>>>>
32108>>>USE      CSAG310.DD
Including file: CSAG310.DD    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG310.DD)
32108>>>>>// Class Name: Csag310_DataDictionary
32108>>>>>// Revision  : 15
32108>>>>>// Version   : 2
32108>>>>>//-2WA
32108>>>>>Use  Windows           // Basic Definitions
32108>>>>>Use  DataDict.pkg          // DataDictionary Class Definition
32108>>>>>Use  DDvalTbl          // Validation Table Class Definitions
32108>>>>>
32108>>>>>Open Csag310
Including file: CSAG310.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG310.fd)
32110>>>>>
32110>>>>>
32110>>>>>Class Csag310_DataDictionary  is a DataDictionary
32111>>>>>
32111>>>>>    // Define_Fields:
32111>>>>>    // This procedure is used to set up all data-dictionary rules.
32111>>>>>
32111>>>>>    Procedure Construct_Object
32113>>>>>        Forward Send Construct_Object
32115>>>>>
32115>>>>>
32115>>>>>        Set Main_File To Csag310.File_Number
32116>>>>>
32116>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
32117>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
32118>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
32119>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
32120>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
32121>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
32122>>>>>
32122>>>>>        // Field-based properties.......................
32122>>>>>
32122>>>>>        Set Field_Label_Long Field Csag310.Tabela To "Tabela"
32123>>>>>        Set Field_Option Field Csag310.Tabela DD_CAPSLOCK to True
32124>>>>>
32124>>>>>        Set Field_Label_Long Field Csag310.Campo To "Campo"
32125>>>>>
32125>>>>>        Set Field_Label_Long Field Csag310.Idioma To "Idioma"
32126>>>>>        Set Field_Option Field Csag310.Idioma DD_RETAINALL to True
32127>>>>>
32127>>>>>        Set Field_Label_Long Field Csag310.Idiomanm To "Idioma"
32128>>>>>        Set Field_Option Field Csag310.Idiomanm DD_RETAINALL to True
32129>>>>>        Set Field_Option Field Csag310.Idiomanm DD_CAPSLOCK to True
32130>>>>>
32130>>>>>        Set Field_Label_Long Field Csag310.Appearance To "Descricao"
32131>>>>>        Set Field_Option Field Csag310.Appearance DD_RETAINALL to True
32132>>>>>
32132>>>>>    End_Procedure    // Construct_Object
32133>>>>>
32133>>>>>    // Field_Defaults:
32133>>>>>    // This procedure is used to establish default field values.
32133>>>>>
32133>>>>>    Procedure Field_Defaults
32135>>>>>        Forward Send Field_Defaults
32137>>>>>    End_Procedure    // Field_Defaults
32138>>>>>
32138>>>>>End_Class    // Csag310_DataDictionary
32139>>>>>
32139>>>
32139>>>
32139>    Use cszJSONParser.pkg
Including file: cszJSONParser.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\cszJSONParser.pkg)
32139>>>//-2WA
32139>>>Use UI
32139>>>Use szJSONParser.pkg
Including file: szJSONParser.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\szJSONParser.pkg)
32139>>>>>//-2WA
32139>>>>>// Visual DataFlex COM proxy classes generated from C:\WWW.SISTEMAS.COM.BR\WEB.CRAFT.COM.BR\WVDF_CAC_v8r0\Deploy\szJSONParser.tlb
32139>>>>>Use FlexCom20.pkg
Including file: FlexCOM20.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\FlexCOM20.pkg)
32139>>>>>>>
32139>>>>>>>//
32139>>>>>>>// Full Flexcom support for automation (cComAutomationObject),
32139>>>>>>>// activeX (cComActiveXControl and document objects (cComDocumentObject)
32139>>>>>>>//
32139>>>>>>>
32139>>>>>>>Use FlexCOM20_Base.pkg // defines basic flexcom symbols and class cComAutomationObject
32139>>>>>>>
32139>>>>>>>Class cComDocumentObject Is a DFComDocumentObject
32140>>>>>>>    Procedure Construct_Object
32142>>>>>>>        Forward Send Construct_Object
32144>>>>>>>        Send RegisterComEvents
32145>>>>>>>        Send Define_Standard_Object_Mixin
32146>>>>>>>        Send Define_Shadow_Mixin
32147>>>>>>>    End_Procedure
32148>>>>>>>    Import_Class_Protocol Standard_Object_Mixin
32149>>>>>>>    Import_Class_Protocol Shadow_Mixin
32150>>>>>>>
32150>>>>>>>    // It is expected that the Com class will augment this with useful event definitions
32150>>>>>>>    Procedure RegisterComEvents
32152>>>>>>>    End_Procedure
32153>>>>>>>
32153>>>>>>>    // returns true if the control is created.
32153>>>>>>>    Function IsComObjectCreated Returns Boolean
32155>>>>>>>        Variant vComObject
32155>>>>>>>        Get pvComObject to vComObject
32156>>>>>>>        Function_Return (Not(IsNullComObject(vComObject)))
32157>>>>>>>    End_Function
32158>>>>>>>
32158>>>>>>>End_Class
32159>>>>>>>
32159>>>>>>>Class cComActiveXControl Is a DFComActiveXControl
32160>>>>>>>    Procedure Construct_Object
32162>>>>>>>        Forward Send Construct_Object
32164>>>>>>>        Send RegisterComEvents
32165>>>>>>>        Send Define_Standard_Object_Mixin
32166>>>>>>>        Send Define_Single_Item_Navigate_Mixin
32167>>>>>>>        Send Define_Dflabel_Mixin
32168>>>>>>>
32168>>>>>>>        // If set true, then the control will attempt to bind the value property in the object to the
32168>>>>>>>        // comValue in the control. It will try to keep these values in synch at all times. This allows a
32168>>>>>>>        // control to be used as a Form style value control. the default is true. Even when true if the
32168>>>>>>>        // get/set ComValue methods are not set up to do anything, this will do nothing.
32168>>>>>>>        Property boolean pbBindValue True
32169>>>>>>>
32169>>>>>>>        // internal: set true object is notified that the OCX value has changed.
32169>>>>>>>        Property Boolean pbPrivateControlChanging false
32170>>>>>>>
32170>>>>>>>        // Class sets this true when making a local (externally triggered) change. This is
32170>>>>>>>        // set when a Set Value change is made to prevent recursion
32170>>>>>>>        property Boolean pbPrivateControlRefresh false
32171>>>>>>>
32171>>>>>>>        // added to eumlate a single item form support
32171>>>>>>>        property Boolean pbPrivateItem_Changed_State false
32172>>>>>>>
32172>>>>>>>        // This keeps track of value, even when control is not created
32172>>>>>>>        Property String psPrivateValue ''
32173>>>>>>>
32173>>>>>>>    End_Procedure
32174>>>>>>>
32174>>>>>>>    Import_Class_Protocol Standard_Object_Mixin
32175>>>>>>>    Import_Class_Protocol Single_Item_Navigate_Mixin
32176>>>>>>>    Import_Class_Protocol Dflabel_Mixin
32177>>>>>>>
32177>>>>>>>    // It is expected that the Com class will augment this with useful event definitions
32177>>>>>>>    Procedure RegisterComEvents
32179>>>>>>>    End_Procedure
32180>>>>>>>
32180>>>>>>>    // added to eumlate a single item form support
32180>>>>>>>    Function Item_Count returns integer
32182>>>>>>>        function_return 1
32183>>>>>>>    end_function
32184>>>>>>>
32184>>>>>>>    // added to eumlate a single item form support
32184>>>>>>>    Procedure Set Item_Changed_State integer iItem integer iState
32186>>>>>>>       Set pbPrivateItem_changed_state to iState
32187>>>>>>>        If (iState and changed_state(self)=false) set changed_state to true
32190>>>>>>>    end_procedure
32191>>>>>>>
32191>>>>>>>    Function Item_Changed_State integer iItem returns integer
32193>>>>>>>        function_return (pbPrivateItem_changed_state(self))
32194>>>>>>>    end_function
32195>>>>>>>
32195>>>>>>>
32195>>>>>>>    // augment to set the label's appearance
32195>>>>>>>    Procedure Shadow_Display
32197>>>>>>>        forward send Shadow_display
32199>>>>>>>        Send Label_Shadow_Display
32200>>>>>>>    End_Procedure // Shadow_Display
32201>>>>>>>
32201>>>>>>>    // Created to simulate get/Set value.
32201>>>>>>>    Procedure set Value integer iItem string sVal
32203>>>>>>>        If not (pbPrivateControlChanging(self)) ;            Send OnRefreshControl sVal
32206>>>>>>>        Set psPrivateValue to sVal
32207>>>>>>>        Send OnChange
32208>>>>>>>        //Set changed_state to True
32208>>>>>>>        set item_changed_state 0 to true
32209>>>>>>>    End_Procedure
32210>>>>>>>
32210>>>>>>>    Function Value integer iItem returns string
32212>>>>>>>        function_return (psPrivateValue(self))
32213>>>>>>>        //function_return (Controlvalue(self))
32213>>>>>>>    end_function
32214>>>>>>>
32214>>>>>>>    Procedure OnChange
32216>>>>>>>    End_Procedure
32217>>>>>>>
32217>>>>>>>
32217>>>>>>>    // It is expected that the sub-class will provide functionality
32217>>>>>>>    // for these messages. This gets and sets the value of the actual
32217>>>>>>>    // window control. These should only be used to synchronize the window
32217>>>>>>>    // control and the DF side. Do not use for any other purpose.
32217>>>>>>>    Procedure Set ControlValue string sVal
32219>>>>>>>    End_Procedure
32220>>>>>>>
32220>>>>>>>    Function ControlValue Returns String
32222>>>>>>>    End_Function
32223>>>>>>>
32223>>>>>>>   Procedure OnCreate
32225>>>>>>>       // if we are binding value to comValue, do so upon creation
32225>>>>>>>       If (pbBindValue(self)) ;           Set ControlValue to (Value(self))
32228>>>>>>>       Forward Send OnCreate
32230>>>>>>>   End_Procedure
32231>>>>>>>
32231>>>>>>>
32231>>>>>>>    // returns true if the control is created.
32231>>>>>>>    Function IsComObjectCreated Returns Boolean
32233>>>>>>>        Variant vComObject
32233>>>>>>>        Get pvComObject to vComObject
32234>>>>>>>        Function_Return (Not(IsNullComObject(vComObject)))
32235>>>>>>>    End_Function
32236>>>>>>>
32236>>>>>>>    // Notification that the control's value has been changed
32236>>>>>>>    // externally by the program (via set value). Use to synchronize
32236>>>>>>>    // OCX control value.
32236>>>>>>>    Procedure OnRefreshControl string sVal
32238>>>>>>>        Boolean bOld
32238>>>>>>>        If (pbBindValue(self) and pbPrivateControlChanging(self)=0 And IsComObjectCreated(self)) Begin
32240>>>>>>>            Get pbPrivateControlRefresh to bOld
32241>>>>>>>            Set pbPrivateControlRefresh to True
32242>>>>>>>            set ControlValue to sval
32243>>>>>>>            Set pbPrivateControlRefresh to bOld
32244>>>>>>>        end
32244>>>>>>>>
32244>>>>>>>    End_Procedure
32245>>>>>>>
32245>>>>>>>    // notification that the control has changed its value. Used to
32245>>>>>>>    // synchronize the object with the change.
32245>>>>>>>    Procedure OnControlValueChanged
32247>>>>>>>        String sVal
32247>>>>>>>        Boolean bOld
32247>>>>>>>        If (pbBindValue(self) and pbPrivateControlRefresh(self)=0) Begin
32249>>>>>>>            Get pbPrivateControlChanging to bOld
32250>>>>>>>            Set pbPrivateControlChanging to True
32251>>>>>>>            Get ControlValue to sVal
32252>>>>>>>            Set Value to sVal
32253>>>>>>>            Set Item_Changed_State 0 to True
32254>>>>>>>            Set pbPrivateControlChanging to bOld
32255>>>>>>>        end
32255>>>>>>>>
32255>>>>>>>    End_Procedure
32256>>>>>>>
32256>>>>>>>    Procedure Delete_Data
32258>>>>>>>        Forward Send Delete_Data
32260>>>>>>>        Set Value to ''
32261>>>>>>>        Set Changed_state to False
32262>>>>>>>        Set Item_changed_state 0 to false
32263>>>>>>>    End_Procedure
32264>>>>>>>
32264>>>>>>>End_Class
32265>>>>>>>
32265>>>>>
32265>>>>>
32265>>>>>// CLSID: {41402F76-51B2-4FE5-B0CA-EC5C0DCDCB25}
32265>>>>>Class cComIszJSONParser is a Mixin
32266>>>>>
32266>>>>>    Function ComDeserializeString String lljson Returns Variant
32268>>>>>        Handle hDispatchDriver
32268>>>>>        Variant retVal
32268>>>>>        Get phDispatchDriver to hDispatchDriver
32269>>>>>        Send PrepareParams to hDispatchDriver 1
32270>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR lljson
32271>>>>>        Get InvokeComMethod of hDispatchDriver 1 OLE_VT_UNKNOWN to retVal
32272>>>>>        Function_Return retVal
32273>>>>>    End_Function
32274>>>>>
32274>>>>>    Function ComSerialize Variant llobj Returns String
32276>>>>>        Handle hDispatchDriver
32276>>>>>        String retVal
32276>>>>>        Get phDispatchDriver to hDispatchDriver
32277>>>>>        Send PrepareParams to hDispatchDriver 1
32278>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llobj
32279>>>>>        Get InvokeComMethod of hDispatchDriver 2 OLE_VT_BSTR to retVal
32280>>>>>        Function_Return retVal
32281>>>>>    End_Function
32282>>>>>
32282>>>>>    Function ComGetTokenType Variant lltkn Returns Integer
32284>>>>>        Handle hDispatchDriver
32284>>>>>        Integer retVal
32284>>>>>        Get phDispatchDriver to hDispatchDriver
32285>>>>>        Send PrepareParams to hDispatchDriver 1
32286>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32287>>>>>        Get InvokeComMethod of hDispatchDriver 3 OLE_VT_I4 to retVal
32288>>>>>        Function_Return retVal
32289>>>>>    End_Function
32290>>>>>
32290>>>>>    Function ComGetTokenTypeAsString Variant lltkn Returns String
32292>>>>>        Handle hDispatchDriver
32292>>>>>        String retVal
32292>>>>>        Get phDispatchDriver to hDispatchDriver
32293>>>>>        Send PrepareParams to hDispatchDriver 1
32294>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32295>>>>>        Get InvokeComMethod of hDispatchDriver 4 OLE_VT_BSTR to retVal
32296>>>>>        Function_Return retVal
32297>>>>>    End_Function
32298>>>>>
32298>>>>>    Function ComGetTokenChildCount Variant lltkn Returns Integer
32300>>>>>        Handle hDispatchDriver
32300>>>>>        Integer retVal
32300>>>>>        Get phDispatchDriver to hDispatchDriver
32301>>>>>        Send PrepareParams to hDispatchDriver 1
32302>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32303>>>>>        Get InvokeComMethod of hDispatchDriver 5 OLE_VT_I4 to retVal
32304>>>>>        Function_Return retVal
32305>>>>>    End_Function
32306>>>>>
32306>>>>>    Function ComGetChild Variant lltkn Integer llindex Returns Variant
32308>>>>>        Handle hDispatchDriver
32308>>>>>        Variant retVal
32308>>>>>        Get phDispatchDriver to hDispatchDriver
32309>>>>>        Send PrepareParams to hDispatchDriver 2
32310>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32311>>>>>        Send DefineParam to hDispatchDriver OLE_VT_I4 llindex
32312>>>>>        Get InvokeComMethod of hDispatchDriver 6 OLE_VT_UNKNOWN to retVal
32313>>>>>        Function_Return retVal
32314>>>>>    End_Function
32315>>>>>
32315>>>>>    Function ComGetPropertyName Variant llprop Returns String
32317>>>>>        Handle hDispatchDriver
32317>>>>>        String retVal
32317>>>>>        Get phDispatchDriver to hDispatchDriver
32318>>>>>        Send PrepareParams to hDispatchDriver 1
32319>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llprop
32320>>>>>        Get InvokeComMethod of hDispatchDriver 7 OLE_VT_BSTR to retVal
32321>>>>>        Function_Return retVal
32322>>>>>    End_Function
32323>>>>>
32323>>>>>    Function ComGetHasValues Variant lltkn Returns Boolean
32325>>>>>        Handle hDispatchDriver
32325>>>>>        Boolean retVal
32325>>>>>        Get phDispatchDriver to hDispatchDriver
32326>>>>>        Send PrepareParams to hDispatchDriver 1
32327>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32328>>>>>        Get InvokeComMethod of hDispatchDriver 8 OLE_VT_BOOL to retVal
32329>>>>>        Function_Return retVal
32330>>>>>    End_Function
32331>>>>>
32331>>>>>    Function ComGetTokenValueAsString Variant lltkn Returns String
32333>>>>>        Handle hDispatchDriver
32333>>>>>        String retVal
32333>>>>>        Get phDispatchDriver to hDispatchDriver
32334>>>>>        Send PrepareParams to hDispatchDriver 1
32335>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32336>>>>>        Get InvokeComMethod of hDispatchDriver 9 OLE_VT_BSTR to retVal
32337>>>>>        Function_Return retVal
32338>>>>>    End_Function
32339>>>>>
32339>>>>>    Function ComGetTokenPath Variant lltkn Returns String
32341>>>>>        Handle hDispatchDriver
32341>>>>>        String retVal
32341>>>>>        Get phDispatchDriver to hDispatchDriver
32342>>>>>        Send PrepareParams to hDispatchDriver 1
32343>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32344>>>>>        Get InvokeComMethod of hDispatchDriver 10 OLE_VT_BSTR to retVal
32345>>>>>        Function_Return retVal
32346>>>>>    End_Function
32347>>>>>
32347>>>>>    Function ComGetTokenParent Variant lltkn Returns Variant
32349>>>>>        Handle hDispatchDriver
32349>>>>>        Variant retVal
32349>>>>>        Get phDispatchDriver to hDispatchDriver
32350>>>>>        Send PrepareParams to hDispatchDriver 1
32351>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32352>>>>>        Get InvokeComMethod of hDispatchDriver 11 OLE_VT_UNKNOWN to retVal
32353>>>>>        Function_Return retVal
32354>>>>>    End_Function
32355>>>>>
32355>>>>>    Function ComGetAtPath Variant llstart String llpath Returns Variant
32357>>>>>        Handle hDispatchDriver
32357>>>>>        Variant retVal
32357>>>>>        Get phDispatchDriver to hDispatchDriver
32358>>>>>        Send PrepareParams to hDispatchDriver 2
32359>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llstart
32360>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpath
32361>>>>>        Get InvokeComMethod of hDispatchDriver 12 OLE_VT_UNKNOWN to retVal
32362>>>>>        Function_Return retVal
32363>>>>>    End_Function
32364>>>>>
32364>>>>>    Function ComGetValue Variant lltkn String llfieldname Returns String
32366>>>>>        Handle hDispatchDriver
32366>>>>>        String retVal
32366>>>>>        Get phDispatchDriver to hDispatchDriver
32367>>>>>        Send PrepareParams to hDispatchDriver 2
32368>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32369>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llfieldname
32370>>>>>        Get InvokeComMethod of hDispatchDriver 13 OLE_VT_BSTR to retVal
32371>>>>>        Function_Return retVal
32372>>>>>    End_Function
32373>>>>>
32373>>>>>    Function ComGetChildByName Variant lltkn String llfieldname Returns Variant
32375>>>>>        Handle hDispatchDriver
32375>>>>>        Variant retVal
32375>>>>>        Get phDispatchDriver to hDispatchDriver
32376>>>>>        Send PrepareParams to hDispatchDriver 2
32377>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32378>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llfieldname
32379>>>>>        Get InvokeComMethod of hDispatchDriver 14 OLE_VT_UNKNOWN to retVal
32380>>>>>        Function_Return retVal
32381>>>>>    End_Function
32382>>>>>
32382>>>>>    Function ComNewJSONObject Returns Variant
32384>>>>>        Handle hDispatchDriver
32384>>>>>        Variant retVal
32384>>>>>        Get phDispatchDriver to hDispatchDriver
32385>>>>>        Get InvokeComMethod of hDispatchDriver 15 OLE_VT_UNKNOWN to retVal
32386>>>>>        Function_Return retVal
32387>>>>>    End_Function
32388>>>>>
32388>>>>>    Procedure ComAddString Variant llcont String llpropName String llpropval
32390>>>>>        Handle hDispatchDriver
32390>>>>>        Get phDispatchDriver to hDispatchDriver
32391>>>>>        Send PrepareParams to hDispatchDriver 3
32392>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
32393>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
32394>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropval
32395>>>>>        Send InvokeComMethod to hDispatchDriver 16 OLE_VT_VOID
32396>>>>>    End_Procedure
32397>>>>>
32397>>>>>    Function ComNewJSONArray Returns Variant
32399>>>>>        Handle hDispatchDriver
32399>>>>>        Variant retVal
32399>>>>>        Get phDispatchDriver to hDispatchDriver
32400>>>>>        Get InvokeComMethod of hDispatchDriver 17 OLE_VT_UNKNOWN to retVal
32401>>>>>        Function_Return retVal
32402>>>>>    End_Function
32403>>>>>
32403>>>>>    Procedure ComAddObject Variant llcont String llpropName Variant lltoadd
32405>>>>>        Handle hDispatchDriver
32405>>>>>        Get phDispatchDriver to hDispatchDriver
32406>>>>>        Send PrepareParams to hDispatchDriver 3
32407>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
32408>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
32409>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltoadd
32410>>>>>        Send InvokeComMethod to hDispatchDriver 18 OLE_VT_VOID
32411>>>>>    End_Procedure
32412>>>>>
32412>>>>>    Procedure ComAddNull Variant llcont String llpropName
32414>>>>>        Handle hDispatchDriver
32414>>>>>        Get phDispatchDriver to hDispatchDriver
32415>>>>>        Send PrepareParams to hDispatchDriver 2
32416>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
32417>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
32418>>>>>        Send InvokeComMethod to hDispatchDriver 19 OLE_VT_VOID
32419>>>>>    End_Procedure
32420>>>>>
32420>>>>>    Procedure ComAddBoolean Variant llcont String llpropName Boolean llpropval
32422>>>>>        Handle hDispatchDriver
32422>>>>>        Get phDispatchDriver to hDispatchDriver
32423>>>>>        Send PrepareParams to hDispatchDriver 3
32424>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
32425>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
32426>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BOOL llpropval
32427>>>>>        Send InvokeComMethod to hDispatchDriver 20 OLE_VT_VOID
32428>>>>>    End_Procedure
32429>>>>>
32429>>>>>    Procedure ComAddInteger Variant llcont String llpropName Integer llpropval
32431>>>>>        Handle hDispatchDriver
32431>>>>>        Get phDispatchDriver to hDispatchDriver
32432>>>>>        Send PrepareParams to hDispatchDriver 3
32433>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
32434>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
32435>>>>>        Send DefineParam to hDispatchDriver OLE_VT_I4 llpropval
32436>>>>>        Send InvokeComMethod to hDispatchDriver 21 OLE_VT_VOID
32437>>>>>    End_Procedure
32438>>>>>
32438>>>>>    Procedure ComRemoveFromParent Variant lltkn
32440>>>>>        Handle hDispatchDriver
32440>>>>>        Get phDispatchDriver to hDispatchDriver
32441>>>>>        Send PrepareParams to hDispatchDriver 1
32442>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32443>>>>>        Send InvokeComMethod to hDispatchDriver 22 OLE_VT_VOID
32444>>>>>    End_Procedure
32445>>>>>
32445>>>>>    Procedure ComRemoveChild Variant lltkn String llpropName
32447>>>>>        Handle hDispatchDriver
32447>>>>>        Get phDispatchDriver to hDispatchDriver
32448>>>>>        Send PrepareParams to hDispatchDriver 2
32449>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32450>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
32451>>>>>        Send InvokeComMethod to hDispatchDriver 23 OLE_VT_VOID
32452>>>>>    End_Procedure
32453>>>>>
32453>>>>>    Procedure ComRemoveAllChildren Variant lltkn
32455>>>>>        Handle hDispatchDriver
32455>>>>>        Get phDispatchDriver to hDispatchDriver
32456>>>>>        Send PrepareParams to hDispatchDriver 1
32457>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
32458>>>>>        Send InvokeComMethod to hDispatchDriver 24 OLE_VT_VOID
32459>>>>>    End_Procedure
32460>>>>>
32460>>>>>    Function ComDeepClone Variant llsrc Returns Variant
32462>>>>>        Handle hDispatchDriver
32462>>>>>        Variant retVal
32462>>>>>        Get phDispatchDriver to hDispatchDriver
32463>>>>>        Send PrepareParams to hDispatchDriver 1
32464>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llsrc
32465>>>>>        Get InvokeComMethod of hDispatchDriver 25 OLE_VT_UNKNOWN to retVal
32466>>>>>        Function_Return retVal
32467>>>>>    End_Function
32468>>>>>
32468>>>>>    Function ComSelectTokens Variant llsrc String llpath Returns Variant[]
32470>>>>>        Handle hDispatchDriver
32470>>>>>        Variant[] retVal
32471>>>>>        Get phDispatchDriver to hDispatchDriver
32472>>>>>        Send PrepareParams to hDispatchDriver 2
32473>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llsrc
32474>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpath
32475>>>>>        Get InvokeComMethod of hDispatchDriver 26 (OLE_VT_ARRAY ior OLE_VT_UNKNOWN) to retVal
32476>>>>>        Function_Return retVal
32477>>>>>    End_Function
32478>>>>>
32478>>>>>    Function ComXMLToJSON String llxmlsrc Returns String
32480>>>>>        Handle hDispatchDriver
32480>>>>>        String retVal
32480>>>>>        Get phDispatchDriver to hDispatchDriver
32481>>>>>        Send PrepareParams to hDispatchDriver 1
32482>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llxmlsrc
32483>>>>>        Get InvokeComMethod of hDispatchDriver 27 OLE_VT_BSTR to retVal
32484>>>>>        Function_Return retVal
32485>>>>>    End_Function
32486>>>>>
32486>>>>>    Function ComJSONToXML String lljsonsrc Returns String
32488>>>>>        Handle hDispatchDriver
32488>>>>>        String retVal
32488>>>>>        Get phDispatchDriver to hDispatchDriver
32489>>>>>        Send PrepareParams to hDispatchDriver 1
32490>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR lljsonsrc
32491>>>>>        Get InvokeComMethod of hDispatchDriver 28 OLE_VT_BSTR to retVal
32492>>>>>        Function_Return retVal
32493>>>>>    End_Function
32494>>>>>End_Class
32495>>>>>
32495>>>>>// CoClass
32495>>>>>// ProgID: szJSONParser
32495>>>>>// CLSID: {82EE46EF-D273-419E-842F-255C280D3DD9}
32495>>>>>Class cComcszJSONParser is a cComAutomationObject
32496>>>>>    Import_Class_Protocol cComIszJSONParser
32497>>>>>
32497>>>>>    Procedure Construct_Object
32499>>>>>        Forward Send Construct_Object
32501>>>>>        Set psProgID to "{82EE46EF-D273-419E-842F-255C280D3DD9}"
32502>>>>>        Set peAutoCreate to acNoAutoCreate
32503>>>>>    End_Procedure
32504>>>>>End_Class
32505>>>Use cszJSONObject.pkg
Including file: cszJSONObject.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\cszJSONObject.pkg)
32505>>>>>//-2WA
32505>>>>>Use UI 
32505>>>>>
32505>>>>>Enum_List   // JToken Type
32505>>>>>    // Summary:
32505>>>>>    //     No token type has been set.
32505>>>>>    Define JTokenType_None 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A JSON object.
32505>>>>>    Define JTokenType_Object
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A JSON array.
32505>>>>>    Define JTokenType_Array 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A JSON constructor.
32505>>>>>    Define JTokenType_Constructor 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A JSON object property.
32505>>>>>    Define JTokenType_Property 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A comment.
32505>>>>>    Define JTokenType_Comment 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     An integer value.
32505>>>>>    Define JTokenType_Integer 
32505>>>>>
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A float value.
32505>>>>>    Define JTokenType_Float 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A string value.
32505>>>>>    Define JTokenType_String 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A boolean value.
32505>>>>>    Define JTokenType_Boolean 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A null value.
32505>>>>>    Define JTokenType_Null 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     An undefined value.
32505>>>>>    Define JTokenType_Undefined 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A date value.
32505>>>>>    Define JTokenType_Date 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A raw JSON value.
32505>>>>>    Define JTokenType_Raw 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A collection of bytes value.
32505>>>>>    Define JTokenType_Bytes 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A Guid value.
32505>>>>>    Define JTokenType_Guid 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A Uri value.
32505>>>>>    Define JTokenType_Uri 
32505>>>>>    //
32505>>>>>    // Summary:
32505>>>>>    //     A TimeSpan value.
32505>>>>>    Define JTokenType_TimeSpan     
32505>>>>>End_Enum_List
32505>>>>>
32505>>>>>//  Function:       IsJSONValueType
32505>>>>>//  Author:         Michael Salzlechner
32505>>>>>//  Copyright:      2016 StarZen Technologies, Inc.
32505>>>>>//  Web:            www.starzen.com
32505>>>>>//  Description:    tests a passed token type and returns true or false depending on type
32505>>>>>
32505>>>>>Function IsJSONValueType Global Integer iType Returns Integer
32507>>>>>    Case Begin
32507>>>>>        Case (iType=JTokenType_Object)
32509>>>>>        Case (iType=JTokenType_Property)
32512>>>>>        Case (iType=JTokenType_Array)
32515>>>>>        Case (iType=JTokenType_None)
32518>>>>>        Case (iType=JTokenType_Constructor)
32521>>>>>        Case (iType=JTokenType_Null)
32524>>>>>            Function_Return (False)
32525>>>>>            Case Break
32526>>>>>        
32526>>>>>        Case (iType=JTokenType_Comment    )
32529>>>>>        Case (iType=JTokenType_Integer)
32532>>>>>        Case (iType=JTokenType_Float)
32535>>>>>        Case (iType=JTokenType_String)
32538>>>>>        Case (iType=JTokenType_Boolean)
32541>>>>>        Case (iType=JTokenType_Date)
32544>>>>>        Case (iType=JTokenType_Raw)
32547>>>>>        Case (iType=JTokenType_Bytes)
32550>>>>>        Case (iType=JTokenType_Guid)
32553>>>>>        Case (iType=JTokenType_Uri)
32556>>>>>        Case (iType=JTokenType_TimeSpan)
32559>>>>>            Function_Return (True)
32560>>>>>            Case Break
32561>>>>>    Case End       
32561>>>>>    
32561>>>>>    Function_Return (False)
32562>>>>>End_Function
32563>>>>>    
32563>>>>>//  Class:          cszJSONObject
32563>>>>>//  Author:         Michael Salzlechner
32563>>>>>//  Copyright:      2016 StarZen Technologies, Inc.
32563>>>>>//  Web:            www.starzen.com
32563>>>>>//  Description:    a JSON Object
32563>>>>>    
32563>>>>>Class cszJSONObject is a cObject
32564>>>>>    Procedure Construct_Object
32566>>>>>        Forward Send Construct_Object
32568>>>>>        
32568>>>>>        Property Variant pvJSONObject 
32569>>>>>        Property Integer phoParser Public 0
32570>>>>>    End_Procedure
32571>>>>>
32571>>>>>    //  Function:       Serialize
32571>>>>>    //  Author:         Michael Salzlechner
32571>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32571>>>>>    //  Web:            www.starzen.com
32571>>>>>    //  Description:    serializes this object into a string containing the JSON data
32571>>>>>    //                  on success this function will return a string containing the object
32571>>>>>    //                  on failure the return value is ""
32571>>>>>        
32571>>>>>    Function Serialize Returns String
32573>>>>>        Integer hoParser
32573>>>>>        Get phoParser to hoParser
32574>>>>>        
32574>>>>>        Variant vJSONObject
32574>>>>>        Get pvJSONObject to vJSONObject
32575>>>>>
32575>>>>>        String sJSON
32575>>>>>        Get ComSerialize vJSONObject to sJSON
32576>>>>>        
32576>>>>>        Function_Return sJSON
32577>>>>>    End_Function
32578>>>>>
32578>>>>>    
32578>>>>>    //  Function:       ChildCount
32578>>>>>    //  Author:         Michael Salzlechner
32578>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32578>>>>>    //  Web:            www.starzen.com
32578>>>>>    //  Description:    returns the number of child tokens in this object
32578>>>>>    
32578>>>>>    Function ChildCount Returns Integer
32580>>>>>        Integer hoParser
32580>>>>>        Get phoParser to hoParser
32581>>>>>        Variant vJSONObject
32581>>>>>        Get pvJSONObject to vJSONObject
32582>>>>>
32582>>>>>        Integer iRetVal
32582>>>>>        Get ComGetTokenChildCount of hoParser vJSONObject to iRetVal
32583>>>>>        
32583>>>>>        Function_Return iRetVal
32584>>>>>    End_Function
32585>>>>>
32585>>>>>    //  Function:       TokenType
32585>>>>>    //  Author:         Michael Salzlechner
32585>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32585>>>>>    //  Web:            www.starzen.com
32585>>>>>    //  Description:    returns the token type for the current JSON object
32585>>>>>        
32585>>>>>    Function TokenType Returns Integer
32587>>>>>        Integer hoParser
32587>>>>>        Get phoParser to hoParser
32588>>>>>        Variant vJSONObject
32588>>>>>        Get pvJSONObject to vJSONObject
32589>>>>>
32589>>>>>        Integer iType
32589>>>>>        Get ComGetTokenType of hoParser vJSONObject to iType
32590>>>>>        
32590>>>>>        Function_Return iType
32591>>>>>    End_Function
32592>>>>>
32592>>>>>    //  Function:       TokenTypeAsString
32592>>>>>    //  Author:         Michael Salzlechner
32592>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32592>>>>>    //  Web:            www.starzen.com
32592>>>>>    //  Description:    returns the token type in text form for the current JSON object
32592>>>>>
32592>>>>>    Function TokenTypeAsString Returns String
32594>>>>>        Integer hoParser
32594>>>>>        Get phoParser to hoParser
32595>>>>>        Variant vJSONObject
32595>>>>>        Get pvJSONObject to vJSONObject
32596>>>>>
32596>>>>>        String sType
32596>>>>>        Get ComGetTokenTypeAsString of hoParser vJSONObject to sType
32597>>>>>        
32597>>>>>        Function_Return sType
32598>>>>>    End_Function
32599>>>>>
32599>>>>>    //  Function:       HasValues
32599>>>>>    //  Author:         Michael Salzlechner
32599>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32599>>>>>    //  Web:            www.starzen.com
32599>>>>>    //  Description:    returns True or False depending on the type of object
32599>>>>>    //                  true means the object has child objects/values
32599>>>>>        
32599>>>>>    Function HasValues Returns Integer
32601>>>>>        Integer hoParser
32601>>>>>        Get phoParser to hoParser
32602>>>>>        Variant vJSONObject
32602>>>>>        Get pvJSONObject to vJSONObject
32603>>>>>
32603>>>>>        Boolean bHasValues
32603>>>>>        Get ComGetHasValues of hoParser vJSONObject to bHasValues
32604>>>>>        Function_Return bHasValues
32605>>>>>    End_Function
32606>>>>>
32606>>>>>    //  Function:       PropertyName
32606>>>>>    //  Author:         Michael Salzlechner
32606>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32606>>>>>    //  Web:            www.starzen.com
32606>>>>>    //  Description:    returns the name of a property token
32606>>>>>        
32606>>>>>    Function PropertyName Returns String
32608>>>>>        Integer hoParser
32608>>>>>        Get phoParser to hoParser
32609>>>>>        Variant vJSONObject
32609>>>>>        Get pvJSONObject to vJSONObject
32610>>>>>            
32610>>>>>        String sPropName            
32610>>>>>        If (TokenType(Self)=JTokenType_Property) Begin
32612>>>>>            Get ComGetPropertyName of hoParser vJSONObject to sPropName 
32613>>>>>            Function_Return sPropName
32614>>>>>        End
32614>>>>>>
32614>>>>>        Function_Return ""
32615>>>>>    End_Function
32616>>>>>    
32616>>>>>    //  Function:       TokenPath
32616>>>>>    //  Author:         Michael Salzlechner
32616>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32616>>>>>    //  Web:            www.starzen.com
32616>>>>>    //  Description:    returns the path for the current token
32616>>>>>    
32616>>>>>    Function TokenPath Returns String
32618>>>>>        Integer hoParser
32618>>>>>        Get phoParser to hoParser
32619>>>>>        Variant vJSONObject
32619>>>>>        Get pvJSONObject to vJSONObject
32620>>>>>        
32620>>>>>        String sPath
32620>>>>>        Get ComGetTokenPath of hoParser vJSONObject to sPath
32621>>>>>        Function_Return sPath
32622>>>>>    End_Function
32623>>>>>    
32623>>>>>    //  Function:       ChildTokenByIndex
32623>>>>>    //  Author:         Michael Salzlechner
32623>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32623>>>>>    //  Web:            www.starzen.com
32623>>>>>    //  Description:    returns a child token at the given index
32623>>>>>    
32623>>>>>    Function ChildTokenByIndex Integer iIndex Returns Integer
32625>>>>>        Integer hoParser
32625>>>>>        Get phoParser to hoParser
32626>>>>>        Variant vJSONObject
32626>>>>>        Get pvJSONObject to vJSONObject
32627>>>>>
32627>>>>>        Variant vChild
32627>>>>>        Get ComGetChild of hoParser vJSONObject iIndex to vChild        
32628>>>>>        If (not(IsNullComObject(vChild))) Begin
32630>>>>>            Integer hoJSONObject
32630>>>>>            Get Create (RefClass(cszJSONObject)) to hoJSONObject
32631>>>>>            Set pvJSONObject of hoJSONObject to vChild
32632>>>>>            Set phoParser of hoJSONObject to hoParser
32633>>>>>            Function_Return hoJSONObject
32634>>>>>        End
32634>>>>>>
32634>>>>>        Else Function_Return 0
32636>>>>>    End_Function
32637>>>>>
32637>>>>>    //  Function:       ChildTokenByName
32637>>>>>    //  Author:         Michael Salzlechner
32637>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32637>>>>>    //  Web:            www.starzen.com
32637>>>>>    //  Description:    returns the child token with a given name
32637>>>>>
32637>>>>>    Function ChildTokenByName String sFieldName Returns Integer
32639>>>>>        Integer hoParser
32639>>>>>        Get phoParser to hoParser
32640>>>>>        Variant vJSONObject
32640>>>>>        Get pvJSONObject to vJSONObject
32641>>>>>
32641>>>>>        Variant vChild
32641>>>>>        Get ComGetChildByName of hoParser vJSONObject sFieldName to vChild   
32642>>>>>        If (not(IsNullComObject(vChild))) Begin
32644>>>>>            Integer hoJSONObject
32644>>>>>            Get Create (RefClass(cszJSONObject)) to hoJSONObject
32645>>>>>            Set pvJSONObject of hoJSONObject to vChild
32646>>>>>            Set phoParser of hoJSONObject to hoParser
32647>>>>>            Function_Return hoJSONObject
32648>>>>>        End
32648>>>>>>
32648>>>>>        Else Function_Return 0
32650>>>>>    End_Function
32651>>>>>
32651>>>>>    //  Function:       ChildValueByName
32651>>>>>    //  Author:         Michael Salzlechner
32651>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32651>>>>>    //  Web:            www.starzen.com
32651>>>>>    //  Description:    returns the value of a child token by name
32651>>>>>
32651>>>>>    Function ChildValueByName String sFieldName Returns String
32653>>>>>        Integer hoParser
32653>>>>>        Get phoParser to hoParser
32654>>>>>        Variant vJSONObject
32654>>>>>        Get pvJSONObject to vJSONObject
32655>>>>>
32655>>>>>        Variant vChild
32655>>>>>        Get ComGetChildByName of hoParser vJSONObject sFieldName to vChild   
32656>>>>>        If (not(IsNullComObject(vChild))) Begin
32658>>>>>            Integer iType
32658>>>>>            Get ComGetTokenType of hoParser vChild to iType
32659>>>>>            If (IsJSONValueType(iType)) Begin
32661>>>>>                String sVal
32661>>>>>                Get ComGetTokenValueAsString of hoParser vChild to sVal
32662>>>>>                Function_Return sVal
32663>>>>>            End
32663>>>>>>
32663>>>>>            Else Begin
32664>>>>>                Function_Return ""
32665>>>>>            End
32665>>>>>>
32665>>>>>        End       
32665>>>>>>
32665>>>>>        Else Function_Return ""
32667>>>>>    End_Function    
32668>>>>>
32668>>>>>    //  Function:       ChildValueByIndex
32668>>>>>    //  Author:         Michael Salzlechner
32668>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32668>>>>>    //  Web:            www.starzen.com
32668>>>>>    //  Description:    returns the value of a child token by index
32668>>>>>
32668>>>>>    Function ChildValueByIndex Integer iIndex Returns String
32670>>>>>        Integer hoParser
32670>>>>>        Get phoParser to hoParser
32671>>>>>        Variant vJSONObject
32671>>>>>        Get pvJSONObject to vJSONObject
32672>>>>>
32672>>>>>        Variant vChild
32672>>>>>        Get ComGetChild of hoParser vJSONObject iIndex to vChild   
32673>>>>>        If (not(IsNullComObject(vChild))) Begin
32675>>>>>            Integer iType
32675>>>>>            Get ComGetTokenType of hoParser vChild to iType
32676>>>>>            If (IsJSONValueType(iType)) Begin
32678>>>>>                String sVal
32678>>>>>                Get ComGetTokenValueAsString of hoParser vChild to sVal
32679>>>>>                Function_Return sVal
32680>>>>>            End
32680>>>>>>
32680>>>>>            Else Begin
32681>>>>>                Function_Return ""
32682>>>>>            End
32682>>>>>>
32682>>>>>        End       
32682>>>>>>
32682>>>>>        Else Function_Return ""
32684>>>>>    End_Function    
32685>>>>>
32685>>>>>    //  Function:       TokenValue
32685>>>>>    //  Author:         Michael Salzlechner
32685>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32685>>>>>    //  Web:            www.starzen.com
32685>>>>>    //  Description:    returns the value of the token 
32685>>>>>
32685>>>>>    Function TokenValue Returns String
32687>>>>>        Integer hoParser
32687>>>>>        Get phoParser to hoParser
32688>>>>>        Variant vJSONObject
32688>>>>>        Get pvJSONObject to vJSONObject
32689>>>>>
32689>>>>>        Integer iType
32689>>>>>        Get ComGetTokenType of hoParser vJSONObject to iType
32690>>>>>        If (IsJSONValueType(iType)) Begin
32692>>>>>            String sVal
32692>>>>>            Get ComGetTokenValueAsString of hoParser vJSONObject to sVal
32693>>>>>            Function_Return sVal
32694>>>>>        End
32694>>>>>>
32694>>>>>        Else Begin
32695>>>>>            Function_Return ""
32696>>>>>        End
32696>>>>>>
32696>>>>>
32696>>>>>        Function_Return ""
32697>>>>>    End_Function
32698>>>>>
32698>>>>>    //  Function:       GetAtPath
32698>>>>>    //  Author:         Michael Salzlechner
32698>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32698>>>>>    //  Web:            www.starzen.com
32698>>>>>    //  Description:    returns the token with the given path starting at the current token
32698>>>>>    
32698>>>>>    Function GetAtPath String sPath Returns Integer
32700>>>>>        Integer hoParser
32700>>>>>        Get phoParser to hoParser
32701>>>>>        Variant vJSONObject
32701>>>>>        Get pvJSONObject to vJSONObject
32702>>>>>        
32702>>>>>        Variant vToken
32702>>>>>        Get ComGetAtPath of hoParser vJSONObject sPath to vToken
32703>>>>>        If (not(IsNullComObject(vToken))) Begin
32705>>>>>            Integer hoJSON 
32705>>>>>            
32705>>>>>            Get Create (RefClass(cszJSONObject)) to hoJSON 
32706>>>>>            Set pvJSONObject of hoJSON to vToken
32707>>>>>            Set phoParser of hoJSON to hoParser
32708>>>>>            
32708>>>>>            Function_Return hoJSON
32709>>>>>        End
32709>>>>>>
32709>>>>>        Else Function_Return 0
32711>>>>>    End_Function
32712>>>>>
32712>>>>>    //  Function:       GetValueAtPath
32712>>>>>    //  Author:         Michael Salzlechner
32712>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32712>>>>>    //  Web:            www.starzen.com
32712>>>>>    //  Description:    returns the value of a token with the given path starting at the current token
32712>>>>>
32712>>>>>    Function GetValueAtPath String sPath Returns Integer
32714>>>>>        Integer hoParser
32714>>>>>        Get phoParser to hoParser
32715>>>>>        Variant vJSONObject
32715>>>>>        Get pvJSONObject to vJSONObject
32716>>>>>        
32716>>>>>        Variant vToken
32716>>>>>        Get ComGetAtPath of hoParser vJSONObject sPath to vToken
32717>>>>>        If (not(IsNullComObject(vToken))) Begin
32719>>>>>            Integer iType
32719>>>>>            Get ComGetTokenType of hoParser vToken to iType
32720>>>>>            If (IsJSONValueType(iType)) Begin
32722>>>>>                String sVal
32722>>>>>                Get ComGetTokenValueAsString of hoParser vToken to sVal
32723>>>>>                Function_Return sVal
32724>>>>>            End
32724>>>>>>
32724>>>>>            Else Begin
32725>>>>>                Function_Return ""
32726>>>>>            End
32726>>>>>>
32726>>>>>        End
32726>>>>>>
32726>>>>>        Else Function_Return ""
32728>>>>>    End_Function
32729>>>>>
32729>>>>>    //  Procedure:      AddString
32729>>>>>    //  Author:         Michael Salzlechner
32729>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32729>>>>>    //  Web:            www.starzen.com
32729>>>>>    //  Description:    adds a strongly typed string value with a given property name to this object
32729>>>>>    //                  in case this object is an array the property name is ignored
32729>>>>>        
32729>>>>>    Procedure AddString String propName String propVal
32731>>>>>        Integer hoParser
32731>>>>>        Get phoParser to hoParser
32732>>>>>        Variant vJSONObject
32732>>>>>        Get pvJSONObject to vJSONObject
32733>>>>>        
32733>>>>>        Send ComAddString to hoParser vJSONObject propName propVal
32734>>>>>    End_Procedure
32735>>>>>
32735>>>>>    //  Procedure:      AddObject
32735>>>>>    //  Author:         Michael Salzlechner
32735>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32735>>>>>    //  Web:            www.starzen.com
32735>>>>>    //  Description:    adds a JSON object with a given property name to this object
32735>>>>>    //                  in case this object is an array the property name is ignored
32735>>>>>
32735>>>>>    Procedure AddObject String propName Integer hoJSONObj
32737>>>>>        Integer hoParser
32737>>>>>        Get phoParser to hoParser
32738>>>>>        Variant vJSONObject vJSONObjectToAdd
32738>>>>>        Get pvJSONObject to vJSONObject
32739>>>>>        
32739>>>>>        Get pvJSONObject of hoJSONObj to vJSONObjectToAdd
32740>>>>>        Send ComAddObject to hoParser vJSONObject propName vJSONObjectToAdd
32741>>>>>    End_Procedure
32742>>>>>
32742>>>>>    //  Procedure:      AddInteger
32742>>>>>    //  Author:         Michael Salzlechner
32742>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32742>>>>>    //  Web:            www.starzen.com
32742>>>>>    //  Description:    adds a strongly typed integer value with a given property name to this object
32742>>>>>    //                  in case this object is an array the property name is ignored
32742>>>>>
32742>>>>>    Procedure AddInteger String propName Integer propVal
32744>>>>>        Integer hoParser
32744>>>>>        Get phoParser to hoParser
32745>>>>>        Variant vJSONObject
32745>>>>>        Get pvJSONObject to vJSONObject
32746>>>>>        
32746>>>>>        Send ComAddInteger to hoParser vJSONObject propName propVal
32747>>>>>    End_Procedure
32748>>>>>
32748>>>>>    //  Procedure:      AddNull
32748>>>>>    //  Author:         Michael Salzlechner
32748>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32748>>>>>    //  Web:            www.starzen.com
32748>>>>>    //  Description:    adds a null value object with a given property name to this object
32748>>>>>    //                  in case this object is an array the property name is ignored
32748>>>>>
32748>>>>>    Procedure AddNull String propName 
32750>>>>>        Integer hoParser
32750>>>>>        Get phoParser to hoParser
32751>>>>>        Variant vJSONObject
32751>>>>>        Get pvJSONObject to vJSONObject
32752>>>>>        
32752>>>>>        Send ComAddNull to hoParser vJSONObject propName
32753>>>>>    End_Procedure
32754>>>>>
32754>>>>>    //  Procedure:      AddBoolean
32754>>>>>    //  Author:         Michael Salzlechner
32754>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32754>>>>>    //  Web:            www.starzen.com
32754>>>>>    //  Description:    adds a strongly typed boolean value with a given property name to this object
32754>>>>>    //                  in case this object is an array the property name is ignored
32754>>>>>
32754>>>>>    Procedure AddBoolean String propName Boolean propVal
32756>>>>>        Integer hoParser
32756>>>>>        Get phoParser to hoParser
32757>>>>>        Variant vJSONObject
32757>>>>>        Get pvJSONObject to vJSONObject
32758>>>>>        
32758>>>>>        Send ComAddBoolean to hoParser vJSONObject propName propVal
32759>>>>>    End_Procedure
32760>>>>>
32760>>>>>    //  Function:       DeepClone
32760>>>>>    //  Author:         Michael Salzlechner
32760>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32760>>>>>    //  Web:            www.starzen.com
32760>>>>>    //  Description:    creates a deep clone of this object meaning descendents are deep cloned as well
32760>>>>>    //                  on success returns new dynamic JSON object that needs to be destroyed
32760>>>>>
32760>>>>>    Function DeepClone Returns Integer
32762>>>>>        Integer hoParser
32762>>>>>        Get phoParser to hoParser
32763>>>>>        Variant vJSONObject
32763>>>>>        Get pvJSONObject to vJSONObject
32764>>>>>
32764>>>>>        Variant vNewObj
32764>>>>>        Get ComDeepClone of hoParser vJSONObject to vNewObj
32765>>>>>        If (not(IsNullComObject(vNewObj))) Begin
32767>>>>>            Integer hoJSON 
32767>>>>>            
32767>>>>>            Get Create (RefClass(cszJSONObject)) to hoJSON 
32768>>>>>            Set pvJSONObject of hoJSON to vNewObj
32769>>>>>            Set phoParser of hoJSON to hoParser
32770>>>>>            
32770>>>>>            Function_Return hoJSON            
32771>>>>>        End
32771>>>>>>
32771>>>>>    End_Function
32772>>>>>
32772>>>>>    //  Procedure:      RemoveFromParent
32772>>>>>    //  Author:         Michael Salzlechner
32772>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32772>>>>>    //  Web:            www.starzen.com
32772>>>>>    //  Description:    do not use at this time
32772>>>>>
32772>>>>>//    Procedure RemoveFromParent 
32772>>>>>//        Integer hoParser
32772>>>>>//        Get phoParser to hoParser
32772>>>>>//        Variant vJSONObject
32772>>>>>//        Get pvJSONObject to vJSONObject
32772>>>>>//        
32772>>>>>//        Send ComRemoveFromParent of hoParser vJSONObject
32772>>>>>//    End_Procedure
32772>>>>>
32772>>>>>    //  Procedure:      RemoveChild 
32772>>>>>    //  Author:         Michael Salzlechner
32772>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32772>>>>>    //  Web:            www.starzen.com
32772>>>>>    //  Description:    will remove the child item with the given property name
32772>>>>>
32772>>>>>    Procedure RemoveChild String propName
32774>>>>>        Integer hoParser
32774>>>>>        Get phoParser to hoParser
32775>>>>>        Variant vJSONObject
32775>>>>>        Get pvJSONObject to vJSONObject
32776>>>>>        
32776>>>>>        Send ComRemoveChild of hoParser vJSONObject propName
32777>>>>>    End_Procedure
32778>>>>>
32778>>>>>    //  Procedure:      RemoveAllChildren
32778>>>>>    //  Author:         Michael Salzlechner
32778>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32778>>>>>    //  Web:            www.starzen.com
32778>>>>>    //  Description:    removes all child objects from this object
32778>>>>>
32778>>>>>    Procedure RemoveAllChildren
32780>>>>>        Integer hoParser
32780>>>>>        Get phoParser to hoParser
32781>>>>>        Variant vJSONObject
32781>>>>>        Get pvJSONObject to vJSONObject
32782>>>>>        
32782>>>>>        Send ComRemoveAllChildren of hoParser vJSONObject 
32783>>>>>    End_Procedure
32784>>>>>
32784>>>>>    //  Function:       SelectToken
32784>>>>>    //  Author:         Michael Salzlechner
32784>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32784>>>>>    //  Web:            www.starzen.com
32784>>>>>    //  Description:    uses JPath queries to select tokens 
32784>>>>>    //                  returns an array of dynamic JSON objects that need to be destroyed
32784>>>>>    
32784>>>>>    Function SelectTokens String sPath Returns Integer[]
32786>>>>>        Integer hoParser
32786>>>>>        Get phoParser to hoParser
32787>>>>>        Variant vJSONObject
32787>>>>>        Get pvJSONObject to vJSONObject
32788>>>>>
32788>>>>>        Variant[] vTokens
32789>>>>>        Get ComSelectTokens of hoParser vJSONObject sPath to vTokens
32790>>>>>        Integer iLoop iCount
32790>>>>>        Move (SizeOfArray(vTokens)-1) to iCount
32791>>>>>        
32791>>>>>        Integer[] jsonObjs
32792>>>>>        For iLoop from 0 to iCount
32798>>>>>>
32798>>>>>            If (not(IsNullComObject(vTokens[iLoop]))) Begin
32800>>>>>                Get Create (RefClass(cszJSONObject)) to jsonObjs[iLoop]
32801>>>>>                Set pvJSONObject of jsonObjs[iLoop] to vTokens[iLoop]
32802>>>>>                Set phoParser of jsonObjs[iLoop] to hoParser                
32803>>>>>            End
32803>>>>>>
32803>>>>>            Else Move 0 to jsonObjs[iLoop]
32805>>>>>        Loop
32806>>>>>>
32806>>>>>        Function_Return jsonObjs
32807>>>>>    End_Function
32808>>>>>    
32808>>>>>    Procedure End_Construct_Object
32810>>>>>        Forward Send End_Construct_Object
32812>>>>>
32812>>>>>    End_Procedure
32813>>>>>
32813>>>>>
32813>>>>>End_Class
32814>>>
32814>>>//  Class:          cszJSONParser
32814>>>//  Author:         Michael Salzlechner
32814>>>//  Copyright:      2016 StarZen Technologies, Inc.
32814>>>//  Web:            www.starzen.com
32814>>>//  Description:
32814>>>
32814>>>Class cszJSONParser is a cComcszJSONParser
32815>>>    
32815>>>    Procedure Construct_Object
32817>>>        Forward Send Construct_Object
32819>>>
32819>>>    End_Procedure
32820>>>
32820>>>    //  Function:       DeserializeString
32820>>>    //  Author:         Michael Salzlechner
32820>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32820>>>    //  Web:            www.starzen.com
32820>>>    //  Description:    deserializes a string into a JSON object
32820>>>    //                  on success this function will create and return a dynamic JSON object that needs to be destroyed
32820>>>    //                  on failure the return value is 0
32820>>>    
32820>>>    Function DeserializeString String sJSON Returns Integer
32822>>>        Variant vJSONObj
32822>>>        
32822>>>        Get ComDeserializeString sJSON to vJSONObj
32823>>>        
32823>>>        If (not(IsNullComObject(vJSONObj))) Begin
32825>>>            Integer hoJSON
32825>>>            Get Create (RefClass(cszJSONObject)) to hoJSON
32826>>>            Set pvJSONObject of hoJSON to vJSONObj
32827>>>            Set phoParser of hoJSON to (Self)
32828>>>            Function_Return hoJSON
32829>>>        End
32829>>>>
32829>>>        Else Function_Return 0
32831>>>    End_Function
32832>>>        
32832>>>    //  Function:       NewJSONObject
32832>>>    //  Author:         Michael Salzlechner
32832>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32832>>>    //  Web:            www.starzen.com
32832>>>    //  Description:    creates a new empty JSON object
32832>>>    //                  on success this function will create and return a dynamic JSON object that needs to be destroyed
32832>>>    //                  on failure the return value is 0
32832>>>    
32832>>>    Function NewJSONObject Returns Integer
32834>>>        Variant vJSONObj 
32834>>>        Get ComNewJSONObject to vJSONObj
32835>>>        If (not(IsNullComObject(vJSONObj))) Begin
32837>>>            Integer hoJSON
32837>>>            Get Create (RefClass(cszJSONObject)) to hoJSON
32838>>>            Set pvJSONObject of hoJSON to vJSONObj
32839>>>            Set phoParser of hoJSON to (Self)
32840>>>            Function_Return hoJSON
32841>>>        End
32841>>>>
32841>>>        Function_Return 0
32842>>>    End_Function
32843>>>
32843>>>    //  Function:       NewJSONArray
32843>>>    //  Author:         Michael Salzlechner
32843>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32843>>>    //  Web:            www.starzen.com
32843>>>    //  Description:    creates a new empty JSON Array
32843>>>    //                  on success this function will create and return a dynamic JSON object that needs to be destroyed
32843>>>    //                  on failure the return value is 0
32843>>>    
32843>>>    Function NewJSONArray Returns Integer
32845>>>        Variant vJSONArr
32845>>>        Get ComNewJSONArray to vJSONArr
32846>>>        If (not(IsNullComObject(vJSONArr))) Begin
32848>>>            Integer hoJSON
32848>>>            Get Create (RefClass(cszJSONObject)) to hoJSON
32849>>>            Set pvJSONObject of hoJSON to vJSONArr
32850>>>            Set phoParser of hoJSON to (Self)
32851>>>            Function_Return hoJSON
32852>>>        End
32852>>>>
32852>>>        Function_Return 0
32853>>>    End_Function
32854>>>
32854>>>    //  Function:       XMLToJSON
32854>>>    //  Author:         Michael Salzlechner
32854>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32854>>>    //  Web:            www.starzen.com
32854>>>    //  Description:    converts an XML string to a JSON string
32854>>>    //                  on success this function will return string
32854>>>    //                  on failure the return value is ""
32854>>>    
32854>>>    Function XMLToJSON String sXML Returns String
32856>>>        String sJSON
32856>>>        Get ComXMLToJSON sXML to sJSON
32857>>>        Function_Return sJSON
32858>>>    End_Function
32859>>>
32859>>>    //  Function:       JSONToXML
32859>>>    //  Author:         Michael Salzlechner
32859>>>    //  Copyright:      2016 StarZen Technologies, Inc.
32859>>>    //  Web:            www.starzen.com
32859>>>    //  Description:    converts a JSON string to an XML string
32859>>>    //                  on success this function will return string
32859>>>    //                  on failure the return value is ""
32859>>>    
32859>>>    Function JSONToXML String sJSON Returns String
32861>>>        String sXML
32861>>>        Get ComJSONToXML sJSON to sXML
32862>>>        Function_Return sXML
32863>>>    End_Function
32864>>>    
32864>>>    Procedure End_Construct_Object
32866>>>        Forward Send End_Construct_Object
32868>>>
32868>>>    End_Procedure
32869>>>
32869>>>End_Class
32870>>>
32870>>>Object oParser is a cszJSONParser
32872>>>End_Object //oParser
32873>    Use cszJSONObject.pkg
32873>    
32873>    Use SessionManager.wo
Including file: SessionManager.wo    (C:\DataFlex Projects\CROSS\WVDF_WS\AppSrc\SessionManager.wo)
32873>>>//-2WA
32873>>>Use cWebSessionManager2WA.pkg
Including file: cWebSessionManager2WA.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\cWebSessionManager2WA.pkg)
32873>>>>>//-2WA
32873>>>>>Use cWebSessionManager.pkg
32873>>>>>Use CSAG300.DD
32873>>>>>Use CSAG311.DD
Including file: CSAG311.DD    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG311.DD)
32873>>>>>>>//-2WA
32873>>>>>>>// Class Name: Csag311_DataDictionary
32873>>>>>>>// Revision  : 28
32873>>>>>>>// Version   : 2
32873>>>>>>>//-2WA
32873>>>>>>>Use  Windows.pkg           // Basic Definitions
32873>>>>>>>Use  CtrlData.PKG          // DataDictionary Class Definition
32873>>>>>>>Use  Ddvaltbl.pkg          // Validation Table Class Definitions
32873>>>>>>>
32873>>>>>>>Open CSAG311
32875>>>>>>>Open CSAG300
32877>>>>>>>
32877>>>>>>>
32877>>>>>>>Class Csag311_DataDictionary  is a c_DataDictionary
32878>>>>>>>
32878>>>>>>>    // Define_Fields:
32878>>>>>>>    // This procedure is used to set up all data-dictionary rules.
32878>>>>>>>
32878>>>>>>>    Procedure Construct_Object
32880>>>>>>>        Forward Send Construct_Object
32882>>>>>>>
32882>>>>>>>
32882>>>>>>>        Set Main_File To Csag311.File_Number
32883>>>>>>>
32883>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
32884>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
32885>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
32886>>>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
32887>>>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
32888>>>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
32889>>>>>>>
32889>>>>>>>        // Field-based properties.......................
32889>>>>>>>
32889>>>>>>>        Set Field_Label_Long Field Csag311.Usuariosessao To "Sessao"
32890>>>>>>>        Set Field_Option Field Csag311.Usuariosessao DD_CAPSLOCK to True
32891>>>>>>>
32891>>>>>>>        Set Field_Label_Long Field Csag311.Usuarioecodigo to "CODIGO"
32892>>>>>>>        Set Field_Option Field Csag311.Usuarioecodigo DD_CAPSLOCK to True
32893>>>>>>>
32893>>>>>>>        Set Field_Label_Long Field Csag311.Usuarioempresa To "Empresa"
32894>>>>>>>        Set Field_Option Field Csag311.Usuarioempresa DD_CAPSLOCK to True
32895>>>>>>>
32895>>>>>>>        Set Field_Label_Long Field Csag311.Usuarionumero To "ID"
32896>>>>>>>
32896>>>>>>>        Set Field_Label_Long Field Csag311.Usuarionome To "Nome"
32897>>>>>>>        Set Field_Option Field Csag311.Usuarionome DD_CAPSLOCK to True
32898>>>>>>>
32898>>>>>>>        Set Field_Label_Long Field Csag311.Usuarioemail To "E-Mail"
32899>>>>>>>
32899>>>>>>>        Set Field_Label_Long Field Csag311.Usuariosenha To "Senha"
32900>>>>>>>        Set Field_Option Field Csag311.Usuariosenha DD_CAPSLOCK to True
32901>>>>>>>
32901>>>>>>>        Set Field_Label_Long Field Csag311.Usuarioip To "IP.Servidor"
32902>>>>>>>
32902>>>>>>>        Set Field_Label_Long Field Csag311.Data To "Data"
32903>>>>>>>
32903>>>>>>>        Set Field_Label_Long Field Csag311.Horario To "Horario"
32904>>>>>>>
32904>>>>>>>    End_Procedure    // Construct_Object
32905>>>>>>>
32905>>>>>>>
32905>>>>>>>    Procedure End_Construct_Object
32907>>>>>>>        Forward Send End_Construct_Object
32909>>>>>>>
32909>>>>>>>        //REMOVE EXTERNAL FILE
32909>>>>>>>        Send Remove_System_File LOGDATA.FILE_NUMBER
32910>>>>>>>        Send Remove_System_File LOGTEXT.FILE_NUMBER
32911>>>>>>>    End_Procedure
32912>>>>>>>
32912>>>>>>>    //Procedure Creating
32912>>>>>>>    //    DateTime dtCurrentDateTime
32912>>>>>>>    //    
32912>>>>>>>    //    Forward Send Creating
32912>>>>>>>    //    
32912>>>>>>>    //    //  Init usecounter
32912>>>>>>>    //    Move 0 to WebAppSession.UseCount
32912>>>>>>>    //    
32912>>>>>>>    //    //  Set the creation and access time to the current time
32912>>>>>>>    //    Move (CurrentDateTime()) to dtCurrentDateTime
32912>>>>>>>    //
32912>>>>>>>    //    Get TimeToString dtCurrentDateTime to CSAG311.DATA
32912>>>>>>>    //    Get TimeToString dtCurrentDateTime to CSAG311.HORARIO
32912>>>>>>>    //    
32912>>>>>>>    //    Move dtCurrentDateTime to CSAG311.DATA
32912>>>>>>>    //    Move dtCurrentDateTime to WebAppSession.LastAccessDate
32912>>>>>>>    //End_Procedure
32912>>>>>>>
32912>>>>>>>    //
32912>>>>>>>    //  Converts the given time to an string that can be saved in the database.
32912>>>>>>>    //
32912>>>>>>>    //  Params:
32912>>>>>>>    //      dtTime  Time to convert
32912>>>>>>>    //  Returns:
32912>>>>>>>    //      String with "HH:MM:SS" format
32912>>>>>>>    //
32912>>>>>>>    Function TimeToString DateTime dtTime Returns String
32914>>>>>>>        String sHours sMinutes sSeconds
32914>>>>>>>        
32914>>>>>>>        //  Extract parts
32914>>>>>>>        Move (String(DateGetHour(dtTime))) to sHours
32915>>>>>>>        Move (String(DateGetMinute(dtTime))) to sMinutes
32916>>>>>>>        Move (String(DateGetSecond(dtTime))) to sSeconds
32917>>>>>>>        
32917>>>>>>>        //  Fill out with 0
32917>>>>>>>        If (Length(sHours) = 1) Move ("0" + sHours) to sHours
32920>>>>>>>        If (Length(sMinutes) = 1) Move ("0" + sMinutes) to sMinutes
32923>>>>>>>        If (Length(sSeconds) = 1) Move ("0" + sSeconds) to sSeconds
32926>>>>>>>        
32926>>>>>>>        Function_Return (sHours + ":" + sMinutes + ":" + sSeconds)
32927>>>>>>>    End_Function
32928>>>>>>>    
32928>>>>>>>    //
32928>>>>>>>    //  Sets the time of the datetime variable to the time in the string.
32928>>>>>>>    //
32928>>>>>>>    //  Params:
32928>>>>>>>    //      dtTime  Datetime variable to add time to
32928>>>>>>>    //      sTimeString String with time in the format "HH:MM:SS"
32928>>>>>>>    //  Returns:
32928>>>>>>>    //      dtDateTime with the loaded time
32928>>>>>>>    //
32928>>>>>>>    Function StringToTime DateTime dtTime String sTimeString Returns DateTime
32930>>>>>>>        String sHours sMinutes sSeconds
32930>>>>>>>        
32930>>>>>>>        //  Extract parts
32930>>>>>>>        Move (Mid(sTimeString, 2, 1)) to sHours
32931>>>>>>>        Move (Mid(sTimeString, 2, 4)) to sMinutes
32932>>>>>>>        Move (Mid(sTimeString, 2, 7)) to sSeconds
32933>>>>>>>        
32933>>>>>>>        //  Set to DateTime
32933>>>>>>>        Move (DateSetHour(dtTime, (Integer(sHours)))) to dtTime
32934>>>>>>>        Move (DateSetMinute(dtTime, (Integer(sMinutes)))) to dtTime
32935>>>>>>>        Move (DateSetSecond(dtTime, (Integer(sSeconds)))) to dtTime
32936>>>>>>>        
32936>>>>>>>        Function_Return dtTime
32937>>>>>>>    End_Function
32938>>>>>>>
32938>>>>>>>    // Field_Defaults:
32938>>>>>>>    // This procedure is used to establish default field values.
32938>>>>>>>
32938>>>>>>>    Procedure Field_Defaults
32940>>>>>>>        Forward Send Field_Defaults
32942>>>>>>>    End_Procedure    // Field_Defaults
32943>>>>>>>
32943>>>>>>>End_Class    // Csag311_DataDictionary
32944>>>>>>>
32944>>>>>
32944>>>>>Class cWebSessionManager2WA is a cWebSessionManager
32945>>>>>    
32945>>>>>    Procedure Construct_Object
32947>>>>>        Handle hoUserDD hoSessionDD
32947>>>>>        
32947>>>>>        Forward Send Construct_Object
32949>>>>>        
32949>>>>>        Property Handle phoUserDD 0      // Handle to the WebAppUser DDO
32950>>>>>        Property Handle phoSessionDD 0   // Handle to the WebAppSession DDO        
32951>>>>>        
32951>>>>>        Get Create (RefClass(Csag300_DataDictionary)) to hoUserDD
32952>>>>>        Get Create (RefClass(Csag311_DataDictionary)) to hoSessionDD
32953>>>>>        //Set DDO_Server of hoSessionDD to hoUserDD
32953>>>>>        
32953>>>>>        Set phoUserDD to hoUserDD
32954>>>>>        Set phoSessionDD to hoSessionDD
32955>>>>>        Property Boolean pbCreatingNewSession False
32956>>>>>        Property Integer piSessionTimeout 480        
32957>>>>>        Property String  psLoginName
32958>>>>>        Property String  psUserName ""
32959>>>>>        Property Integer piUserRights 0
32960>>>>>    End_Procedure //Construct_Object
32961>>>>>    
32961>>>>>    Function CreateSession String sRemoteAddress String sFingerPrint Returns String
32963>>>>>        String sSessionKey
32963>>>>>        Integer iErr
32963>>>>>        Boolean bLogWebSession
32963>>>>>        Handle hoSessionDD       
32963>>>>>        Get phoSessionDD to hoSessionDD
32964>>>>>        
32964>>>>>        //  Get session key
32964>>>>>        Forward Get CreateSession sRemoteAddress to sSessionKey
32966>>>>>        
32966>>>>>        Get pbLogWebSession to bLogWebSession
32967>>>>>        If (not(bLogWebSession)) Begin
32969>>>>>            Function_Return sSessionKey        
32970>>>>>        End
32970>>>>>>
32970>>>>>
32970>>>>>        Date dlToday dDtLastRun
32970>>>>>        String slHH slMM sHrLastRun slTime
32970>>>>>        Integer idTime
32970>>>>>        Sysdate dlToday slHH slMM
32973>>>>>    
32973>>>>>        If (Integer(slMM)<10) Move (Insert('0', slMM, 1)) to slMM
32976>>>>>        If (Integer(slHH)<10) Move (Insert('0', slHH, 1)) to slHH
32979>>>>>    
32979>>>>>        Move (slHH + slMM) to slTime
32980>>>>>    
32980>>>>>        Move dlToday           to dDtLastRun
32981>>>>>        Move (slHH +':'+ slMM) to sHrLastRun
32982>>>>>    
32982>>>>>        //- WE NEED AN INTEGER TO REPRESENT THE TIME OF DAY TO ELIMINATE CROSS MIDNIGHT PROBLEMS.
32982>>>>>        //  WE CREATED A SINGLE INTEGER FROM THE DATE, HOUR AND MINUTES THAT DOES NOT HAVE TO GO
32982>>>>>        //  BACK TO 0 AT THE BEGINNING OF THE DAY OR HOUR.
32982>>>>>        Move (Integer(dlToday)*1440 + (Integer(slHH)*60) + Integer(slMM)) to idTime
32983>>>>>
32983>>>>>        //  Store session
32983>>>>>        Send Clear of hoSessionDD
32984>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOSESSAO  to sSessionKey
32985>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOIP      to sRemoteAddress
32986>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOECODIGO to CSAG300.USUARIOECODIGO
32987>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOEMAIL   to CSAG300.USUARIOEMAIL
32988>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOEMPRESA to CSAG300.USUARIOEMPRESA
32989>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIONOME    to CSAG300.USUARIONOME
32990>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOSENHA   to CSAG300.USUARIOSENHA
32991>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.ACTIVE         to "Y"
32992>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.FINGERPRINT    to sFingerPrint
32993>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTRUN        to idTime
32994>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTACCESSDATE to dDtLastRun
32995>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTACCESSTIME to sHrLastRun
32996>>>>>        
32996>>>>>        Get Request_Validate of hoSessionDD to iErr
32997>>>>>        If (iErr) Begin
32999>>>>>            // this should not happen. If it does its a programming error
32999>>>>>            Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
33000>>>>>>
33000>>>>>            Function_Return ""
33001>>>>>        End
33001>>>>>>
33001>>>>>        Send Request_Save of hoSessionDD
33002>>>>>       
33002>>>>>        Function_Return sSessionKey        
33003>>>>>    End_Function //CreateSession
33004>>>>>    
33004>>>>>    
33004>>>>>    Function ValidateSession String sSessionKey Returns Boolean
33006>>>>>        DateTime dtLastAccess dtCurrent
33006>>>>>        TimeSpan tsDiff
33006>>>>>        Integer iErr iSessionTimeout iSpanMinutes
33006>>>>>        Boolean bResult bCreatingNewSession
33006>>>>>        Boolean bLogWebSession 
33006>>>>>        Integer eLoginMode
33006>>>>>        String sTime
33006>>>>>        Handle hoSessionDD hoUserDD       
33006>>>>>        
33006>>>>>        Get phoSessionDD to hoSessionDD
33007>>>>>        Get phoUserDD to hoUserDD
33008>>>>>        
33008>>>>>        Get pbLogWebSession to bLogWebSession
33009>>>>>        Get peLoginMode to eLoginMode
33010>>>>>        
33010>>>>>        // for this object, you can only disable logging if login completely is disabled
33010>>>>>        If (not(bLogWebSession) and (eLoginMode<>lmLoginNone)) Begin
33012>>>>>            Error DFERR_PROGRAM C_$WebSessionLoggingMustBeEnabled
33013>>>>>>
33013>>>>>            Function_Return False
33014>>>>>        End
33014>>>>>>
33014>>>>>
33014>>>>>        //  Clear session properties
33014>>>>>        Set psUsername to ""
33015>>>>>        Set psLoginName to ""
33016>>>>>        Set piUserrights to 0
33017>>>>>        
33017>>>>>        If not bLogWebSession Begin
33019>>>>>            Forward Get ValidateSession sSessionKey to bResult
33021>>>>>            Function_Return bResult
33022>>>>>        End        
33022>>>>>>
33022>>>>>        
33022>>>>>        Move False to bResult
33023>>>>>        Get piSessionTimeout to iSessionTimeout 
33024>>>>>        
33024>>>>>        //  Check if session exists
33024>>>>>        Send Clear of hoSessionDD
33025>>>>>        Move sSessionKey to CSAG311.USUARIOSESSAO
33026>>>>>        Send Find of hoSessionDD EQ 1
33027>>>>>        If (Found) Begin
33029>>>>>            //  Calculate timespan between now and last access time
33029>>>>>            Move (CurrentDateTime()) to dtCurrent
33030>>>>>            Move CSAG311.LASTACCESSDATE to dtLastAccess
33031>>>>>            Get StringToTime of hoSessionDD dtLastAccess CSAG311.LASTACCESSTIME to dtLastAccess
33032>>>>>            Move (dtCurrent - dtLastAccess) to tsDiff
33033>>>>>            Move (SpanTotalMinutes(tsDiff)) to iSpanMinutes
33034>>>>>            
33034>>>>>            //  Check if session didn't time out
33034>>>>>            If ((iSessionTimeout <= 0 or (iSpanMinutes < iSessionTimeout)) and CSAG311.ACTIVE = "Y") Begin
33036>>>>>                Forward Get ValidateSession sSessionKey to bResult
33038>>>>>                   
33038>>>>>                If (bResult) Begin
33040>>>>>                    //  Update session record
33040>>>>>                    Get TimeToString of hoSessionDD dtCurrent to sTime 
33041>>>>>                    Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTACCESSDATE to dtCurrent
33042>>>>>                    Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTACCESSTIME to sTime
33043>>>>>                    Set Field_Changed_Value of hoSessionDD Field CSAG311.USECOUNT to (CSAG311.USECOUNT + 1)
33044>>>>>                    Get Request_Validate of hoSessionDD to iErr
33045>>>>>                    If (iErr) Begin
33047>>>>>                        // this should not happen. If it does its a programming error
33047>>>>>                        Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
33048>>>>>>
33048>>>>>                        Function_Return False
33049>>>>>                    End
33049>>>>>>
33049>>>>>                    Send Request_Save of hoSessionDD
33050>>>>>                    
33050>>>>>                    //  Update user properties
33050>>>>>                    If (HasRecord(hoUserDD)) Begin
33052>>>>>                        Set psUsername to (Rtrim(CSAG300.USUARIONOME))
33053>>>>>                        Set psLoginName to (Rtrim(CSAG300.USUARIOEMAIL))
33054>>>>>                        Set piUserRights to (Rtrim(CSAG300.USUARIOCLASSE))
33055>>>>>                    End
33055>>>>>>
33055>>>>>                End
33055>>>>>>
33055>>>>>            End
33055>>>>>>
33055>>>>>            Else Begin
33056>>>>>                // Test the Creating New Session Flag to protect against infinite recursion....
33056>>>>>                Get pbCreatingNewSession to bCreatingNewSession
33057>>>>>                
33057>>>>>                If (not(bCreatingNewSession)) Begin
33059>>>>>                    Set pbCreatingNewSession to True                    
33060>>>>>                    Send RecreateSession to ghoWebApp
33061>>>>>                    Error 950 "Your application session has timed out or is inactive, please login again."
33062>>>>>>
33062>>>>>                    Send NavigateRefresh of ghoWebApp          // refresh the WebApp at the client (triggers a login)
33063>>>>>                    Set pbCreatingNewSession to False
33064>>>>>                End
33064>>>>>>
33064>>>>>            End
33064>>>>>>
33064>>>>>        End
33064>>>>>>
33064>>>>>        Else Begin
33065>>>>>            Error 951 "Session key not known (reload page to recreate session)"
33066>>>>>>
33066>>>>>        End
33066>>>>>>
33066>>>>>        
33066>>>>>        Function_Return bResult
33067>>>>>    End_Function //ValidateSession
33068>>>>>    
33068>>>>>    Function UserLogin String sLoginName String sPassword Returns Boolean
33070>>>>>        String sSessionKey sUserPassword
33070>>>>>        Handle hoSessionDD hoUserDD       
33070>>>>>        DateTime dtCurrentDateTime
33070>>>>>        String sCurrentTime
33070>>>>>        
33070>>>>>        Get phoSessionDD to hoSessionDD
33071>>>>>        Get phoUserDD to hoUserDD
33072>>>>>        Integer iErr eLoginMode
33072>>>>>        
33072>>>>>        // Refind session record
33072>>>>>        Get psSessionKey to sSessionKey
33073>>>>>        Send Clear of hoSessionDD
33074>>>>>        Move sSessionKey to CSAG311.USUARIOSESSAO
33075>>>>>        Send Find of hoSessionDD EQ 1
33076>>>>>        
33076>>>>>        If (Found and CSAG311.USUARIOSESSAO = sSessionKey) Begin
33078>>>>>            Get peLoginMode to eLoginMode
33079>>>>>            
33079>>>>>            // if login is not required, we will allow for a blank name and password, which gives you access to whatever
33079>>>>>            // your have access to with not being logged in. We consider this to be a success, even if you are not logged in.
33079>>>>>            If (eLoginMode <> lmLoginRequired and Trim(sLoginName) = "" and Trim(sPassword) = "") Begin
33081>>>>>                Set psUsername to ""
33082>>>>>                Set psLoginName to ""
33083>>>>>                Set piUserrights to 0
33084>>>>>                Send NotifyChangeRights
33085>>>>>                Function_Return True
33086>>>>>            End
33086>>>>>>
33086>>>>>            
33086>>>>>            //  Find the user
33086>>>>>            Move sLoginName to CSAG300.USUARIOEMAIL
33087>>>>>            Send Find of hoUserDD EQ 7
33088>>>>>            
33088>>>>>            // Check username and password
33088>>>>>            Get Field_Current_Value of hoUserDD Field CSAG300.USUARIOSENHA to sUserPassword
33089>>>>>            
33089>>>>>            If (Found and (Lowercase(sLoginName) = Lowercase(Trim(CSAG300.USUARIOEMAIL))) and Trim(sUserPassword) = Trim(sPassword)) Begin
33091>>>>>                // Store the login
33091>>>>>                Move (CurrentDateTime()) to dtCurrentDateTime
33092>>>>>                Get TimeToString of hoSessionDD dtCurrentDateTime to sCurrentTime
33093>>>>>                Set Field_Changed_Value of hoUserDD Field CSAG300.DTAULTLOGIN to dtCurrentDateTime
33094>>>>>                Set Field_Changed_Value of hoUserDD Field CSAG300.HORULTLOGIN to sCurrentTime
33095>>>>>                Get Request_Validate of hoSessionDD to iErr
33096>>>>>                If (iErr) Begin
33098>>>>>                    // this should not happen. If it does its a programming error
33098>>>>>                    Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
33099>>>>>>
33099>>>>>                    Function_Return False
33100>>>>>                End
33100>>>>>>
33100>>>>>                
33100>>>>>                Set Field_Changed_Value of hoSessionDD Field CSAG311.DATA    to dtCurrentDateTime
33101>>>>>                Set Field_Changed_Value of hoSessionDD Field CSAG311.HORARIO to sCurrentTime
33102>>>>>                Send Request_Save of hoSessionDD
33103>>>>>                
33103>>>>>                // Update session properties
33103>>>>>                Set psUsername to (Rtrim(CSAG300.USUARIONOME))
33104>>>>>                Set psLoginName to (Rtrim(CSAG300.USUARIOEMAIL))
33105>>>>>                Set piUserrights to (Rtrim(CSAG300.USUARIOCLASSE))
33106>>>>>                Send NotifyChangeRights
33107>>>>>                Function_Return True
33108>>>>>            End
33108>>>>>>
33108>>>>>        End
33108>>>>>>
33108>>>>>          
33108>>>>>        Function_Return False
33109>>>>>    End_Function //UserLogin
33110>>>>>    
33110>>>>>    Function IsLoggedIn Returns Boolean
33112>>>>>        String sLoginName
33112>>>>>        Boolean bLogWebSession bLoggedIn
33112>>>>>        
33112>>>>>        Get pbLogWebSession to bLogWebSession
33113>>>>>        If not bLogWebSession Begin
33115>>>>>            Forward Get IsLoggedIn to bLoggedIn
33117>>>>>            Function_Return bLoggedIn
33118>>>>>        End
33118>>>>>>
33118>>>>>        
33118>>>>>        Get psLoginName to sLoginName
33119>>>>>        
33119>>>>>        Function_Return (sLoginName <> "")
33120>>>>>    End_Function //IsLoggedIn
33121>>>>>    
33121>>>>>    
33121>>>>>    Procedure EndSession
33123>>>>>        Integer iErr
33123>>>>>        Boolean bLogWebSession
33123>>>>>        Handle hoSessionDD       
33123>>>>>        
33123>>>>>        Get phoSessionDD to hoSessionDD
33124>>>>>        Get pbLogWebSession to bLogWebSession
33125>>>>>        If not bLogWebSession Begin
33127>>>>>            Forward Send EndSession
33129>>>>>            Procedure_Return
33130>>>>>        End
33130>>>>>>
33130>>>>>            
33130>>>>>        //  Check if session exists
33130>>>>>        Send Clear of hoSessionDD
33131>>>>>        Get psSessionKey to CSAG311.USUARIOSESSAO
33132>>>>>        Send Find of hoSessionDD EQ 1
33133>>>>>        If (Found) Begin
33135>>>>>            Set Field_Changed_Value of hoSessionDD Field CSAG311.ACTIVE to "N"
33136>>>>>            Get Request_Validate of hoSessionDD to iErr
33137>>>>>            If (iErr) Begin
33139>>>>>                // this should not happen. If it does its a programming error
33139>>>>>                Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
33140>>>>>>
33140>>>>>                Procedure_Return
33141>>>>>            End
33141>>>>>>
33141>>>>>            Send Request_Save of hoSessionDD
33142>>>>>        End
33142>>>>>>
33142>>>>>    End_Procedure //EndSession
33143>>>>>
33143>>>>>End_Class //cWebSessionManager2WA
33144>>>>>
33144>>>Use cOneTimePassword.pkg
Including file: cOneTimePassword.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\cOneTimePassword.pkg)
33144>>>>>// File name  : cOneTimePassword.pkg                                          //
33144>>>>>// File title : One Time Password (OTP) generator                             //
33144>>>>>// Author(s)  : Ulbe Stellema, Eddy Kleinjan                                  //
33144>>>>>//                                                                            //
33144>>>>>// Confidential Trade Secret.                                                 //
33144>>>>>// Copyright 1999 Data Access Corporation, Miami FL, USA                      //
33144>>>>>// All Rights reserved                                                        //
33144>>>>>// DataFlex is a registered trademark of Data Access Corporation.             //
33144>>>>>//                                                                            //
33144>>>>>// This package implements 
33144>>>>>// - HOTP: an HMAC-Based One-Time Password Algorithm
33144>>>>>// - TOTP: Time-Based One-Time Password Algorithm
33144>>>>>// password RFC 6238 and RFC 4226
33144>>>>>// https://tools.ietf.org/html/rfc4226
33144>>>>>// https://tools.ietf.org/html/rfc6238
33144>>>>>//
33144>>>>>// Example:
33144>>>>>//    Object oOneTimePassword is a cOneTimePassword
33144>>>>>//    End_Object
33144>>>>>//    
33144>>>>>//    Function GetTOTP Returns String
33144>>>>>//        Integer iOtp
33144>>>>>//        Get TOTP of oOneTimePassword "12345678901234567890" to iOtp
33144>>>>>//    End_Procedure
33144>>>>>//    
33144>>>>>//    
33144>>>>>//
33144>>>>>// $Rev History                                                               //
33144>>>>>//                                                                            //
33144>>>>>// US 2015-11-27 Initial version                                              //
33144>>>>>// EK 2015-11-27 Integrated                                                   //
33144>>>>>//****************************************************************************//
33144>>>>>
33144>>>>>Use UI
33144>>>>>
33144>>>>>Define otpDecodeNone     for 0
33144>>>>>Define otpDecodeBase16   for 1
33144>>>>>Define otpDecodeBase32   for 2
33144>>>>>Define otpDecodeBase64   for 3
33144>>>>>
33144>>>>>Define otpHmacSha1       for 160
33144>>>>>Define otpHmacSha256     for 256
33144>>>>>Define otpHmacSha512     for 512
33144>>>>>
33144>>>>>//OATH_API LPCSTR Base16Encode(LPCSTR sString)
33144>>>>>External_Function otpBase16Encode "Base16Encode" oath.dll ;    Pointer sString ;    Integer iLength ;    Returns Address
33145>>>>>
33145>>>>>//OATH_API LPCSTR Base32Encode(LPCSTR sString)
33145>>>>>External_Function otpBase32Encode "Base32Encode" oath.dll ;    Pointer sString ;    Integer iLength ;    Returns Address
33146>>>>>
33146>>>>>// OATH_API int HOTP(LPCSTR sSecret, int decodetype, int bitcount, int counter)
33146>>>>>External_Function HOTP "HOTP" oath.dll ;    Pointer sSecret ;    Integer iDecodeType ;    Integer iDigitCount ;    Pointer iCounter ;    Returns Integer
33147>>>>>//-2WA
33147>>>>>// OATH_API int TOTP(LPCSTR sSecret, int decodetype, int bitcount, int hmactype, int epoch, int Time, int step)
33147>>>>>External_Function TOTP "TOTP" oath.dll ;    Pointer sSecret ;    Integer iDecodeType ;    Integer iDigitCount ;    Integer iHMACType ;    Pointer iEpoch ;    Pointer iTime ;    Pointer iStep ;    Returns Integer
33148>>>>>
33148>>>>>Class cOneTimePassword is a cObject
33149>>>>>    
33149>>>>>    Procedure Construct_Object
33151>>>>>        Forward Send Construct_Object
33153>>>>>        Property Integer piSecretCodeType otpDecodeNone // Default None; options otpDecodeBase16, otpDecodeBase32 or otpDecodeBase64
33154>>>>>        Property Integer piDigitCount 6                 // Default = 6 bit; options 6, 7 or 8
33155>>>>>        Property BigInt  piCounter  0                   // Default = 0
33156>>>>>        Property Integer piHmacType otpHmacSha1         // Default = otpHmacSha1; options otpHmacSha1, otpHmacSha256, otpHmacSha512
33157>>>>>        Property BigInt  piEpoch    0                   // Default = 0; options 0 or 1
33158>>>>>        Property BigInt  piTime     0                   // Default = 0 (now); otherwise number of seconds since unix time
33159>>>>>        // next 2 settings will define a 10-minute window
33159>>>>>        Property BigInt  piStep     60                  // Default = 30 sec; step size for factor
33160>>>>>        Property Integer piStepGraceCount 10             // Default = 2; Defines the maximum number of piSteps a code might fall outside the current time when validating
33161>>>>>    End_Procedure // Construct_Object                  
33162>>>>>    
33162>>>>>
33162>>>>>
33162>>>>>    // Function : HOTP
33162>>>>>    // Purpose  : HMAC-based One-time Password Algorithm
33162>>>>>    Function HOTP String sSecret Returns String
33164>>>>>        Integer iResult iDigitCount iType 
33164>>>>>        BigInt iCounter
33164>>>>>        Get piSecretCodeType to iType
33165>>>>>        Get piDigitCount to iDigitCount
33166>>>>>        Get piCounter to iCounter
33167>>>>>        Move (HOTP(AddressOf(sSecret),iType,iDigitCount,AddressOf(iCounter))) to iResult
33168>>>>>        Function_Return (Right("00000000" + String(iResult), iDigitCount))
33169>>>>>    End_Function // HOTP
33170>>>>>    
33170>>>>>
33170>>>>>
33170>>>>>    // Function : TOTP
33170>>>>>    // Purpose  : Time-based One-time Password Algorithm
33170>>>>>    Function TOTP String sSecret Returns String
33172>>>>>        Integer iType iResult iDigitCount iHMACType 
33172>>>>>        BigInt iEpoch iTime iStep
33172>>>>>        If (sSecret = "") Begin
33174>>>>>            Error 999 "TOTP: There is no secret!"
33175>>>>>>
33175>>>>>            Function_Return ""
33176>>>>>        End
33176>>>>>>
33176>>>>>        Get piSecretCodeType to iType
33177>>>>>        Get piDigitCount to iDigitCount
33178>>>>>        Get piHMACType to iHMACType
33179>>>>>        Get piEpoch to iEpoch
33180>>>>>        Get piTime to iTime
33181>>>>>        Get piStep to iStep
33182>>>>>        Move (TOTP(AddressOf(sSecret),iType,iDigitCount,iHMACType,AddressOf(iEpoch),AddressOf(iTime),AddressOf(iStep))) to iResult
33183>>>>>        Function_Return (Right("00000000" + String(iResult), iDigitCount))
33184>>>>>    End_Function // TOTP
33185>>>>>
33185>>>>>
33185>>>>>    // Function : Base16Encode
33185>>>>>    // Purpose  : Returns base16 encoded string
33185>>>>>    Function Base16Encode String sInput Returns String
33187>>>>>        String sResult
33187>>>>>        Address pResult
33187>>>>>        Boolean bOk
33187>>>>>        Move (otpBase16Encode(AddressOf(sInput),Length(sInput))) to pResult
33188>>>>>        Move pResult to sResult
33189>>>>>        Move (Free(pResult)) to bOk
33190>>>>>        Function_Return sResult
33191>>>>>    End_Function // Base16Encode
33192>>>>>
33192>>>>>    // Function : Base32Encode
33192>>>>>    // Purpose  : Returns base32 encoded string
33192>>>>>    Function Base32Encode String sInput Returns String
33194>>>>>        String sResult
33194>>>>>        Address pResult
33194>>>>>        Boolean bOk
33194>>>>>        Move (otpBase32Encode(AddressOf(sInput),Length(sInput))) to pResult
33195>>>>>        Move pResult to sResult
33196>>>>>        Move (Free(pResult)) to bOk
33197>>>>>        Function_Return sResult
33198>>>>>    End_Function // Base32Encode
33199>>>>>
33199>>>>>    // Function : IsValidOneTimePassword
33199>>>>>    // Purpose  : Validates the passed code based on the current time or time window
33199>>>>>    Function IsValidTimeBasedOneTimePassword String sSecret String sCode Returns Boolean
33201>>>>>        Boolean bIsValid
33201>>>>>        Integer iStep iCount iOldEpoch
33201>>>>>        String sCurrentCode
33201>>>>>        
33201>>>>>        Get piEpoch to iOldEpoch
33202>>>>>        Set piEpoch to 0 // Make sure it's 0 when starting
33203>>>>>        Get piStep to iStep
33204>>>>>        
33204>>>>>        // Get the current code
33204>>>>>        Get TOTP sSecret to sCurrentCode
33205>>>>>        If (sCode = sCurrentCode) Move True to bIsValid
33208>>>>>
33208>>>>>        // If not valid, try validating next and previous steps
33208>>>>>        While (not(bIsValid) and iCount < piStepGraceCount(Self))
33212>>>>>
33212>>>>>            // Try previous time window
33212>>>>>            Set piEpoch to (iStep * (iCount + 1))
33213>>>>>            Get TOTP sSecret to sCurrentCode
33214>>>>>            If (sCode = sCurrentCode) Begin
33216>>>>>                Move True to bIsValid
33217>>>>>            End
33217>>>>>>
33217>>>>>            Else Begin
33218>>>>>                // Try next time window
33218>>>>>                Set piEpoch to (iStep * (iCount + 1) * -1)
33219>>>>>                Get TOTP sSecret to sCurrentCode
33220>>>>>                If (sCode = sCurrentCode) Move True to bIsValid
33223>>>>>            End
33223>>>>>>
33223>>>>>
33223>>>>>            Increment iCount
33224>>>>>
33224>>>>>        Loop
33225>>>>>>
33225>>>>>        
33225>>>>>        // Reset piEpoch
33225>>>>>        Set piEpoch to iOldEpoch
33226>>>>>        
33226>>>>>        Function_Return bIsValid
33227>>>>>        
33227>>>>>    End_Function
33228>>>>>    
33228>>>>>    
33228>>>>>    // Function : RandomBase32Secret
33228>>>>>    // Purpose  : HMAC-based One-time Password Algorithm
33228>>>>>    Function otpRandomBase32Secret Integer iSecretCodeType Integer iHmacType Returns String
33230>>>>>        Integer i iLen iAlphabetLength
33230>>>>>        String sSecret sFiller sAlphabet
33230>>>>>        If (iSecretCodeType <> otpDecodeBase32) Begin
33232>>>>>            Error 999 "Only BASE32 is implemented at this time."
33233>>>>>>
33233>>>>>            Function_Return ""
33234>>>>>        End
33234>>>>>>
33234>>>>>        Move "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567" to sAlphabet
33235>>>>>        Move (Length(sAlphabet)) to iAlphabetLength
33236>>>>>        Case Begin
33236>>>>>            Case (iHmacType = otpHmacSha1) 
33238>>>>>                Move 32 to iLen
33239>>>>>                Move "" to sFiller
33240>>>>>                Case Break
33241>>>>>            Case (iHmacType = otpHmacSha256) 
33244>>>>>                Move 52 to iLen
33245>>>>>                Move "====" to sFiller
33246>>>>>                Case Break
33247>>>>>            Case (iHmacType = otpHmacSha512) 
33250>>>>>                Move 104 to iLen
33251>>>>>                Move "=" to sFiller
33252>>>>>                Case Break
33253>>>>>        Case End
33253>>>>>        For i from 1 to iLen
33259>>>>>>
33259>>>>>            Move (sSecret + Mid(sAlphabet, 1, Random(iAlphabetLength) + 1)) to sSecret
33260>>>>>        Loop
33261>>>>>>
33261>>>>>        Move (sSecret + sFiller) to sSecret
33262>>>>>        Function_Return sSecret
33263>>>>>    End_Function
33264>>>>>    
33264>>>>>    
33264>>>>>End_Class // cOATH
33265>>>>>
33265>>>
33265>>>Object oSessionManager is a cWebSessionManager
33267>>>    Object oOneTimePassword is a cOneTimePassword
33269>>>        Set piSecretCodeType to otpDecodeBase32
33270>>>    End_Object
33271>>>    
33271>>>End_Object //oSessionManager
33272>>>
33272>    Use WebServiceDispatcher.wo
33272>    Use WebResourceManager.wo
Including file: WebResourceManager.wo    (C:\DataFlex Projects\CROSS\WVDF_WS\AppSrc\WebResourceManager.wo)
33272>>>//-2WA
33272>>>Use cWebResourceManager.pkg
33272>>>
33272>>>Register_Object oWS_LOG3040
33272>>>
33272>>>Object oWebResourceManager is a cWebResourceManager
33274>>>    Function UpdloadDestinoProposta String aUsuarioSessao String aFingerprint String aPasta String aPropostaId Returns String
33277>>>        Declare_Datafile TSMG800
33277>>>        Declare_Datafile HCGS3004
Including file: HCGS3004.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HCGS3004.fd)
33277>>>        
33277>>>         String loadPath
33277>>>        Boolean bExist
33277>>>        
33277>>>        stDefaultMessage myMsg
33277>>>        stDefaultMessage myMsg
33277>>>
33277>>>        Get ValidarSessaoUsuario of ghoApplication aUsuarioSessao aFingerPrint to myMsg
33278>>>        If (myMsg.hasError) Function_Return ""
33281>>>        
33281>>>//        Clear HCGS3004
33281>>>//        Move aPropostaId to HCGS3004.PROPOSTA
33281>>>//        Find EQ HCGS3004 by 1
33281>>>//        If (not(Found)) Function_Return ""
33281>>>
33281>>>        Move (Rtrim(TSMG800.COPY_FOTOS))    to loadPath
33282>>>        
33282>>>        If (Right(loadPath, 1) <> "\") Move (loadPath + "\") to loadPath
33285>>>        
33285>>>        If (aPasta = '') Move (loadPath + "propostas")       to loadPath
33288>>>        Else Move (loadPath + aPasta) to loadPath
33290>>>        
33290>>>        
33290>>>        File_Exist loadPath bExist
33291>>>        If (not(bExist)) Begin
33293>>>            Make_Directory loadPath
33294>>>            File_Exist loadPath bExist
33295>>>            If (not(bExist)) Function_Return "[invalid folder]"
33298>>>        End
33298>>>>
33298>>>
33298>>>        Move (loadPath + "\" + aPropostaId) to loadPath
33299>>>        
33299>>>        File_Exist loadPath bExist
33300>>>        If (not(bExist)) Begin
33302>>>            Make_Directory loadPath
33303>>>            File_Exist loadPath bExist
33304>>>            If (not(bExist)) Function_Return "[invalid folder]"
33307>>>        End
33307>>>>
33307>>>        
33307>>>        Move (loadPath+"\") to loadPath
33308>>>        
33308>>>        Function_Return loadPath
33309>>>    End_Function //UpdloadDestinoProposta
33310>>>    Send RegisterInterface (RefFunc(UpdloadDestinoProposta)) "Get_UpdloadDestinoProposta" "String aUsuarioSessao String aFingerprint String aPropostaId String aPasta Returns String" ""
33311>>>
33311>>>    Function UpdloadDestino String aUsuarioSessao Returns String
33314>>>        Declare_Datafile TSMG800
33314>>>
33314>>>        Clear CSAG311
33315>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33316>>>        Find Eq CSAG311 by 1
33317>>>>
33317>>>        If (not(Found)) Function_Return ""
33320>>>        
33320>>>        Function_Return (Rtrim(TSMG800.COPY_FOTOS))
33321>>>    End_Function //UpdloadDestino
33322>>>    Send RegisterInterface (RefFunc(UpdloadDestino)) "Get_UpdloadDestino" "String aUsuarioSessao Returns String" ""
33323>>>
33323>>>    Function UploadFileFinished String aPath;                               Variant aFileName;                                String aUsuarioSessao;                                String aSize;                                Returns String
33326>>>                                
33326>>>        Declare_Datafile TSMG800
33326>>>        
33326>>>        String urlDownload
33326>>>        String sDados
33326>>>
33326>>>         Handle hoNJSON hoJSONObj
33326>>>        Get NewJSONObject of oParser to hoNJSON
33327>>>        Get NewJSONObject of oParser to hoJSONObj
33328>>>        If (hoNJSON = 0) Function_Return sDados
33331>>>        If (hoJSONObj = 0) Function_Return sDados
33334>>>
33334>>>        Set phoParser     of hoJSONObj  to oParser
33335>>>        Set phoParser     of hoNJSON    to oParser
33336>>>        
33336>>>        Clear CSAG311
33337>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33338>>>        Find Eq CSAG311 by 1
33339>>>>
33339>>>        If (not(Found)) Begin
33341>>>            Send AddBoolean of hoJSONObj "hasError" True
33342>>>            Send AddString  of hoJSONObj "msgError" "INVALID SESSION"
33343>>>            Send AddString  of hoJSONObj "msgInfo" ""
33344>>>            //-
33344>>>            Send AddObject  of hoNJSON "msg"    hoJSONObj
33345>>>
33345>>>            Get Serialize   of hoNJSON to sDados
33346>>>        End
33346>>>>
33346>>>        
33346>>>        Move (Rtrim(TSMG800.HTTP_FOTOS)) to urlDownload
33347>>>        Move (Replaces('{aHTTP}', urlDownload, Rtrim(TSMG800.HTTP_SITE))) to urlDownload
33348>>>        
33348>>>        Send AddBoolean of hoJSONObj "hasError" False
33349>>>        Send AddString  of hoJSONObj "msgError" ""
33350>>>        Send AddString  of hoJSONObj "msgInfo" "!Completed!"
33351>>>        
33351>>>        Send AddObject  of hoNJSON "msg"    hoJSONObj
33352>>>        
33352>>>        Send AddInteger of hoNJSON "id"     1
33353>>>        Send AddString  of hoNJSON "value"  aFileName
33354>>>        Send AddString  of hoNJSON "url"    (urlDownload + aFileName)
33355>>>        Send AddString  of hoNJSON "size"   aSize
33356>>>        
33356>>>        Get Serialize     of hoNJSON to sDados
33357>>>        
33357>>>        Function_Return sDados
33358>>>        
33358>>>    End_Function //UploadFileFinished
33359>>>    Send RegisterInterface (RefFunc(UploadFileFinished)) "Get_UploadFileFinished" "String sPath Variant sFileName String aUsuarioSessao String aSize Returns String" ""
33360>>>    
33360>>>
33360>>>    Function UploadFileFinishedProposta String aPath;                                       Variant aFileName;                                        String aUsuarioSessao;                                        String aFingerPrint;                                        String aSize;                                        String aPropostaId;                                        String aTipoDocumento;                                        String aTabela;                                        Returns String
33363>>>        Declare_Datafile TSMG800
33363>>>        Declare_Datafile HCGS3004
33363>>>        Declare_Datafile CSAG336
33363>>>        
33363>>>        String aurlDownload
33363>>>        String sDados
33363>>>        String statusId
33363>>>        
33363>>>        String[] aLogFile
33364>>>        
33364>>>        stIdValueURL myFileList
33364>>>        stIdValueURL myFileList
33364>>>        stDefaultMessage myMsg
33364>>>        stDefaultMessage myMsg
33364>>>
33364>>>         Handle hoNJSON hoJSONObj
33364>>>        Get NewJSONObject of oParser to hoNJSON
33365>>>        Get NewJSONObject of oParser to hoJSONObj
33366>>>        If (hoNJSON = 0) Function_Return sDados
33369>>>        If (hoJSONObj = 0) Function_Return sDados
33372>>>
33372>>>        Set phoParser     of hoJSONObj  to oParser
33373>>>        Set phoParser     of hoNJSON    to oParser
33374>>>        
33374>>>        Get ValidarSessaoUsuario of ghoApplication aUsuarioSessao aFingerPrint to myMsg
33375>>>        If (myMsg.hasError) Begin
33377>>>            Send AddBoolean of hoJSONObj "hasError" myMsg.hasError
33378>>>            Send AddString  of hoJSONObj "msgError" myMsg.msgError
33379>>>            Send AddString  of hoJSONObj "msgInfo" ""
33380>>>            //-
33380>>>            Send AddObject  of hoNJSON "msg"    hoJSONObj
33381>>>
33381>>>            Get Serialize   of hoNJSON to sDados
33382>>>            
33382>>>            Function_Return sDados
33383>>>        End
33383>>>>
33383>>>
33383>>>//        Clear HCGS3004
33383>>>//        Move aPropostaId to HCGS3004.PROPOSTA
33383>>>//        Find EQ HCGS3004 by 1
33383>>>//        If (not(Found)) Begin
33383>>>//            Send AddBoolean of hoJSONObj "hasError" True
33383>>>//            Send AddString  of hoJSONObj "msgError" "PROPOSTA INVALIDA"
33383>>>//            Send AddString  of hoJSONObj "msgInfo" ""
33383>>>//            //-
33383>>>//            Send AddObject  of hoNJSON "msg"    hoJSONObj
33383>>>//
33383>>>//            Get Serialize   of hoNJSON to sDados
33383>>>//            
33383>>>//            Function_Return sDados
33383>>>//        End
33383>>>
33383>>>        Move (Rtrim(TSMG800.HTTP_FOTOS))    to aurlDownload
33384>>>
33384>>>        If (Right(aurlDownload, 1) <> "/") Move (aurlDownload + "/") to aurlDownload
33387>>>
33387>>>        Move (aurlDownload + "propostas/" + aPropostaId)  to aurlDownload
33388>>>        
33388>>>        Move (Replaces('{aHTTP}', aurlDownload, Rtrim(TSMG800.HTTP_SITE))) to aurlDownload
33389>>>        Move (aurlDownload + "/" + aFileName) to aurlDownload
33390>>>        
33390>>>        Move (ResizeArray(aLogFile, 0)) to aLogFile
33391>>>        
33391>>>//        Move "HCGS3004"     to aLogFile[0] //tabela
33391>>>        Move aTabela        to aLogFile[0]
33392>>>        Move aPropostaId    to aLogFile[1] //idProposta
33393>>>        
33393>>>        //1-ATIVO
33393>>>        //2-INATIVO
33393>>>        Move "1" to statusId
33394>>>        
33394>>>//        Clear CSAG336
33394>>>//        Move "ATIVO" to CSAG336.DESCRICAO
33394>>>//        Find Eq CSAG336 by 2
33394>>>//        If (Found) Move CSAG336.CODIGO to statusId
33394>>>//        Else Move "1" to statusId
33394>>>        
33394>>>        Move statusId       to aLogFile[2] //aStatus (1)ATIVO (2)INATIVO
33395>>>        
33395>>>        Move aFileName      to aLogFile[3] //aFileName
33396>>>        Move aPath          to aLogFile[4] //aFolder
33397>>>        Move aurlDownload   to aLogFile[5] //aurlDownload
33398>>>        Move aSize          to aLogFile[6] //size
33399>>>        Move aTipoDocumento to aLogFile[7] //tipoDocumento
33400>>>        
33400>>>// ToDo:         Get fLOG3040Register of oWS_LOG3040 aLogFile aUsuarioSessao to myFileList 
33400>>>        
33400>>>        If (not(myFileList.msg.hasError)) Begin
33402>>>            Send AddBoolean of hoJSONObj "hasError" False
33403>>>            Send AddString  of hoJSONObj "msgError" ""
33404>>>            Send AddString  of hoJSONObj "msgInfo" "Upload Completed"
33405>>>            
33405>>>            Send AddObject  of hoNJSON "msg"    hoJSONObj
33406>>>            
33406>>>            Send AddInteger of hoNJSON "id"         myFileList.id
33407>>>            Send AddString  of hoNJSON "value"      myFileList.value
33408>>>            Send AddString  of hoNJSON "url"        myFileList.url
33409>>>            Send AddString  of hoNJSON "size"       myFileList.size
33410>>>            Send AddString  of hoNJSON "tipoDoc"    myFileList.tipoDoc
33411>>>        End
33411>>>>
33411>>>        
33411>>>        Get Serialize     of hoNJSON to sDados
33412>>>        
33412>>>        Function_Return sDados
33413>>>        
33413>>>    End_Function //UploadFileFinished
33414>>>    Send RegisterInterface (RefFunc(UploadFileFinishedProposta)) "Get_UploadFileFinishedProposta" "String sPath Variant sFileName String aUsuarioSessao String aFingerPrint String aSize String aPropostaId String aTipoDocumento String aTabela Returns String" ""
33415>>>
33415>>>    Procedure OnAttachProcess
33418>>>        Forward Send OnAttachProcess
33420>>>    End_Procedure
33421>>>End_Object
33422>
33422>    Use ws_HCGS3001.wo //- Classes da Taxa
Including file: ws_HCGS3001.wo    (C:\DataFlex Projects\CROSS\WVDF_WS\AppSrc\ws_HCGS3001.wo)
33422>>>//-2WA
33422>>>Use cWebService.pkg
33422>>>Open CCGS223
33424>>>Open CSAG311
33426>>>Open HCGS3001
Including file: HCGS3001.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HCGS3001.fd)
33428>>>
33428>>>Struct st_hcgs3001_classestx
33428>>>    String ID
33428>>>    String DS
33428>>>End_Struct //st_hcgs3001_classestx
33428>>>
33428>>>Object oWs_HCGS3001 is a cWebService
33430>>>    
33430>>>    // psDocumentation provides high level documentation of your web service. 
33430>>>    // Clients using this service will see and use this documentation. 
33430>>>    Set psDocumentation to "2WA - www.2wa.com.br"
33431>>>    Set psServiceTitle  to "CLASSES of TAX"
33432>>>    Set psServiceName   to "ws_hcgs3001"
33433>>>
33433>>>    //CLASSES DA TAXA POR JS
33433>>>    Function f_classesSelTaxa String aUsuarioSessao String sTaxaId Returns st_hcgs3001_classestx[]
#REM SEND REGISTERINTERFACE |CI7303 "get_f_classesSelTaxa" "String aUsuarioSessao String sTaxaId Returns st_hcgs3001_classestx[]" "f_classesSelTaxa"
33437>>>        
33437>>>        st_hcgs3001_classestx[] arr_classestx
33437>>>        st_hcgs3001_classestx[] arr_classestx
33438>>>        
33438>>>        String  sQuery
33438>>>        Integer iIndex
33438>>>        String  sClasseTaxa
33438>>>        RowID   rFileNumber
33438>>>        
33438>>>        Clear CSAG311
33439>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33440>>>        Find Eq CSAG311 by 1
33441>>>>
33441>>>        If (not(Found)) Begin
33443>>>            Function_Return arr_classestx
33444>>>        End
33444>>>>
33444>>>        
33444>>>        Move "" to sQuery
33445>>>        CREATE_MAIN_CONNECTION BYFILE HCGS3001
33450>>>>
33450>>>        
33450>>>        Move "SELECT a.CLASSE_TAXA FROM DBO.HCGS3001 a WHERE a.CODIGO = %1" to sQuery
33451>>>        Move (SFormat(sQuery, ToSQLNumber(sTaxaId))) to sQuery
33452>>>        SQL_FIND_BEGIN hStmt_HCGS3001 sQuery
33471>>>>
33471>>>                Move (Trim(SqlFindValue(hStmt_HCGS3001,1))) to sClasseTaxa
33472>>>        SQL_FIND_END hStmt_HCGS3001 
33479>>>>
33479>>>        
33479>>>        Move "" to sQuery
33480>>>        Move (ResizeArray(arr_classestx, 0)) to arr_classestx
33481>>>        
33481>>>        CREATE_MAIN_CONNECTION BYFILE CCGS221
33486>>>>
33486>>>        
33486>>>        Move "SELECT CODIGO, DESCRICAO FROM DBO.CCGS221 WHERE CODIGO in (%1) ORDER BY DESCRICAO" to sQuery
33487>>>        Move (Replaces(',', sClasseTaxa, "','")) to sClasseTaxa
33488>>>        Move ("'"+sClasseTaxa+"'") to sClasseTaxa
33489>>>        Move (SFormat(sQuery, sClasseTaxa)) to sQuery
33490>>>        SQL_FIND_BEGIN hStmt_CCGS221_01 sQuery
33509>>>>
33509>>>                
33509>>>                Move (SizeOfArray(arr_classestx)) to iIndex
33510>>>                Move (SqlFindValue(hStmt_CCGS221_01,1)) to arr_classestx[iIndex].ID
33511>>>                Move (ToOEM(Trim(SqlFindValue(hStmt_CCGS221_01,2)))) to arr_classestx[iIndex].DS
33512>>>                
33512>>>        SQL_FIND_END hStmt_CCGS221_01 
33519>>>>
33519>>>            
33519>>>        Function_Return arr_classestx
33520>>>
33520>>>    End_Function //f_classesSelTaxa 
33521>>>    
33521>>>    Function f_classes Returns stIdValueClasse[]
#REM SEND REGISTERINTERFACE |CI7304 "get_f_classes" "Returns stIdValueClasse[]" "f_classes"
33525>>>        
33525>>>        stIdValueClasse[] lista
33525>>>        stIdValueClasse[] lista
33526>>>        
33526>>>        Move 'O' to lista[0].id
33527>>>        Move 'F' to lista[1].id
33528>>>        Move 'D' to lista[2].id
33529>>>        
33529>>>        Move 'ORIGEM'   to lista[0].value
33530>>>        Move 'FRETE'    to lista[1].value
33531>>>        Move 'DESTINO'  to lista[2].value
33532>>>        
33532>>>        Function_Return lista
33533>>>        
33533>>>    End_Function //f_classes
33534>>>    
33534>>>    Function f_lista_HCGS3001 String aUsuarioSessao Returns stCombo[]
#REM SEND REGISTERINTERFACE |CI7305 "get_f_lista_HCGS3001" "String aUsuarioSessao Returns stCombo[]" "f_lista_HCGS3001"
33538>>>        
33538>>>        stCombo[] arr_tax
33538>>>        stCombo[] arr_tax
33539>>>
33539>>>        Clear CSAG311
33540>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33541>>>        Find Eq CSAG311 by 1
33542>>>>
33542>>>        If (not(Found)) Function_Return arr_tax
33545>>>        
33545>>>        Move (ResizeArray(arr_tax,0)) to arr_tax
33546>>>        
33546>>>        String sQuery
33546>>>        Integer iIndex
33546>>>        
33546>>>        Move 'SELECT CODIGO, NM_TAXA FROM DBO.HCGS3001 ORDER BY NM_TAXA' to sQuery
33547>>>        SQL_FIND_BEGIN hStmt_tx sQuery
33566>>>>
33566>>>            Move (SizeOfArray(arr_tax)) to iIndex
33567>>>            Move (Trim(SqlFindValue(hStmt_tx,1))) to arr_tax[iIndex].ID
33568>>>            Move (ToOEM(Trim(SqlFindValue(hStmt_tx,2)))) to arr_tax[iIndex].DS
33569>>>        SQL_FIND_END hStmt_tx
33576>>>>
33576>>>        
33576>>>        Function_Return arr_tax
33577>>>
33577>>>    End_Function //f_lista_HCGS3001 
33578>>>
33578>>>    Function buscarTaxas String aUsuarioSessao;                         Returns stIdValueClasse[]
#REM SEND REGISTERINTERFACE |CI7306 "get_buscarTaxas" "String aUsuarioSessao Returns stIdValueClasse[]" "buscarTaxas"
33582>>>                                
33582>>>        stIdValueClasse[] arrLista
33582>>>        stIdValueClasse[] arrLista
33583>>>        String[][3] arrTaxas
33584>>>        String[]    arrClasseTaxa
33585>>>        
33585>>>        Integer iIndex 
33585>>>        Integer idTaxa
33585>>>        Integer iX
33585>>>        Integer idLista
33585>>>
33585>>>        String  sQuery
33585>>>        String  nomeTaxa
33585>>>        String  classeTaxa
33585>>>        String  idClasseTaxa
33585>>>        
33585>>>        Clear CSAG311
33586>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33587>>>        Find Eq CSAG311 by 1
33588>>>>
33588>>>        If (not(Found)) Begin
33590>>>            Function_Return arrLista
33591>>>        End
33591>>>>
33591>>>        
33591>>>        Move (ResizeArray(arrLista, 0)) to arrLista
33592>>>        Move (ResizeArray(arrTaxas, 0)) to arrTaxas
33593>>>        Move (ResizeArray(arrClasseTaxa, 0)) to arrClasseTaxa
33594>>>        
33594>>>        CREATE_MAIN_CONNECTION BYFILE HCGS3001
33599>>>>
33599>>>        Move "SELECT CODIGO, NM_TAXA, CLASSE_TAXA" to sQuery
33600>>>        Move (sQuery*"FROM DBO.HCGS3001") to sQuery
33601>>>        Move (sQuery*"ORDER BY NM_TAXA") to sQuery
33602>>>        SQL_FIND_BEGIN hStmtTaxas sQuery
33621>>>>
33621>>>            Move (SizeOfArray(arrTaxas)) to iIndex
33622>>>            Move            (SqlFindValue(hStmtTaxas,1))   to arrTaxas[iIndex][0] //idTaxa
33623>>>            Move (ToOEM(Trim(SqlFindValue(hStmtTaxas,2)))) to arrTaxas[iIndex][1] //nomeTaxa
33624>>>            Move       (Trim(SqlFindValue(hStmtTaxas,3)))  to arrTaxas[iIndex][2] //classeTaxa
33625>>>        SQL_FIND_END hStmtTaxas 
33632>>>>
33632>>>        //preparar a lista de taxas com a respectiva classe
33632>>>        Move (ResizeArray(arrLista, 0)) to arrLista
33633>>>        If (SizeOfArray(arrTaxas)>0) Begin
33635>>>            For iIndex from 0 to (SizeOfArray(arrTaxas)-1)
33641>>>>
33641>>>                Move arrTaxas[iIndex][0] to idTaxa    
33642>>>                Move arrTaxas[iIndex][1] to nomeTaxa  
33643>>>                Move arrTaxas[iIndex][2] to classeTaxa
33644>>>                If (classeTaxa <> '') Begin
33646>>>                    Move (ResizeArray(arrClasseTaxa, 0))    to arrClasseTaxa
33647>>>                    Move (StrSplitToArray(classeTaxa, ',')) to arrClasseTaxa
33648>>>                    For iX from 0 to (SizeOfArray(arrClasseTaxa)-1)
33654>>>>
33654>>>                        Move (SizeOfArray(arrLista)) to idLista
33655>>>                        Clear CCGS221
33656>>>                        Move arrClasseTaxa[iX] to CCGS221.CODIGO
33657>>>                        Find Eq CCGS221 by 1
33658>>>>
33658>>>                        Move (String(idTaxa)+arrClasseTaxa[iX])     to arrLista[idLista].id
33659>>>                        Move (nomeTaxa*'-'*Trim(CCGS221.DESCRICAO)) to arrLista[idLista].value
33660>>>                        Move arrClasseTaxa[iX]                      to arrLista[idLista].classe
33661>>>                    Loop
33662>>>>
33662>>>                End
33662>>>>
33662>>>                Else Begin
33663>>>                        Move (SizeOfArray(arrLista)) to idLista
33664>>>                        Move (String(idTaxa)+'_') to arrLista[idLista].id
33665>>>                        Move (nomeTaxa)           to arrLista[idLista].value
33666>>>                        
33666>>>                        Move (SizeOfArray(arrClasseTaxa)-1) to iX
33667>>>                        Move arrClasseTaxa[iX]    to arrLista[idLista].classe
33668>>>                End
33668>>>>
33668>>>            Loop
33669>>>>
33669>>>        End //(SizeOfArray(arrTaxas)>0)
33669>>>>
33669>>>        
33669>>>        Function_Return arrLista
33670>>>        
33670>>>    End_Function //buscarTaxas
33671>>>    
33671>>>    Function fSerchComboTaxes String aUsuarioSessao String idClasse Returns stIdValueClasse[]
#REM SEND REGISTERINTERFACE |CI7307 "get_fSerchComboTaxes" "String aUsuarioSessao String idClasse Returns stIdValueClasse[]" "fSerchComboTaxes"
33675>>>        
33675>>>        stIdValueClasse[] aLista
33675>>>        stIdValueClasse[] aLista
33676>>>        Integer iIndex
33676>>>        String sQuery
33676>>>        String sWhere
33676>>>        
33676>>>        Move (ResizeArray(aLista, 0)) to aLista
33677>>>        
33677>>>        Clear CSAG311
33678>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33679>>>        Find EQ CSAG311 by 1
33680>>>>
33680>>>        If (not(Found)) Function_Return aLista
33683>>>        
33683>>>        If (idClasse <> '') Begin
33685>>>            Move "WHERE CLASSE_TAXA LIKE ('%1')" to sWhere
33686>>>            Move (SFormat(sWhere, '%'+idClasse+'%' )) to sWhere
33687>>>        End
33687>>>>
33687>>>        
33687>>>        Move "SELECT CODIGO, NM_TAXA FROM DBO.HCGS3001 %1 ORDER BY NM_TAXA" to sQuery
33688>>>        Move (SFormat(sQuery, sWhere)) to sQuery
33689>>>        SQL_FIND_BEGIN hStmtTaxas sQuery
33708>>>>
33708>>>            Move (SizeOfArray(aLista)) to iIndex
33709>>>            Move            (SqlFindValue(hStmtTaxas,1))   to aLista[iIndex].id //idTaxa
33710>>>            Move (ToOEM(Trim(SqlFindValue(hStmtTaxas,2)))) to aLista[iIndex].value //nomeTaxa
33711>>>        SQL_FIND_END hStmtTaxas 
33718>>>>
33718>>>        
33718>>>        Function_Return aLista
33719>>>        
33719>>>    End_Function //fSerchComboTaxes
33720>>>
33720>>>    Function buscarTaxasPorNome String aUsuarioSessao;                                String inicial;                                Returns stTaxas[]
#REM SEND REGISTERINTERFACE |CI7308 "get_buscarTaxasPorNome" "String aUsuarioSessao String inicial Returns stTaxas[]" "buscarTaxasPorNome"
33724>>>                                
33724>>>        String  sQuery
33724>>>        Integer iIndex
33724>>>        stTaxas[] arrTaxas
33724>>>        stTaxas[] arrTaxas
33725>>>        
33725>>>        Move (Uppercase(inicial)) to inicial
33726>>>        Move (Rtrim(inicial))     to inicial
33727>>>        Move (Ltrim(inicial))     to inicial
33728>>>        Move ('%'+inicial+'%')    to inicial
33729>>>                
33729>>>        Move (ResizeArray(arrTaxas, 0)) to arrTaxas
33730>>>        CREATE_MAIN_CONNECTION BYFILE HCGS3001
33735>>>>
33735>>>                Get Find_Code_Description of oCSAG367_FVT 'WS_HCGS3001_BUSCAR_TAXAS' to sQuery
33736>>>        //Move (fLoadSQL_CSAG367('WS_HCGS3001_BUSCAR_TAXAS', '2')) to sQuery
33736>>>        Move (SFORMAT(sQuery, inicial)) to sQuery
33737>>>        SQL_FIND_BEGIN hStmtTaxas sQuery
33756>>>>
33756>>>            //SqlFindValueByName
33756>>>            Move (SizeOfArray(arrTaxas)) to iIndex
33757>>>            Move            (SqlFindValue(hStmtTaxas,1))     to arrTaxas[iIndex].id
33758>>>            Move (ToOEM(Trim(SqlFindValue(hStmtTaxas,2))))   to arrTaxas[iIndex].value
33759>>>        SQL_FIND_END hStmtTaxas 
33766>>>>
33766>>>        
33766>>>        Function_Return arrTaxas
33767>>>        
33767>>>    End_Function // buscarTaxasporNome
33768>>>    
33768>>>    Function buscarTaxasPorClasse String aClasse Returns stTaxas[]
#REM SEND REGISTERINTERFACE |CI7309 "get_buscarTaxasPorClasse" "String aClasse Returns stTaxas[]" "buscarTaxasPorClasse"
33772>>>                                
33772>>>        String  sQuery
33772>>>        Integer iIndex
33772>>>        stTaxas[] arrTaxas
33772>>>        stTaxas[] arrTaxas
33773>>>        
33773>>>        Move (Trim(Uppercase(aClasse))) to aClasse
33774>>>        Move ('%'+aClasse+'%') to aClasse
33775>>>                
33775>>>        Move (ResizeArray(arrTaxas, 0)) to arrTaxas
33776>>>        
33776>>>        CREATE_MAIN_CONNECTION BYFILE HCGS3001
33781>>>>
33781>>>                If (aClasse <> '') Begin
33783>>>                Get Find_Code_Description of oCSAG367_FVT 'WS_HCGS3001_BUSCAR_TAXAS2' to sQuery
33784>>>            Move (SFORMAT(sQuery, aClasse)) to sQuery
33785>>>                End
33785>>>>
33785>>>                Else Begin
33786>>>                    Move "SELECT CODIGO, NM_TAXA,CLASSE_TAXA FROM DBO.HCGS3001" to sQuery
33787>>>                    Move (sQuery*"WHERE ID_DESATIVADA = '0' ORDER by NM_TAXA") to sQuery 
33788>>>        End
33788>>>>
33788>>>        SQL_FIND_BEGIN hStmtTaxas2 sQuery
33807>>>>
33807>>>            Move (SizeOfArray(arrTaxas)) to iIndex
33808>>>            Move            (SqlFindValue(hStmtTaxas2,1))     to arrTaxas[iIndex].id
33809>>>            Move (ToOEM(Trim(SqlFindValue(hStmtTaxas2,2))))   to arrTaxas[iIndex].value
33810>>>        SQL_FIND_END hStmtTaxas2 
33817>>>>
33817>>>        
33817>>>        Function_Return arrTaxas
33818>>>        
33818>>>    End_Function // buscarTaxasPorClasse
33819>>>    
33819>>>    Function taxas_tarifarioxproposta String aClasse String aProp Returns stTaxas[]
#REM SEND REGISTERINTERFACE |CI7310 "get_taxas_tarifarioxproposta" "String aClasse String aProp Returns stTaxas[]" "taxas_tarifarioxproposta"
33823>>>                                
33823>>>        String  sQuery
33823>>>        Integer iIndex
33823>>>        stTaxas[] arrTaxas
33823>>>        stTaxas[] arrTaxas
33824>>>                
33824>>>                Move (Trim(Uppercase(aClasse))) to aClasse
33825>>>                
33825>>>                If (aClasse <> '') Begin
33827>>>            Move ('%'+aClasse+'%') to aClasse
33828>>>            Move "SELECT DISTINCT  T.CODIGO,T.NM_TAXA,P.DESCRICAO FROM DBO.HCGS3001 T INNER JOIN DBO.HCGS3006 P ON" to sQuery
33829>>>                    Move (sQuery*"P.TAXA_ID=T.CODIGO WHERE P.PROPOSTA_ID=%1 AND P.TAXA_CLASSES LIKE '%2' ORDER BY T.NM_TAXA") to sQuery 
33830>>>            Move (SFORMAT(sQuery,aProp,aClasse)) to sQuery
33831>>>                End
33831>>>>
33831>>>                Else Begin
33832>>>                    Move "SELECT DISTINCT  T.CODIGO,T.NM_TAXA,P.DESCRICAO FROM DBO.HCGS3001 T INNER JOIN DBO.HCGS3006 P ON" to sQuery
33833>>>                    Move (sQuery*"P.TAXA_ID=T.CODIGO WHERE P.PROPOSTA_ID=%1 ORDER BY T.NM_TAXA") to sQuery 
33834>>>                    Move (SFormat(sQuery,aProp)) to sQuery
33835>>>        End
33835>>>>
33835>>>        SQL_FIND_BEGIN hStmtTaxas2 sQuery
33854>>>>
33854>>>            Move (SizeOfArray(arrTaxas)) to iIndex
33855>>>            Move            (SqlFindValue(hStmtTaxas2,1))     to arrTaxas[iIndex].id
33856>>>            
33856>>>            Move (ToOEM(Trim(SqlFindValue(hStmtTaxas2,2))))   to arrTaxas[iIndex].value
33857>>>            Move (ToOEM(Trim(SqlFindValue(hStmtTaxas2,3))))   to arrTaxas[iIndex].value2
33858>>>            
33858>>>            If (SqlFindValue(hStmtTaxas2,3) <> '');                Move (arrTaxas[iIndex].value*'('+arrTaxas[iIndex].value2+')')   to arrTaxas[iIndex].value
33861>>>        
33861>>>        SQL_FIND_END hStmtTaxas2 
33868>>>>
33868>>>        
33868>>>        Function_Return arrTaxas
33869>>>        
33869>>>    End_Function // taxas_tarifarioxproposta
33870>>>
33870>>>    Function fResearchTaxsbyClass String aUsuarioSessao;                                  String aInicio;                                  String aClasse;                                  Returns stIdValueClasse[]
#REM SEND REGISTERINTERFACE |CI7311 "get_fResearchTaxsbyClass" "String aUsuarioSessao String aInicio String aClasse Returns stIdValueClasse[]" "fResearchTaxsbyClass"
33874>>>        
33874>>>        stIdValueClasse[] aLista
33874>>>        stIdValueClasse[] aLista
33875>>>        Integer iIndex
33875>>>        String sQuery
33875>>>        String sWhere
33875>>>        
33875>>>        Move (ResizeArray(aLista, 0)) to aLista
33876>>>
33876>>>        Move (Uppercase(aInicio))  to aInicio        
33877>>>        Move (Trim(aInicio))       to aInicio
33878>>>        Move ('%' + aInicio + '%') to aInicio
33879>>>        
33879>>>        
33879>>>        Clear CSAG311
33880>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33881>>>        Find EQ CSAG311 by 1
33882>>>>
33882>>>        If (not(Found)) Function_Return aLista
33885>>>        Move '' to sWhere
33886>>>        
33886>>>        If (aClasse <> '') Begin
33888>>>            Move "WHERE CLASSE_TAXA LIKE ('%1')" to sWhere
33889>>>            Move (SFormat(sWhere, '%'+aClasse+'%' )) to sWhere
33890>>>        End
33890>>>>
33890>>>
33890>>>        If (aInicio <> '') Begin
33892>>>            If (sWhere <> '') Move "WHERE NM_TAXA LIKE ('%1')" to sWhere
33895>>>            Else Move (sWhere * "AND NM_TAXA LIKE ('%1')") to sWhere
33897>>>            Move (SFormat(sWhere, aInicio)) to sWhere
33898>>>        End
33898>>>>
33898>>>        
33898>>>        Move "SELECT CODIGO, NM_TAXA FROM DBO.HCGS3001 %1 ORDER BY NM_TAXA" to sQuery
33899>>>        Move (SFormat(sQuery, sWhere)) to sQuery
33900>>>        SQL_FIND_BEGIN hStmtTaxas sQuery
33919>>>>
33919>>>            Move (SizeOfArray(aLista)) to iIndex
33920>>>            Move            (SqlFindValue(hStmtTaxas,1))   to aLista[iIndex].id //idTaxa
33921>>>            Move (ToOEM(Trim(SqlFindValue(hStmtTaxas,2)))) to aLista[iIndex].value //nomeTaxa
33922>>>        SQL_FIND_END hStmtTaxas 
33929>>>>
33929>>>        
33929>>>        Function_Return aLista
33930>>>        
33930>>>    End_Function //fResearchTaxsbyClass
33931>>>    
33931>>>End_Object //oWs_HCGS3001
33932>>>
33932>>>
33932>    Use ws_CSAG325.wo  //- Cidades
Including file: ws_CSAG325.wo    (C:\DataFlex Projects\CROSS\WVDF_WS\AppSrc\ws_CSAG325.wo)
33932>>>//-2WA
33932>>>Use cWebService.pkg
33932>>>Open CSAG325
33934>>>
33934>>>Object ows_CSAG325 is a cWebService
33936>>>    
33936>>>    // psDocumentation provides high level documentation of your web service. 
33936>>>    // Clients using this service will see and use this documentation. 
33936>>>    Set psDocumentation to "2WA - www.2wa.com.br"
33937>>>    Set psServiceTitle  to "Cidades"
33938>>>    Set psServiceName   to "ws_csag325"
33939>>>    //Set psServiceUri    to "http://tempuri.org/"
33939>>>    
33939>>>    Function f_bPaisCidade String aUsuarioSessao String idCidade Returns String
#REM SEND REGISTERINTERFACE |CI7312 "get_f_bPaisCidade" "String aUsuarioSessao String idCidade Returns String" "f_bPaisCidade"
33943>>>        Clear CSAG311
33944>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33945>>>        Find Eq CSAG311 by 1
33946>>>>
33946>>>        If (not(Found)) Begin
33948>>>            Function_Return ''
33949>>>        End
33949>>>>
33949>>>
33949>>>        Clear CSAG325
33950>>>        Move idCidade to CSAG325.CODIGO
33951>>>        Find Eq CSAG325 by 1
33952>>>>
33952>>>        Function_Return (Trim(CSAG325.PAIS))
33953>>>        
33953>>>    End_Function //f_bPaisCidade
33954>>>
33954>>>    Function buscarCidadesPorPaisesPorTrade String aUsuarioSessao;                                            String idPais;                                            String sCidade;                                            Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7313 "get_buscarCidadesPorPaisesPorTrade" "String aUsuarioSessao String idPais String sCidade Returns stCityCountryTrade[]" "buscarCidadesPorPaisesPorTrade"
33958>>>        stCityCountryTrade[] tLista
33958>>>        stCityCountryTrade[] tLista
33959>>>        
33959>>>        Move (Ltrim(sCidade))     to sCidade
33960>>>        Move (Trim(sCidade))      to sCidade
33961>>>        Move (Uppercase(sCidade)) to sCidade
33962>>>        Move (sCidade+'%')        to sCidade
33963>>>        
33963>>>        String  sQuery
33963>>>        String  sWhere sAux sAux2
33963>>>        String  sPais
33963>>>        String  sValue
33963>>>        Integer iIndex
33963>>>        String[] arPais
33964>>>        
33964>>>        Clear CSAG311
33965>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
33966>>>        Find Eq CSAG311 by 1
33967>>>>
33967>>>        If (not(Found)) Begin
33969>>>            Function_Return tLista
33970>>>        End
33970>>>>
33970>>>        
33970>>>        Move "SELECT TOP 15 C.CODIGO, C.DESCRICAO, P.DESCRICAO,C.UF" to sQuery
33971>>>        Move (sQuery*"FROM DBO.CSAG325 C,DBO.CSAG329 P %1 ORDER BY C.DESCRICAO") to sQuery
33972>>>        
33972>>>//        Get Find_Code_Description of oCSAG367_FVT 'WS_CSAG325_CIDADES_POR_PAISES_POR_TRADE' to sQuery
33972>>>        
33972>>>        
33972>>>        Move (ResizeArray(tLista, 0)) to tLista         
33973>>>        Move (Trim(idPais)) to idPais
33974>>>        Move (Uppercase(idPais)) to idPais
33975>>>    
33975>>>        Move '' to sWhere
33976>>>        Move '' to sAux2
33977>>>        Move (SFormat("WHERE C.PAIS=P.SIGLA AND C.DESCRICAO LIKE '%1' AND C.CSAG336_ID='1'", sCidade)) to sWhere
33978>>>        
33978>>>        If (idPais <> '') Begin
33980>>>            
33980>>>            Move '' to sAux
33981>>>            Move '' to sAux2
33982>>>                        
33982>>>            Move (StrSplitToArray(idPais,',')) to arPais
33983>>>            
33983>>>            For iIndex from 0 to (SizeOfArray(arPais)-1)
33989>>>>
33989>>>                
33989>>>                Move (SFormat("P.SIGLA = '%1'", arPais[iIndex])) to sAux
33990>>>                
33990>>>                If (sAux2 <> '') Move (sAux2*"OR "+sAux) to sAux2
33993>>>                Else Move ("("+sAux) to sAux2
33995>>>                
33995>>>            Loop
33996>>>>
33996>>>            
33996>>>            Move (sWhere*'AND'*Trim(sAux2)+')') to sWhere
33997>>>        
33997>>>        End
33997>>>>
33997>>>        
33997>>>        Move (SFormat(sQuery, sWhere)) to sQuery 
33998>>>        SQL_FIND_BEGIN hStmtCidades sQuery
34017>>>>
34017>>>            Move (SizeOfArray(tLista)) to iIndex
34018>>>            Move       (Trim(SqlFindValue(hStmtCidades,1)))  to tLista[iIndex].id
34019>>>            Move (ToOEM(Trim(SqlFindValue(hStmtCidades,2)))) to sValue
34020>>>
34020>>>            Move (sValue*'('+(SqlFindValue(hStmtCidades,4))+') -'*(SqlFindValue(hStmtCidades,3))) to sValue
34021>>>            
34021>>>            Move (Trim(sValue)) to tLista[iIndex].value
34022>>>        SQL_FIND_END hStmtCidades
34029>>>>
34029>>>            
34029>>>        Function_Return tLista
34030>>>    End_Function //buscarCidadesPorPaisesPorTrade 
34031>>>    
34031>>>    Function buscarCidadesVia String aUsuarioSessao;                                            String idPais;                                            String sCidade;                                            Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7314 "get_buscarCidadesVia" "String aUsuarioSessao String idPais String sCidade Returns stCityCountryTrade[]" "buscarCidadesVia"
34035>>>        stCityCountryTrade[] tLista
34035>>>        stCityCountryTrade[] tLista
34036>>>        
34036>>>        Move (Ltrim(sCidade))     to sCidade
34037>>>        Move (Trim(sCidade))      to sCidade
34038>>>        Move (Uppercase(sCidade)) to sCidade
34039>>>        Move (sCidade+'%')        to sCidade
34040>>>        
34040>>>        String  sQuery
34040>>>        String  sWhere sAux sAux2
34040>>>        String  sPais
34040>>>        String  sValue
34040>>>        Integer iIndex
34040>>>        String[] arPais 
34041>>>        
34041>>>        Clear CSAG311
34042>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34043>>>        Find Eq CSAG311 by 1
34044>>>>
34044>>>        If (not(Found)) Begin
34046>>>            Function_Return tLista
34047>>>        End
34047>>>>
34047>>>        
34047>>>        Move "SELECT TOP 15 C.CODIGO, C.DESCRICAO, P.DESCRICAO,C.UF" to sQuery
34048>>>        Move (sQuery*"FROM DBO.CSAG325 C,DBO.CSAG329 P %1 ORDER BY C.DESCRICAO") to sQuery
34049>>>        
34049>>>//        Get Find_Code_Description of oCSAG367_FVT 'WS_CSAG325_CIDADES_POR_PAISES_POR_TRADE' to sQuery
34049>>>        
34049>>>        
34049>>>        Move (ResizeArray(tLista, 0)) to tLista         
34050>>>        Move (Trim(idPais)) to idPais
34051>>>        Move (Uppercase(idPais)) to idPais
34052>>>    
34052>>>        Move '' to sWhere
34053>>>        Move '' to sAux2
34054>>>        Move (SFormat("WHERE C.PAIS=P.SIGLA AND C.DESCRICAO LIKE '%1' AND C.CSAG336_ID='1'", sCidade)) to sWhere
34055>>>        
34055>>>        If (idPais <> '') Begin
34057>>>            
34057>>>            Move '' to sAux
34058>>>            Move '' to sAux2
34059>>>                        
34059>>>            Move (StrSplitToArray(idPais,',')) to arPais
34060>>>            
34060>>>            For iIndex from 0 to (SizeOfArray(arPais)-1)
34066>>>>
34066>>>                
34066>>>                Move (SFormat("P.SIGLA = '%1'", arPais[iIndex])) to sAux
34067>>>                
34067>>>                If (sAux2 <> '') Move (sAux2*"OR "+sAux) to sAux2
34070>>>                Else Move ("("+sAux) to sAux2
34072>>>                
34072>>>            Loop
34073>>>>
34073>>>            
34073>>>            Move (sWhere*'AND'*Trim(sAux2)+')') to sWhere
34074>>>        End
34074>>>>
34074>>>        
34074>>>        Move (SFormat(sQuery, sWhere)) to sQuery 
34075>>>        
34075>>>        If (sCidade contains 'DIRE') Begin
34077>>>            Move 0 to tLista[0].id
34078>>>            Move "DIRECT SERVICE" to tLista[0].value
34079>>>        End
34079>>>>
34079>>>        
34079>>>        SQL_FIND_BEGIN hStmtCidades sQuery
34098>>>>
34098>>>            Move (SizeOfArray(tLista)) to iIndex
34099>>>            Move       (Trim(SqlFindValue(hStmtCidades,1)))  to tLista[iIndex].id
34100>>>            Move (ToOEM(Trim(SqlFindValue(hStmtCidades,2)))) to sValue
34101>>>
34101>>>            Move (sValue*'('+(SqlFindValue(hStmtCidades,4))+') -'*(SqlFindValue(hStmtCidades,3))) to sValue
34102>>>            
34102>>>            Move (Trim(sValue)) to tLista[iIndex].value
34103>>>        SQL_FIND_END hStmtCidades
34110>>>>
34110>>>            
34110>>>        Function_Return tLista
34111>>>    End_Function //buscarCidadesVia 
34112>>>    
34112>>>    Function cidadeDescricaoPais String sCODIGO Returns String
#REM SEND REGISTERINTERFACE |CI7315 "get_cidadeDescricaoPais" "String sCODIGO Returns String" "cidadeDescricaoPais"
34116>>>        If (sCODIGO = '' or sCODIGO='0') Function_Return ''
34119>>>        
34119>>>        Clear CSAG325
34120>>>        Move sCODIGO   to CSAG325.CODIGO
34121>>>        Find Eq CSAG325 by 1
34122>>>>
34122>>>        If (not(Found)) Function_Return 'REGISTRO NAO ENCONTRATO.'
34125>>>        Else Begin
34126>>>            Clear CSAG329
34127>>>            Move CSAG325.PAIS to CSAG329.SIGLA
34128>>>            Find EQ CSAG329 by 1
34129>>>>
34129>>>            
34129>>>            Function_Return (Rtrim(CSAG325.DESCRICAO)+'('+CSAG325.UF+') -'*CSAG329.DESCRICAO)
34130>>>        End
34130>>>>
34130>>>    End_Function //cidadeDescricaoPais
34131>>>    
34131>>>    Function propostaVia String sPol String sPod String sMod String sCliente Returns stIdValue[]
#REM SEND REGISTERINTERFACE |CI7316 "get_propostaVia" "String sPol String sPod String sMod String sCliente Returns stIdValue[]" "propostaVia"
34135>>>        
34135>>>        stIdValue[] arVia
34135>>>        stIdValue[] arVia
34136>>>        
34136>>>        Date dDate
34136>>>        Sysdate dDate
34137>>>        
34137>>>        String sQuery sTipoCliente
34137>>>        Integer iIndex 
34137>>>        Integer[] iMoeda
34138>>>        
34138>>>        Clear CSAG340
Including file: CSAG340.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG340.fd)
34139>>>        Move sCliente to CSAG340.CSAG320_ID
34140>>>        Find EQ CSAG340 by 2
34141>>>>
34141>>>        If (Found) Begin
34143>>>                If (CSAG340.IND_TER = 'I') Move 'CD' to sTipoCliente
34146>>>                If (CSAG340.IND_TER = 'T') Move 'CL' to sTipoCliente
34149>>>        End
34149>>>>
34149>>>        Else Move 'CD' to sTipoCliente 
34151>>>    
34151>>>        If (sPod = 'undefined' or sPol = 'undefined') Function_Return arVia
34154>>>        Else Begin
34155>>>            If (sPol <> '' and sPod <> '') Begin
34157>>>                Move 'SELECT DISTINCT C.CODIGO, C.DESCRICAO' to sQuery
34158>>>                Move (sQuery*"FROM DBO.HCGS3000 A LEFT JOIN DBO.CSAG325 C ON C.CODIGO=A.CSAG325_VIA") to sQuery
34159>>>                Move (sQuery*"WHERE A.CSAG325_ORIGEM=%1 AND A.CSAG325_DESTINO=%2 AND A.CCGS202_ID='%3'") to sQuery
34160>>>                Move (SFormat(sQuery,sPol,sPod,sMod)) to sQuery
34161>>>                Move (sQuery*"AND (%1 BETWEEN A.DT_INICIAL AND A.DT_FINAL) AND A.TAXA_CLASSE='F' AND A.TAXA_ID=9") to sQuery
34162>>>                Move (SFormat(sQuery,ToSQLDate(dDate))) to sQuery
34163>>>                Move (sQuery*(SFormat("AND A.ID_TIPO_CLCD='%1'",sTipoCliente))) to sQuery
34164>>>                Move (sQuery*"ORDER BY C.DESCRICAO") to sQuery
34165>>>                SQL_FIND_BEGIN hStmt_via sQuery
34184>>>>
34184>>>                    
34184>>>                    Move (SizeOfArray(arVia)) to iIndex
34185>>>                    Move (SqlFindValue(hStmt_via,1)) to arVia[iIndex].id
34186>>>                    Move (Trim(SqlFindValue(hStmt_via,2))) to arVia[iIndex].value
34187>>>                SQL_FIND_END hStmt_via 
34194>>>>
34194>>>                
34194>>>                For iIndex from 0 to (SizeOfArray(arVia)-1)
34200>>>>
34200>>>                    
34200>>>                    Clear CSAG325
34201>>>                    Move arVia[iIndex].id to CSAG325.CODIGO
34202>>>                    Find EQ CSAG325 by 1
34203>>>>
34203>>>                    If (Found) Begin
34205>>>                        Move (Trim(arVia[iIndex].value*"("+Trim(CSAG325.UF)+")")) to arVia[iIndex].value    
34206>>>                    End
34206>>>>
34206>>>                    If (arVia[iIndex].id = '0') Move ("DIRECT SERVICE"*Trim(arVia[iIndex].value)) to arVia[iIndex].value
34209>>>                Loop
34210>>>>
34210>>>            End
34210>>>>
34210>>>        End
34210>>>>
34210>>>        
34210>>>        Function_Return arVia
34211>>>        
34211>>>    End_Function //propostaVia
34212>>>    
34212>>>    Function propostaCidadeOrigem String aUsuarioSessao;                                  String sCidade;                                  String sPais;                                  String sMod;                                  String sCliente;                                 Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7317 "get_propostaCidadeOrigem" "String aUsuarioSessao String sCidade String sPais String sMod String sCliente Returns stCityCountryTrade[]" "propostaCidadeOrigem"
34216>>>        
34216>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34216>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34217>>>        
34217>>>        Move (Ltrim(sCidade))     to sCidade
34218>>>        Move (Trim(sCidade))      to sCidade
34219>>>        Move (Uppercase(sCidade)) to sCidade
34220>>>
34220>>>        Move (Replaces("'", sCidade, "''")) to sCidade
34221>>>        
34221>>>        Move (sCidade+'%')        to sCidade
34222>>>        
34222>>>        Move (Trim(sPais)) to sPais
34223>>>        Move (Uppercase(sPais)) to sPais
34224>>>    
34224>>>        String  sQuery sTipoCliente sValue
34224>>>        String  sICAO sIATA sUf
34224>>>        Integer iIndex
34224>>>        Date dDate
34224>>>        
34224>>>        Sysdate dDate
34225>>>        
34225>>>        Clear CSAG311
34226>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34227>>>        Find Eq CSAG311 by 1
34228>>>>
34228>>>        If (not(Found)) Function_Return tListaCidadesOrigemProposta
34231>>>        
34231>>>        Clear CSAG340
34232>>>        Move HCGS3004.CSAG320_ID to CSAG340.CSAG320_ID
34233>>>        Find EQ CSAG340 by 2
34234>>>>
34234>>>        If (Found) Begin
34236>>>                If (CSAG340.IND_TER = 'I') Move 'CD' to sTipoCliente
34239>>>                If (CSAG340.IND_TER = 'T') Move 'CL' to sTipoCliente
34242>>>        End 
34242>>>>
34242>>>        Else Move 'CD' to sTipoCliente 
34244>>>        
34244>>>        If (sCidade <> '') Begin
34246>>>
34246>>>            // VERSAO ABERTA PARA TODAS AS CIDADES, POREM SINALIZANDO AS QUE POSSUEM TARIFARIO.
34246>>>            Move "select top 25 C.CODIGO ,C.DESCRICAO ,P.DESCRICAO ,uf.no_uf" to sQuery      
34247>>>        
34247>>>                        If (sMod = 'AIR') Begin
34249>>>                            Move (sQuery*",TARIFA.ORG_IATA") to sQuery
34250>>>                                Move (sQuery*",(case when AIR.IATA is null then '' else AIR.IATA end) IATA") to sQuery
34251>>>                                Move (sQuery*",(case when AIR.NAME is null then '' else AIR.NAME end) AIRPORT") to sQuery
34252>>>                        End
34252>>>>
34252>>>                        Else Begin
34253>>>                            Move (sQuery*",TARIFA.CSAG325_ORIGEM") to sQuery
34254>>>            End
34254>>>>
34254>>>        
34254>>>            Move (sQuery*"from dbo.CSAG325 C ") to sQuery
34255>>>            
34255>>>            If (sMod = 'AIR') Begin
34257>>>                                Move (sQuery*"inner join dbo.HSAG325_AIR AIR on (AIR.CSAG325_ID = C.CODIGO)") to sQuery
34258>>>                Move (sQuery*"left join (select distinct AA.ORG_IATA from dbo.HCGS3000_AIRFR8 AA") to sQuery
34259>>>                Move (sQuery*"where %3 <= AA.VALID_UNTIL) TARIFA on (TARIFA.ORG_IATA = AIR.IATA)") to sQuery
34260>>>            End
34260>>>>
34260>>>            Else Begin
34261>>>                Move (sQuery*"left join (select distinct AA.CSAG325_ORIGEM from dbo.HCGS3000 AA") to sQuery
34262>>>                Move (sQuery*"where AA.TAXA_CLASSE='F' and (AA.CCGS202_ID='%1' or AA.CCGS202_ID='DTA')") to sQuery
34263>>>                Move (sQuery*"and (AA.ID_TIPO_CLCD='%2' or AA.ID_TIPO_CLCD='AL')") to sQuery
34264>>>                Move (sQuery*"and (TAXA_ID = 9 OR TAXA_ID = 42) and (%3 between AA.DT_INICIAL and AA.DT_FINAL)") to sQuery
34265>>>                Move (sQuery*") TARIFA on (TARIFA.CSAG325_ORIGEM = C.CODIGO)") to sQuery
34266>>>            End
34266>>>>
34266>>>            
34266>>>            //-ADICIONADO OS ESTADOS OU DIVISOES            
34266>>>            Move (sQuery*"left join dbo.CSAG329 P on (P.SIGLA = C.PAIS)") to sQuery
34267>>>            Move (sQuery*"left join dbo.TsubdivisionCode uf") to sQuery
34268>>>            Move (sQuery*"on (C.UF = uf.sg_uf and P.SIGLA_ISO = uf.sg_iso2_country)") to sQuery
34269>>>
34269>>>                        Move (sQuery*"where C.CSAG336_ID=1") to sQuery
34270>>>                                
34270>>>                        If (sMod = 'AIR');                                Move (sQuery*"and (C.DESCRICAO like '%4' or AIR.NAME like '%4' or AIR.IATA like '%4')") to sQuery
34273>>>                        Else;                                Move (sQuery*"and (C.DESCRICAO like '%4')") to sQuery
34275>>>
34275>>>            Move (SFormat(sQuery,sMod,sTipoCliente,ToSQLDate(dDate),sCidade)) to sQuery
34276>>>
34276>>>            If (sPais);                Move (sQuery*SFormat("and C.PAIS = '%1'", sPais)) to sQuery 
34279>>>                
34279>>>                        If (sMod = 'AIR');                                Move (sQuery*"order by TARIFA.ORG_IATA desc ,AIR.IATA ,C.DESCRICAO ,AIR.NAME") to sQuery  
34282>>>                        Else;                                Move (sQuery*"order by TARIFA.CSAG325_ORIGEM desc ,C.DESCRICAO") to sQuery  
34284>>>            
34284>>>            SQL_FIND_BEGIN hStmt_city sQuery
34303>>>>
34303>>>                Move (SizeOfArray(tListaCidadesOrigemProposta)) to iIndex
34304>>>                Move       (Trim(SqlFindValue(hStmt_city,1)))  to tListaCidadesOrigemProposta[iIndex].id
34305>>>                Move       (Trim(SqlFindValue(hStmt_city,3)))  to tListaCidadesOrigemProposta[iIndex].pais
34306>>>                Move (Trim(Uppercase(ToOEM(SqlFindValue(hStmt_city,4))))) to tListaCidadesOrigemProposta[iIndex].uf
34307>>>                
34307>>>               
34307>>>            If (sMod = 'AIR') Begin
34309>>>                Move (Trim(SqlFindValue(hStmt_city,6))) to tListaCidadesOrigemProposta[iIndex].iata // IATA
34310>>>                
34310>>>                Move tListaCidadesOrigemProposta[iIndex].iata to sIATA
34311>>>                
34311>>>                Move ( If(sIATA  <> '', sIATA + ' - ','') + ToOEM(Trim(SqlFindValue(hStmt_city,7))) ) to sValue //NOME AEROPORTO
34312>>>                Move ( sValue + If(sValue <> '', ', ','') + ToOEM(Trim(SqlFindValue(hStmt_city,2))) ) to sValue //CIDADE
34313>>>            End
34313>>>>
34313>>>            Else Begin
34314>>>                Move ( ToOEM(Trim(SqlFindValue(hStmt_city,2))) ) to sValue
34315>>>                Move '' to tListaCidadesOrigemProposta[iIndex].port
34316>>>            End
34316>>>>
34316>>>                Move tListaCidadesOrigemProposta[iIndex].uf to sUf
34317>>>                Move (sValue + If(sUf <> '',' (' + sUf + ') - ', ' - ') + Trim(SqlFindValue(hStmt_city,3))) to sValue
34318>>>
34318>>>                If (sMod = 'AIR') If (SqlFindValue(hStmt_city,5) <> "") Move (sValue*"- POSSUI FRETE") to sValue //
34323>>>                Else If (SqlFindValue(hStmt_city,5) > 0) Move (sValue*"- POSSUI FRETE") to sValue //
34327>>>                
34327>>>                Move (Trim(sValue)) to tListaCidadesOrigemProposta[iIndex].value
34328>>>            SQL_FIND_END hStmt_city
34335>>>>
34335>>>        End
34335>>>>
34335>>>        
34335>>>        Function_Return tListaCidadesOrigemProposta
34336>>>        
34336>>>    End_Function //propostaCidadeOrigem
34337>>>    
34337>>>    Function propostaCidadeDestino String aUsuarioSessao;                                   String sCidade;                                   String sPais;                                   String sMod;                                   String sCliente;                                   String sPol;                                  Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7318 "get_propostaCidadeDestino" "String aUsuarioSessao String sCidade String sPais String sMod String sCliente String sPol Returns stCityCountryTrade[]" "propostaCidadeDestino"
34341>>>        
34341>>>        stCityCountryTrade[] tListaCidadesDestinoProposta
34341>>>        stCityCountryTrade[] tListaCidadesDestinoProposta
34342>>>        
34342>>>        Move (Ltrim(sCidade))     to sCidade
34343>>>        Move (Trim(sCidade))      to sCidade
34344>>>        Move (Uppercase(sCidade)) to sCidade
34345>>>        Move (Replaces("'" , sCidade ,"''")) to sCidade
34346>>>        Move (sCidade+'%')        to sCidade
34347>>>        
34347>>>        Move (Trim(sPais)) to sPais
34348>>>        Move (Uppercase(sPais)) to sPais
34349>>>    
34349>>>        String  sQuery sTipoCliente sValue
34349>>>        String  sICAO sIATA
34349>>>        String  sUF
34349>>>        Integer iIndex
34349>>>        Date dDate
34349>>>        
34349>>>        Sysdate dDate
34350>>>        
34350>>>        Clear CSAG311
34351>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34352>>>        Find Eq CSAG311 by 1
34353>>>>
34353>>>        If (not(Found)) Function_Return tListaCidadesDestinoProposta
34356>>>        
34356>>>        Clear CSAG340
34357>>>        Move HCGS3004.CSAG320_ID to CSAG340.CSAG320_ID
34358>>>        Find EQ CSAG340 by 2
34359>>>>
34359>>>        If (Found) Begin
34361>>>                If (CSAG340.IND_TER = 'I') Move 'CD' to sTipoCliente
34364>>>                If (CSAG340.IND_TER = 'T') Move 'CL' to sTipoCliente
34367>>>        End 
34367>>>>
34367>>>        Else Move 'CD' to sTipoCliente 
34369>>>        
34369>>>        If (sPol = 'undefined') Move '' to sPol
34372>>>        
34372>>>        If (sCidade <> '') Begin
34374>>>            // VERSAO ABERTA PARA TODAS AS CIDADES, POREM SINALIZANDO AS QUE POSSUEM TARIFARIO.
34374>>>            Move "SELECT TOP 25 C.CODIGO ,C.DESCRICAO," to sQuery      
34375>>>             
34375>>>             
34375>>>                        If (sMod = 'AIR') Begin
34377>>>                Move (sQuery*"C.PAIS,C.UF,TARIFA.DST_IATA") to sQuery      
34378>>>                                Move (sQuery*",(CASE WHEN AIR.IATA IS NULL THEN '' ELSE AIR.IATA END) IATA") to sQuery
34379>>>                                Move (sQuery*",(CASE WHEN AIR.NAME IS NULL THEN '' ELSE AIR.NAME END) AIRPORT") to sQuery
34380>>>                        End
34380>>>>
34380>>>                        Else Begin
34381>>>                Move (sQuery*"P.DESCRICAO,uf.no_uf,TARIFA.CSAG325_DESTINO") to sQuery      
34382>>>            End
34382>>>>
34382>>>
34382>>>            Move (sQuery*"FROM DBO.CSAG325 C ") to sQuery
34383>>>            
34383>>>            If (sMod = 'AIR') Begin
34385>>>                                Move (sQuery*"INNER JOIN DBO.HSAG325_AIR AIR ON (AIR.CSAG325_ID = C.CODIGO)") to sQuery
34386>>>                Move (sQuery*"left join (select distinct AA.DST_IATA from dbo.HCGS3000_AIRFR8 AA") to sQuery
34387>>>                Move (sQuery*"where %3 <= AA.VALID_UNTIL) TARIFA on (TARIFA.DST_IATA = AIR.IATA)") to sQuery
34388>>>            End
34388>>>>
34388>>>            Else Begin
34389>>>                Move (sQuery*"LEFT JOIN (SELECT DISTINCT AA.CSAG325_DESTINO FROM DBO.HCGS3000 AA WHERE") to sQuery
34390>>>                Move (sQuery*"AA.TAXA_CLASSE='F' AND (AA.CCGS202_ID='%1' OR AA.CCGS202_ID='DTA')") to sQuery
34391>>>                Move (sQuery*"AND (AA.ID_TIPO_CLCD='%2' OR AA.ID_TIPO_CLCD='AL')") to sQuery
34392>>>                Move (sQuery*"AND (TAXA_ID = 9 OR TAXA_ID = 42) AND (%3 BETWEEN AA.DT_INICIAL AND AA.DT_FINAL)") to sQuery
34393>>>                Move (sQuery*") TARIFA ON TARIFA.CSAG325_DESTINO = C.CODIGO") to sQuery
34394>>>                
34394>>>                //ADICIONADO OS ESTADOS OU DIVISOES  
34394>>>                Move (sQuery*"LEFT JOIN DBO.CSAG329 P ON P.SIGLA = C.PAIS") to sQuery  
34395>>>                Move (sQuery*"LEFT JOIN DBO.TsubdivisionCode uf") to sQuery
34396>>>                Move (sQuery*"on C.UF = uf.sg_uf and P.SIGLA_ISO = uf.sg_iso2_country") to sQuery
34397>>>            End       
34397>>>>
34397>>>            
34397>>>                        Move (sQuery*"WHERE C.CSAG336_ID='1'") to sQuery
34398>>>                                
34398>>>                        If (sMod = 'AIR');                                Move (sQuery*"AND (C.DESCRICAO LIKE '%4' OR AIR.NAME LIKE '%4' OR AIR.IATA LIKE '%4')") to sQuery
34401>>>                        Else;                                Move (sQuery*"AND (C.DESCRICAO LIKE '%4')") to sQuery
34403>>>
34403>>>            Move (SFormat(sQuery,sMod,sTipoCliente,ToSQLDate(dDate),sCidade)) to sQuery
34404>>>            
34404>>>        If (sPais) Move (sQuery*SFormat("AND C.PAIS = '%1'", sPais)) to sQuery 
34407>>>
34407>>>        If (sMod = 'AIR');            Move (sQuery*"ORDER BY TARIFA.DST_IATA DESC ,AIR.IATA ,C.DESCRICAO ,AIR.NAME") to sQuery  
34410>>>        Else;            Move (sQuery*"ORDER BY TARIFA.CSAG325_DESTINO DESC ,C.DESCRICAO") to sQuery     
34412>>>            
34412>>>            SQL_FIND_BEGIN hStmt_city sQuery
34431>>>>
34431>>>                Move (SizeOfArray(tListaCidadesDestinoProposta)) to iIndex
34432>>>                Move       (Trim(SqlFindValue(hStmt_city,1)))  to tListaCidadesDestinoProposta[iIndex].id
34433>>>                Move       (Trim(SqlFindValue(hStmt_city,3)))  to tListaCidadesDestinoProposta[iIndex].pais
34434>>>                Move (Trim(Uppercase(ToOEM(SqlFindValue(hStmt_city,4))))) to tListaCidadesDestinoProposta[iIndex].uf
34435>>>                
34435>>>            If (sMod = 'AIR') Begin
34437>>>                Move (Trim(SqlFindValue(hStmt_city,6))) to tListaCidadesDestinoProposta[iIndex].iata // IATA
34438>>>                
34438>>>                Move tListaCidadesDestinoProposta[iIndex].iata to sIATA
34439>>>                
34439>>>                Move ( If(sIATA <> '', sIATA + ' - ','') + ToOEM(Trim(SqlFindValue(hStmt_city,7))) ) to sValue //AIRPORT NAME
34440>>>                Move ( sValue + If(sValue <> '',', ','') + ToOEM(Trim(SqlFindValue(hStmt_city,2))) ) to sValue //CITY NAME
34441>>>            End
34441>>>>
34441>>>            Else Begin
34442>>>                Move ( ToOEM(Trim(SqlFindValue(hStmt_city,2))) ) to sValue
34443>>>                Move '' to tListaCidadesDestinoProposta[iIndex].port
34444>>>            End
34444>>>>
34444>>>                Move tListaCidadesDestinoProposta[iIndex].uf to sUF
34445>>>                Move ( sValue + If(sUF <> '',' (' + sUF + ') - ',' - ') + Trim(SqlFindValue(hStmt_city,3)) ) to sValue
34446>>>                
34446>>>            If (sMod = 'AIR') If (SqlFindValue(hStmt_city,5) <> "") Move (sValue*"- POSSUI FRETE") to sValue //
34451>>>            Else              If (SqlFindValue(hStmt_city,5) > 0)   Move (sValue*"- POSSUI FRETE") to sValue //
34455>>>                
34455>>>                Move (Trim(sValue)) to tListaCidadesDestinoProposta[iIndex].value
34456>>>            SQL_FIND_END hStmt_city
34463>>>>
34463>>>        End
34463>>>>
34463>>>        
34463>>>        Function_Return tListaCidadesDestinoProposta
34464>>>        
34464>>>    End_Function //propostaCidadeDestino
34465>>>    
34465>>>    //AUTOCOMPLETE CIDADES
34465>>>    Function autoCidades String aInicio String aPais Returns stIdValueClasse[]
#REM SEND REGISTERINTERFACE |CI7319 "get_autoCidades" "String aInicio String aPais Returns stIdValueClasse[]" "autoCidades"
34469>>>        stIdValueClasse[] tListaAutoCidade
34469>>>        stIdValueClasse[] tListaAutoCidade
34470>>>        
34470>>>        String aCont
34470>>>        String  sQuery sQueryAuxC sQueryAuxP sAux2 sAux
34470>>>        Integer iIndex
34470>>>        String[] arCont
34471>>>        String[] arPais
34472>>>        
34472>>>        Move '' to sAux2
34473>>>        If (aPais <> '' and aPais <> 'undefined') Begin
34475>>>            If (aPais contains ',') Begin
34477>>>                Move (StrSplitToArray(aPais,',')) to arPais
34478>>>                For iIndex from 0 to (SizeOfArray(arPais)-1)
34484>>>>
34484>>>                    Move (SFormat("C.PAIS = '%1'", arPais[iIndex])) to sAux
34485>>>                    If (sAux2 <> '') Move (sAux2*"OR"*sAux) to sAux2
34488>>>                    Else Move ("("+sAux) to sAux2
34490>>>                Loop
34491>>>>
34491>>>                Move ('AND'*(sAux2+')')) to sQueryAuxP
34492>>>            End
34492>>>>
34492>>>            
34492>>>            Else Move (SFormat("AND C.PAIS='%1'",aPais)) to sQueryAuxP
34494>>>        End
34494>>>>
34494>>>        
34494>>>        Move (Trim(Uppercase(aInicio))) to aInicio
34495>>>        Move (aInicio+"%") to aInicio
34496>>>        
34496>>>        Move "SELECT TOP 25 C.CODIGO,C.DESCRICAO,uf.no_uf,P.DESCRICAO" to sQuery 
34497>>>        Move (sQuery*"FROM DBO.CSAG325 C") to sQuery
34498>>>        
34498>>>        //ADICIONADO OS ESTADOS OU DIVISOES  
34498>>>        Move (sQuery*"LEFT JOIN DBO.CSAG329 P ON P.SIGLA = C.PAIS") to sQuery          
34499>>>        Move (sQuery*"LEFT JOIN DBO.TsubdivisionCode uf") to sQuery
34500>>>        Move (sQuery*"ON C.UF = uf.sg_uf AND P.SIGLA_ISO = uf.sg_iso2_country") to sQuery
34501>>>        
34501>>>        Move (sQuery*"WHERE C.CSAG336_ID=1 AND C.DESCRICAO LIKE '%1'") to sQuery
34502>>>        
34502>>>        Move (SFormat(sQuery,aInicio)) to sQuery
34503>>>
34503>>>        If (sQueryAuxP <> '') Move (sQuery*sQueryAuxP) to sQuery
34506>>>        
34506>>>        Move (sQuery*"ORDER BY C.DESCRICAO") to sQuery
34507>>>        
34507>>>        SQL_FIND_BEGIN hStmtConti sQuery
34526>>>>
34526>>>            Move (SizeOfArray(tListaAutoCidade)) to iIndex
34527>>>            Move            (SqlFindValue(hStmtConti,1))   to tListaAutoCidade[iIndex].id
34528>>>            Move (ToOEM(Trim(SqlFindValue(hStmtConti,2)))) to tListaAutoCidade[iIndex].value
34529>>>            Move (tListaAutoCidade[iIndex].value*'('+ToOEM(Trim(SqlFindValue(hStmtConti,3)))+')') to tListaAutoCidade[iIndex].value
34530>>>            Move tListaAutoCidade[iIndex].value to tListaAutoCidade[iIndex].classe
34531>>>            Move (tListaAutoCidade[iIndex].value*'-'*Trim(SqlFindValue(hStmtConti,4))) to tListaAutoCidade[iIndex].value
34532>>>            
34532>>>            Move (Trim(tListaAutoCidade[iIndex].value)) to tListaAutoCidade[iIndex].value
34533>>>            
34533>>>        SQL_FIND_END hStmtConti
34540>>>>
34540>>>            
34540>>>        Function_Return tListaAutoCidade
34541>>>    End_Function //autoCidades 
34542>>>    
34542>>>    Function buscarCidadeporIATA String aUsuarioSessao String aCodigo String aIATA Returns String
#REM SEND REGISTERINTERFACE |CI7320 "get_buscarCidadeporIATA" "String aUsuarioSessao String aCodigo String aIATA Returns String" ""
34546>>>        String sRetVal
34546>>>        String sUF
34546>>>        String sQuery
34546>>>        
34546>>>        Boolean bhasIATA 
34546>>>        Boolean bhasLOCAL
34546>>>        
34546>>>        Clear CSAG311
34547>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34548>>>        Find eq CSAG311 by 1
34549>>>>
34549>>>        If (not(Found)) Function_Return sRetVal
34552>>>        
34552>>>        Clear HSAG325_AIR
Including file: HSAG325_AIR.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HSAG325_AIR.fd)
34553>>>        Move aIATA to HSAG325_AIR.IATA
34554>>>        Find Eq HSAG325_AIR by 1
34555>>>>
34555>>>        Move (Found) to bhasIATA
34556>>>        
34556>>>        Clear CSAG325
34557>>>        Move aCodigo to CSAG325.CODIGO
34558>>>        Find Eq CSAG325 by 1
34559>>>>
34559>>>        Move (Found and CSAG325.CSAG336_ID = 1) to bhasLOCAL
34560>>>        
34560>>>                                    Move ( If(bhasIATA, Trim(HSAG325_AIR.IATA) + ' - ','') )    to sRetVal //IATA
34561>>>        If (bhasIATA)               Move ( sRetVal + Trim(HSAG325_AIR.NAME) )                   to sRetVal //NOME AEROPORTO
34564>>>        If (bhasIATA and bhasLOCAL) Move ( sRetVal + ', ' + Trim(CSAG325.DESCRICAO) )           to sRetVal //CIDADE
34567>>>        Else         If (bhasLOCAL) Move ( sRetVal + Trim(CSAG325.DESCRICAO) )                  to sRetVal //CIDADE
34571>>>        Else         If (bhasIATA)  Move ( sRetVal + ', ' + Trim(HSAG325_AIR.CITY) )            to sRetVal //CIDADE
34575>>>
34575>>>        Clear CSAG329
34576>>>             If (bhasLOCAL) Move HSAG325_AIR.COUNTRY to CSAG329.SIGLA
34579>>>        Else If (bhasIATA)  Move CSAG325.PAIS        to CSAG329.SIGLA
34583>>>        Find eq CSAG329 by 1
34584>>>>
34584>>>
34584>>>        If (bhasLOCAL) Begin
34586>>>            //- LOCALIZAR UF BY CSAG325
34586>>>            Move "select uf.no_uf from dbo.CSAG325 C" to sQuery
34587>>>            //-ADICIONADO OS ESTADOS OU DIVISOES            
34587>>>            Move (sQuery*"left join dbo.CSAG329 P on (P.SIGLA = C.PAIS)") to sQuery
34588>>>            Move (sQuery*"left join dbo.TsubdivisionCode uf on (C.UF = uf.sg_uf and P.SIGLA_ISO = uf.sg_iso2_country)") to sQuery
34589>>>                Move (sQuery*"where C.CODIGO = %1") to sQuery
34590>>>            Move ( SFormat(sQuery,aCodigo) )  to sQuery
34591>>>            SQL_FIND_BEGIN hStmtUF sQuery
34610>>>>
34610>>>                Move (Trim(ToOEM(SqlFindValue(hStmtUF,1)))) to sUF
34611>>>            SQL_FIND_END hStmtUF
34618>>>>
34618>>>        End
34618>>>>
34618>>>        Else If (bhasIATA) Begin
34621>>>            //- LOCALIZAR UF BY HSAG325_AIR
34621>>>            Move "select uf.no_uf from dbo.HSAG325_AIR C" to sQuery
34622>>>            //-ADICIONADO OS ESTADOS OU DIVISOES            
34622>>>            Move (sQuery*"left join dbo.CSAG329 P on (P.SIGLA = C.COUNTRY)") to sQuery
34623>>>            Move (sQuery*"left join dbo.TsubdivisionCode uf on (C.UF = uf.sg_uf and P.SIGLA_ISO = uf.sg_iso2_country)") to sQuery
34624>>>                Move (sQuery*"where C.IATA = '%1'") to sQuery
34625>>>            Move ( SFormat(sQuery,aIATA) )  to sQuery
34626>>>            SQL_FIND_BEGIN hStmtUF sQuery
34645>>>>
34645>>>                Move (Trim(ToOEM(SqlFindValue(hStmtUF,1)))) to sUF
34646>>>            SQL_FIND_END hStmtUF
34653>>>>
34653>>>        End
34653>>>>
34653>>>
34653>>>        Move ( sRetVal + If(sUF <> '', ' (' + Uppercase(sUF) + ') - ', ' - ') + Trim(CSAG329.DESCRICAO) ) to sRetVal
34654>>>        
34654>>>        Function_Return sRetVal        
34655>>>    End_Function //buscarCidadeporIATA
34656>>>    
34656>>>    Function multiOrigemCidadeOrigem String aUsuarioSessao String sCidade String sPais;                                  String sCliente Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7321 "get_multiOrigemCidadeOrigem" "String aUsuarioSessao String sCidade String sPais String sCliente Returns stCityCountryTrade[]" "multiOrigemCidadeOrigem"
34660>>>        
34660>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34660>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34661>>>        String[] arAux
34662>>>        String  sQuery sTipoCliente sValue
34662>>>        String  sICAO sQueryPais sUf
34662>>>        Integer iIndex
34662>>>        String sMod
34662>>>        Date dDate
34662>>>        
34662>>>        Sysdate dDate
34663>>>        
34663>>>        Clear CSAG311
34664>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34665>>>        Find Eq CSAG311 by 1
34666>>>>
34666>>>        If (not(Found)) Function_Return tListaCidadesOrigemProposta
34669>>>        
34669>>>        Move (Ltrim(sCidade))     to sCidade
34670>>>        Move (Trim(sCidade))      to sCidade
34671>>>        Move (Uppercase(sCidade)) to sCidade
34672>>>
34672>>>        Move (Replaces("'", sCidade, "''")) to sCidade
34673>>>        
34673>>>        Move (sCidade+'%') to sCidade
34674>>>        
34674>>>        Move (Trim(sPais)) to sPais
34675>>>        Move (Uppercase(sPais)) to sPais
34676>>>        Move (StrSplitToArray(sPais,',')) to arAux
34677>>>        
34677>>>        For iIndex from 0 to (SizeOfArray(arAux)-1)
34683>>>>
34683>>>            If (sQueryPais = '') Move (SFormat("C.PAIS = '%1'",Trim(arAux[iIndex]))) to  sQueryPais
34686>>>            Else Move (sQueryPais*SFormat("OR C.PAIS = '%1'",Trim(arAux[iIndex]))) to sQueryPais
34688>>>        Loop
34689>>>>
34689>>>        If (sQueryPais <> '') Move ('('+sQueryPais+')') to sQueryPais
34692>>>        
34692>>>        Move "FCL" to sMod
34693>>>        
34693>>>        Clear CSAG340
34694>>>        Move HCGS3004.CSAG320_ID to CSAG340.CSAG320_ID
34695>>>        Find EQ CSAG340 by 2
34696>>>>
34696>>>        If (Found) Begin
34698>>>                If (CSAG340.IND_TER = 'I') Move 'CD' to sTipoCliente
34701>>>                If (CSAG340.IND_TER = 'T') Move 'CL' to sTipoCliente
34704>>>        End 
34704>>>>
34704>>>        Else Move 'CD' to sTipoCliente 
34706>>>        
34706>>>        If (sCidade <> '') Begin
34708>>>
34708>>>            // VERSAO ABERTA PARA TODAS AS CIDADES, POREM SINALIZANDO AS QUE POSSUEM TARIFARIO.
34708>>>            Move "select top 25 C.CODIGO ,C.DESCRICAO ,P.DESCRICAO ,uf.no_uf" to sQuery      
34709>>>        
34709>>>                    Move (sQuery*",TARIFA.CSAG325_ORIGEM") to sQuery
34710>>>        
34710>>>            Move (sQuery*"from dbo.CSAG325 C ") to sQuery
34711>>>            
34711>>>            Move (sQuery*"left join (select distinct AA.CSAG325_ORIGEM from dbo.HCGS3000 AA") to sQuery
34712>>>            Move (sQuery*"where AA.TAXA_CLASSE='F' and (AA.CCGS202_ID='%1' or AA.CCGS202_ID='DTA')") to sQuery
34713>>>            Move (sQuery*"and (AA.ID_TIPO_CLCD='%2' or AA.ID_TIPO_CLCD='AL')") to sQuery
34714>>>            Move (sQuery*"and (TAXA_ID = 9 OR TAXA_ID = 42) and (%3 between AA.DT_INICIAL and AA.DT_FINAL)") to sQuery
34715>>>            Move (sQuery*") TARIFA on (TARIFA.CSAG325_ORIGEM = C.CODIGO)") to sQuery
34716>>>            
34716>>>            //-ADICIONADO OS ESTADOS OU DIVISOES            
34716>>>            Move (sQuery*"left join dbo.CSAG329 P on (P.SIGLA = C.PAIS)") to sQuery
34717>>>            Move (sQuery*"left join dbo.TsubdivisionCode uf") to sQuery
34718>>>            Move (sQuery*"on (C.UF = uf.sg_uf and P.SIGLA_ISO = uf.sg_iso2_country)") to sQuery
34719>>>
34719>>>                        Move (sQuery*"where C.CSAG336_ID=1") to sQuery
34720>>>                        Move (sQuery*"and (C.DESCRICAO like '%4')") to sQuery
34721>>>            Move (SFormat(sQuery,sMod,sTipoCliente,ToSQLDate(dDate),sCidade)) to sQuery
34722>>>
34722>>>            If (sQueryPais) Move (sQuery*SFormat("AND %1", sQueryPais)) to sQuery
34725>>>            
34725>>>            Move (sQuery*"AND TARIFA.CSAG325_ORIGEM <> 0") to sQuery            
34726>>>                        Move (sQuery*"order by TARIFA.CSAG325_ORIGEM desc ,C.DESCRICAO") to sQuery  
34727>>>            
34727>>>            SQL_FIND_BEGIN hStmt_city sQuery
34746>>>>
34746>>>                Move (SizeOfArray(tListaCidadesOrigemProposta)) to iIndex
34747>>>                Move       (Trim(SqlFindValue(hStmt_city,1)))  to tListaCidadesOrigemProposta[iIndex].id
34748>>>                Move       (Trim(SqlFindValue(hStmt_city,3)))  to tListaCidadesOrigemProposta[iIndex].pais
34749>>>                Move (Trim(Uppercase(ToOEM(SqlFindValue(hStmt_city,4))))) to tListaCidadesOrigemProposta[iIndex].uf
34750>>>                
34750>>>                Move (ToOEM(Trim(SqlFindValue(hStmt_city,2)))) to sValue
34751>>>                Move tListaCidadesOrigemProposta[iIndex].uf to sUf
34752>>>                Move (sValue * If(sUf <> '','(' + sUf + ')','') + Trim(SqlFindValue(hStmt_city,3))) to sValue
34753>>>                Move (Trim(sValue)) to tListaCidadesOrigemProposta[iIndex].value
34754>>>
34754>>>            SQL_FIND_END hStmt_city
34761>>>>
34761>>>        End
34761>>>>
34761>>>        
34761>>>        Function_Return tListaCidadesOrigemProposta
34762>>>        
34762>>>    End_Function //propostaCidadeOrigem
34763>>>    
34763>>>    Function multiOrigemCidadeDestino String aUsuarioSessao String sCidade String sPais;                                  String sCliente Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7322 "get_multiOrigemCidadeDestino" "String aUsuarioSessao String sCidade String sPais String sCliente Returns stCityCountryTrade[]" "multiOrigemCidadeDestino"
34767>>>        
34767>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34767>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34768>>>        
34768>>>        String[] arAux
34769>>>        String  sQuery sTipoCliente sValue
34769>>>        String  sICAO sQueryPais sUf
34769>>>        Integer iIndex
34769>>>        String sMod
34769>>>        Date dDate
34769>>>        
34769>>>        Sysdate dDate
34770>>>        
34770>>>        Clear CSAG311
34771>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34772>>>        Find Eq CSAG311 by 1
34773>>>>
34773>>>        If (not(Found)) Function_Return tListaCidadesOrigemProposta
34776>>>        
34776>>>        Move (Ltrim(sCidade))     to sCidade
34777>>>        Move (Trim(sCidade))      to sCidade
34778>>>        Move (Uppercase(sCidade)) to sCidade
34779>>>
34779>>>        Move (Replaces("'", sCidade, "''")) to sCidade
34780>>>        
34780>>>        Move (sCidade+'%') to sCidade
34781>>>        
34781>>>        Move (Trim(sPais)) to sPais
34782>>>        Move (Uppercase(sPais)) to sPais
34783>>>        Move (StrSplitToArray(sPais,',')) to arAux
34784>>>        
34784>>>        For iIndex from 0 to (SizeOfArray(arAux)-1)
34790>>>>
34790>>>            If (sQueryPais = '') Move (SFormat("C.PAIS = '%1'",Trim(arAux[iIndex]))) to  sQueryPais
34793>>>            Else Move (sQueryPais*SFormat("OR C.PAIS = '%1'",Trim(arAux[iIndex]))) to sQueryPais
34795>>>        Loop
34796>>>>
34796>>>        If (sQueryPais <> '') Move ('('+sQueryPais+')') to sQueryPais
34799>>>        
34799>>>        Move "FCL" to sMod
34800>>>        
34800>>>        Clear CSAG340
34801>>>        Move HCGS3004.CSAG320_ID to CSAG340.CSAG320_ID
34802>>>        Find EQ CSAG340 by 2
34803>>>>
34803>>>        If (Found) Begin
34805>>>                If (CSAG340.IND_TER = 'I') Move 'CD' to sTipoCliente
34808>>>                If (CSAG340.IND_TER = 'T') Move 'CL' to sTipoCliente
34811>>>        End 
34811>>>>
34811>>>        Else Move 'CD' to sTipoCliente 
34813>>>        
34813>>>        If (sCidade <> '') Begin
34815>>>
34815>>>            // VERSAO ABERTA PARA TODAS AS CIDADES, POREM SINALIZANDO AS QUE POSSUEM TARIFARIO.
34815>>>            Move "select top 25 C.CODIGO ,C.DESCRICAO ,P.DESCRICAO ,uf.no_uf" to sQuery      
34816>>>        
34816>>>                    Move (sQuery*",TARIFA.CSAG325_DESTINO") to sQuery
34817>>>        
34817>>>            Move (sQuery*"from dbo.CSAG325 C ") to sQuery
34818>>>            
34818>>>            Move (sQuery*"left join (select distinct AA.CSAG325_DESTINO from dbo.HCGS3000 AA") to sQuery
34819>>>            Move (sQuery*"where AA.TAXA_CLASSE='F' and (AA.CCGS202_ID='%1' or AA.CCGS202_ID='DTA')") to sQuery
34820>>>            Move (sQuery*"and (AA.ID_TIPO_CLCD='%2' or AA.ID_TIPO_CLCD='AL')") to sQuery
34821>>>            Move (sQuery*"and (TAXA_ID = 9 OR TAXA_ID = 42) and (%3 between AA.DT_INICIAL and AA.DT_FINAL)") to sQuery
34822>>>            Move (sQuery*") TARIFA on (TARIFA.CSAG325_DESTINO = C.CODIGO)") to sQuery
34823>>>            
34823>>>            //-ADICIONADO OS ESTADOS OU DIVISOES            
34823>>>            Move (sQuery*"left join dbo.CSAG329 P on (P.SIGLA = C.PAIS)") to sQuery
34824>>>            Move (sQuery*"left join dbo.TsubdivisionCode uf") to sQuery
34825>>>            Move (sQuery*"on (C.UF = uf.sg_uf and P.SIGLA_ISO = uf.sg_iso2_country)") to sQuery
34826>>>
34826>>>                        Move (sQuery*"where C.CSAG336_ID=1") to sQuery
34827>>>                        Move (sQuery*"and (C.DESCRICAO like '%4')") to sQuery
34828>>>            Move (SFormat(sQuery,sMod,sTipoCliente,ToSQLDate(dDate),sCidade)) to sQuery
34829>>>
34829>>>            If (sQueryPais) Move (sQuery*SFormat("AND %1", sQueryPais)) to sQuery 
34832>>>            
34832>>>            Move (sQuery*"AND TARIFA.CSAG325_DESTINO <> 0") to sQuery            
34833>>>                        Move (sQuery*"order by TARIFA.CSAG325_DESTINO desc ,C.DESCRICAO") to sQuery  
34834>>>            
34834>>>            SQL_FIND_BEGIN hStmt_city sQuery
34853>>>>
34853>>>                Move (SizeOfArray(tListaCidadesOrigemProposta)) to iIndex
34854>>>                Move       (Trim(SqlFindValue(hStmt_city,1)))  to tListaCidadesOrigemProposta[iIndex].id
34855>>>                Move       (Trim(SqlFindValue(hStmt_city,3)))  to tListaCidadesOrigemProposta[iIndex].pais
34856>>>                Move (Trim(Uppercase(ToOEM(SqlFindValue(hStmt_city,4))))) to tListaCidadesOrigemProposta[iIndex].uf
34857>>>                
34857>>>                Move (ToOEM(Trim(SqlFindValue(hStmt_city,2)))) to sValue
34858>>>                Move tListaCidadesOrigemProposta[iIndex].uf to sUf
34859>>>                Move (sValue * If(sUf <> '','(' + sUf + ')','') + Trim(SqlFindValue(hStmt_city,3))) to sValue
34860>>>                Move (Trim(sValue)) to tListaCidadesOrigemProposta[iIndex].value
34861>>>
34861>>>            SQL_FIND_END hStmt_city
34868>>>>
34868>>>        End
34868>>>>
34868>>>        
34868>>>        Function_Return tListaCidadesOrigemProposta
34869>>>        
34869>>>    End_Function //propostaCidadeOrigem
34870>>>    
34870>>>    Function autoCompleteCity String aUsuarioSessao;                                  String sCidade;                                  String sPais;                                  String sMod;                                  String sCliente;                                 Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7323 "get_autoCompleteCity" "String aUsuarioSessao String sCidade String sPais String sMod String sCliente Returns stCityCountryTrade[]" "autoCompleteCity"
34874>>>        
34874>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34874>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34875>>>        
34875>>>        Move (Ltrim(sCidade))     to sCidade
34876>>>        Move (Trim(sCidade))      to sCidade
34877>>>        Move (Uppercase(sCidade)) to sCidade
34878>>>
34878>>>        Move (Replaces("'", sCidade, "''")) to sCidade
34879>>>        
34879>>>        Move (sCidade+'%')        to sCidade
34880>>>        
34880>>>        Move (Trim(sPais)) to sPais
34881>>>        Move (Uppercase(sPais)) to sPais
34882>>>    
34882>>>        String  sQuery sTipoCliente sValue
34882>>>        String  sICAO sIATA sUf
34882>>>        Integer iIndex
34882>>>        Date dDate
34882>>>        
34882>>>        Sysdate dDate
34883>>>        
34883>>>        Clear CSAG311
34884>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34885>>>        Find Eq CSAG311 by 1
34886>>>>
34886>>>        If (not(Found)) Function_Return tListaCidadesOrigemProposta
34889>>>        
34889>>>        If (sCidade <> '') Begin
34891>>>
34891>>>            // VERSAO ABERTA PARA TODAS AS CIDADES, POREM SINALIZANDO AS QUE POSSUEM TARIFARIO.
34891>>>            Move "select top 25 C.CODIGO ,C.DESCRICAO ,P.DESCRICAO ,uf.no_uf, uf.sg_uf" to sQuery      
34892>>>            Move (sQuery*"from dbo.CSAG325 C ") to sQuery
34893>>>            
34893>>>            //-ADICIONADO OS ESTADOS OU DIVISOES            
34893>>>            Move (sQuery*"left join dbo.CSAG329 P on (P.SIGLA = C.PAIS)") to sQuery
34894>>>            Move (sQuery*"left join dbo.TsubdivisionCode uf") to sQuery
34895>>>            Move (sQuery*"on (C.UF = uf.sg_uf and P.SIGLA_ISO = uf.sg_iso2_country)") to sQuery
34896>>>
34896>>>                        Move (sQuery*"where C.CSAG336_ID=1") to sQuery
34897>>>                                
34897>>>                        Move (sQuery*"and (C.DESCRICAO like '%1')") to sQuery
34898>>>
34898>>>            Move (SFormat(sQuery,sCidade)) to sQuery
34899>>>
34899>>>            If (sPais) Move (sQuery*SFormat("and C.PAIS = '%1'", sPais)) to sQuery 
34902>>>                
34902>>>                        Move (sQuery*"order by C.DESCRICAO") to sQuery  
34903>>>            
34903>>>            SQL_FIND_BEGIN hStmt_city sQuery
34922>>>>
34922>>>
34922>>>                Move (SizeOfArray(tListaCidadesOrigemProposta)) to iIndex
34923>>>                Move       (Trim(SqlFindValue(hStmt_city,1)))  to tListaCidadesOrigemProposta[iIndex].id
34924>>>                Move       (Trim(SqlFindValue(hStmt_city,3)))  to tListaCidadesOrigemProposta[iIndex].pais
34925>>>                
34925>>>                Move ( ToOEM(Trim(SqlFindValue(hStmt_city,2))) ) to sValue
34926>>>                Move '' to tListaCidadesOrigemProposta[iIndex].port
34927>>>            
34927>>>                Move (Trim(Uppercase(ToOEM(SqlFindValue(hStmt_city,4))))) to sUf
34928>>>                Move (sValue + If(sUf <> '',' (' + sUf + ') - ', ' - ') + Trim(SqlFindValue(hStmt_city,3))) to sValue
34929>>>                Move (Trim(sValue)) to tListaCidadesOrigemProposta[iIndex].value
34930>>>                
34930>>>                Move (Trim(Uppercase(ToOEM(SqlFindValue(hStmt_city,5))))) to tListaCidadesOrigemProposta[iIndex].uf
34931>>>
34931>>>            SQL_FIND_END hStmt_city
34938>>>>
34938>>>        End
34938>>>>
34938>>>        
34938>>>        Function_Return tListaCidadesOrigemProposta
34939>>>        
34939>>>    End_Function //autoCompleteCity
34940>>>    
34940>>>    Function autoCompleteAirport String aUsuarioSessao String sCidade Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7324 "get_autoCompleteAirport" "String aUsuarioSessao String sCidade Returns stCityCountryTrade[]" "autoCompleteAirport"
34944>>>        
34944>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34944>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
34945>>>        
34945>>>        Move (Ltrim(sCidade))     to sCidade
34946>>>        Move (Trim(sCidade))      to sCidade
34947>>>        Move (Uppercase(sCidade)) to sCidade
34948>>>
34948>>>        Move (Replaces("'", sCidade, "''")) to sCidade
34949>>>        
34949>>>        Move (sCidade+'%')        to sCidade
34950>>>        
34950>>>        String  sQuery sTipoCliente sValue
34950>>>        String  sICAO sIATA sUf
34950>>>        Integer iIndex
34950>>>        Date dDate
34950>>>        
34950>>>        Sysdate dDate
34951>>>        
34951>>>        Clear CSAG311
34952>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34953>>>        Find Eq CSAG311 by 1
34954>>>>
34954>>>        If (not(Found)) Function_Return tListaCidadesOrigemProposta
34957>>>        
34957>>>        If (sCidade <> '') Begin
34959>>>
34959>>>            // VERSAO ABERTA PARA TODAS AS CIDADES, POREM SINALIZANDO AS QUE POSSUEM TARIFARIO.
34959>>>            Move "select top 25 C.CODIGO ,C.DESCRICAO ,P.DESCRICAO ,uf.no_uf" to sQuery      
34960>>>                Move (sQuery*",(case when AIR.IATA is null then '' else AIR.IATA end) IATA") to sQuery
34961>>>                        Move (sQuery*",(case when AIR.NAME is null then '' else AIR.NAME end) AIRPORT") to sQuery
34962>>>                        
34962>>>            Move (sQuery*"from dbo.CSAG325 C ") to sQuery
34963>>>            
34963>>>                Move (sQuery*"inner join dbo.HSAG325_AIR AIR on (AIR.CSAG325_ID = C.CODIGO)") to sQuery
34964>>>            
34964>>>            //-ADICIONADO OS ESTADOS OU DIVISOES            
34964>>>            Move (sQuery*"left join dbo.CSAG329 P on (P.SIGLA = C.PAIS)") to sQuery
34965>>>            Move (sQuery*"left join dbo.TsubdivisionCode uf") to sQuery
34966>>>            Move (sQuery*"on (C.UF = uf.sg_uf and P.SIGLA_ISO = uf.sg_iso2_country)") to sQuery
34967>>>
34967>>>                        Move (sQuery*"where C.CSAG336_ID=1") to sQuery
34968>>>                                
34968>>>                        Move (sQuery*"and (C.DESCRICAO like '%1' or AIR.NAME like '%1' or AIR.IATA like '%1')") to sQuery
34969>>>                        
34969>>>            Move (SFormat(sQuery,sCidade)) to sQuery
34970>>>
34970>>>                Move (sQuery*"order by AIR.IATA ,C.DESCRICAO ,AIR.NAME") to sQuery  
34971>>>            
34971>>>            SQL_FIND_BEGIN hStmt_city sQuery
34990>>>>
34990>>>                Move (SizeOfArray(tListaCidadesOrigemProposta)) to iIndex
34991>>>                Move       (Trim(SqlFindValue(hStmt_city,1)))  to tListaCidadesOrigemProposta[iIndex].id
34992>>>                Move       (Trim(SqlFindValue(hStmt_city,3)))  to tListaCidadesOrigemProposta[iIndex].pais
34993>>>                Move (Trim(Uppercase(ToOEM(SqlFindValue(hStmt_city,4))))) to tListaCidadesOrigemProposta[iIndex].uf
34994>>>                
34994>>>               
34994>>>                Move (Trim(SqlFindValue(hStmt_city,6))) to tListaCidadesOrigemProposta[iIndex].iata // IATA
34995>>>                
34995>>>                Move tListaCidadesOrigemProposta[iIndex].iata to sIATA
34996>>>                
34996>>>                Move ( If(sIATA  <> '', sIATA + ' - ','') + ToOEM(Trim(SqlFindValue(hStmt_city,7))) ) to sValue //NOME AEROPORTO
34997>>>                Move ( sValue + If(sValue <> '', ', ','') + ToOEM(Trim(SqlFindValue(hStmt_city,2))) ) to sValue //CIDADE
34998>>>
34998>>>                Move tListaCidadesOrigemProposta[iIndex].uf to sUf
34999>>>                Move (sValue + If(sUf <> '',' (' + sUf + ') - ', ' - ') + Trim(SqlFindValue(hStmt_city,3))) to sValue
35000>>>
35000>>>                Move (Trim(sValue)) to tListaCidadesOrigemProposta[iIndex].value
35001>>>            SQL_FIND_END hStmt_city
35008>>>>
35008>>>        End
35008>>>>
35008>>>        
35008>>>        Function_Return tListaCidadesOrigemProposta
35009>>>        
35009>>>    End_Function //autoCompleteAirport
35010>>>    
35010>>>    Function propostaOrigemDestino String aUsuarioSessao;                                   String aCidade;                                   String aPaisSiglaIso;                                   String aCliente;                                   String aPais;                                      String aMod;                                     Returns stCityCountryTrade[]
#REM SEND REGISTERINTERFACE |CI7325 "get_propostaOrigemDestino" "String aUsuarioSessao String aCidade String aPaisSiglaIso String aCliente String aPais String aMod Returns stCityCountryTrade[]" "propostaOrigemDestino"
35014>>>        
35014>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
35014>>>        stCityCountryTrade[] tListaCidadesOrigemProposta
35015>>>        
35015>>>        Move (Ltrim(aCidade))     to aCidade
35016>>>        Move (Trim(aCidade))      to aCidade
35017>>>        Move (Uppercase(aCidade)) to aCidade
35018>>>
35018>>>        Move (Replaces("'", aCidade, "''")) to aCidade
35019>>>        
35019>>>        Move (aCidade+'%')        to aCidade
35020>>>        
35020>>>        Move (Trim(aPaisSiglaIso)) to aPaisSiglaIso
35021>>>        Move (Uppercase(aPaisSiglaIso)) to aPaisSiglaIso
35022>>>    
35022>>>        String  sQuery sTipoCliente sValue
35022>>>        String  sICAO sIATA sUf
35022>>>        Integer iIndex
35022>>>        Date dDate
35022>>>        
35022>>>        Sysdate dDate
35023>>>        
35023>>>        Clear CSAG311
35024>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
35025>>>        Find Eq CSAG311 by 1
35026>>>>
35026>>>        If (not(Found)) Function_Return tListaCidadesOrigemProposta
35029>>>        
35029>>>        Clear CSAG340
35030>>>        Move aCliente to CSAG340.CSAG320_ID
35031>>>        Find EQ CSAG340 by 2
35032>>>>
35032>>>        If (Found) Begin
35034>>>                If (CSAG340.IND_TER = 'I') Move 'CD' to sTipoCliente
35037>>>                If (CSAG340.IND_TER = 'T') Move 'CL' to sTipoCliente
35040>>>        End
35040>>>>
35040>>>        Else Move 'CD' to sTipoCliente 
35042>>>        
35042>>>        If (aCidade <> '') Begin
35044>>>
35044>>>            CREATE_MAIN_CONNECTION BYFILE CSAG325
35049>>>>
35049>>>            
35049>>>            Move "select top 25" to sQuery   
35050>>>            Move (sQuery*"cid.codigo as codcidade") to sQuery 
35051>>>            Move (sQuery*",rtrim(ltrim(pais.DESCRICAO)) as PAIS") to sQuery
35052>>>            Move (sQuery*",rtrim(ltrim(cid.DESCRICAO)) as CIDADE") to sQuery 
35053>>>            Move (sQuery*",cid.UF ,coalesce(uf.no_UF,'') as State_Province_Comune") to sQuery 
35054>>>            Move (sQuery*",cat.Name as categoria") to sQuery 
35055>>>            Move (sQuery*",pais.SIGLA_ISO, cid.CITY_CODE, (pais.SIGLA_ISO + cid.CITY_CODE) as UNLOCODE") to sQuery 
35056>>>        
35056>>>                        If (aMod = 'AIR') Begin
35058>>>                            Move (sQuery*",tarifa.ORG_IATA") to sQuery
35059>>>                                Move (sQuery*",(case when AIR.IATA is null then '' else AIR.IATA end) IATA") to sQuery
35060>>>                                Move (sQuery*",(case when AIR.NAME is null then '' else AIR.NAME end) AIRPORT") to sQuery
35061>>>                        End
35061>>>>
35061>>>                        Else Begin
35062>>>                            Move (sQuery*",tarifa.CSAG325_ORIGEM") to sQuery
35063>>>            End
35063>>>>
35063>>>        
35063>>>            Move (sQuery*"from dbo.CSAG325 cid ") to sQuery
35064>>>            
35064>>>            If (aMod = 'AIR') Begin
35066>>>                                Move (sQuery*"inner join dbo.HSAG325_AIR air on (air.CSAG325_ID = cid.CODIGO)") to sQuery
35067>>>                Move (sQuery*"left join (select distinct AA.ORG_IATA from dbo.HCGS3000_AIRFR8 AA") to sQuery
35068>>>                Move (sQuery*"where %3 <= AA.VALID_UNTIL) tarifa on (tarifa.ORG_IATA = air.IATA)") to sQuery
35069>>>            End
35069>>>>
35069>>>            Else Begin
35070>>>                Move (sQuery*"left join (select distinct AA.CSAG325_ORIGEM from dbo.HCGS3000 AA") to sQuery
35071>>>                Move (sQuery*"where AA.TAXA_CLASSE='F' and (AA.CCGS202_ID='%1' or AA.CCGS202_ID='DTA')") to sQuery
35072>>>                Move (sQuery*"and (AA.ID_TIPO_CLCD='%2' or AA.ID_TIPO_CLCD='AL')") to sQuery
35073>>>                Move (sQuery*"and (AA.TAXA_ID = 9 OR AA.TAXA_ID = 42) and (%3 between AA.DT_INICIAL and AA.DT_FINAL)") to sQuery
35074>>>                Move (sQuery*") tarifa on (tarifa.CSAG325_ORIGEM = cid.CODIGO)") to sQuery
35075>>>            End
35075>>>>
35075>>>            
35075>>>            //-ADICIONADO OS ESTADOS OU DIVISOES            
35075>>>            Move (sQuery*"inner join dbo.CSAG329 pais on (pais.SIGLA = cid.PAIS)") to sQuery
35076>>>            Move (sQuery*"left join dbo.TsubdivisionCode uf") to sQuery
35077>>>            Move (sQuery*"on (cid.UF = uf.sg_uf and pais.SIGLA_ISO = uf.sg_iso2_country)") to sQuery
35078>>>            
35078>>>            Move (sQuery*"left join dbo.CityCityCategories catcid on (cid.CODIGO = catcid.CityId)") to sQuery
35079>>>            Move (sQuery*"left join dbo.CityCategories cat on (catcid.citycategoryid = cat.Id)") to sQuery  
35080>>>            
35080>>>                        Move (sQuery*"where cid.CSAG336_ID=1") to sQuery
35081>>>                                
35081>>>                        If (aMod = 'AIR');                                Move (sQuery*"and (cid.DESCRICAO like '%4' or air.NAME like '%4' or air.IATA like '%4')") to sQuery
35084>>>                        Else;                Move (sQuery*"and rtrim(ltrim(cid.DESCRICAO)) like '%4'") to sQuery
35086>>>
35086>>>            Move (SFormat(sQuery,aMod,sTipoCliente,ToSQLDate(dDate),aCidade)) to sQuery
35087>>>
35087>>>            If (aPais <> "");                Move (sQuery*SFormat("and cid.PAIS = '%1'", aPais)) to sQuery 
35090>>>            If (aPaisSiglaIso <> "");                Move (sQuery*SFormat("and (pais.SIGLA_ISO + cid.CITY_CODE) like '%1___'", aPaisSiglaIso)) to sQuery 
35093>>>                
35093>>>            If (aMod = 'AIR');                 Move (sQuery*"and cat.id = 5") to sQuery
35096>>>            Else;                Move (sQuery*"and cat.id = 2") to sQuery 
35098>>>                
35098>>>                        If (aMod = 'AIR');                                Move (sQuery*"order by cid.PAIS ,tarifa.ORG_IATA desc ,air.IATA ,cid.DESCRICAO ,air.NAME") to sQuery  
35101>>>                        Else;                                Move (sQuery*"order by cid.PAIS ,tarifa.CSAG325_ORIGEM desc ,cid.DESCRICAO") to sQuery  
35103>>>            
35103>>>            SQL_FIND_BEGIN hStmt_city sQuery
35122>>>>
35122>>>                Move (SizeOfArray(tListaCidadesOrigemProposta)) to iIndex
35123>>>                Move       (Trim(SqlFindValue(hStmt_city,1)))             to tListaCidadesOrigemProposta[iIndex].id
35124>>>                Move       (Trim(SqlFindValue(hStmt_city,2)))             to tListaCidadesOrigemProposta[iIndex].pais
35125>>>                Move (Trim(Uppercase(ToOEM(SqlFindValue(hStmt_city,5))))) to tListaCidadesOrigemProposta[iIndex].uf
35126>>>                Move (Trim(SqlFindValue(hStmt_city,6)))                   to tListaCidadesOrigemProposta[iIndex].port
35127>>>                             
35127>>>                Move "%4 - %1 (%2) - %3" to sValue
35128>>>                Move (SFormat(sValue;                                , Uppercase(Trim(ToOEM(SqlFindValue(hStmt_city,3))));                                , Uppercase(Trim(ToOEM(SqlFindValue(hStmt_city,5))));                                , Uppercase(Trim(ToOEM(SqlFindValue(hStmt_city,2))));                                , Trim(SqlFindValue(hStmt_city,9)) ))     to tListaCidadesOrigemProposta[iIndex].value
35129>>>                        
35129>>>                If (aMod = 'AIR') If (SqlFindValue(hStmt_city,10) <> "") Move (tListaCidadesOrigemProposta[iIndex].value*"- POSSUI FRETE") to tListaCidadesOrigemProposta[iIndex].value //
35134>>>                Else If (SqlFindValue(hStmt_city,10) > 0)                Move (tListaCidadesOrigemProposta[iIndex].value*"- POSSUI FRETE") to tListaCidadesOrigemProposta[iIndex].value //
35138>>>            SQL_FIND_END hStmt_city
35145>>>>
35145>>>        End
35145>>>>
35145>>>        
35145>>>        Function_Return tListaCidadesOrigemProposta
35146>>>        
35146>>>    End_Function //propostaOrigemDestino
35147>>>    
35147>>>    Function descricaoOrigemDestino String aUsuarioSessao;                                    String aCodigo;                                    Returns String
35150>>>        
35150>>>        String sQuery 
35150>>>        String sValue
35150>>>        String sRetorno
35150>>>        
35150>>>        Clear CSAG311
35151>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
35152>>>        Find Eq CSAG311 by 1
35153>>>>
35153>>>        If (not(Found)) Function_Return sRetorno
35156>>>                
35156>>>        Move "select cid.codigo as codcidade" to sQuery
35157>>>        Move (sQuery * ",rtrim(ltrim(p.DESCRICAO)) as PAIS") to sQuery
35158>>>        Move (sQuery * ",rtrim(ltrim(cid.DESCRICAO)) as CIDADE") to sQuery
35159>>>        Move (sQuery * ",cid.UF") to sQuery
35160>>>        Move (sQuery * ",coalesce(uf.no_UF,'') as State_Province_Comune") to sQuery
35161>>>        Move (sQuery * ",cat.Name as categoria") to sQuery
35162>>>        Move (sQuery * ", p.SIGLA_ISO, cid.CITY_CODE,") to sQuery
35163>>>        Move (sQuery * "(p.SIGLA_ISO + cid.CITY_CODE) as UNLOCODE") to sQuery
35164>>>        Move (sQuery * "from dbo.CSAG325 cid") to sQuery
35165>>>        Move (sQuery * "inner join dbo.csag329 p on (cid.PAIS = p.SIGLA)") to sQuery
35166>>>        Move (sQuery * "left join dbo.TsubdivisionCode uf on (cid.UF = uf.sg_uf and p.sigla_iso = uf.sg_iso2_country)") to sQuery
35167>>>        Move (sQuery * "left join dbo.CityCityCategories catcid on (cid.CODIGO = catcid.CityId)") to sQuery
35168>>>        Move (sQuery * "left join dbo.CityCategories cat on (catcid.citycategoryid = cat.Id)") to sQuery
35169>>>        Move (sQuery * "where") to sQuery
35170>>>        Move (sQuery * "cid.CODIGO = %1") to sQuery
35171>>>        Move (sQuery * "and cid.CSAG336_ID = 1") to sQuery
35172>>>        Move (sQuery * "and cat.id = 2 --porto") to sQuery
35173>>>        
35173>>>        Move (SFormat(sQuery, aCodigo)) to sQuery        
35174>>>        
35174>>>        SQL_FIND_BEGIN hStmt_city sQuery
35193>>>>
35193>>>            Move "%4 - %1 (%2) - %3" to sValue
35194>>>            Move (SFormat(sValue;                            , Uppercase(Trim(ToOEM(SqlFindValue(hStmt_city,3))));                            , Uppercase(Trim(ToOEM(SqlFindValue(hStmt_city,5))));                            , Uppercase(Trim(ToOEM(SqlFindValue(hStmt_city,2))));                            , Trim(SqlFindValue(hStmt_city,9)) ))     to sRetorno
35195>>>        SQL_FIND_END hStmt_city
35202>>>>
35202>>>        
35202>>>        Function_Return sRetorno
35203>>>        
35203>>>    End_Function //descricaoOrigemDestino
35204>>>    
35204>>>End_Object //ows_CSAG325
35205>                                         
35205>    Procedure StartWebApp //************************** MELHOR LUGAR AQUI
35208>        Send CreateComObject to oParser
35209>        If (IsNullComObject(pvComObject(oParser(Self)))) Begin
35211>            Error 255 "Unable to create Parser"
35212>        End
35212>        Forward Send StartWebApp
35214>        CREATE_MAIN_CONNECTION BYFILE CSAG300
35219>    End_Procedure // StartWebApp    
35220>
35220>End_Object
35221>
35221>Send StartWebApp of oWebApp
35222>
Summary
Memory Available: 2147483646
Total Warnings : 0
Total Errors   : 0
Total Symbols  : 23497
Total Resources: 0
Total Commands : 35221
Total Windows  : 1
Total Pages    : 1
Static Data    : 383155
Message area   : 216435
Total Blocks   : 14745
