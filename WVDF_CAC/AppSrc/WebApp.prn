Compiling Program: C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\WebApp.src
Memory Available: 2147483646
1>//-2WA
1>Use AllWebAppClasses.pkg
Using pre-compiled package ALLWEBAPPCLASSES.PKG
Including file: AllWebAppClasses.pkd    (C:\Program Files (x86)\DataFlex 18.2\Pkg\AllWebAppClasses.pkd)
29136>
29136>Register_Object oApplication
29136>Register_Object oWebApp
29136>
29136>Use WinUser.pkg
29136>Use Func.pkg
Including file: func.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\func.pkg)
29136>>>// FUNC.PKG
29136>>>// New global DataFlex functions
29136>>>// Doug Goldner  2/25/91
29136>>>
29136>>>//
29136>>>// OBSOLETE - This package is included for backwards compatibility .
29136>>>//            Do not use these for new programs and attempt to replace these
29136>>>//            with your own package as soon as possible.
29136>>>//
29136>>>Use LanguageText.pkg
29136>>>
29136>>>use VDFBase.pkg
29136>>>
29136>>>Object Eng_Month_Name is an Array 
29138>>>    Set value item  1 to "January"  
29139>>>    Set value item  2 to "February" 
29140>>>    Set value item  3 to "March"    
29141>>>    Set value item  4 to "April"    
29142>>>    Set value item  5 to "May"      
29143>>>    Set value item  6 to "June"     
29144>>>    Set value item  7 to "July"     
29145>>>    Set value item  8 to "August"   
29146>>>    Set value item  9 to "September"
29147>>>    Set value item 10 to "October"  
29148>>>    Set value item 11 to "November" 
29149>>>    Set value item 12 to "December" 
29150>>>End_Object // Eng_Month_Name
29151>>>
29151>>>Object Pbr_Month_Name is an Array 
29153>>>    Set value item  1 to "Janeiro"  
29154>>>    Set value item  2 to "Fevereiro" 
29155>>>    Set value item  3 to "Marco"    
29156>>>    Set value item  4 to "Abril"    
29157>>>    Set value item  5 to "Maio"      
29158>>>    Set value item  6 to "Junho"     
29159>>>    Set value item  7 to "Julho"     
29160>>>    Set value item  8 to "Agosto"   
29161>>>    Set value item  9 to "Setembro"
29162>>>    Set value item 10 to "Outubro"  
29163>>>    Set value item 11 to "Novembro" 
29164>>>    Set value item 12 to "Dezembro" 
29165>>>End_Object // Pbr_Month_Name
29166>>>
29166>>>function get_month global string our_date$ returns integer
29168>>>   function_return (left(our_date$,2))
29169>>>end_function
29170>>>
29170>>>function get_day global string our_date$ returns integer
29172>>>   function_return (mid(our_date$,2,4))
29173>>>end_function
29174>>>
29174>>>function get_year global string our_date$ returns integer
29176>>>   function_return (mid(our_date$,4,7))
29177>>>end_function
29178>>>
29178>>>function get_current_hour global returns string
29180>>>   date tdate$
29180>>>   string our_hour$
29180>>>
29180>>>   sysdate tdate$ our_hour$
29182>>>   if our_hour$ lt 10 insert "0" in our_hour$ at 0
29186>>>   function_return our_hour$
29187>>>end_function
29188>>>
29188>>>function get_current_minute global returns string
29190>>>   date tdate$
29190>>>   string our_hour$ our_minute$
29190>>>
29190>>>   sysdate tdate$ our_hour$ our_minute$
29193>>>   if our_minute$ lt 10 insert "0" in our_minute$ at 0
29197>>>   function_return our_minute$
29198>>>end_function
29199>>>
29199>>>function get_current_second global returns string
29201>>>   date tdate$
29201>>>   String our_hour$ our_minute$ our_second$
29201>>>
29201>>>   sysdate tdate$ our_hour$ our_minute$ our_second$
29205>>>   if our_second$ lt 10 insert "0" in our_second$ at 0
29209>>>   function_return our_second$
29210>>>end_function
29211>>>
29211>>>function get_hour global string our_time$ returns string
29213>>>   function_return (left(our_time$,2))
29214>>>end_function
29215>>>
29215>>>function get_minute global string our_time$ returns string
29217>>>   function_return (mid(our_time$,2,4))
29218>>>end_function
29219>>>
29219>>>function get_second global string our_time$ returns string
29221>>>   function_return (mid(our_time$,2,7))
29222>>>end_function
29223>>>
29223>>>function get_time global string hr$ string min$ string sec$ integer am_pm_wanted$ returns string
29225>>>   String am_pm$ time_string$
29225>>>
29225>>>   move C_$AM to am_pm$
29226>>>
29226>>>   if hr$ gt 11 move C_$PM to am_pm$
29229>>>   if hr$ lt 1 begin
29231>>>      move 12 to hr$
29232>>>      move C_$AM to am_pm$
29233>>>   end
29233>>>>
29233>>>   if am_pm_wanted$ eq 1 if hr$ gt 12 move (hr$ - 12) to hr$
29238>>>   if hr$ lt 10 insert "0" in hr$ at 0
29242>>>   if min$ lt 10 insert "0" in min$ at 0
29246>>>   if sec$ lt 10 insert "0" in sec$ at 0
29250>>>   move hr$ to time_string$
29251>>>   append time_string$ ":" min$ ":" sec$
29255>>>   if am_pm_wanted$ eq 1 append time_string$ " " am_pm$
29259>>>   function_return time_string$
29260>>>end_function
29261>>>
29261>>>function get_time_no_sec global string hr$ string min$ integer am_pm_wanted$ returns string
29263>>>   String am_pm$ time_string$
29263>>>
29263>>>   move C_$AM to am_pm$
29264>>>
29264>>>   if hr$ gt 11 move C_$PM to am_pm$
29267>>>   if hr$ lt 1 begin
29269>>>      move 12 to hr$
29270>>>      move C_$AM to am_pm$
29271>>>   end
29271>>>>
29271>>>   if am_pm_wanted$ eq 1 if hr$ gt 12 move (hr$ - 12) to hr$
29276>>>   if hr$ lt 10 insert "0" in hr$ at 0
29280>>>   if min$ lt 10 insert "0" in min$ at 0
29284>>>   move hr$ to time_string$
29285>>>   append time_string$ ":" min$
29287>>>   if am_pm_wanted$ eq 1 append time_string$ " " am_pm$
29291>>>   function_return time_string$
29292>>>end_function
29293>>>
29293>>>function get_current_time global integer am_pm_wanted$ returns string
29295>>>   date tdate$
29295>>>   string hr$ min$ sec$
29295>>>
29295>>>   sysdate tdate$ hr$ min$ sec$
29299>>>   function_return (get_time(hr$,min$,sec$,am_pm_wanted$))
29300>>>end_function
29301>>>
29301>>>
29301>>>
29301>>>function get_current_time_no_sec global integer am_pm_wanted$ returns string
29303>>>   date tdate$
29303>>>   String hr$ min$
29303>>>
29303>>>   sysdate tdate$ hr$ min$
29306>>>   function_return (get_time_no_sec(hr$,min$,am_pm_wanted$))
29307>>>end_function
29308>>>
29308>>>function get_word_date global string our_date$ returns string
29310>>>   integer month$
29310>>>   string month_name$
29310>>>   string total_date$
29310>>>   String our_year$
29310>>>   move (get_month(our_date$)) to month$
29311>>>   if month$ eq 1 move C_$January to month_name$
29314>>>   if month$ eq 2 move C_$February to month_name$
29317>>>   if month$ eq 3 move C_$March to month_name$
29320>>>   if month$ eq 4 move C_$April to month_name$
29323>>>   if month$ eq 5 move C_$May to month_name$
29326>>>   if month$ eq 6 move C_$June to month_name$
29329>>>   if month$ eq 7 move C_$July to month_name$
29332>>>   if month$ eq 8 move C_$August to month_name$
29335>>>   if month$ eq 9 move C_$September to month_name$
29338>>>   if month$ eq 10 move C_$October to month_name$
29341>>>   if month$ eq 11 move C_$November to month_name$
29344>>>   if month$ eq 12 move C_$December to month_name$
29347>>>   move month_name$ to total_date$
29348>>>   append total_date$ " " (get_day(our_date$)) ", "
29351>>>   move (get_year(our_date$)) to our_year$
29352>>>   if (length(our_year$)) lt 2 insert "0" in our_year$ at 0
29356>>>   if (length(our_year$)) lt 4 insert "19" in our_year$ at 0
29360>>>   append total_date$ our_year$
29361>>>   function_return total_date$
29362>>>
29362>>>end_function
29363>>>
29363>>>function get_title global string our_word$ returns string
29365>>>   integer lvar$
29365>>>   string title_word$
29365>>>   integer upper_next$
29365>>>   String our_letter$
29365>>>
29365>>>   move 1 to upper_next$
29366>>>   move "" to title_word$
29367>>>
29367>>>   for lvar$ from 1 to (length(our_word$))
29373>>>>
29373>>>      mid our_word$ to our_letter$ 1 lvar$
29376>>>>
29376>>>      if our_letter$ eq " " begin
29378>>>         append title_word$ " "
29379>>>         move 1 to upper_next$
29380>>>      end
29380>>>>
29380>>>      else begin
29381>>>         if upper_next$ eq 1 append title_word$ (uppercase(our_letter$))
29384>>>         else append title_word$ our_letter$
29386>>>         move 0 to upper_next$
29387>>>      end
29387>>>>
29387>>>   loop
29388>>>>
29388>>>   function_return title_word$
29389>>>end_function
29390>>>
29390>>>function get_file_exists global string filename$ returns integer
29392>>>   Integer exists$
29392>>>   direct_input channel 9 filename$
29394>>>   [seqeof] move 0 to exists$
29395>>>   [not seqeof] move 1 to exists$
29396>>>   close_input channel 9
29398>>>   function_return exists$
29399>>>end_function
29400>>>
29400>>>function get_time_difference_no_sec global integer hr1$ integer min1$ integer hr2$ integer min2$ ;                                    returns string
29402>>>
29402>>>   function_return (get_time_no_sec(abs(hr1$ - hr2$),abs(min1$ - min2$),0))
29403>>>end_function
29404>>>
29404>>>function get_time_difference global integer hr1$ integer min1$ integer sec1$ integer hr2$ integer min2$ integer sec2$ returns string
29406>>>
29406>>>   function_return (get_time(abs(hr1$ - hr2$),abs(min1$ - min2$),abs(sec1$ - sec2$),0))
29407>>>end_function // get_time_difference
29408>>>
29408>>>//  Set date to current window if the window is blank
29408>>>// this is very, very obsolete. Avoid!
29408>>>procedure default_date for cUIObject integer item#
29410>>>  String dte
29410>>>  if ( (not(item_changed_state(self,item#)) and ;       value(self,item#)=0)) begin
29412>>>     sysdate dte
29413>>>     set value item item# to dte
29414>>>     set item_changed_state item item# to true
29415>>>  end
29415>>>>
29415>>>End_Procedure // default_date
29416>>>
29416>>>Function get_SysDate Global Integer iNone Returns Date
29418>>>    Date dDte
29418>>>    Sysdate dDte
29419>>>    Function_Return dDte
29420>>>End_Function // Get_SysDate    
29421>>>
29421>>>
29421>
29421>    Integer giIdUsuario
29421>
29421>    String gsIPComputer
29421>
29421>Set_Argument_Size 1024000
29422>Define Week_Length for |CI7
29422>Define Day_Length  for |CI1440
29422>Define Hour_Length for |CI60
29422>
29422>Use cApplication.pkg
29422>Use cWebApp.pkg
29422>Use vWin32fh.pkg
Including file: vWin32fh.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\vWin32fh.pkg)
29422>>>//-2WA
29422>>>// This code is part of VDF GUIdance
29422>>>// Visit us @ http://www.vdf-guidance.com
29422>>>// e-Mail us @ info@vdf-guidance.com
29422>>>// VDF GUIdance is a mutual project of
29422>>>// Frank Vandervelpen - Vandervelpen Systems and
29422>>>// Wil van Antwerpen  - Antwise Solutions
29422>>>// All software source code should be used <<AS IS>> without any warranty.
29422>>>//
29422>>>//
29422>>>// *** Windows 32bit file handling wrapper class ***
29422>>>//
29422>>>
29422>>>// 05-09-2000 **WvA: Changed namingconvention of all classes and methods to new standard
29422>>>//                   This may be painfull for some of you, but it was really needed as it was
29422>>>//                   getting messy. The "vs" -prefix we used before was confusing and could
29422>>>//                   unintentionally have been interpreted as "Vdf-GUIdance String".
29422>>>//
29422>>>// The used naming-convention is:
29422>>>//     - a prefix of "vWin32_" for every external function declaration
29422>>>//     - a prefix of the letter "v" for the full API name for the vdf-wrapper function.
29422>>>//
29422>>>// By using this we are guarding ourselves for conflicts with variable declarations
29422>>>// of DataAccess in the future.
29422>>>// Or at least almost as the letter "v" is now also synonym for variant (duh~!)
29422>>>//
29422>>>// mm-dd-yyyy Author Description
29422>>>//
29422>>>//                   vSHGetFolderPath added to retrieve the new shell folders
29422>>>//                   vGetWindowsDirectory
29422>>>//
29422>>>//                   vGetTempFileName
29422>>>//                   vGetTempPath
29422>>>// 11-17-2001 **WvA: Removed User Interface Error popups such as Error handling.
29422>>>//                   This is an absolute need for WebApp. We expect you to handle the
29422>>>//                   error in your application anyways. Changed this for:
29422>>>//                   vDeleteFile, vCopyFile, vMoveFile and vRenameFile
29422>>>// 03-02-2002 **WvA: vRemoveDirectory added
29422>>>// 03-11-2002 **WvA: The parameter lpdword in the external function declaration for
29422>>>//                   vWin32_SHBrowsForFolder can cause compiler errors.
29422>>>//                   It is renamed too avoid this.
29422>>>// 11-11-2002 **WvA: Codecleanup, vcSelectFile_Dialog is now cvSelectFile_Dialog, its
29422>>>//                   function vSelectedFileName is now just SelectedFileName
29422>>>//                   Removed the local keyword in the variable declarations
29422>>>// 10-17-2003 **WvA: Cleaned up function vSelect_File and added code to destroy the dynamically 
29422>>>//                   created file-open dialog
29422>>>// 02-12-2004 **WvA: Allan Ankerstjeme pointed me into a bug for the vCreateTempFileInPath
29422>>>//                   in that it didn't exactly return the correct filename of the file created.
29422>>>//                   This has now been taken care of.
29422>>>// 02-19-2004 **WvA: Removed all API declarations from the package itself to improve readability
29422>>>//                   These declarations are now included from the vWin32fh header file.
29422>>>// 02-19-2004 **WvA: Changed the default way in which the standard file handling works
29422>>>//                   Before today one could always undo the operation, as of now you cannot as
29422>>>//                   the default was a silly one using unnecessary resources (mainly diskspace)
29422>>>//                   Since i don't really expect someone to use that feature it has been removed.
29422>>>//                   One can however restore to the old way of handling by simply calling the
29422>>>//                   vWin32fhCompatibilityMode procedure ONE time before accessing any of the 
29422>>>//                   filehandling operations
29422>>>// 02-19-2004 **WvA: The functions ParseFolderName, ParseFileName and ParseFileExtenstion added
29422>>>//                   as well as the StringFromRightOfChar function.
29422>>>// 02-19-2004 **WvA: sfoFormatDisk function added which can use to format a floppydisk
29422>>>//                   DISABLED now as testing shows that it does not work as advertised...
29422>>>// 02-20-2004 **WvA: The function vDDE_Error_Handler didn't pass the errornumber on to the DDE_Error_To_String function
29422>>>//                   Moved the hardcoded strings from vDDE_Error_Handler to define declarations for easier translation later on.
29422>>>// 09-10-2004 **WvA: Added the ToAnsi function to the fileoperations method so that
29422>>>//                   extended characters are treated ok too.
29422>>>//                   Reported by Flemming from
29422>>>// 12-17-2004 **WvA: Changed vFilePathExists to be global, reported by Peter van Mil
29422>>>// 12-28-2004 **WvA: WebApp compatibility added by introducing compiler directives
29422>>>// 03-10-2006 **WvA: Added more CSIDL types to our header file for use with the vSHGetFolderPath function
29422>>>// 01-02-2007 **WvA: Set NoChangeDir_State on vSelect_File and vSelectSaveFile to True but changed it back due to side effects.
29422>>>//                   Added vSelectSavefile function to create a file save dialog
29422>>>//                   Fixed ParseFolderName which was horribly broken (thanks for the reports)
29422>>>//                   Added vParentPath function to retrieve the parent "node" of a path
29422>>>//                   
29422>>>Use Case.mac
29422>>>Use Seq_chnl.pkg
29422>>>
29422>>>Use windows
29422>>>Use Dferror
29422>>>Use Dll
29422>>>Use vWin32fh.h       // Header file with WinAPI declarations
Including file: vwin32fh.h    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\vwin32fh.h)
29422>>>>>//-2WA
29422>>>>>//TH-Header
29422>>>>>//*****************************************************************************************
29422>>>>>// Copyright (c)  2004 KURANT Project
29422>>>>>// All rights reserved.
29422>>>>>//
29422>>>>>// $FileName    : G:\Projects\vWin32fh\vWin32fh.h
29422>>>>>// $ProjectName : Windows 32 bits file handling
29422>>>>>// $Authors     : Wil van Antwerpen
29422>>>>>// $Created     : 19.02.2004  19:25
29422>>>>>// $Type        : BSD (as in do with it whatever you like)
29422>>>>>//
29422>>>>>// Contents:
29422>>>>>//  This file contains the Windows API external function call definitions and
29422>>>>>//  constants as they are used in the vWin32fh package.
29422>>>>>//*****************************************************************************************
29422>>>>>//TH-RevisionStart
29422>>>>>//TH-RevisionEnd
29422>>>>>
29422>>>>>Define CS_DDE_ERR_FILE_NOT_FOUND  For "The specified file was not found.\n"
29422>>>>>Define CS_DDE_ERR_PATH_NOT_FOUND  For "The specified path was not found.\n"
29422>>>>>Define CS_DDE_ERR_BAD_FORMAT      For "The .EXE file is invalid.\n"
29422>>>>>Define CS_DDE_ERR_ACCESSDENIED    For "The operating system denied access to the specified file.\n"
29422>>>>>Define CS_DDE_ERR_ASSOCINCOMPLETE For "The filename association is incomplete or invalid.\n"
29422>>>>>Define CS_DDE_ERR_DDEBUSY         For "The DDE transaction could not be completed because other DDE\ntransactions were being processed.\n"
29422>>>>>Define CS_DDE_ERR_DDEFAIL         For "The DDE transaction failed.\n"
29422>>>>>Define CS_DDE_ERR_DDETIMEOUT      For "The DDE transaction could not be completed,\nbecause the request timed out.\n"
29422>>>>>Define CS_DDE_ERR_DLLNOTFOUND     For "The specified dynamic-link library was not found.\n"
29422>>>>>Define CS_DDE_ERR_NOASSOC         For "There is no application associated with the given filename extension.\n"
29422>>>>>Define CS_DDE_ERR_OOM             For "There is not enough free memory available to complete the operation.\n"
29422>>>>>Define CS_DDE_ERR_PNF             For "The specified path was not found.\n"
29422>>>>>Define CS_DDE_ERR_SHARE           For "A sharing violation occurred.\n"
29422>>>>>Define CS_DDE_ERR_UNKNOWN_LINE1   For "Unknown DDE-error occurred.\nErrornumber"
29422>>>>>Define CS_DDE_ERR_UNKNOWN_LINE2   For ".\n"
29422>>>>>Define CS_DDE_ERR_HANDL_PAKTC     For "\nPress a key to continue...\n\n"
29422>>>>>Define CS_DDE_ERR_HANDL_CAPTION   For "a DDE-error occured"
29422>>>>>
29422>>>>>
29422>>>>>Define vMax_Path     For |CI260
29422>>>>>Define vMinChar      For |CI$80
29422>>>>>Define vMaxChar      For |CI$7F
29422>>>>>Define vMinShort     For |CI$8000
29422>>>>>Define vMaxShort     For |CI$7FFF
29422>>>>>Define vMinLong      For |CI$80000000
29422>>>>>Define vMaxLong      For |CI$7FFFFFFF
29422>>>>>Define vMaxByte      For |CI$FF
29422>>>>>Define vMaxWord      For |CI$FFFF
29422>>>>>Define vMaxDword     For |CI$FFFFFFFF
29422>>>>>
29422>>>>>
29422>>>>>
29422>>>>>// For FindFirstFile
29422>>>>>Define vINVALID_HANDLE_VALUE   For |CI-1
29422>>>>>Define vINVALID_FILE_SIZE      For |CI$FFFFFFFF
29422>>>>>Define vERROR_NO_MORE_FILES    For |CI18
29422>>>>>
29422>>>>>// The defines below can be used to find out what kind of error has occured if
29422>>>>>// the API-call ShellExecute is used.
29422>>>>>Define vERROR_FILE_NOT_FOUND   For |CI0002
29422>>>>>Define vERROR_PATH_NOT_FOUND   For |CI0003
29422>>>>>Define vERROR_BAD_FORMAT       For |CI0011
29422>>>>>Define vSE_ERR_ACCESSDENIED    For |CI0005
29422>>>>>Define vSE_ERR_ASSOCINCOMPLETE For |CI0027
29422>>>>>Define vSE_ERR_DDEBUSY         For |CI0030
29422>>>>>Define vSE_ERR_DDEFAIL         For |CI0029
29422>>>>>Define vSE_ERR_DDETIMEOUT      For |CI0028
29422>>>>>Define vSE_ERR_DLLNOTFOUND     For |CI0032
29422>>>>>Define vSE_ERR_FNF             For |CI0002
29422>>>>>Define vSE_ERR_NOASSOC         For |CI0031
29422>>>>>Define vSE_ERR_OOM             For |CI0008
29422>>>>>Define vSE_ERR_PNF             For |CI0003
29422>>>>>Define vSE_ERR_SHARE           For |CI0026
29422>>>>>
29422>>>>>
29422>>>>>// C-Structure
29422>>>>>//typedef struct _browseinfo {
29422>>>>>//    HWND hwndOwner;
29422>>>>>//    LPCITEMIDLIST pidlRoot;
29422>>>>>//    LPSTR pszDisplayName;
29422>>>>>//    LPCSTR lpszTitle;
29422>>>>>//    UINT ulFlags;
29422>>>>>//    BFFCALLBACK lpfn;
29422>>>>>//    LPARAM lParam;
29422>>>>>//    int iImage;
29422>>>>>//} BROWSEINFO, *PBROWSEINFO, *LPBROWSEINFO;
29422>>>>>
29422>>>>>//declare C structure struct_browseinfo
29422>>>>>//as documented in MSDN under Windows Shell API
29422>>>>>Type vtBrowseInfo
29422>>>>>  Field vtBrowseInfo.hWndOwner      as Handle
29422>>>>>  Field vtBrowseInfo.pIDLRoot       as Pointer
29422>>>>>  Field vtBrowseInfo.pszDisplayName as Pointer
29422>>>>>  Field vtBrowseInfo.lpszTitle      as Pointer
29422>>>>>  Field vtBrowseInfo.ulFlags        as dWord
29422>>>>>  Field vtBrowseInfo.lpfnCallback   as Pointer
29422>>>>>  Field vtBrowseInfo.lParam         as dWord
29422>>>>>  Field vtBrowseInfo.iImage         as dWord
29422>>>>>End_Type // tBrowseInfo
29422>>>>>
29422>>>>>// Browsing for directory.
29422>>>>>Define vBIF_RETURNONLYFSDIRS   For |CI$0001  // For finding a folder to start document searching
29422>>>>>Define vBIF_DONTGOBELOWDOMAIN  For |CI$0002  // For starting the Find Computer
29422>>>>>Define vBIF_STATUSTEXT         For |CI$0004  // Includes a status area in the dialog box.
29422>>>>>                                            // The callback function can set the status text by
29422>>>>>                                            // sending messages to the dialog box.
29422>>>>>Define vBIF_RETURNFSANCESTORS  For |CI$0008  // Only returns file system ancestors.
29422>>>>>
29422>>>>>Define vBIF_BROWSEFORCOMPUTER  For |CI$1000  // Browsing for Computers.
29422>>>>>Define vBIF_BROWSEFORPRINTER   For |CI$2000  // Browsing for Printers
29422>>>>>
29422>>>>>// message from browser
29422>>>>>//Define BFFM_INITIALIZED        1
29422>>>>>//Define BFFM_SELCHANGED         2
29422>>>>>
29422>>>>>// messages to browser
29422>>>>>//Define BFFM_SETSTATUSTEXT      (WM_USER + 100)
29422>>>>>//Define BFFM_ENABLEOK           (WM_USER + 101)
29422>>>>>//Define BFFM_SETSELECTION       (WM_USER + 102)
29422>>>>>
29422>>>>>
29422>>>>>External_function vWin32_SHBrowseForFolder "SHBrowseForFolder" shell32.dll ;  Pointer lpsBrowseInfo Returns dWord
29423>>>>>
29423>>>>>External_function vWin32_SHGetPathFromIDList "SHGetPathFromIDList" shell32.dll ;  Pointer pidList Pointer lpBuffer Returns dWord
29424>>>>>
29424>>>>>External_function vWin32_CoTaskMemFree "CoTaskMemFree" ole32.dll Pointer pV Returns Integer
29425>>>>>
29425>>>>>
29425>>>>>
29425>>>>>
29425>>>>>Type vtSecurity_attributes
29425>>>>>  Field vtSecurity_attributes.nLength        as dWord
29425>>>>>  Field vtSecurity_attributes.lpDescriptor   as Pointer
29425>>>>>  Field vtSecurity_attributes.bInheritHandle as Integer
29425>>>>>End_Type // vtSecurity_attributes
29425>>>>>
29425>>>>>//nLength:
29425>>>>>// Specifies the size, in bytes, of this structure. Set this value to the size of the
29425>>>>>// SECURITY_ATTRIBUTES structure.
29425>>>>>// Windows NT: Some functions that use the SECURITY_ATTRIBUTES structure do not verify the
29425>>>>>// value of the nLength member. However, an application should still set it properly.
29425>>>>>// That ensures current, future, and cross-platform compatibility.
29425>>>>>//
29425>>>>>//lpSecurityDescriptor:
29425>>>>>// Points to a security descriptor for the object that controls the sharing of it.
29425>>>>>// If NULL is specified for this member, the object may be assigned the default security
29425>>>>>// descriptor of the calling process.
29425>>>>>//
29425>>>>>//bInheritHandle:
29425>>>>>// Specifies whether the returned handle is inherited when a new process is created.
29425>>>>>// If this member is TRUE, the new process inherits the handle.
29425>>>>>
29425>>>>>
29425>>>>>// BOOL CreateDirectory(
29425>>>>>//    LPCTSTR lpPathName,
29425>>>>>//    LPSECURITY_ATTRIBUTES lpSecurityAttributes  // pointer to a security descriptor
29425>>>>>//   );
29425>>>>>//
29425>>>>>// lpPathName
29425>>>>>//  Points to a null-terminated string that specifies the path of the directory
29425>>>>>//  to be created.
29425>>>>>//  There is a default string size limit for paths of MAX_PATH characters.
29425>>>>>//  This limit is related to how the CreateDirectory function parses paths.
29425>>>>>// lpSecurityAttributes
29425>>>>>//  Pointer to a SECURITY_ATTRIBUTES structure als called a security descriptor that
29425>>>>>//  determines whether the returned handle can be inherited by child processes.
29425>>>>>//  If lpSecurityAttributes is NULL, the handle cannot be inherited.
29425>>>>>// Returns:
29425>>>>>//  If the function succeeds, the return value is nonzero.
29425>>>>>//  If the function fails, the return value is zero. To get extended error information, call GetLastError.
29425>>>>>External_function vWin32_CreateDirectory "CreateDirectoryA" kernel32.dll ;  Pointer lpPathName Pointer lpSecurity_Attributes Returns Integer
29426>>>>>
29426>>>>>
29426>>>>>// lpPathName
29426>>>>>//  Points to a null-terminated string that specifies the path of the directory
29426>>>>>//  to be removed.
29426>>>>>//  There is a default string size limit for paths of MAX_PATH characters.
29426>>>>>// Returns:
29426>>>>>//  If the function succeeds, the return value is nonzero.
29426>>>>>//  If the function fails, the return value is zero. To get extended error information, call GetLastError.
29426>>>>>External_function vWin32_RemoveDirectory "RemoveDirectoryA" kernel32.dll ;  Pointer lpPathName Returns Integer
29427>>>>>
29427>>>>>
29427>>>>>
29427>>>>>// The ShellExecute function opens or prints a specified file. The file can be an
29427>>>>>// executable file or a document file.
29427>>>>>//
29427>>>>>// Operation can be one of the following:
29427>>>>>//    "OPEN"  The function opens the file specified by lpFile.
29427>>>>>//            The file can be an executable file or a document file.
29427>>>>>//            The file can be a folder to open.
29427>>>>>//    "PRINT" The function prints the file specified by lpFile.
29427>>>>>//            The file should be a document file. If the file is an executable file,
29427>>>>>//            the function opens the file, as if  open  had been specified.
29427>>>>>//  "EXPLORE" The function explores the folder specified by lpFile.
29427>>>>>//
29427>>>>>// Return Values:
29427>>>>>//
29427>>>>>// If the function succeeds, the return value is the instance handle of the application that
29427>>>>>// was run, or the handle of a dynamic data exchange (DDE) server application.
29427>>>>>// If the function fails, the return value is an error value that is less than or equal to 32.
29427>>>>>//
29427>>>>>// The following table lists these error values:
29427>>>>>// Public Const ERROR_FILE_NOT_FOUND = 2&
29427>>>>>// Public Const ERROR_PATH_NOT_FOUND = 3&
29427>>>>>// Public Const ERROR_BAD_FORMAT = 11&
29427>>>>>// Public Const SE_ERR_ACCESSDENIED = 5
29427>>>>>// Public Const SE_ERR_ASSOCINCOMPLETE = 27
29427>>>>>// Public Const SE_ERR_DDEBUSY = 30
29427>>>>>// Public Const SE_ERR_DDEFAIL = 29
29427>>>>>// Public Const SE_ERR_DDETIMEOUT = 28
29427>>>>>// Public Const SE_ERR_DLLNOTFOUND = 32
29427>>>>>// Public Const SE_ERR_FNF = 2
29427>>>>>// Public Const SE_ERR_NOASSOC = 31
29427>>>>>// Public Const SE_ERR_OOM = 8
29427>>>>>// Public Const SE_ERR_PNF = 3
29427>>>>>// Public Const SE_ERR_SHARE = 26
29427>>>>>
29427>>>>>
29427>>>>>
29427>>>>>// Code to open the program that is associated with the selected file.
29427>>>>>//
29427>>>>>// External function call used in Procedure DoStartDocument
29427>>>>>External_function vWin32_ShellExecute "ShellExecuteA" shell32.dll ;  Handle hWnd ;  Pointer lpOperation ;  Pointer lpFile ;  Pointer lpParameters ;  Pointer lpDirectory ;  Dword iShowCmd Returns Handle
29428>>>>>
29428>>>>>
29428>>>>>
29428>>>>>
29428>>>>>
29428>>>>>                                          // Must be freed using SHFreeNameMappings
29428>>>>>
29428>>>>>Type vtShFileOpStruct
29428>>>>>  Field vtShFileOpStruct.hWnd                   as Handle
29428>>>>>  Field vtShFileOpStruct.wFunc                  as Integer
29428>>>>>  Field vtShFileOpStruct.pFrom                  as Pointer
29428>>>>>  Field vtShFileOpStruct.pTo                    as Pointer
29428>>>>>  Field vtShFileOpStruct.fFlags                 as Short
29428>>>>>  Field vtShFileOpStruct.fAnyOperationsAborted  as Short
29428>>>>>  Field vtShFileOpStruct.hNameMappings          as Pointer
29428>>>>>  Field vtShFileOpStruct.lpszProgressTitle      as Pointer // only used if FOF_SIMPLEPROGRESS
29428>>>>>End_Type // tShFileOpStruct
29428>>>>>
29428>>>>>// hwnd
29428>>>>>//   Handle of the dialog box to use to display information about the status of the operation.
29428>>>>>
29428>>>>>// wFunc
29428>>>>>//   Operation to perform. This member can be one of the following values:
29428>>>>>//     FO_COPY     Copies the files specified by pFrom to the location specified by pTo.
29428>>>>>//     FO_DELETE   Deletes the files specified by pFrom (pTo is ignored).
29428>>>>>//     FO_MOVE     Moves the files specified by pFrom to the location specified by pTo.
29428>>>>>//     FO_RENAME   Renames the files specified by pFrom.
29428>>>>>
29428>>>>>// pFrom
29428>>>>>//   Pointer to a buffer that specifies one or more source file names. Multiple names must
29428>>>>>//   be null-separated. The list of names must be double null-terminated.
29428>>>>>
29428>>>>>// pTo
29428>>>>>//   Pointer to a buffer that contains the name of the destination file or directory. The
29428>>>>>//   buffer can contain mutiple destination file names if the fFlags member specifies
29428>>>>>//   FOF_MULTIDESTFILES. Multiple names must be null-separated. The list of names must be
29428>>>>>//   double null-terminated.
29428>>>>>
29428>>>>>// fAnyOperationsAborted
29428>>>>>//   Value that receives TRUE if the user aborted any file operations before they
29428>>>>>//   were completed or FALSE otherwise.
29428>>>>>
29428>>>>>
29428>>>>>// Performs a copy, move, rename, or delete operation on a file system object.
29428>>>>>// This can be a file or a folder.
29428>>>>>// With thanks to Andrew S Kaplan
29428>>>>>External_function vWin32_SHFileOperation "SHFileOperationA" Shell32.dll ;        Pointer lpFileOp Returns Integer
29429>>>>>
29429>>>>>
29429>>>>>// Thanks To Oliver Nelson for posting this code on the newsgroups
29429>>>>>External_function vWin32_GetWindowsDirectory "GetWindowsDirectoryA" kernel32.dll ;                           Pointer lpBuffer Integer nSize Returns Integer
29430>>>>>
29430>>>>>
29430>>>>>
29430>>>>>// Courtesy Of Vincent Oorsprong
29430>>>>>//External_Function vWin32_GetTempFileName "GetTempFileNameA" Kernel32.Dll ;
29430>>>>>//   Pointer lpPathName ;
29430>>>>>//   Pointer lpPrefixString ;
29430>>>>>//   Integer uUnique ;
29430>>>>>//   Pointer lpTempFileName ;
29430>>>>>//   Returns Integer
29430>>>>>// **WvA: 28-04-2005 Changed string parameter type into pointers
29430>>>>>External_function vWin32_GetTempFileName "GetTempFileNameA" kernel32.dll Pointer lpsPath ;        Pointer lpsPrefix Integer iUnique Pointer pLoad Returns Integer
29431>>>>>
29431>>>>>External_function vWin32_GetTempPath "GetTempPathA" Kernel32.Dll ;   Dword nBufferLength ;   Pointer lpBuffer ;   Returns Integer
29432>>>>>
29432>>>>>External_function vWin32_DeleteFile "DeleteFileA" Kernel32.Dll ;   Pointer lpFileName ;   Returns Integer
29433>>>>>                  
29433>>>>>// from:
29433>>>>>// http://msdn.microsoft.com/library/default.asp?url=/library/en-us/shellcc/platform/shell/reference/enums/csidl.asp
29433>>>>>//
29433>>>>>Define vCSIDL_FLAG_CREATE       For |CI$8000 // IE5+, use this to create a special folder
29433>>>>>Define vCSIDL_ADMIN_TOOLS       For |CI$0030 // IE5+, The file system directory that is used to store administrative tools for an individual user
29433>>>>>Define vCSIDL_ALT_STARTUP       For |CI$001D // The file system directory that corresponds to the user's nonlocalized Startup program group
29433>>>>>Define vCSIDL_APPDATA           For |CI$001A // Version 4.71. The file system directory that serves as a common repository for application-specific data. A typical path is C:\Documents and Settings\<username>\Application Data
29433>>>>>Define vCSIDL_BITBUCKET         For |CI$000A // The virtual folder containing the objects in the user's Recycle Bin
29433>>>>>Define vCSIDL_CDBURN_AREA       For |CI$003B // IE6+ The file system directory acting as a staging area for files waiting to be written to CD. A typical path is C:\Documents and Settings\<username>\Local Settings\Application Data\Microsoft\CD Burning
29433>>>>>Define vCSIDL_COMMON_ADMINTOOLS For |CI$002F // IE5+ The file system directory containing administrative tools for all users of the computer
29433>>>>>Define vCSIDL_COMMON_ALTSTARTUP For |CI$001E // The file system directory that corresponds to the nonlocalized Startup program group for all users
29433>>>>>Define vCSIDL_COMMON_APPDATA    For |CI$0023 // IE5+ The file system directory containing application data for all users. A typical path is C:\Documents and Settings\All Users\Application Data
29433>>>>>Define vCSIDL_COMMON_DESKTOPDIRECTORY for |CI$0019 // WinNT+ Only, The file system directory that contains files and folders that appear on the desktop for all users. A typical path is C:\Documents and Settings\All Users\Desktop
29433>>>>>Define vCSIDL_COMMON_DOCUMENTS  For |CI$002E // IE5+ The file system directory that contains documents that are common to all users. A typical paths is C:\Documents and Settings\All Users\Documents
29433>>>>>Define vCSIDL_COMMON_FAVORITES  For |CI$001F // The file system directory that serves as a common repository for favorite items common to all users
29433>>>>>Define vCSIDL_COMMON_MUSIC      For |CI$0035 // IE6+ The file system directory that serves as a repository for music files common to all users. A typical path is C:\Documents and Settings\All Users\Documents\My Music
29433>>>>>Define vCSIDL_COMMON_PICTURES   For |CI$0036 // The file system directory that serves as a repository for image files common to all users. A typical path is C:\Documents and Settings\All Users\Documents\My Pictures
29433>>>>>Define vCSIDL_COMMON_PROGRAMS   For |CI$0017 // WinNT+ The file system directory that contains the directories for the common program groups that appear on the Start menu for all users. A typical path is C:\Documents and Settings\All Users\Start Menu\Programs
29433>>>>>Define vCSIDL_COMMON_STARTMENU  For |CI$0016 // WinNT+ The file system directory that contains the programs and folders that appear on the Start menu for all users. A typical path is C:\Documents and Settings\All Users\Start Menu
29433>>>>>Define vCSIDL_COMMON_STARTUP    For |CI$0018 // WinNT+ The file system directory that contains the programs that appear in the Startup folder for all users. A typical path is C:\Documents and Settings\All Users\Start Menu\Programs\Startup
29433>>>>>Define vCSIDL_COMMON_TEMPLATES  For |CI$002D // WinNT+ The file system directory that contains the templates that are available to all users. A typical path is C:\Documents and Settings\All Users\Templates
29433>>>>>Define vCSIDL_COMMON_VIDEO      For |CI$0037 // IE6+ The file system directory that serves as a repository for video files common to all users. A typical path is C:\Documents and Settings\All Users\Documents\My Videos
29433>>>>>Define vCSIDL_COMPUTERSNEARME   For |CI$003D // The folder representing other machines in your workgroup
29433>>>>>Define vCSIDL_CONNECTIONS       For |CI$0031 // The virtual folder representing Network Connections, containing network and dial-up connections
29433>>>>>Define vCSIDL_CONTROLS          For |CI$0003 // The virtual folder containing icons for the Control Panel applications
29433>>>>>Define vCSIDL_COOKIES           For |CI$0021 // The file system directory that serves as a common repository for Internet cookies. A typical path is C:\Documents and Settings\username\Cookies
29433>>>>>Define vCSIDL_DESKTOP           For |CI$0000 // The virtual folder representing the Windows desktop, the root of the namespace
29433>>>>>Define vCSIDL_DESKTOPDIRECTORY  For |CI$0010 // The file system directory used to physically store file objects on the desktop (not to be confused with the desktop folder itself). A typical path is C:\Documents and Settings\username\Desktop
29433>>>>>Define vCSIDL_DRIVES            For |CI$0011 // The virtual folder representing My Computer, containing everything on the local computer: storage devices, printers, and Control Panel. The folder may also contain mapped network drives
29433>>>>>Define vCSIDL_FAVORITES         For |CI$0006 // The file system directory that serves as a common repository for the user's favorite items. A typical path is C:\Documents and Settings\username\Favorites
29433>>>>>Define vCSIDL_FONTS             For |CI$0014 // A virtual folder containing fonts. A typical path is C:\Windows\Fonts
29433>>>>>Define vCSIDL_HISTORY           For |CI$0022 // The file system directory that serves as a common repository for Internet history items
29433>>>>>Define vCSIDL_INTERNET          For |CI$0001 // A virtual folder representing the Internet
29433>>>>>Define vCSIDL_INTERNET_CACHE    For |CI$0020 // Comctl4.72+, The file system directory that serves as a common repository for temporary Internet files. A typical path is C:\Documents and Settings\username\Local Settings\Temporary Internet Files
29433>>>>>Define vCSIDL_LOCAL_APPDATA     For |CI$001C // IE5+ The file system directory that serves as a data repository for local (nonroaming) applications. A typical path is C:\Documents and Settings\username\Local Settings\Application Data
29433>>>>>Define vCSIDL_MYDOCUMENTS       For |CI$000C // IE6+ The virtual folder representing the My Documents desktop item
29433>>>>>Define vCSIDL_MYMUSIC           For |CI$000D // The file system directory that serves as a common repository for music files. A typical path is C:\Documents and Settings\User\My Documents\My Music
29433>>>>>Define vCSIDL_MYPICTURES        For |CI$0027 // IE5+ The file system directory that serves as a common repository for image files. A typical path is C:\Documents and Settings\username\My Documents\My Pictures
29433>>>>>Define vCSIDL_MYVIDEO           For |CI$000E // IE6+ The file system directory that serves as a common repository for video files. A typical path is C:\Documents and Settings\username\My Documents\My Videos
29433>>>>>Define vCSIDL_NETHOOD           For |CI$0013 // A file system directory containing the link objects that may exist in the My Network Places virtual folder. It is not the same as CSIDL_NETWORK, which represents the network namespace root. A typical path is C:\Documents and Settings\username\NetHood
29433>>>>>Define vCSIDL_NETWORK           For |CI$0012 // A virtual folder representing Network Neighborhood, the root of the network namespace hierarchy
29433>>>>>Define vCSIDL_PERSONAL          For |CI$0005 // (Documents folder) IE6 The virtual folder representing the My Documents desktop item. 
29433>>>>>                                             // This is equivalent to CSIDL_MYDOCUMENTS. Previous to Version 6.0. The file system directory used to physically store a user's common repository of documents. A typical path is C:\Documents and Settings\username\My Documents
29433>>>>>Define vCSIDL_PHOTOALBUMS       For |CI$0045 // Vista+ The virtual folder used to store photo albums, typically username\My Pictures\Photo Albums
29433>>>>>Define vCSIDL_PLAYLISTS         For |CI$003F // Vista+ The virtual folder used to store play albums, typically username\My Music\Playlists                                             
29433>>>>>Define vCSIDL_PRINTERS          For |CI$0004 // The virtual folder containing installed printers
29433>>>>>Define vCSIDL_PRINTHOOD         For |CI$001B // The file system directory that contains the link objects that can exist in the Printers virtual folder. A typical path is C:\Documents and Settings\username\PrintHood
29433>>>>>Define vCSIDL_PROFILE           For |CI$0028 // IE5+ The user's profile folder. A typical path is C:\Documents and Settings\username
29433>>>>>Define vCSIDL_PROGRAM_FILES     For |CI$0026 // IE5+ The Program Files folder. A typical path is C:\Program Files
29433>>>>>Define vCSIDL_PROGRAM_FILES_COMMON For |CI$002B // IE5+, WinNT+ A folder for components that are shared across applications. A typical path is C:\Program Files\Common
29433>>>>>Define vCSIDL_PROGRAMS          For |CI$0002 // The file system directory that contains the user's program groups (which are themselves file system directories). A typical path is C:\Documents and Settings\username\Start Menu\Programs
29433>>>>>Define vCSIDL_RECENT            For |CI$0008 // The file system directory that contains shortcuts to the user's most recently used documents. A typical path is C:\Documents and Settings\username\My Recent Documents
29433>>>>>Define vCSIDL_RESOURCES         For |CI$0038 // undocumented
29433>>>>>Define vCSIDL_SAMPLE_MUSIC      For |CI$0040 // Vista+, The file system directory that contains sample music. A typical path is C:\Documents and Settings\username\My Documents\My Music\Sample Music
29433>>>>>Define vCSIDL_SAMPLE_PLAYLISTS  For |CI$0041 // Vista+, The file system directory that contains sample playlists. A typical path is C:\Documents and Settings\username\My Documents\My Music\Sample Playlists
29433>>>>>Define vCSIDL_SAMPLE_PICTURES   For |CI$0042 // Vista+, The file system directory that contains sample pictures. A typical path is C:\Documents and Settings\username\My Documents\My Pictures\Sample Pictures
29433>>>>>Define vCSIDL_SAMPLE_VIDEOS     For |CI$0043 // Vista+, The file system directory that contains sample videos. A typical path is C:\Documents and Settings\username\My Documents\My Videos\Sample Videos
29433>>>>>Define vCSIDL_SENDTO            For |CI$0009 // The file system directory that contains Send To menu items. A typical path is C:\Documents and Settings\username\SendTo
29433>>>>>Define vCSIDL_STARTMENU         For |CI$000B // The file system directory containing Start menu items. A typical path is C:\Documents and Settings\username\Start Menu
29433>>>>>Define vCSIDL_STARTUP           For |CI$0007 // The file system directory that corresponds to the user's Startup program group. The system starts these programs whenever any user logs onto Windows NT or starts Windows 95. A typical path is C:\Documents and Settings\username\Start Menu\Programs\Startup
29433>>>>>Define vCSIDL_SYSTEM            For |CI$0025 // The Windows System folder. A typical path is C:\Windows\System32
29433>>>>>Define vCSIDL_TEMPLATES         For |CI$0015 // The file system directory that serves as a common repository for document templates. A typical path is C:\Documents and Settings\username\Templates
29433>>>>>Define vCSIDL_WINDOWS           For |CI$0024 // The Windows directory or SYSROOT. This corresponds to the %windir% or %SYSTEMROOT% environment variables. A typical path is C:\Windows
29433>>>>>
29433>>>>>
29433>>>>>//HRESULT SHGetFolderPath(
29433>>>>>//    HWND hwndOwner,
29433>>>>>//    int nFolder,
29433>>>>>//    HANDLE hToken,
29433>>>>>//    DWORD dwFlags,
29433>>>>>//    LPTSTR pszPath
29433>>>>>//);
29433>>>>>// This function is a superset of SHGetSpecialFolderPath, included with earlier versions of
29433>>>>>// the shell. It is implemented in a redistributable DLL, SHFolder.dll, that also simulates
29433>>>>>// many of the new shell folders on older platforms such as Windows 95, Windows 98, and
29433>>>>>// Windows NT 4.0. This DLL always calls the current platform's version of this function.
29433>>>>>// If that fails, it will try to simulate the appropriate behavior.
29433>>>>>//
29433>>>>>External_function vWin32_SHGetFolderPath "SHGetFolderPathA" SHFolder.Dll ;   Pointer hWnd ;   Integer nFolder ;   Pointer hToken ;   DWord   dwFlags ;   Pointer lpszPath ;   Returns Integer
29434>>>>>
29434>>>>>
29434>>>>>
29434>>>>>Type vWin32_Find_Data
29434>>>>>  Field vWin32_Find_Data.dwFileAttributes As Dword
29434>>>>>  Field vWin32_Find_Data.ftCreationLowDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.ftCreationHighDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.ftLastAccessLowDateTime As dword
29434>>>>>  Field vWin32_Find_Data.ftLastAccessHighDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.ftLastWriteLowDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.ftLastWriteHighDateTime As Dword
29434>>>>>  Field vWin32_Find_Data.nFileSizeHigh As Dword
29434>>>>>  Field vWin32_Find_Data.nFileSizeLow As Dword
29434>>>>>  Field vWin32_Find_Data.dwReserved0 As Dword
29434>>>>>  Field vWin32_Find_Data.dwReserved1 As Dword
29434>>>>>  Field vWin32_Find_Data.cFileName As Char vMax_Path
29434>>>>>  Field vWin32_Find_Data.cAlternateFileName As Char 14
29434>>>>>End_Type // vWin32_Find_Data
29434>>>>>
29434>>>>>// Courtesy Of Vincent Oorsprong
29434>>>>>// lpFileName      : address of name of file to search for
29434>>>>>// lpFindFileData  : address of returned information
29434>>>>>External_function vWin32_FindFirstFile "FindFirstFileA"  Kernel32.dll Pointer lpFileName ;          Pointer lpFindFileData Returns Handle
29435>>>>>
29435>>>>>// Courtesy Of Vincent Oorsprong
29435>>>>>// hFindFile       : handle of search
29435>>>>>// lpFindFileData  : address of structure for data on found file
29435>>>>>External_function vWin32_FindNextFile "FindNextFileA" Kernel32.dll Handle hFindFile ;          Pointer lpFindFileData Returns Integer
29436>>>>>
29436>>>>>// Courtesy Of Vincent Oorsprong
29436>>>>>//  hFindFile      : file search handle
29436>>>>>External_function vWin32_FindClose "FindClose" Kernel32.dll Handle hFindFile Returns Integer
29437>>>>>
29437>>>>>
29437>>>>>
29437>>>>>Type vFileTime
29437>>>>>  Field vFileTime.dwLowDateTime As Dword
29437>>>>>  Field vFileTime.dwHighDateTime As Dword
29437>>>>>End_Type // vFileTime
29437>>>>>
29437>>>>>
29437>>>>>Type vSystemTime
29437>>>>>  Field vSystemTime.wYear As Word
29437>>>>>  Field vSystemTime.wMonth As Word
29437>>>>>  Field vSystemTime.wDayOfWeek As Word
29437>>>>>  Field vSystemTime.wDay As Word
29437>>>>>  Field vSystemTime.wHour As Word
29437>>>>>  Field vSystemTime.wMinute As Word
29437>>>>>  Field vSystemTime.wSecond As Word
29437>>>>>  Field vSystemTime.wMilliSeconds As Word
29437>>>>>End_Type // vSystemTime
29437>>>>>
29437>>>>>
29437>>>>>// Courtesy Of Vincent Oorsprong
29437>>>>>//  lpFileTime     : pointer to file time to convert
29437>>>>>//  lpSystemTime   : pointer to structure to receive system time
29437>>>>>External_function vWin32_FileTimeToSystemTime "FileTimeToSystemTime" Kernel32.Dll ;          Pointer lpFileTime Pointer lpsystemTime Returns Integer
29438>>>>>
29438>>>>>// Courtesy Of Vincent Oorsprong
29438>>>>>// This function formats the time in a picture-string passed
29438>>>>>//
29438>>>>>// Picture      Meaning
29438>>>>>//    h         Hours with no leading zero for single-digit hours; 12-hour clock
29438>>>>>//    hh        Hours with leading zero for single-digit hours; 12-hour clock
29438>>>>>//    H         Hours with no leading zero for single-digit hours; 24-hour clock
29438>>>>>//    HH        Hours with leading zero for single-digit hours; 24-hour clock
29438>>>>>//    m         Minutes with no leading zero for single-digit minutes
29438>>>>>//    mm        Minutes with leading zero for single-digit minutes
29438>>>>>//    s         Seconds with no leading zero for single-digit seconds
29438>>>>>//    ss        Seconds with leading zero for single-digit seconds
29438>>>>>//    t         One character time marker string, such as A or P
29438>>>>>//    tt        Multicharacter time marker string, such as AM or PM
29438>>>>>//
29438>>>>>// For example, to get the time string  "11:29:40 PM"
29438>>>>>//    use the following picture string: "hh" : "mm" : "ss tt"
29438>>>>>
29438>>>>>External_function vWin32_GetTimeFormat "GetTimeFormatA" Kernel32.Dll ;  Dword LCID Dword dwFlags Pointer lpsSystemTime Pointer lpFormat Pointer lpTimeStr ;  Integer cchTime Returns Integer
29439>>>>>
29439>>>>>
29439>>>>>// Courtesy Of Vincent Oorsprong
29439>>>>>// This function formats the date in a picture-string passed
29439>>>>>//
29439>>>>>// Picture      Meaning
29439>>>>>//    d         Day of month as digits with no leading zero for single-digit days.
29439>>>>>//    dd        Day of month as digits with leading zero for single-digit days.
29439>>>>>//    ddd       Day of week as a three-letter abbreviation. The function uses the
29439>>>>>//              LOCALE_SABBREVOAYMAME value associated with the specified locale.
29439>>>>>//    dddd      Day of week as its full name. The function uses the LOCALE_SDAYNAME
29439>>>>>//              value associated with the specified locale.
29439>>>>>//    M         Month as digits with no leading zero for single-digit months.
29439>>>>>//    MM        Month as digits with leading zero for single-digit months.
29439>>>>>//    MMM       Month as a three-letter abbreviation. The function uses the
29439>>>>>//              LOCALE_SABBREVMONTHNAME value associated with the specified locale.
29439>>>>>//    MMMM      Month as its full name. The function uses the LOCALE_SMONTHNAME value
29439>>>>>//              associated with the specified locale.
29439>>>>>//    y         Year as last two digits, but with no leading zero for years less than 10.
29439>>>>>//    yy        Year as last two digits, but with leading zero for years less than 10.
29439>>>>>//    yyyy      Year represented hy full four digits.
29439>>>>>//    gg        Period/era string. The function uses the CAL_SERASTRING value associated
29439>>>>>//              with the specified locale. This element is ignored if the date to be formatted
29439>>>>>//              does not have an associated era or period string.
29439>>>>>// For example, to get the date string  "Wed, Aug 31 94"
29439>>>>>// use the following picture string:    "ddd","MMM dd yy"
29439>>>>>
29439>>>>>External_function vWin32_GetDateFormat "GetDateFormatA" Kernel32.Dll ;  Dword LCID Dword dwFlags Pointer lpsSystemTime Pointer lpFormat Pointer lpDateStr ;  Integer cchDate Returns Integer
29440>>>>>
29440>>>>>Define LOCALE_NOUSEROVERRIDE    For |CI$80000000  //  do not use user overrides
29440>>>>>Define TIME_NOMIHUTESORSECONDS  For |CI$0000000l  //  do not use minutes or seconds
29440>>>>>Define TIME_NOSECONDS           For |CI$00000002  //  do not use seconds
29440>>>>>Define TIME_NOTIMEMARKER        For |CI$00000004  //  do not use time marker
29440>>>>>Define TIME_FORCE24HOURFORMAT   For |CI$00000008  //  always use 24 hour format
29440>>>>>
29440>>>>>//  Date Flags for GetDateFormatW.
29440>>>>>//
29440>>>>>Define DATE_SHORTDATE           For |CI$0000000l  //  use short date picture
29440>>>>>Define DATE_LONGDATE            For |CI$00000002  //  use long date picture
29440>>>>>Define DATE_USE_ALT_CALENDAR    For |CI$00000004  //  use alternate calendar (if any)
29440>>>>>
29440>>>>>
29440>>>>>External_function vWin32_SetLastError "SetLastError" Kernel32.Dll Dword dwLastError Returns Integer
29441>>>>>
29441>>>>>
29441>>>>>// **WvA: 20-02-2004
29441>>>>>// While i was testing the format capabilities i stumbled over a very
29441>>>>>// weird problem where it looks like that the integer value gets somehow translated
29441>>>>>// incorrectly into an unsigned integer.
29441>>>>>// I don't have the time to dive into this.. so added a workaround (and removed it again)
29441>>>>>// It does smell a bit fishy though
29441>>>>>// Tested it with the same results on both VDF7 and VDF9.1
29441>>>>>
29441>>>>>Define SHFMT_ID_DEFAULT        For |CI$0000FFFF // The default format ID
29441>>>>>Define SHFMT_OPT_DEFAULT       For |CI$00000000 // The default "Quick Format" option.
29441>>>>>Define SHFMT_OPT_FULL          For |CI$00000001 // Deselects the "Quick Format" option, providing a full format instead. This is useful when an unformatted disk is detected.
29441>>>>>Define SHFMT_OPT_SYSONLY       For |CI$00000002 // Selects the "Create an MS-DOS startup disk" option, creating a system boot disk.
29441>>>>>
29441>>>>>// Possible errors that can be returned by the shellformat function
29441>>>>>Define SHFMT_ERROR             For (|CI$FFFFFFFF+1) // An error occurred during the last format or no drive parameter passed. This does not indicate that the disk is unformatable.
29441>>>>>Define SHFMT_CANCEL            For (|CI$FFFFFFFE+1) // The last format was canceled.
29441>>>>>Define SHFMT_NOFORMAT          For (|CI$FFFFFFFD+1) // The drive cannot be formatted.
29441>>>>>                                                
29441>>>>>
29441>>>>> // Courtesy Of Steve Walter,
29441>>>>> // USA Software, Inc
29441>>>>> // Format a disk
29441>>>>> // Called By:  Move (vWin32_ShFormatDrive(hWnd,0,$FFFF,1)) To dwReturn
29441>>>>>External_function vWin32_ShFormatDrive "SHFormatDrive" shell32.dll Handle hWnd ;         Integer iDrive Integer iFormatID Integer iOptions Returns DWORD
29442>>>>>                  
29442>>>
29442>>>
29442>>>
29442>>>
29442>>>
29442>>>//            
29442>>>// Gets the string from the right of the last sStopChar in sFrom
29442>>>// If sStopChar has no occurences in the string an empty string is
29442>>>// returned.
29442>>>Function StringFromRightOfChar Global String sFrom String sStopChar Returns String
29444>>>  String  sRetVal
29444>>>  String  sChar
29444>>>  Integer iLength
29444>>>  Integer iPos
29444>>>  Boolean bStopChar
29444>>>  Move "" To sRetval
29445>>>  Move (Length(sFrom)) To iLength
29446>>>  If ((iLength>0) And (Pos(sStopChar,sFrom) <> 0)) Begin
29448>>>    Move iLength   To iPos
29449>>>    Move (False)   To bStopChar
29450>>>    While Not bStopChar
29454>>>      Move (Mid(sFrom,1,iPos)) To sChar
29455>>>      Decrement iPos
29456>>>      If ((sChar=sStopChar) Or (iPos<1)) Begin
29458>>>        Move (True) To bStopChar
29459>>>      End
29459>>>>
29459>>>      Else Begin
29460>>>        Move (sChar+sRetVal) To sRetVal
29461>>>      End
29461>>>>
29461>>>    Loop 
29462>>>>
29462>>>  End
29462>>>>
29462>>>  Function_Return sRetVal
29463>>>End_Function // StringFromRightOfChar
29464>>>
29464>>>
29464>>>// Pre:  sFileName contains the complete path of the file.
29464>>>// Post: returns the complete path of the file.
29464>>>// This function is inspired on function SEQ_ExtractPathFromFileName of Sture Andersen.
29464>>>Function ParseFolderName Global String sFileName Returns String
29466>>>  String sFile
29466>>>  String sFolderName
29466>>>  String sDirSep // this is "\" for windows, or "/" for unix
29466>>>  MOve "" To sFolderName
29467>>>  Move (sysconf(SYSCONF_DIR_SEPARATOR)) To sDirSep
29468>>>  If sDirSep In sFileName Begin
29470>>>    Move (StringFromRightOfChar(sFileName,sDirSep)) To sFile
29471>>>    Move (Replace(sFile,sFileName,"")) To sFolderName
29472>>>  End  
29472>>>>
29472>>>  Else If ":" In sFileName Begin
29475>>>    Move (StringFromRightOfChar(sFileName,":")) To sFile
29476>>>    Move (Replace(sFile,sFileName,"")) To sFolderName
29477>>>  End  
29477>>>>
29477>>>  Function_Return sFolderName
29478>>>End_Function // ParseFolderName
29479>>>
29479>>>
29479>>>// Pre:  sFileName contains the complete path of the file.
29479>>>// post: The returned filename has it's path removed, but will have a extension
29479>>>Function ParseFileName Global String sFileName Returns String
29481>>>  String sFolderName
29481>>>  String sDirSep // this is "\" for windows, or "/" for unix
29481>>>  Move (sysconf(SYSCONF_DIR_SEPARATOR)) To sDirSep
29482>>>  Get ParseFolderName sFileName To sFolderName
29483>>>  If (sFolderName <> "") Move (Replace(sFolderName,sFileName,"")) To sFileName
29486>>>  Move (Replace(sDirSep,sFileName,"")) To sFileName
29487>>>  Function_Return sFilename
29488>>>End_Function // ParseFileName
29489>>>
29489>>>
29489>>>// Pre:  sFileName may contain the complete path of the file.
29489>>>//       or contain multiple dots in the filename, so temp.gif.bak will
29489>>>//       return "bak" as the extension and not "gif"
29489>>>// Post: returns the extension only, this extension can be a valid unixlike extension
29489>>>//       such as "html" or "java"
29489>>>Function ParseFileExtension Global String sFileName Returns String
29491>>>  String  sFileExtension
29491>>>  Get StringFromRightOfChar sFileName "." To sFileExtension
29492>>>  Function_Return sFileExtension
29493>>>End_Function // ParseFileExtension
29494>>>
29494>>>
29494>>>Define CS_DDE_ERR_UNKNOWN_LINE2   For ".\n"
29494>>>
29494>>>
29494>>>Function DDE_Error_To_String Integer iErrorID Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29496>>>  String sMessage
29496>>>  Case Begin
29496>>>    Case (iErrorID = vERROR_FILE_NOT_FOUND)
29498>>>      Move CS_DDE_ERR_FILE_NOT_FOUND To sMessage
29499>>>      Case Break
29500>>>    Case (iErrorID = vERROR_PATH_NOT_FOUND)
29503>>>      Move CS_DDE_ERR_PATH_NOT_FOUND To sMessage
29504>>>      Case Break
29505>>>    Case (iErrorID = vERROR_BAD_FORMAT)
29508>>>      Move CS_DDE_ERR_BAD_FORMAT To sMessage 
29509>>>      Case Break
29510>>>    Case (iErrorID = vSE_ERR_ACCESSDENIED)
29513>>>      Move CS_DDE_ERR_ACCESSDENIED To sMessage
29514>>>      Case Break
29515>>>    Case (iErrorID = vSE_ERR_ASSOCINCOMPLETE)
29518>>>      Move CS_DDE_ERR_ASSOCINCOMPLETE To sMessage
29519>>>      Case Break
29520>>>    Case (iErrorID = vSE_ERR_DDEBUSY)
29523>>>      Move CS_DDE_ERR_DDEBUSY To sMessage
29524>>>      Case Break
29525>>>    Case (iErrorID = vSE_ERR_DDEFAIL)
29528>>>      Move CS_DDE_ERR_DDEFAIL To sMessage
29529>>>      Case Break
29530>>>    Case (iErrorID = vSE_ERR_DDETIMEOUT)
29533>>>      Move CS_DDE_ERR_DDETIMEOUT To sMessage
29534>>>      Case Break
29535>>>    Case (iErrorID = vSE_ERR_DLLNOTFOUND)
29538>>>      Move CS_DDE_ERR_DLLNOTFOUND To sMessage
29539>>>      Case Break
29540>>>    Case (iErrorID = vSE_ERR_NOASSOC)
29543>>>      Move CS_DDE_ERR_NOASSOC To sMessage
29544>>>      Case Break
29545>>>    Case ((iErrorID = vSE_ERR_OOM) Or (iErrorID = 0))
29548>>>      Move CS_DDE_ERR_OOM To sMessage
29549>>>      Case Break
29550>>>    Case (iErrorID = vSE_ERR_PNF)
29553>>>      Move CS_DDE_ERR_PNF To sMessage
29554>>>      Case Break
29555>>>    Case (iErrorID = vSE_ERR_SHARE)
29558>>>      Move CS_DDE_ERR_SHARE To sMessage
29559>>>      Case Break
29560>>>    Case Else
29560>>>      Move CS_DDE_ERR_UNKNOWN_LINE1 To sMessage
29561>>>      Move (sMessage*Trim(iErrorID)*CS_DDE_ERR_UNKNOWN_LINE2) To sMessage
29562>>>      Case Break
29563>>>  Case End
29563>>>  Function_Return sMessage
29564>>>End_Function // DDE_Error_To_String
29565>>>
29565>>>
29565>>>Procedure vDDE_Error_Handler Integer iErrorID
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29567>>>  String sMessage
29567>>>  Get DDE_Error_To_String iErrorID To sMessage
29568>>>  Append sMessage CS_DDE_ERR_HANDL_PAKTC //  "Press a key to continue..."
29569>>>  Send Stop_Box sMessage CS_DDE_ERR_HANDL_CAPTION
29570>>>End_Procedure // vDDE_Error_Handler hInstance
29571>>>
29571>>>
29571>>>// Does the directory exist? - No = 0, Yes = 1
29571>>>// This also works with UNC path encoding and wildcards
29571>>>Function vFolderExists Global String sFolderName Returns Integer
29573>>>  String  sFolder sTmp
29573>>>  Integer bFolderExists iCh
29573>>>
29573>>>  Move dfTrue To bFolderExists
29574>>>  Move "dir:" To sFolder
29575>>>  Append sFolder sFolderName
29576>>>  Get Seq_New_Channel To iCh  // get free channel for input
29577>>>  Direct_Input Channel iCh sFolder
29579>>>    Repeat
29579>>>>
29579>>>      Readln Channel iCh sTmp
29581>>>      If (Trim(sTmp)="") Move dfFalse To bFolderExists
29584>>>      Else Begin
29585>>>        Move dfTrue To bFolderExists
29586>>>        Indicate seqeof True  // end loop
29587>>>        End
29587>>>>
29587>>>    Until (seqeof)
29589>>>  Close_Input Channel iCh
29591>>>  Send Seq_Release_Channel iCh
29592>>>  Function_Return bFolderExists
29593>>>End_Function  // vFolderExists
29594>>>
29594>>>
29594>>>// returns folder name if a folder was selected, otherwise returns ""
29594>>>Function vSHBrowseForFolder Global String sDialogTitle Returns String
29596>>>  String sFolder sBrowseInfo sTitle
29596>>>  Pointer lpItemIdList lpsFolder lpsBrowseInfo lpsTitle
29596>>>  Integer iFolderSelected iRetval
29596>>>
29596>>>  // fill string variable with null characters
29596>>>  ZeroType vtBrowseInfo To sBrowseInfo
29597>>>
29597>>>  If (sDialogTitle<>"") Begin
29599>>>    Move sDialogTitle To sTitle
29600>>>    // Torben Lund suggested converting the string with toansi. Doing it like that
29600>>>    // disables showing some commonly used ascii characters like ascii 137 ( )
29600>>>    // These chars are correctly shown if no toansi is used.
29600>>>    // I can imagine that he wanted to path to be ANSI, but as long as it isa just
29600>>>    // selected it will always be valid.
29600>>>    GetAddress Of sTitle To lpsTitle
29601>>>    Put lpsTitle To sBrowseInfo At vtBrowseInfo.lpszTitle
29602>>>  End
29602>>>>
29602>>>
29602>>>  Put vBIF_RETURNONLYFSDIRS To sBrowseInfo At vtBrowseInfo.ulFlags
29603>>>
29603>>>  // Torben Lund added line below. Move handle of focus object to structure before
29603>>>  // calling function. Otherwise, the folderdialog will be started as a seperate task.
29603>>>  Put (window_handle(focus(desktop))) To sBrowseInfo At vtBrowseInfo.hWndOwner
29604>>>
29604>>>  GetAddress Of sBrowseInfo To lpsBrowseInfo
29605>>>
29605>>>  // null 128 chars into var (make space)
29605>>>  Move (Repeat(Character(0), vMAX_PATH)) To sFolder
29606>>>  GetAddress Of sFolder To lpsFolder
29607>>>
29607>>>  // select folder
29607>>>  Move (vWin32_SHBrowseForFolder(lpsBrowseInfo)) To lpItemIdList
29608>>>  // get selected folder name
29608>>>  Move (vWin32_SHGetPathFromIDList(lpItemIdList, lpsFolder)) To iFolderSelected
29609>>>
29609>>>  // release memory resources that are used by the ItemIdList
29609>>>  Move (vWin32_CoTaskMemFree(lpItemIdList)) To iRetval
29610>>>
29610>>>  If (iFolderSelected<>0) Function_Return (CString(sFolder))
29613>>>  Else Function_Return ""
29615>>>End_Function // vSHBrowseForFolder
29616>>>
29616>>>
29616>>>// returns 0 if the folder is created.
29616>>>//         1 if the API-call returned an error.
29616>>>Function vCreateDirectory Global String sNewFolder Returns Integer
29618>>>  String  sFolder sSA
29618>>>  Pointer lpsFolder lpsSecurity_Attributes lpDescriptor
29618>>>  Integer iRetval bFolderCreated bInheritHandle
29618>>>
29618>>>  Move (False) To bFolderCreated
29619>>>  // fill string variable with null characters
29619>>>  ZeroType vtSecurity_attributes To sSA
29620>>>
29620>>>  // null MAX_PATH chars into var (make space)
29620>>>  Move (Repeat(Character(0), vMAX_PATH)) To sFolder
29621>>>
29621>>>  If (sNewFolder <> "") Begin
29623>>>
29623>>>    Move dfTrue To  bInheritHandle
29624>>>    // Setting this to NULL is already done by the zerotype command
29624>>>    // Move NULL   To  lpDescriptor
29624>>>    Put (length(sSA))   To sSA At vtSecurity_attributes.nLength
29625>>>    //Put lpDescriptor To sSA at vtSecurity_attributes.lpDescriptor
29625>>>    Put bInheritHandle To sSA At vtSecurity_attributes.bInheritHandle
29626>>>
29626>>>    GetAddress Of sSA To lpsSecurity_Attributes
29627>>>
29627>>>    //
29627>>>    Move sNewFolder To sFolder
29628>>>    GetAddress Of sFolder To lpsFolder
29629>>>    Move (vWin32_CreateDirectory(lpsFolder, lpsSecurity_Attributes)) To bFolderCreated
29630>>>  End
29630>>>>
29630>>>
29630>>>  Ifnot bFolderCreated Move 1 To iRetVal
29633>>>  Function_Return iRetVal
29634>>>End_Function // vCreateDirectory
29635>>>
29635>>>
29635>>>// **WvA: 03-02-2002 Function created.
29635>>>// With this function one can remove a directory.
29635>>>// returns 0 if the folder is removed.
29635>>>//         1 if the API-call returned an error (Use GetLastError API to get the details)
29635>>>//         2 if the folder did not exist
29635>>>//         3 if the sFolder parameter passed is equal to ""
29635>>>Function vRemoveDirectory Global String sFolder Returns Integer
29637>>>  String  sPath
29637>>>  Pointer lpsPath
29637>>>  Integer iRetval bRemoved bExists
29637>>>
29637>>>  Move (False) To bRemoved
29638>>>  Move 0 To iRetVal
29639>>>  Move (Trim(sFolder)) To sFolder
29640>>>  If (sFolder="") Begin
29642>>>    Move 3 To iRetVal
29643>>>  End
29643>>>>
29643>>>  If (vFolderExists(sFolder)=False) Begin
29645>>>    Move 2 To iRetVal
29646>>>  End
29646>>>>
29646>>>  If (iRetVal=0) Begin
29648>>>    // null MAX_PATH chars into var (make space)
29648>>>    Move (Repeat(Character(0), vMAX_PATH)) To sPath
29649>>>    //
29649>>>    Move (Insert(sFolder,sPath,1)) To sPath
29650>>>    GetAddress Of sPath To lpsPath
29651>>>    Move (vWin32_RemoveDirectory(lpsPath)) To bRemoved
29652>>>  End
29652>>>>
29652>>>
29652>>>  If ((iRetVal=0) And (bRemoved=False)) Begin
29654>>>    Move 1 To iRetVal
29655>>>  End
29655>>>>
29655>>>  Function_Return iRetVal
29656>>>End_Function // vRemoveDirectory
29657>>>
29657>>>
29657>>>
29657>>>// This function informs the user that he entered a yet unknown folder and
29657>>>// asks if he/she wants to create the folder (Yes/No)
29657>>>// Choice: "Yes" - this creates the folder
29657>>>//                 if successful, the function returns false
29657>>>//                 else it will be true.
29657>>>// Choice: "No"  - returns TRUE, This allows the programmer to take action
29657>>>//                 For example: to stop a save
29657>>>// Precondition: A foldername must be entered. We do not check for empty paths
29657>>>// This function returns a non-zero value if the folder isn't created afterwards
29657>>>Function vVerifyNewFolder Global String sFolderName Returns Integer
29659>>>  Integer bIsNotValid
29659>>>  Integer iUsers_Choice
29659>>>  String  sMessage
29659>>>
29659>>>  If (vFolderExists(sFolderName) Eq 0) Begin
29661>>>    Move "The folder '" To sMessage
29662>>>    Append sMessage sFolderName
29663>>>    Append sMessage "' does not yet exist,\n"
29664>>>    Append sMessage "Do you want to create it now?"
29665>>>    Get YesNo_Box sMessage "Confirm" MB_DefButton1 To iUsers_Choice
29666>>>    Case Begin
29666>>>      Case (iUsers_Choice = MBR_Yes)
29668>>>        Move (vCreateDirectory(sFolderName)) To bIsNotValid
29669>>>        If bIsNotValid Begin
29671>>>          Move "An error occurred while trying to create folder '" To sMessage
29672>>>          Append sMessage sFolderName "'.\n\n"
29674>>>          Send Info_Box sMessage "Info"
29675>>>          End
29675>>>>
29675>>>        Case Break
29676>>>      Case (iUsers_Choice = MBR_No)
29679>>>        Move dfTrue To bIsNotValid // Cancel the save
29680>>>        Case Break
29681>>>    Case End
29681>>>  End
29681>>>>
29681>>>  Function_Return bIsNotValid
29682>>>End_Function // vVerifyNewFolder
29683>>>
29683>>>
29683>>>// This will perform an operation on a file (e.g. open) with the application
29683>>>// registered in the Windows Registry to open that type of file (via its extension)
29683>>>// sOperation would be "OPEN" (it could also be "PRINT" etc).
29683>>>Procedure vShellExecute global String sOperation String sDocument String sParameters String sPath
29685>>>  Handle  hInstance hWnd
29685>>>  Pointer lpsOperation
29685>>>  Pointer lpsDocument
29685>>>  Pointer lpsParameters
29685>>>  Pointer lpsPath
29685>>>  // remove any leading/trailing spaces in the string
29685>>>  Move (Trim(sDocument)) To sDocument
29686>>>  Move (Trim(sPath))     To sPath
29687>>>  // Make the strings readable for windows API, by converting them to null-terminated
29687>>>  Append sOperation   (Character(0))
29688>>>  Append sDocument    (Character(0))
29689>>>  Append sParameters  (Character(0))
29690>>>  Append sPath        (Character(0))
29691>>>  // Connect the corresponding pointers to the strings
29691>>>  GetAddress Of sOperation  To lpsOperation
29692>>>  GetAddress Of sDocument   To lpsDocument
29693>>>  GetAddress Of sParameters To lpsParameters
29694>>>  GetAddress Of sPath       To lpsPath
29695>>>
29695>>>  Get Window_Handle To hWnd
29696>>>  Move (vWin32_ShellExecute (hWnd, lpsOperation, lpsDocument, lpsParameters, lpsPath, 1)) To hInstance
29697>>>  If (hInstance <= 32) Begin
29699>>>    Send vDDE_Error_Handler hInstance
29700>>>  End
29700>>>>
29700>>>End_Procedure // vShellExecute
29701>>>
29701>>>
29701>>>Class cShellFileOperations Is a Array
29702>>>
29702>>>  Procedure Construct_Object
29704>>>    Forward Send Construct_Object
29706>>>    Property Integer piDeleteFlags        Public 0
29707>>>    Property Integer piCopyFlags          Public 0
29708>>>    Property Integer piMoveFlags          Public 0
29709>>>    Property Integer piRenameFlags        Public 0
29710>>>    
29710>>>    Set piCopyFlags   To (vFOF_NOCONFIRMMKDIR Ior vFOF_NOCONFIRMATION)
29711>>>    Set piMoveFlags   To (vFOF_NOCONFIRMMKDIR Ior vFOF_NOCONFIRMATION)
29712>>>    Set piDeleteFlags To (vFOF_SILENT Ior vFOF_NOCONFIRMATION)
29713>>>    Set piRenameFlags To (vFOF_SILENT Ior vFOF_NOCONFIRMATION)
29714>>>  End_Procedure // Construct_Object
29715>>>  
29715>>>  
29715>>>  // This function uses the shell API to perform a file operation on the
29715>>>  // files supplied.
29715>>>  //
29715>>>  Function FileOperation String sSource String sDestination Integer iOperation Integer iFlags Returns Integer
29717>>>    String   sShFileOp
29717>>>    Pointer  lpShFileOp
29717>>>    Pointer  lpsSource
29717>>>    Pointer  lpsDestination
29717>>>    Integer  iRetVal
29717>>>    Integer  bUserAbort
29717>>>             
29717>>>    ZeroType vtShFileOpStruct To sShFileOp
29718>>>    Move (ToAnsi(sSource)+Character(0)+Character(0))      To sSource
29719>>>    Move (ToAnsi(sDestination)+Character(0)+Character(0)) To sDestination
29720>>>    GetAddress Of sSource    To lpsSource
29721>>>    If iOperation Ne vFO_DELETE Begin
29723>>>      GetAddress Of sDestination      To lpsDestination
29724>>>      Put lpsDestination To sShFileOp At vtShFileOpStruct.pTo
29725>>>    End  
29725>>>>
29725>>>  
29725>>>    Put iOperation     To sShFileOp At vtShFileOpStruct.wFunc
29726>>>    Put lpsSource      To sShFileOp At vtShFileOpStruct.pFrom
29727>>>    Put iFlags         To sShFileOp At vtShFileOpStruct.fFlags
29728>>>  
29728>>>    GetAddress Of sShFileOp To lpShFileOp
29729>>>  
29729>>>    Move (vWin32_SHFileOperation(lpShFileOp)) To iRetVal
29730>>>    GetBuff From sShFileOp At vtShFileOpStruct.fAnyOperationsAborted To bUserAbort
29731>>>    If (bUserAbort <> 0) Begin
29733>>>      Move 80 To iRetVal  // file Operation Aborted by USER
29734>>>    End
29734>>>>
29734>>>    Function_Return (iRetVal)
29735>>>  End_Function // FileOperation
29736>>>    
29736>>>  
29736>>>  Function sfoDeleteFile String sFileName Returns Integer
29738>>>    Integer  iRetVal
29738>>>    Integer  iFlags
29738>>>    
29738>>>    Get piDeleteFlags To iFlags
29739>>>    Get FileOperation sFileName "" vFO_DELETE iFlags To iRetVal
29740>>>    Function_Return iRetVal
29741>>>  End_Function // sfoDeleteFile
29742>>>  
29742>>>  
29742>>>  Function sfoCopyFile String sSource String sDestination Returns Integer
29744>>>    Integer  iRetVal
29744>>>    Integer  iFlags
29744>>>    
29744>>>    Get piCopyFlags To iFlags
29745>>>    Get FileOperation sSource sDestination vFO_COPY iFlags To iRetVal
29746>>>    Function_Return iRetVal
29747>>>  End_Function // sfoCopyFile
29748>>>  
29748>>>  
29748>>>  Function sfoMoveFile String sSource String sDestination Returns Integer
29750>>>    Integer  iRetVal
29750>>>    Integer  iFlags
29750>>>    
29750>>>    Get piMoveFlags To iFlags
29751>>>    Get FileOperation sSource sDestination vFO_MOVE iFlags To iRetVal
29752>>>    Function_Return iRetVal
29753>>>  End_Function // sfoMoveFile
29754>>>  
29754>>>  
29754>>>  // Rename a file or folder
29754>>>  // Returns a nonzero value if the operation failed.
29754>>>  Function sfoRenameFile String sSource String sDestination Returns Integer
29756>>>    Integer  iRetVal
29756>>>    Integer  iFlags
29756>>>    
29756>>>    Get piRenameFlags To iFlags
29757>>>    Get FileOperation sSource sDestination vFO_RENAME iFlags To iRetVal
29758>>>    Function_Return iRetVal
29759>>>  End_Function // sfoRenameFile
29760>>>
29760>>>  // Courtesy Of Steve Walter
29760>>>  // Requires Windows 2000 and up according to msdn but it was
29760>>>  //  in fact available before that as an unpublished API call
29760>>>  //  a little google search shows that this was already available
29760>>>  //  in windows 95 and NT
29760>>>  //
29760>>>  // The format is controlled by the dialog interface. 
29760>>>  // That is, the user must click the OK button To actually Begin the format
29760>>>  // the format cannot be started programmatically.
29760>>>  // An alternative to this functionality would be to use a controlpanel
29760>>>  //  http://www.vdf-guidance.com/ContribPage.asp?Page=PKGCLSDFCPLAPP&ContribRecId=93
29760>>>  //
29760>>>  // hWnd = The windows handle of the object from which the format Function
29760>>>  //        is called.
29760>>>  // To Get this,
29760>>>  //          use:  Get Window_Handle Of <object>
29760>>>  //          For instance, in this app, we're going to use the Report_Panel:
29760>>>  //                  Get Window_Handle Of (Report_Panel(Main(Self))) To hWind
29760>>>  //
29760>>>  // sDrive = The drive letter. At this moment only A and B are valid
29760>>>  //
29760>>>  // iOptions = Format options.  
29760>>>  //  SHFMT_OPT_DEFAULT = Quick format
29760>>>  //  SHFMT_OPT_FULL    = Full Format
29760>>>  //  SHFMT_OPT_SYSONLY = System only
29760>>>  //  3                 = Full format with system. (unsupported)
29760>>>  //
29760>>>  // Return Values:
29760>>>  //  SHFMT_ERROR    = Error on format or no drive specified.
29760>>>  //  SHFMT_CANCEL   = Format cancelled by user.
29760>>>  //  SHFMT_NOFORMAT = Drive is not formatable.
29760>>>  //                 
29760>>>  //
29760>>>  // *** ATTENTION: This function has been disabled as it doesn't
29760>>>  //                seem to work, i must have made a silly mistake 
29760>>>  //                somewhere.
29760>>>  //
29760>>>  Function sfoFormatDisk String sDrive Integer iOptions Returns DWORD
29762>>>    Handle   hWnd
29762>>>    Integer  iObj
29762>>>    DWORD    dwReturnVal
29762>>>    Integer iDrive
29762>>>
29762>>>    Function_Return (1) // STOP HERE
29763>>>    
29763>>>    Move (Trim(sDrive)) To sDrive
29764>>>    If ( sDrive <> '' ) Begin
29766>>>      If ( sDrive Contains ':' ) Move (Replace(':',sDrive,'')) To sDrive
29769>>>      If (Not( 'AB' Contains sDrive )) Function_Return (SHFMT_NOFORMAT)
29772>>>      If ( sDrive = 'A' ) Move 0 To iDrive
29775>>>      Else If ( sDrive = 'B' ) Move 1 To iDrive
29779>>>      // Window_Handle Of Desktop equals to 0
29779>>>      
29779>>>      Get focus Of desktop To iObj
29780>>>      If (iObj>desktop) ;          Get Container_Handle Of iObj To hWnd
29783>>>      While (hWnd=0 And iObj<>Desktop)
29787>>>          Get Parent Of iObj To iObj
29788>>>          Get Container_Handle Of iObj To hWnd
29789>>>      End
29790>>>>
29790>>>                      
29790>>>      //Showln "hWnd = " hWnd " iDrive " iDrive " iOptions " iOptions
29790>>>      Move (vWin32_ShFormatDrive(hWnd, iDrive, SHFMT_ID_DEFAULT, iOptions)) To dwReturnVal
29791>>>    End
29791>>>>
29791>>>    Else Begin
29792>>>      Move (SHFMT_ERROR) To dwReturnVal
29793>>>    End  
29793>>>>
29793>>>    Function_Return dwReturnVal
29794>>>  End_Function // sfoFormatDisk
29795>>> 
29795>>>  //Example:
29795>>>  // Get sfoFormatDisk 'A' 0 To dReturnVal    // Formats drive A in QuickFormat
29795>>>  //                                          mode.
29795>>>  
29795>>>End_Class // cShellFileOperations 
29796>>>
29796>>>
29796>>>Object oShellFileOperations Is a cShellFileOperations
29798>>>End_Object // oShellFileOperations
29799>>>  
29799>>>                                                     
29799>>>// Restore to the old way of working with the shell file operations.
29799>>>// or.. to put lay man terms, allow any of the operations vDeleteFile
29799>>>// vCopyFile/vMoveFile/vRenameFile to have an UNDO                                                     
29799>>>Procedure vWin32fhCompatibilityMode 
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29801>>>  Integer hoSFO
29801>>>  Integer iFlags
29801>>>  
29801>>>  Move (vFOF_SILENT Ior vFOF_NOCONFIRMATION Ior vFOF_ALLOWUNDO) To iFlags
29802>>>  Move (oShellFileOperations(Self)) To hoSFO
29803>>>  
29803>>>  Set piDeleteFlags Of hoSFO To iFlags
29804>>>  Set piCopyFlags   Of hoSFO To iFlags
29805>>>  Set piMoveFlags   Of hoSFO To iFlags
29806>>>  Set piRenameFlags Of hoSFO To iFlags
29807>>>End_Procedure // vWin32fhCompatibilityMode 
29808>>>
29808>>>
29808>>>Function vDeleteFile Global String sFileName Returns Integer
29810>>>  Integer  iRetVal
29810>>>
29810>>>  Get sfoDeleteFile Of (oShellFileOperations(Self)) sFileName To iRetVal
29811>>>  Function_Return iRetVal
29812>>>End_Function // vDeleteFile
29813>>>
29813>>>
29813>>>Function vCopyFile Global String sSource String sDestination Returns Integer
29815>>>  Integer  iRetVal
29815>>>  
29815>>>  Get sfoCopyFile Of (oShellFileOperations(Self)) sSource sDestination To iRetVal
29816>>>  Function_Return iRetVal
29817>>>End_Function // vCopyFile
29818>>>
29818>>>
29818>>>Function vMoveFile Global String sSource String sDestination Returns Integer
29820>>>  Integer  iRetVal
29820>>>  
29820>>>  Get sfoMoveFile Of (oShellFileOperations(Self)) sSource sDestination To iRetVal
29821>>>  Function_Return iRetVal
29822>>>End_Function // vMoveFile
29823>>>
29823>>>
29823>>>// Rename a file or folder
29823>>>// Returns a nonzero value if the operation failed.
29823>>>Function vRenameFile Global String sSource String sDestination Returns Integer
29825>>>  Integer  iRetVal
29825>>>  
29825>>>  Get sfoRenameFile Of (oShellFileOperations(Self)) sSource sDestination To iRetVal
29826>>>  Function_Return iRetVal
29827>>>End_Function // vRenameFile
29828>>>
29828>>>
29828>>>
29828>>>Function vGetWindowsDirectory Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29830>>>  String  sDirectory
29830>>>  Pointer lpDirectory
29830>>>  Integer iVoid
29830>>>
29830>>>  ZeroString vMAX_PATH To sDirectory
29831>>>  GetAddress Of sDirectory To lpDirectory
29832>>>
29832>>>  Move (vWin32_GetWindowsDirectory(lpDirectory, vMAX_PATH)) To iVoid
29833>>>  Function_Return (CString(sDirectory))  // **WvA: Changed to CString()
29834>>>End_Function // vGetWindowsDirectory
29835>>>
29835>>>
29835>>>
29835>>>
29835>>>// Courtesy of Marco Kuipers
29835>>>Function vMakeTempFile Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29837>>>    Integer iRetval
29837>>>    String  sTempPath sTempFileName sPrefixString
29837>>>    Pointer lpTempPath lpTempFileName lpPrefixString
29837>>>
29837>>>    Move (Repeat (Character (0), 255)) To sTempPath
29838>>>    GetAddress Of sTempPath To lpTempPath
29839>>>    Move (vWin32_GetTempPath (255, lpTempPath)) To iRetVal
29840>>>
29840>>>    If (sTempPath = "") Begin
29842>>>       Get_Current_Directory To sTempPath
29843>>>    End
29843>>>>
29843>>>    Move (pad(sTempPath,vMax_Path-14)) To sTempPath // *WvA: 28-04-2005 Quote from msdn: The string cannot be longer than MAX_PATH-14 characters.
29844>>>    Move (Repeat (Character (0), 255)) To sTempFileName
29845>>>    GetAddress Of sTempFileName To lpTempFileName
29846>>>    Move ("tmp"+character(0)) To sPrefixString // **WvA: 28-04-2005 Added a null
29847>>>    GetAddress Of sPrefixString To lpPrefixString
29848>>>    GetAddress Of sTempPath To lpTempPath
29849>>>    Move (vWin32_GetTempFileName (lpTempPath, lpPrefixString, 0, lpTempFileName)) To iRetval
29850>>>    If (iRetval = 0) Begin  // **WvA: 28-04-2005 Changed condition, the api call returns 0 if an error occurs
29852>>>        Move "" To sTempFileName
29853>>>    End
29853>>>>
29853>>>
29853>>>    Function_Return (Cstring(sTempFileName)) // **WvA: 28-04-2005 Cstring added
29854>>>End_Function // vMakeTempFile
29855>>>
29855>>>
29855>>>// This function creates a uniquely named temporary file in folder sPath
29855>>>// The file created will have a prefix based on the first 3 characters in sPrefix
29855>>>// Note that you will have to cleanup the tempfile yourself as the function
29855>>>// does not take care of that.
29855>>>Function vCreateTempFileInPath String sPath String sPrefix Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29857>>>    String sTempFileName
29857>>>    Integer iCnt iRetVal
29857>>>    Pointer lpTempFileName
29857>>>
29857>>>    Move (ToAnsi(sPath)+Character(0))   To sPath
29858>>>    Move (ToAnsi(sPrefix)+Character(0)) To sPrefix
29859>>>    Move (pad("", vMAX_PATH)) To sTempFileName
29860>>>    GetAddress Of sTempFileName To lpTempFileName
29861>>>
29861>>>    Move (vWin32_GetTempFileName(sPath, sPrefix, 0, lpTempFileName)) To iRetVal
29862>>>    Move (Trim(Cstring(sTempFileName))) To sTempFileName
29863>>>    Function_Return sTempFileName
29864>>>End_Function // vCreateTempFileInPath
29865>>>
29865>>>//
29865>>>// Get a specific shell folder for example to get the desktop folder
29865>>>// simply call this function and pass it vCSIDL_DESKTOP
29865>>>//
29865>>>Function vSHGetFolderPath Integer eFolder Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
29867>>>  String  sFolder
29867>>>  Integer iVoid
29867>>>  Pointer lpsFolder
29867>>>  Handle  hWnd
29867>>>  Move (Window_Handle(focus(desktop))) To hWnd
29868>>>
29868>>>  Move (Repeat(Character(0), vMAX_PATH)) To sFolder
29869>>>  GetAddress Of sFolder To lpsFolder
29870>>>
29870>>>  Move (vWin32_SHGetFolderPath(hWnd,eFolder, 0, 0,lpsFolder)) To iVoid
29871>>>  Function_Return (CString(sFolder))
29872>>>End_Function // vSHGetFolderPath
29873>>>
29873>>>
29873>>>
29873>>>// Courtesy Of Vincent Oorsprong
29873>>>Function vConvertFileDateTime Global Dword dwLowDateTime Dword dwHighDateTime Returns String
29875>>>  String  sftTime sSystemTime sFormattedTime sFormattedDate
29875>>>  Pointer lpsftTime lpsSystemTime lpsFormattedTime lpsFormattedDate
29875>>>  Integer iSuccess iLenCcTime iDataLength iLenCcDate
29875>>>
29875>>>  ZeroType vFileTime  To sftTime
29876>>>  Put dwLowDateTime  To sftTime At vFileTime.dwLowDateTime
29877>>>  Put dwHighDateTime To sftTime At vFileTime.dwHighDateTime
29878>>>  GetAddress Of sftTime To lpsftTime
29879>>>
29879>>>  ZeroType vSystemTime To sSystemTime
29880>>>  GetAddress Of sSystemTime To lpsSystemTime
29881>>>
29881>>>  Moveint (vWin32_FileTimeToSystemTime (lpsftTime, lpsSystemTime)) To iSuccess
29882>>>>
29882>>>  If iSuccess Eq DfTrue Begin
29884>>>    ZeroString 255 To sFormattedTime
29885>>>    GetAddress Of sFormattedTime To lpsFormattedTime
29886>>>    Length sFormattedTime To iLenCcTime
29887>>>>
29887>>>    Moveint (vWin32_GetTimeFormat (LOCALE_USER_DEFAULT, 0, lpsSystemTime, 0, ;                             lpsFormattedTime, iLenCcTime)) To iDataLength
29888>>>>
29888>>>    ZeroString 255 To sFormattedDate
29889>>>    GetAddress Of sFormattedDate To lpsFormattedDate
29890>>>    Length sFormattedDate To iLenCcDate
29891>>>>
29891>>>    Moveint (vWin32_GetDateFormat (LOCALE_USER_DEFAULT, 0, lpsSystemTime, 0, ;                             lpsFormattedDate, iLenCcDate)) To iDataLength
29892>>>>
29892>>>    Function_Return (Cstring (sFormattedDate)  * Cstring (sFormattedTime))
29893>>>  End // iSuccess
29893>>>>
29893>>>End_Function // vConvertFileDateTime
29894>>>
29894>>>
29894>>>// **WvA Removed, See the cFileSet class for an alternative
29894>>>//Procedure DoBrowseDir String sFilePath
29894>>>//End_Procedure // DoBrowseDir
29894>>>
29894>>>// **WvA:
29894>>>// A windows replacement for the standard function FileExists.
29894>>>// This version will also return (true) for a file when it is open by an application.
29894>>>// Note that you can apply normal windows mask-signs in the filename such as * and ?
29894>>>// Example: Get vFilePathExists "C:\config.sy?"
29894>>>// This will return true if you have a file matching these conditions. (aka config.sys)
29894>>>Function vFilePathExists Global String sFilePathMask Returns Integer
29896>>>  String  sWin32FindData
29896>>>  String  sLongFileName
29896>>>  Pointer lpsFilePathMask lpsWin32FindData
29896>>>  Handle  hFindFile
29896>>>  Integer iVoid iRetval bFound
29896>>>
29896>>>  GetAddress Of sFilePathMask To lpsFilePathMask
29897>>>  ZeroType vWin32_Find_Data To sWin32FindData
29898>>>  GetAddress Of sWin32FindData To lpswin32FindData
29899>>>  Move (vWin32_FindFirstFile (lpsFilePathMask, lpsWin32FindData)) To hFindFile
29900>>>  Move (vWin32_FindClose (hFindFile)) To iVoid
29901>>>  Function_Return (hFindFile <> vINVALID_HANDLE_VALUE)
29902>>>End_Function // vFilePathExists
29903>>>
29903>>>
29903>>>// **WvA
29903>>>// Formats a foldername by first trimming it and after that by sticking a
29903>>>// directory separator (/\) to the end if it doesn't have one there already.
29903>>>// The folder may contain a drive letter or UNC encoding.
29903>>>Function vFolderFormat Global String sFolderName Returns String
29905>>>  String sDirSep
29905>>>  Move (sysconf(SYSCONF_DIR_SEPARATOR)) To sDirSep  // normally \ (backslash)
29906>>>  Move (Trim(sFolderName)) To sFolderName
29907>>>  If (Right(sFolderName,1)<>sDirSep) Begin
29909>>>    Move (sFolderName+sDirSep) To sFolderName
29910>>>  End
29910>>>>
29910>>>  Function_Return sFolderName
29911>>>End_Function // vFolderFormat   
29912>>>
29912>>>//
29912>>>// Gets the parent path of the currently supplied path
29912>>>// Returns "" when we are at the root folder.
29912>>>//
29912>>>Function vParentPath Global String sPath Returns String 
29914>>>  String sStrip
29914>>>  
29914>>>  If (Right(sPath,1)="\") Begin
29916>>>    Move (Left(sPath,Length(sPath)-1)) To sPath
29917>>>  End
29917>>>>
29917>>>  If (Pos("\",sPath)) Begin
29919>>>    Move (StringFromRightOfChar(sPath,"\")) To sStrip
29920>>>    Move (Replace(sStrip,sPath,"")) To sPath
29921>>>  End
29921>>>>
29921>>>  Else Begin
29922>>>    Move "" To sPath
29923>>>  End
29923>>>>
29923>>>  Function_Return sPath
29924>>>End_Function // vParentPath
29925>>>
29925>Use seq_chnl.pkg
29925>Use btGlobal.pkg
Including file: btGlobal.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\btGlobal.pkg)
29925>>>//-2WA
29925>>>//------------------------------------------------------------------------
29925>>>// Estruturas utilizadas pelo sistema
29925>>>//------------------------------------------------------------------------
29925>>>    Struct stDefaultValues
29925>>>        String id
29925>>>        String label
29925>>>        String value
29925>>>        String recId
29925>>>    End_Struct //stDefaultValues
29925>>>
29925>>>    Struct stDefaultMessage
29925>>>        Boolean hasError
29925>>>         String msgError
29925>>>         String msgInfo
29925>>>         String msgSession
29925>>>         String msgStep
29925>>>    End_Struct //stDefaultMessage
29925>>>
29925>>>    Struct stCampos
29925>>>        String  id
29925>>>        String  data
29925>>>        String  title
29925>>>        Boolean sortable
29925>>>        Boolean visible
29925>>>    End_Struct // stCampos
29925>>>    
29925>>>    Struct stIdValueClasse
29925>>>        String id
29925>>>        String value
29925>>>        String classe
29925>>>    End_Struct //stIdValueClasse
29925>>>
29925>>>    Struct stIdValue
29925>>>        String id
29925>>>        String value
29925>>>    End_Struct //stIdValue
29925>>>    
29925>>>    Struct stIdValue_I
29925>>>        Integer id
29925>>>        String value
29925>>>    End_Struct //stIdValue
29925>>>    
29925>>>    Struct stIdValueURL
29925>>>        stDefaultMessage msg
29925>>>        stDefaultMessage msg
29925>>>        Integer id
29925>>>         String value
29925>>>         String url
29925>>>         String size
29925>>>         String tipoDoc
29925>>>    End_Struct //stIdValueURL
29925>>>
29925>>>    Struct stCombo
29925>>>        String ID
29925>>>        String DS
29925>>>        String DS2
29925>>>    End_Struct //stCombo
29925>>>    
29925>>>    Struct stDate
29925>>>        Date value
29925>>>        String type //'date'
29925>>>    End_Struct //stDate
29925>>>
29925>>>    Struct stValueType
29925>>>        String value
29925>>>        String type //'ico'
29925>>>    End_Struct //stValueType
29925>>>
29925>>>    Struct stDefaultMsgRecId
29925>>>        stDefaultMessage defaultMessage
29925>>>        stDefaultMessage defaultMessage
29925>>>                  String recId
29925>>>    End_Struct //stDefaultMsgRecId
29925>>>
29925>>>    Struct stTaxas
29925>>>        String id
29925>>>        String value
29925>>>        String value2
29925>>>        String classe
29925>>>    End_Struct //stTaxas
29925>>>
29925>>>    Struct stTaxasPorProduto
29925>>>        String id
29925>>>        String value
29925>>>        String classe
29925>>>        String produto
29925>>>    End_Struct //stTaxasPorProduto
29925>>>    
29925>>>    Struct st_TABELA
29925>>>        String  ID
29925>>>        String  DS
29925>>>        Integer SEL
29925>>>    End_Struct //st_TABELA
29925>>>    
29925>>>    Struct stPesquisaTABELA
29925>>>        st_TABELA[] dados
29925>>>        st_TABELA[] dados
29925>>>        Number qtdLinhas
29925>>>    End_Struct //stPesquisaTABELA
29925>>>    
29925>>>    Struct st_negociation
29925>>>        String aTaxas
29925>>>        Number aValor
29925>>>        String aMoeda
29925>>>        String aObs
29925>>>        String aRecnum
29925>>>        String aMoeda_DS
29925>>>        String aModPagto
29925>>>        String venda
29925>>>        String classe
29925>>>        Number aValorMin
29925>>>        Number aValorMax
29925>>>    End_Struct //st_negociation
29925>>>    
29925>>>    //- Negociacao de Taxas Aereo
29925>>>    Struct st_ngtTaxAir
29925>>>       stCombo moeda
29925>>>       stCombo moeda
29925>>>        Number valor
29925>>>        Number vlMin
29925>>>        Number vlMax
29925>>>       stCombo tpCalculo
29925>>>       stCombo tpCalculo
29925>>>       stTaxas taxa
29925>>>       stTaxas taxa
29925>>>     stIdValue modPagamento
29925>>>     stIdValue modPagamento
29925>>>       stCombo tpMotivo
29925>>>       stCombo tpMotivo
29925>>>       stCombo infoCompl
29925>>>       stCombo infoCompl
29925>>>    End_Struct //st_ngtTaxAir
29925>>>
29925>>>    Struct st_negociationAir
29925>>>        String recId
29925>>>  st_ngtTaxAir venda      
29925>>>  st_ngtTaxAir venda      
29925>>>        String classe
29925>>>        String DS_T
29925>>>        String N_Note
29925>>>        String edit
29925>>>    End_Struct //st_negociationAir
29925>>>    
29925>>>    //- Negociacao de Taxas FCL
29925>>>    Struct st_ngtTaxFcl
29925>>>       stCombo equipamento
29925>>>       stCombo equipamento
29925>>>       stCombo moeda
29925>>>       stCombo moeda
29925>>>        Number valor
29925>>>        Number vlMin
29925>>>        Number vlMax
29925>>>       stCombo tpCalculo
29925>>>       stCombo tpCalculo
29925>>>       stTaxas taxa
29925>>>       stTaxas taxa
29925>>>     stIdValue modPagamento
29925>>>     stIdValue modPagamento
29925>>>    End_Struct //st_ngtTaxFcl
29925>>>
29925>>>    Struct st_negociationFcl
29925>>>        String recId
29925>>>  st_ngtTaxFcl venda      
29925>>>  st_ngtTaxFcl venda      
29925>>>        String classe
29925>>>        String DS_T
29925>>>        String N_Note
29925>>>        String edit
29925>>>    End_Struct //st_negociationFcl
29925>>>    
29925>>>    Struct stSchedule
29925>>>        String armador            
29925>>>        String nomeAgente         
29925>>>        String nomeNavio          
29925>>>        String numeroViagem       
29925>>>        String eta                
29925>>>        String deadlineCraft      
29925>>>        String horaDeadlineCraft  
29925>>>        String numeroConsolidada  
29925>>>        String prev               
29925>>>        String dlimo              
29925>>>        String dldta              
29925>>>        String dl      
29925>>>        String dlvgm
29925>>>        String dldraft   
29925>>>        String dlcliente   
29925>>>        //FCL 
29925>>>        String book_armador   
29925>>>        String obsconsol
29925>>>        String terminal
29925>>>        String agmaritima
29925>>>        String agemissaobl
29925>>>        String margem
29925>>>        String supervisor
29925>>>        String dtchegada  
29925>>>        String ftarmador   
29925>>>        String ftcliente   
29925>>>        String documentacao
29925>>>        String master_armador
29925>>>        
29925>>>        String dlhr        
29925>>>        String dldrafthr   
29925>>>        String dlimohr     
29925>>>        String dlvgmhr    
29925>>>        String dlclientehr 
29925>>>        
29925>>>    End_Struct //stSchedule
29925>>>    
29925>>>    Struct stScheduleTruck
29925>>>        String dataDeadline
29925>>>        String dataSaida
29925>>>        String dataChegada
29925>>>        String numConhecimento
29925>>>        String consolidadaTruck
29925>>>    End_Struct //stScheduleTruck
29925>>>    
29925>>>    Struct stTarifarioGravacao
29925>>>        String sCONTAINER
29925>>>        String sCARRIER_ID
29925>>>        String sCCGS202_ID
29925>>>        String sCSAG308_ID
29925>>>        String sTAXA_CLASSE
29925>>>        String sTAXA_ID
29925>>>        String sOBSERVACOES
29925>>>        String sVENDA_MODPGTO
29925>>>        String sVENDA_MOEDA
29925>>>        Integer sVENDA_TPCALC
29925>>>        String sVENDA_VLMIN
29925>>>        String sVENDA_VLMAX
29925>>>        String sVENDA_VALOR
29925>>>        String sCOMPRA_MODPGTO
29925>>>        String sCOMPRA_MOEDA
29925>>>        Integer sCOMPRA_TPCALC
29925>>>        String sCOMPRA_VLMIN
29925>>>        String sCOMPRA_VLMAX
29925>>>        String sCOMPRA_VALOR
29925>>>        String sDESCRICAO
29925>>>        String sTRANSIT_TIME
29925>>>        String sCSAG345_ID_ORIGEM
29925>>>        String sCSAG345_ID_DESTINO
29925>>>        String sCSAG346_ID_ORIGEM
29925>>>        String sCSAG346_ID_DESTINO
29925>>>        
29925>>>        String sPERCENTUAL_TIPO_V
29925>>>        String sPERCENTUAL_APLICA_V 
29925>>>        String sPESO_FAIXA_V
29925>>>        String sPESO_UNIDADE_V
29925>>>        
29925>>>        String sPERCENTUAL_TIPO_C
29925>>>        String sPERCENTUAL_APLICA_C 
29925>>>        String sPESO_FAIXA_C
29925>>>        String sPESO_UNIDADE_C
29925>>>        
29925>>>        String sDT_FINAL
29925>>>        String sFREQUENCIA
29925>>>        String sWEIGHT     
29925>>>        String sWEIGHT_TYPE
29925>>>        String sVOLUME     
29925>>>        String sVOLUME_TYPE
29925>>>        String sCSAG325_DESTINO
29925>>>        String sCSAG325_ORIGEM 
29925>>>        String sCSAG325_VIA    
29925>>>        String sCSAG329_DESTINO
29925>>>        String sCSAG329_ORIGEM 
29925>>>        String sINCOTERM
29925>>>        String sTABELA
29925>>>        String STABELA_ID
29925>>>        String sFREETIME
29925>>>        String sFORNECEDOR
29925>>>        String sRATIO_CBMKG_DENSIDADE
29925>>>        String sVENDA_TPCALC_DSC
29925>>>        String sVENDA_VALOR_OBS
29925>>>        String sCOMPRA_TPCALC_DSC
29925>>>        String sCOMPRA_VALOR_OBS
29925>>>End_Struct //stTarifarioGravacao
29925>>>
29925>>>Struct st_ValorPorEquipamento
29925>>>   Integer iTP_CALCULO_V
29925>>>    Number nVL_VENDA    
29925>>>    Number nVL_MINIMO_V 
29925>>>    Number nVL_MAXIMO_V 
29925>>>    Number nVL_FRETE_V
29925>>>    String sCONTAINER   
29925>>>    String sAux1        
29925>>>    String sAux2        
29925>>>    String sAux3        
29925>>>End_Struct //st_ValorPorEquipamento
29925>>>
29925>>>Struct stCityCountryTrade
29925>>>    String id
29925>>>    String value
29925>>>    String pais
29925>>>    String uf
29925>>>    String trade
29925>>>    String icao
29925>>>    String iata
29925>>>    String port
29925>>>End_Struct //stCityCountryTrade
29925>>>
29925>>>Struct stCityCountryTradeMsg
29925>>>   stCityCountryTrade[] aCityCountryTrade
29925>>>   stCityCountryTrade[] aCityCountryTrade
29925>>>   stDefaultMessage aMessage
29925>>>   stDefaultMessage aMessage
29925>>>End_Struct
29925>>>
29925>>>Struct stReportTitle
29925>>>    String sTitle
29925>>>    String sICO
29925>>>    String sCampo
29925>>>End_Struct //stReportTitle
29925>>>
29925>>>Struct stLogMail
29925>>>    String   fromMail             //Type:ASC, Size:200  
29925>>>    String   replaytoMail         //Type:ASC, Size:200  
29925>>>    String   toMail               //Type:ASC, Size:1024  
29925>>>    String   ccMail               //Type:ASC, Size:1024  
29925>>>    String   bccMail              //Type:ASC, Size:1024  
29925>>>    String   subjectMail          //Type:ASC, Size:250  
29925>>>    String   msgMail              //Type:TEX, Size:2048  
29925>>>    String   ipusuarioMail        //Type:ASC, Size:20   
29925>>>    String   idenviadoMail        //Type:ASC, Size:1    
29925>>>    DateTime dthrenviadoMail      //Type:DTM, Size:26   
29925>>>    String   anexoMail            //Type:ASC, Size:250      
29925>>>    Integer  idanexoMail          //Type:NUM, Size:14.0  
29925>>>    String   htmlbodyMaIL         //Type:ASC, Size:250      
29925>>>End_Struct //stLogMail
29925>>>
29925>>>
29925>>>//ESTRUTURAS PARA A NOVA PROPOSTA -- INICIO
29925>>>
29925>>>Struct stDoor
29925>>>    String pais
29925>>>    Integer cidade
29925>>>    String cep
29925>>>    String endereco
29925>>>End_Struct
29925>>>
29925>>>Struct stOrigemDestino
29925>>>    String pais
29925>>>    Integer cidade
29925>>>    stDoor door
29925>>>    stDoor door
29925>>>End_Struct
29925>>>
29925>>>Struct stDimensao
29925>>>    Number L
29925>>>    Number W
29925>>>    Number H
29925>>>    String un
29925>>>End_Struct
29925>>>
29925>>>Struct stValorUn
29925>>>    Number valor
29925>>>    String un
29925>>>End_Struct
29925>>>
29925>>>Struct stOutros
29925>>>    Boolean status
29925>>>    String texto
29925>>>End_Struct
29925>>>
29925>>>Struct stMercadorias    
29925>>>    Integer id
29925>>>    Integer     mercadoria
29925>>>    String      descricao
29925>>>    String      ncm
29925>>>    String      un
29925>>>    String      pkg
29925>>>    String      classe
29925>>>    String      subrisk
29925>>>End_Struct
29925>>>
29925>>>Struct stContainer
29925>>>    Integer id
29925>>>    Integer pcs
29925>>>    Integer package
29925>>>    stValorUn weight
29925>>>    stValorUn weight
29925>>>    stDimensao dimensoes
29925>>>    stDimensao dimensoes
29925>>>    stValorUn grossWeight
29925>>>    stValorUn grossWeight
29925>>>    stValorUn volume
29925>>>    stValorUn volume
29925>>>    Boolean imo
29925>>>    Boolean bagagem
29925>>>    Boolean consumoHumano
29925>>>    Boolean nonEmpilhavel
29925>>>    Boolean consumoAnimal
29925>>>    stOutros outros
29925>>>    stOutros outros
29925>>>    stMercadorias[] mercadorias  
29925>>>    stMercadorias[] mercadorias  
29925>>>End_Struct
29925>>>
29925>>>Struct stInfoGeral
29925>>>    Integer id
29925>>>    Integer cliente
29925>>>    Integer marca
29925>>>    Integer operacao
29925>>>    String incoterm
29925>>>    Integer embarque
29925>>>    String modalidade
29925>>>    stOrigemDestino origem
29925>>>    stOrigemDestino origem
29925>>>    stOrigemDestino destino
29925>>>    stOrigemDestino destino
29925>>>        Integer clienteFinal
29925>>>        stContainer[] containers
29925>>>        stContainer[] containers
29925>>>        String aUsuarioSessao
29925>>>End_Struct
29925>>>
29925>>>Struct stLiteralValor
29925>>>    String literal
29925>>>    String valor
29925>>>End_Struct
29925>>>
29925>>>Struct tOAuth2Response
29925>>>    String access_token
29925>>>   Integer expires_in
29925>>>    String token_type
29925>>>End_Struct
29925>>>
29925>>>Struct tError
29925>>>    Integer code
29925>>>    String message
29925>>>End_Struct
29925>>>
29925>>>Struct tInfos
29925>>>   Integer proposta
29925>>>    String incoterms
29925>>>    String pol
29925>>>    String pod
29925>>>    String operacao
29925>>>    String caracEmbarque
29925>>>   Integer cliente
29925>>>    String clienteFantasia
29925>>>   Integer agenteOrigem
29925>>>    String agenteOrigemFantasia
29925>>>End_Struct
29925>>>
29925>>>Struct stReportCCGS250
29925>>>    String sRecnum
29925>>>    String referenciaId
29925>>>    String referenciaDs
29925>>>    String texto
29925>>>End_Struct //stReportCCGS250
29925>>>
29925>>>Struct stSaveCCGS250
29925>>>    stDefaultMessage aDefaultMessage
29925>>>    stDefaultMessage aDefaultMessage
29925>>>    stReportCCGS250[] aReportCCGS250
29925>>>    stReportCCGS250[] aReportCCGS250
29925>>>End_Struct
29925>>>
29925>>>//FIM
29925>Use MSSQL_2WA.pkg
Including file: MSSQL_2WA.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\MSSQL_2WA.pkg)
29925>>>//-2WA
29925>>>//*******************************************************************
29925>>>// 21/03/2012 - Fernando Emiliano David Nunes - Criacao do Pacote
29925>>>//*******************************************************************
29925>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote MS-SQLSERVER
29925>>>//*******************************************************************
29925>>>
29925>>>
29925>>>//****** NO INCLUIR "MAX_ROW_FETCHED" NO .INT
29925>>>//****** SEMPRE APAGAR O .CCH PARA QUALQUER ALTERAO NO .INT
29925>>>//****** Ajudar o Banco de Dados com indices (cabeas de chave)
29925>>>
29925>>>// ***********************************
29925>>>//   EXEMPLO:
29925>>>// ***********************************
29925>>>//Object oDicionario is a c_DataDictionary    
29925>>>//
29925>>>//   FILTER_PREPARE //MANTEM OS RECURSOS DO DICIONARIO DE DADOS
29925>>>//         OR
29925>>>//   FILTER_PREPARE NOSERVER //DESATIVA OS RECURSOS DE DICIONARIO DE DADOS: PODE FICAR UM POUCO + RAPIDO
29925>>>//
29925>>>//   Procedure onFilterConstrain  
29925>>>//       FILTER_CONSTRAIN (SFormat("data BETWEEN %1 and %2"   , ToDB2Date(dDataInicial), toDB2Date(dDataFinal))) 
29925>>>//       FILTER_CONSTRAIN (SFormat("empresa BETWEEN %1 and %2", iEmpInicial, iEmpFinal))) 
29925>>>//       FILTER_CONSTRAIN (SFormat("saldo >= %1"              , ToDB2Number(nSaldo))) 
29925>>>//   End_Procedure // onFilterConstrain 
29925>>>//
29925>>>//End_Object // oDicionario
29925>>>//
29925>>>
29925>>>//EXEMPLO COM cWebReport:
29925>>>//
29925>>>//Object oRelatorio is a cWebReport_Filter
29925>>>//End_Object // oRelatorio
29925>>>//
29925>>>//
29925>>>
29925>>>//EXEMPLO COM Leitura pelo DD:
29925>>>//
29925>>>//FILTER_DATADICTIONARY_BEGIN hDD
29925>>>//    Send Request_Find of hDD FIRST_RECORD (Main_File(hDD)) iIndex
29925>>>//    Repeat
29925>>>//       If (Found) Begin
29925>>>//            if TemQueAbortarAntesDoFinal begin
29925>>>//               FILTER_DATADICTIONARY_RELEASE hDD //*******<--- IMPORTANTE
29925>>>//               procedure_return
29925>>>//            end   
29925>>>//            :
29925>>>//            : 
29925>>>//            :
29925>>>//            Send Request_Find of hDD NEXT_RECORD (Main_File(hDD)) iIndex
29925>>>//        end
29925>>>//    Until (iSai=1)
29925>>>//    Move 0 to iSai
29925>>>//FILTER_DATADICTIONARY_END hDD
29925>>>//
29925>>>Use MSSQLDRV.pkg
Including file: MSSqldrv.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\MSSqldrv.pkg)
29925>>>>>//*****************************************************************************
29925>>>>>//*** MSSQLDRV.PKG                                                          ***
29925>>>>>//***                                                                       ***
29925>>>>>//*** Author: Ben Weijers                                                   ***
29925>>>>>//***         Data Access Nederland                                         ***
29925>>>>>//***         29 June 1998                                                  ***
29925>>>>>//***                                                                       ***
29925>>>>>//***                                                                       ***
29925>>>>>//*** Purpose:                                                              ***
29925>>>>>//***   Package that declares MS SQL driver constants and functions.        ***
29925>>>>>//****                                                                      ***
29925>>>>>//***   This package can be used by developers who want to add Data Access  ***
29925>>>>>//***   MS SQL Client specific code to a DataFlex application.              ***
29925>>>>>//***   Updated:  June 4th 2012 (Current CK build: 5.1.0.96)                ***
29925>>>>>//***             Changed EnumerateServers function to use the highest      ***
29925>>>>>//***             available SQL Server client driver.                       ***
29925>>>>>//***             Moved SQL Server client constants from cli.pkg to         ***
29925>>>>>//***             mssqldrv.pkg                                              ***
29925>>>>>//***   Updated:  November 6th 2013 (Current CK build: 6.0.0.19)            ***
29925>>>>>//***             Added constants for SQL Server specific native types      ***
29925>>>>>//***             ( var...(max) types, money types, datetime types)         ***
29925>>>>>//*****************************************************************************
29925>>>>>
29925>>>>>Use Cli.pkg
29925>>>>>Use SQL.pkg
29925>>>>>
29925>>>>>//*** Driver Indentification
29925>>>>>
29925>>>>>//*** Error number constants
29925>>>>>
29925>>>>>
29925>>>>>//*** Possible DF_DRIVER_SQLSERVER_CLIENT_VERSION values
29925>>>>>
29925>>>>>
29925>>>>>
29925>>>>>
29925>>>>>// SQL Server spcific types. 
29925>>>>>Define SQL_SS_TIMESTAMPOFFSET   for   (-155) //SQL server datetimeoffset type */
29925>>>>>Define SQL_SS_TIME2             for   (-154) //SQL server time type */
29925>>>>>Define SQL_SS_XML               for   (-152) //SQL server xml type */
29925>>>>>Define SQL_SS_VARIANT           for   (-150) //SQL server variant type */
29925>>>>>
29925>>>>>// SQL Server spcific types. 
29925>>>>>Define SQL_TYPE_TIMESTAMP2      for   (-200) //SQL server datetime2 type */
29925>>>>>Define SQL_VARCHARMAX           for   (-201) //SQL server varchar(max) type */
29925>>>>>Define SQL_WVARCHARMAX          for   (-202) //SQL server wvarchar(max) type */
29925>>>>>Define SQL_VARBINARYMAX         for   (-203) //SQL server varbinary(max) type */
29925>>>>>Define SQL_TYPE_MONEY           for   (-204) //SQL server money type */
29925>>>>>Define SQL_TYPE_SMALLMONEY      for   (-205) //SQL server smallmoney type */
29925>>>>>Define SQL_TYPE_SMALLDATETIME   for   (-206) //SQL server smalldatetype type */
29925>>>>>
29925>>>>>
29925>>>>>//*****************************************************************************
29925>>>>>//*** MSSQL_SetConstraint <FileNum> <ConstraintText>                        ***
29925>>>>>//***                                                                       ***
29925>>>>>//***   Setup a constraint for a file.                                      ***
29925>>>>>//*****************************************************************************
29925>>>>>
29925>>>>>
29925>>>>>
29925>>>>>Class cMSSQLHandler Is A cCLIHandler
29926>>>>>
29926>>>>>    Procedure Construct_Object
29928>>>>>        Forward Send Construct_Object
29930>>>>>
29930>>>>>        Set psDriverID To MSSQLDRV_ID
29931>>>>>    End_Procedure // Construct_Object
29932>>>>>
29932>>>>>
29932>>>>>
29932>>>>>    //***
29932>>>>>    //*** Function: ExtractList
29932>>>>>    //*** Purpose : Extract the list from the out connect string.
29932>>>>>    //***
29932>>>>>
29932>>>>>    Function ExtractList String sOutConnStr Integer hoStore Returns Integer
29934>>>>>        Local String  sItem
29934>>>>>        Local Integer iStart
29934>>>>>        Local Integer iEnd
29934>>>>>
29934>>>>>        If (hoStore = 0) ;            Move Current_object To hoStore
29937>>>>>
29937>>>>>        Send Delete_Data To hoStore
29938>>>>>        Move (Pos("{", sOutConnStr)) To iStart
29939>>>>>        While (iStart > 0)
29943>>>>>            Move (Right(sOutConnStr, Length(sOutConnStr) - iStart)) To sOutConnStr
29944>>>>>            If (Left(sOutConnStr, 1) = "}") ;                Move 0 To iStart
29947>>>>>            Else Begin
29948>>>>>                Move (Pos(",", sOutConnStr)) To iStart
29949>>>>>                Move (Pos("}", sOutConnStr)) To iEnd
29950>>>>>                If ((iStart = 0) Or (iEnd < iStart)) ;                    Move iEnd To iStart
29953>>>>>
29953>>>>>                If (iStart > 0) ;                    Set Value Of hoStore Item (Item_Count(Current_Object)) To (Left(sOutConnStr, iStart - 1))
29956>>>>>
29956>>>>>                If (iStart = iEnd) ;                    Move 0 To iStart
29959>>>>>            End
29959>>>>>>
29959>>>>>        Loop
29960>>>>>>
29960>>>>>
29960>>>>>        Function_Return (Item_Count(hoStore))
29961>>>>>    End_Procedure // ExtractList
29962>>>>>
29962>>>>>
29962>>>>>
29962>>>>>    //***
29962>>>>>    //*** Function: BrowseConnect
29962>>>>>    //*** Purpose : Call the driver's browse connect function
29962>>>>>    //***
29962>>>>>
29962>>>>>    Function BrowseConnect String sInConnStr Returns String
29964>>>>>        Local String  sDriver
29964>>>>>        Local String  sOutConnStr
29964>>>>>        Local Integer iArg
29964>>>>>        Local Integer iRetval
29964>>>>>
29964>>>>>        Get psDriverID To sDriver
29965>>>>>        If (sDriver <> "") Begin
29967>>>>>            Move (Repeat(" ", 8192)) To sOutConnStr
29968>>>>>            Call_Driver 0 sDRiver Function CLI_BROWSECONNECT Callback 0 Passing sInConnStr sOutConnStr iArg Result iRetval
29973>>>>>        End
29973>>>>>>
29973>>>>>
29973>>>>>        Function_Return sOutConnStr
29974>>>>>    End_Function// BrowseConnect
29975>>>>>
29975>>>>>    Function DriverIndex String sDriver Returns Integer
29977>>>>>    
29977>>>>>        Local String  sCurrentDriver
29977>>>>>        Local Integer iNumberOfDrivers iDriver iCount
29977>>>>>    
29977>>>>>        Move 0 to iDriver
29978>>>>>    
29978>>>>>        Get_Attribute DF_NUMBER_DRIVERS to iNumberOfDrivers
29981>>>>>        For iCount from 1 to iNumberOfDrivers
29987>>>>>>
29987>>>>>    
29987>>>>>            Get_Attribute DF_DRIVER_NAME of iCount to sCurrentDriver
29990>>>>>            If ( Uppercase(sCurrentDriver) = Uppercase(sDriver) ) Begin
29992>>>>>                Move iCount to iDriver
29993>>>>>            End
29993>>>>>>
29993>>>>>        Loop
29994>>>>>>
29994>>>>>    
29994>>>>>        Function_Return iDriver
29995>>>>>    
29995>>>>>    End_Function 
29996>>>>>
29996>>>>>    //***
29996>>>>>    //*** Procedure: EnumerateServers
29996>>>>>    //*** Purpose  : Enumerate the available SQL Server database servers
29996>>>>>    //***
29996>>>>>    Function EnumerateServers Returns Integer
29998>>>>>        Local String  sServerList
29998>>>>>        Local Integer iNumServers
29998>>>>>        Local Integer iDriver
29998>>>>>        Local Integer iClientVersion
29998>>>>>        Local String  sDriver
29998>>>>>        
29998>>>>>        Get DriverIndex MSSQLDRV_ID to iDriver
29999>>>>>        
29999>>>>>        Get_Attribute DF_DRIVER_SQLSERVER_CLIENT_VERSION of iDriver to iClientVersion
30002>>>>>        
30002>>>>>        If (iClientVersion = SQLSERVER2012CLIENT) Begin
30004>>>>>            Move SQLSERVER2012DRVRSTR to sDriver
30005>>>>>        End
30005>>>>>>
30005>>>>>        Else Begin
30006>>>>>            If (iClientVersion = SQLSERVER2008CLIENT) Begin
30008>>>>>                Move SQLSERVER2008DRVRSTR to sDriver
30009>>>>>            End  
30009>>>>>>
30009>>>>>            Else Begin
30010>>>>>                If (iClientVersion = SQLSERVER2005CLIENT) Begin
30012>>>>>                    Move SQLSERVER2005DRVRSTR to sDriver
30013>>>>>                End  
30013>>>>>>
30013>>>>>                Else Begin
30014>>>>>                    Move SQLSERVER2000DRVRSTR to sDriver 
30015>>>>>                End
30015>>>>>>
30015>>>>>            End
30015>>>>>>
30015>>>>>        End
30015>>>>>>
30015>>>>>
30015>>>>>        Move ("DRIVER={" + sDriver + "};") to sDriver
30016>>>>>        Get BrowseConnect sDriver to sServerList
30017>>>>>        Get ExtractList sServerList Current_object To iNumServers
30018>>>>>        Function_Return iNumServers
30019>>>>>    End_Function // EnumerateServers
30020>>>>>
30020>>>>>    //***
30020>>>>>    //*** Function: EnumerateDatabases
30020>>>>>    //*** Purpose : Enumerate database in a given server.
30020>>>>>    //***
30020>>>>>
30020>>>>>    Function EnumerateDatabases String sServer String sUser String sPassWord Returns Integer
30022>>>>>        Local Integer hoSQL
30022>>>>>        Local String  sConnect
30022>>>>>        Local String  sDatabase
30022>>>>>        Local Integer hdbc
30022>>>>>        Local Integer hstmt
30022>>>>>        Local Integer iFetchResult
30022>>>>>
30022>>>>>        If (Num_Arguments < 3) ;            Move "" To sPassWord
30025>>>>>        If (Num_Arguments < 2) ;            Move "" To sUser
30028>>>>>
30028>>>>>        If (sUser <> "") ;            Move ("SERVER=" + Trim(sServer) + ";UID=" + Trim(sUser) + ";PWD=" + Trim(sPassword) + ";") To sConnect
30031>>>>>        Else ;            Move ("SERVER=" + Trim(sServer) + ";Trusted_Connection=yes") To sConnect
30033>>>>>
30033>>>>>        Object oEnumDBSQLmanager Is A cSQLHandleManager
30035>>>>>            Move Current_Object To hoSQL
30036>>>>>        End_Object // oEnumDBSQLManager
30037>>>>>
30037>>>>>        If (hoSQL <> 0) Begin
30039>>>>>            Get SQLConnect Of hoSQL "MSSQLDRV" sConnect To hdbc
30040>>>>>            If (hdbc <> 0) Begin
30042>>>>>                Get SQLOpen Of hdbc To hstmt
30043>>>>>                If (hstmt <> 0) Begin
30045>>>>>                    //*** We could do a direct select on the sysdatabases table but we use
30045>>>>>                    //*** the stored procedure sp_database instead. SQL Server recommends this
30045>>>>>                    //*** approach in case meta data might change, the stored procedure will
30045>>>>>                    //*** stay the same.
30045>>>>>                    Send SQLSetProcedureName To hstmt "sp_databases"
30046>>>>>                    Send SQLCall To hstmt
30047>>>>>                    Repeat
30047>>>>>>
30047>>>>>                        Get SQLFetch Of hstmt To iFetchResult
30048>>>>>                        If (iFetchResult <> 0) Begin
30050>>>>>                            Get SQLColumnValue Of hstmt 1 To sDatabase
30051>>>>>                            Set Value Item (Item_Count(Current_Object)) To sDatabase
30052>>>>>                        End
30052>>>>>>
30052>>>>>                    Until (iFetchResult = 0)
30054>>>>>
30054>>>>>                    Send SQLClose To hstmt
30055>>>>>                End
30055>>>>>>
30055>>>>>                Send SQLDisconnect To hdbc
30056>>>>>            End
30056>>>>>>
30056>>>>>        End
30056>>>>>>
30056>>>>>        Send Destroy_Object To hoSQL
30057>>>>>
30057>>>>>        Function_return (Item_Count(Current_Object))
30058>>>>>    End_Function // EnumerateDatabases
30059>>>>>
30059>>>>>End_Class // cMSSQLHandler
30060>>>>>
30060>>>//**********************************************************************************
30060>>>//  ADAPTACAO
30060>>>//**********************************************************************************
30060>>>//*** Global object handle for the manager
30060>>>Integer _embsqlghoSQLHandleMngr
30060>>>
30060>>>//***
30060>>>//*** Function: CreateSQLManager
30060>>>//*** Purpose : Create the embedded SQL manager, this is an internal function!
30060>>>//***
30060>>>
30060>>>
30060>>>
30060>>>Function CreateSQLmanager for cDesktop Returns Integer
30062>>>    Local Integer hoSQlMngr
30062>>>
30062>>>    Object oSQLHandleManager is a cSQLHandleManager
30064>>>        Move Current_object to hoSQLMngr
30065>>>    End_Object // oSQLHandleManager
30066>>>
30066>>>    Function_Return hoSQLMngr
30067>>>End_Function // CreateSQLMngr
30068>>>
30068>>>
30068>>>//*** Make sure the object is global by creating it under DESKTOP
30068>>>Get CreateSQLManager of Desktop to _embsqlghoSQLHandleMngr
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLSetConnect                                                ***
30069>>>//*** Purpose: Setup default connection information for embedded SQL.       ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLSetConnect sSDriverId sConnectString                      ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLConnect                                                   ***
30069>>>//*** Purpose: Connect to a server for embedded SQL usage.                  ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLConnect To hdbc                                           ***
30069>>>//***          SQLConnect [sDriverId sConnectString] To hdbc                ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLFileConnect                                               ***
30069>>>//*** Purpsoe: Return the handle to a connection of an open file. This      ***
30069>>>//***          connection is (obviously) already opened. We are just using  ***
30069>>>//***          the same connection for Embedded SQL. This allows the        ***
30069>>>//***          programmer not to know connection details.                   ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLFileConnect Filex To hdbc                                 ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLDisconnect                                                ***
30069>>>//*** Purpose: Connect to a server for embedded SQL usage.                  ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLDisConnect hdbc                                           ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLOpen                                                      ***
30069>>>//*** Purpose: Allocate the memory to stroe statement information.          ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLOpen hdbc To hstmt                                        ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLClose                                                     ***
30069>>>//*** Purpose: Close a statement and free all associated memory.            ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLClose hstmt                                               ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLPrepare                                                   ***
30069>>>//*** Purpose: Prepare a statement for execution.                           ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLPrepare hstmt sStatement                                  ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLExecute                                                   ***
30069>>>//*** Purpose: Execute a prepared statement                                 ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLExecute hstmt                                             ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLExecDirect                                                ***
30069>>>//*** Purpose: Prepare and execute a statement.                             ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLExecDirect hstmt sStatement                               ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLFileFetch                                                 ***
30069>>>//*** Purpose: Get a row from a statement result set.                       ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLFileFetch hstmt [To File1 [File2 ...]]                    ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLBindFetchFile                                             ***
30069>>>//*** Purpose: Binds a file number to a statement so it can be used for     ***
30069>>>//***          fetching data. Only needed in non fileconnect. Note that     ***
30069>>>//***          can be assigned to the connection or the statement handle    ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLBindFileForFetch hstmt|hdbc FileName|FileNumber           ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLFetch                                                     ***
30069>>>//*** Purpose: Get a row from a statement result set.                       ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLFetch hstmt [To Var1 [Var2 ...]]                          ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLGetData                                                   ***
30069>>>//*** Purpose: Get a column's data.                                         ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLGetData hstmt iColumnNUmber [Length iLen] To Var          ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLColumnMap                                                 ***
30069>>>//*** Purpose: Determine the column number based on the column name.        ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLColumnMap hstmt sColName To iColNumber                    ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLColAttribute                                              ***
30069>>>//*** Purpose: Get an attribute of a column in a statements result set.     ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLColAttribute hstmt iCol iAttrId To sAttrib                ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLStmtAttribute                                             ***
30069>>>//*** Purpose: Get an atribute of a statement.                              ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLStmtAttribute hstmt iAttribId To sAttrib                  ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLCall                                                      ***
30069>>>//*** Purpose: Call a stored procedure.                                     ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLCall hstmt ProcedureName SchemaName [Arg1 ...] [To Var]   ***
30069>>>//***          You can pass "" for SchemaName.                              ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLGetArguments                                              ***
30069>>>//*** Purpsoe: Get the arguments of a stored procedure. This command should ***
30069>>>//***          be used when a procedure has multiple result sets. Some      ***
30069>>>//***          backends (SQL SErver for example) will return these as the   ***
30069>>>//***          last result set. This emans you first process all other      ***
30069>>>//***          result sets and then get the arguments and return value.     ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLGetArguments hstmt [Arg1...] [To Var]                     ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLNextResultSet                                             ***
30069>>>//*** Purpose: Go the the next result set. This command should be used when ***
30069>>>//***          a procedure call results in multiple result sets. Processing ***
30069>>>//***          such procedures can be done by loping through the result     ***
30069>>>//***          sets.                                                        ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLNextResultSet hstmt                                       ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>//*****************************************************************************
30069>>>//*** Command: SQLFetchActivatesBuffer                                      ***
30069>>>//*** Purpose: Setup fetch behavior for a file. When set to true a          ***
30069>>>//***          succesfull fetch of the statement resutl set will            ***
30069>>>//***          automatically set the status of the file's bufer to          ***
30069>>>//***          DF_FILE_ACTIVE.                                              ***
30069>>>//***                                                                       ***
30069>>>//*** Syntax : SQLFetchActivatesBuffer hstmt FileNUmber|FileName sState     ***
30069>>>//*****************************************************************************
30069>>>
30069>>>
30069>>>
30069>>>
30069>>>// *********************************************************************************
30069>>>//                         FUNCOES PARA CONVERSAO DE VALORES
30069>>>// *********************************************************************************
30069>>>Use Utils.pkg
Including file: Utils.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\Utils.pkg)
30069>>>>>//*****************************************************************
30069>>>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote
30069>>>>>//*****************************************************************
30069>>>>>//-2WA
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>
30069>>>>>    
30069>>>Use DBConvTypesMSSQL.pkg
Including file: DBConvTypesMSSQL.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\DBConvTypesMSSQL.pkg)
30069>>>>>//*****************************************************************
30069>>>>>// 21/03/2012 - Fernando Emiliano David Nunes - Criacao do Pacote
30069>>>>>//*****************************************************************
30069>>>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote
30069>>>>>//********************************************************************
30069>>>>>
30069>>>>>
30069>>>>>// *********************************************************************************
30069>>>>>//                    FUNCOES PARA CONVERSAO DE VALORES MS-SQLSERVER
30069>>>>>// *********************************************************************************
30069>>>>>
30069>>>>>Define DRIVER_DEFAULT_DATE for '1753-01-01'
30069>>>>>    
30069>>>>>Function ToSQLDate Global Date dData Returns String
30071>>>>>    If (dData = 0) Function_Return (SFormat("'%1'",DRIVER_DEFAULT_DATE))
30074>>>>>    //
30074>>>>>    String sData
30074>>>>>    Move dData to sData
30075>>>>>    //
30075>>>>>    Function_Return ("'" + mid(sData, 4, 7) + "-" +  mid(sData, 2, 4) + "-" + mid(sData, 2, 1) + "'")
30076>>>>>End_Function // ToSQLDate
30077>>>>>
30077>>>>>Function ToSQLInteger Global Integer iInteger Returns String
30079>>>>>    //
30079>>>>>    If (iInteger = 0) Function_Return "0"
30082>>>>>    Else Function_Return iInteger
30084>>>>>    //
30084>>>>>End_Function // ToSQLInteger
30085>>>>>
30085>>>>>Function ToSQLNumber Global Number nNumber Returns String
30087>>>>>    //
30087>>>>>    If (nNumber = 0) Function_Return "0"
30090>>>>>    Else Function_Return (Replaces(",",nNumber,"."))
30092>>>>>    //
30092>>>>>End_Function // ToSQLNumber
30093>>>>>
30093>>>>>
30093>>>>>Function SQLToDfDate Global String sData Returns Date
30095>>>>>    If (trim(sData = "") or sData = DRIVER_DEFAULT_DATE) Function_Return 0
30098>>>>>    else begin
30099>>>>>        If (mid(trim(sData),1,5) = "-") ; //Formato ISO,              Function_return (mid(sData, 2,9) + "/" + mid(sData, 2,6) + "/" + mid(sData, 4,1))
30102>>>>>        else ; //Formato DataFlex           Function_return sData
30104>>>>>    end    
30104>>>>>>
30104>>>>>End_Function // SQLToDfDate
30105>>>>>
30105>>>>>Function SQLToDfNum Global String sNum Returns Number
30107>>>>>    function_return (Replaces(".",sNum,","))
30108>>>>>End_Function // SQLToDfNum
30109>>>Use SqlFind.pkg
Including file: SqlFind.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\SqlFind.pkg)
30109>>>>>//*****************************************************************
30109>>>>>// 21/03/2012 - Fernando Emiliano David Nunes - Criacao do Pacote
30109>>>>>//*****************************************************************
30109>>>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote
30109>>>>>//********************************************************************
30109>>>>>
30109>>>>>//CREATE_MAIN_CONNECTION BYFILE PARAMETER    //<<<-- nao use conectar dentro do loops, ficar muito lento
30109>>>>>//       ou
30109>>>>>//CREATE_MAIN_CONNECTION "ODBC_DRV" "DSN..." //<<<-- nao use conectar dentro do loops, ficar muito lento
30109>>>>>//
30109>>>>>//  SQL_FIND_BEGIN hStmt1 "SELECT RECNUM FROM CLIENTE where qualquer coisa e ordem limit 10 "
30109>>>>>//     Clear cliente
30109>>>>>//     SQL_FIND_VALUE hStmt1 1 to cliente.recnum
30109>>>>>//     find eq cliente by recnum
30109>>>>>//    
30109>>>>>//     if (found) begin
30109>>>>>//        SQL_FIND_BEGIN hStmt2 "SELECT SUM(VALOR) FROM VENDAS where VENDA DO CLIENTE"
30109>>>>>//
30109>>>>>//           SQL_FIND_VALUE hStmt2 1 to nTotalVendas
30109>>>>>//                  ou
30109>>>>>//           move (SqlFindValue(hStmt2,1)) to nTotalVendas
30109>>>>>//
30109>>>>>//           if TemQueAbortarESairDoProcedimento begin
30109>>>>>//              SQL_FIND_RELEASE hStmt2
30109>>>>>//              procedure_Return ou function_return
30109>>>>>//           end
30109>>>>>// 
30109>>>>>//        SQL_FIND_END hstmt2
30109>>>>>//     end
30109>>>>>//  SQL_FIND_END hStmt1  
30109>>>>>//
30109>>>>>//  if (SQL_FIND_ERR) send stop_box "ERRO" 
30109>>>>>//  else send stop_box "OK"
30109>>>>>//
30109>>>>>//      ou
30109>>>>>//  
30109>>>>>//  SQL_EXECUTE hStmt1  "INSERT INTO...."
30109>>>>>//
30109>>>>>//  if (ERR) send stop_box "ERRO"
30109>>>>>//  else send stop_box "OK"
30109>>>>>//
30109>>>>>//CLOSE_MAIN_CONNECTION 
30109>>>>>
30109>>>>>
30109>>>>>//EXEMPLO loop com SQL_FIND_TABLE_BEGIN
30109>>>>>//
30109>>>>>//SQL_FIND_TABLE_BEGIN PEDIDO by 9 WHERE ;
30109>>>>>//    (SFormat("CD_EMPRESA2 = %1 and SIGLA_PEDIDO = '%2' and SEQ_PEDIDO = %3 and ANO_PEDIDO = %4 and FLAG_LIBERADO <> 'L'", ;
30109>>>>>//            ROTEIRO.CD_EMPRESA, ROTEIRO.SIGLA_ROTEIRO, ROTEIRO.SEQ_ROTEIRO, ROTEIRO.ANO_ROTEIRO)) //LIMIT 1 - Opcional
30109>>>>>//
30109>>>>>//    :
30109>>>>>//    :
30109>>>>>//    :
30109>>>>>//    if TemQueAbortarESairDoProcedimento begin
30109>>>>>//        SQL_FIND_TABLE_RELEASE PEDIDO
30109>>>>>//        procedure_Return
30109>>>>>//    end
30109>>>>>//    :
30109>>>>>//    :
30109>>>>>//    if TemQuePararLoop SQL_FIND_TABLE_BREAK PEDIDO
30109>>>>>//    
30109>>>>>//    
30109>>>>>//SQL_FIND_TABLE_END PEDIDO
30109>>>>>//
30109>>>>>
30109>>>>>
30109>>>>>Use Utils.pkg
30109>>>>>Use Sql.pkg
30109>>>>>Use DBConvTypesMSSQL.pkg
30109>>>>>Use DebugLog.pkg
Including file: DebugLog.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\DebugLog.pkg)
30109>>>>>>>//-2WA
30109>>>>>>>//********************************************************************
30109>>>>>>>// 21/03/2012 - Fernando Emiliano David Nunes - Criacao do Pacote
30109>>>>>>>//********************************************************************
30109>>>>>>>// 03/04/2013 - Fernando Emiliano David Nunes - Atualizacao do Pacote
30109>>>>>>>//********************************************************************
30109>>>>>>>// 21/12/2013 - Anderson Rodrigues - Revisao do Pacote
30109>>>>>>>//********************************************************************
30109>>>>>>>
30109>>>>>>>Use seq_chnl.pkg
30109>>>>>>>Declare_Datafile TSMG800
Including file: TSMG800.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\TSMG800.fd)
30109>>>>>>>
30109>>>>>>>Function InDebug Returns Boolean
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30111>>>>>>>    Open TSMG800
30113>>>>>>>    Function_Return (TSMG800.LOGQUERY_YN = "D") //(D)EBUG
30114>>>>>>>End_Function // InDebug
30115>>>>>>>
30115>>>>>>>Function DebugLogFileName Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30117>>>>>>>   String sApplicationFileName
30117>>>>>>>   
30117>>>>>>>   Register_Object oApplication
30117>>>>>>>   Get GetApplicationFileName of oApplication to sApplicationFileName
30118>>>>>>>   Move (Replaces(".exe", sApplicationFileName, "")) to sApplicationFileName
30119>>>>>>>   
30119>>>>>>>   Function_Return (sApplicationFileName+"_DEBUG.log")    
30120>>>>>>>End_Function // DebugLogFileName
30121>>>>>>> 
30121>>>>>>>Procedure WriteDebugLogTrim Handle hoSender String sTextLog //Fernando Nunes, 02/04/2013
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30123>>>>>>>    Integer iChOut
30123>>>>>>>    String sApplicationFileName
30123>>>>>>>    
30123>>>>>>>    Register_Object oApplication
30123>>>>>>>    Get GetApplicationFileName of oApplication to sApplicationFileName
30124>>>>>>>    
30124>>>>>>>    Move (Seq_New_Channel()) to iChOut
30125>>>>>>>    
30125>>>>>>>    //Vou Gerar um log com a STATEMENT utilizada no filtro dentro da pasta PROGRAMS da Workspace.
30125>>>>>>>    Append_Output channel iChOut (Replaces("_DEBUG.", DebugLogFileName(Self), "_DEBUG_RevomeTrim."))
30127>>>>>>>       Writeln channel iChOut (SFormat('[%1] %2.%3', CurrentDateTime(), Name(hoSender), sTextLog))
30130>>>>>>>    Close_Output channel iChOut  
30132>>>>>>>    
30132>>>>>>>    Send Seq_Release_Channel iChOut 
30133>>>>>>>    
30133>>>>>>>End_Procedure // WriteDebugLogTrim
30134>>>>>>>
30134>>>>>>>Procedure WriteDebugLog Overloaded Handle hoSender String sTextLog Boolean bWriteHTML //Fernando Nunes, 02/04/2013
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30137>>>>>>>    Integer iChOut
30137>>>>>>>    String sApplicationFileName
30137>>>>>>>    
30137>>>>>>>    If (not(InDebug(Self))) Procedure_Return
30140>>>>>>>    
30140>>>>>>>    Register_Object oApplication
30140>>>>>>>    Get GetApplicationFileName of oApplication to sApplicationFileName
30141>>>>>>>    
30141>>>>>>>    Move (Seq_New_Channel()) to iChOut
30142>>>>>>>    
30142>>>>>>>    //Vou Gerar um log com a STATEMENT utilizada no filtro dentro da pasta PROGRAMS da Workspace.
30142>>>>>>>    Append_Output channel iChOut (DebugLogFileName(Self))
30144>>>>>>>       Writeln channel iChOut (SFormat('[%1] %2.%3', CurrentDateTime(), Name(hoSender), sTextLog))
30147>>>>>>>    Close_Output channel iChOut  
30149>>>>>>>    
30149>>>>>>>    Send Seq_Release_Channel iChOut 
30150>>>>>>>    
30150>>>>>>>    If (bWriteHTML) Send WriteHtml (SFormat('[%1] %2.%3<BR>', DebugLogFileName(Self), Name(hoSender), sTextLog ))   
30153>>>>>>>End_Procedure // WriteDebugLog
30154>>>>>>>
30154>>>>>>>Procedure WriteDebugLog Overloaded Handle hoSender String sTextLog  //Fernando Nunes, 02/04/2013
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30157>>>>>>>    Send WriteDebugLog hoSender sTextLog False
30158>>>>>>>End_Procedure // WriteDebugLog
30159>>>>>>>
30159>>>>>>>//Procedure WriteDebugLogToHTML Handle hoSender String sTextLog
30159>>>>>>>//   Send WriteHtml (SFormat('<BR>[%1] %2.%3<BR><BR>', DebugLogFileName(), Name(hoSender), sTextLog ))
30159>>>>>>>//End_Procedure // WriteDebugLogToHTML
30159>>>>>>>//
30159>>>>>>>//Procedure WriteDebugLog Handle hoSender String sTextLog
30159>>>>>>>//    Send WriteDebugLogToHTML hoSender sTextLog
30159>>>>>>>//    Send WriteDebugLogToFile hoSender sTextLog
30159>>>>>>>//End_Procedure // WriteDebugLog
30159>>>>>>>
30159>>>>>>>
30159>>>>>>>Function SQLRemoveTrim  String sStmt Boolean bOnlyAfterWhere Handle hoSender Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30161>>>>>>>    String sResult sParteWhere
30161>>>>>>>    Integer iPosWhere iPosRisco iPosTrim
30161>>>>>>>    Date dData 
30161>>>>>>>    Integer iHora iMinuto
30161>>>>>>>    Boolean bAtivar
30161>>>>>>>    
30161>>>>>>>    Sysdate dData iHora iMinuto
30164>>>>>>>    
30164>>>>>>>    
30164>>>>>>>    //Move ((dData >= Date("05/04/2013") and dData <= Date("09/04/2013"))  and (iHora = 16)) to bAtivar
30164>>>>>>>    
30164>>>>>>>    //---  LOG DESLIGADO
30164>>>>>>>    Move (False) to bAtivar
30165>>>>>>>    
30165>>>>>>>    If (bOnlyAfterWhere) ;        Move (Pos("WHERE", Uppercase(sStmt))) to iPosWhere
30168>>>>>>>    Else ;        Move 1 to iPosWhere
30170>>>>>>>    
30170>>>>>>>    If (iPosWhere > 0 or not(bOnlyAfterWhere)) Begin
30172>>>>>>>       If (bOnlyAfterWhere) ;          Move (Mid(sStmt, iPosWhere-1, 1)) to sResult
30175>>>>>>>       Else ;          Move "" to sResult
30177>>>>>>>             
30177>>>>>>>       Move (Mid(sStmt, (length(sStmt) - iPosWhere)+1, iPosWhere)) to sParteWhere
30178>>>>>>>
30178>>>>>>>       Move (Pos("TRIM", Uppercase(sParteWhere))) to iPosTrim
30179>>>>>>>       
30179>>>>>>>       If (iPosTrim > 0) Begin
30181>>>>>>>           //Send WriteDebugLogTrim Self (SFormat('SQLRemoveTrim.%2.Original="%1"',sStmt, If(bAtivar, "ATIVADO", "DESATIVADO")))
30181>>>>>>>           
30181>>>>>>>           If (bAtivar) Begin
30183>>>>>>>                                  Move (Pos("LIKE", Uppercase(sStmt))) to iPosRisco
30184>>>>>>>               If (iPosRisco = 0) Move (Pos("||", Uppercase(sStmt)))   to iPosRisco
30187>>>>>>>            
30187>>>>>>>               If (iPosRisco = 0) Begin
30189>>>>>>>                   Move (Replaces("LTRIM(",sParteWhere,"(")) to sParteWhere
30190>>>>>>>                   Move (Replaces("LTrim(",sParteWhere,"(")) to sParteWhere
30191>>>>>>>                   Move (Replaces("Ltrim(",sParteWhere,"(")) to sParteWhere
30192>>>>>>>                   Move (Replaces("ltrim(",sParteWhere,"(")) to sParteWhere
30193>>>>>>>                   
30193>>>>>>>                   Move (Replaces("RTRIM(",sParteWhere,"(")) to sParteWhere
30194>>>>>>>                   Move (Replaces("RTrim(",sParteWhere,"(")) to sParteWhere
30195>>>>>>>                   Move (Replaces("Rtrim(",sParteWhere,"(")) to sParteWhere
30196>>>>>>>                   Move (Replaces("rtrim(",sParteWhere,"(")) to sParteWhere
30197>>>>>>>                   
30197>>>>>>>                   Move (Replaces("TRIM(",sParteWhere,"(")) to sParteWhere
30198>>>>>>>                   Move (Replaces("Trim(",sParteWhere,"(")) to sParteWhere
30199>>>>>>>                   Move (Replaces("trim(",sParteWhere,"(")) to sParteWhere
30200>>>>>>>                   
30200>>>>>>>                   Move (sResult + sParteWhere) to sResult
30201>>>>>>>                   
30201>>>>>>>                   Send WriteDebugLogTrim Self (SFormat('SQLRemoveTrim.%2.Modificado="%1"',sResult, If(bAtivar, "ATIVADO", "DESATIVADO")))                   
30202>>>>>>>                   Function_Return sResult
30203>>>>>>>               End
30203>>>>>>>>
30203>>>>>>>           End
30203>>>>>>>>
30203>>>>>>>       End
30203>>>>>>>>
30203>>>>>>>    End
30203>>>>>>>>
30203>>>>>>>    
30203>>>>>>>    Function_Return sStmt 
30204>>>>>>>    
30204>>>>>>>End_Function // SQLRemoveTrim
30205>>>>>
30205>>>>>Handle ghMainConnection //Global
30205>>>>>Integer giOldFetch
30205>>>>>
30205>>>>>Boolean SQL_FIND_ERR
30205>>>>>Boolean SQL_STATEMENT_ERR
30205>>>>>
30205>>>>>
30205>>>>>//
30205>>>>>//*******************************************************************************************************************
30205>>>>>//--- ALTEREI ESSA MACRO PARA NO FORAR O FECHAMENTO DA CONEXO DEVIDO A PROBLEMAS QUE PODERIAM SER CAUSADOS       *
30205>>>>>//--- PELAS INCLUDES. UM EXEMPLO SERIA UMA PROCEDURE COM CREATE E CLOSE MAIN CONNECTION QUE FOSSE CHAMADA DENTRO DE *
30205>>>>>//--- UM SQL_FIND_BEGIN, AO TERMINAR AO TENTAR ABRIR A CONEXO DA PROCEDURE FORARIA O FECHAMENTO DA CONEXO ATUAL  *
30205>>>>>//--- QUE  A DO SQL_FIND, CAUSANDO UMA PERDA DESSA PRIMEIRA CONEXO. DANIEL. 09/04/2012                            *
30205>>>>>//*******************************************************************************************************************
30205>>>>>//                                                                                                                  
30205>>>>>//#COMMAND CREATE_MAIN_CONNECTION //"BYFILE" ""
30205>>>>>//    If (ghMainConnection <> 0) Begin
30205>>>>>//       CLOSE_MAIN_CONNECTION
30205>>>>>//    End
30205>>>>>//    //
30205>>>>>//    #IFSAME !1 BYFILE
30205>>>>>//        Open !2
30205>>>>>//        Get SQLFileConnect of _embsqlghoSQLHandleMngr !2.file_number to ghMainConnection
30205>>>>>//    #ELSE
30205>>>>>//        Get SQLConnect of _embsqlghoSQLHandleMngr !1 !2 to ghMainConnection
30205>>>>>//    #ENDIF
30205>>>>>//#ENDCOMMAND
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>
30205>>>>>    
30205>>>>>
30205>>>>>    
30205>>>>>
30205>>>>>
30205>>>>>//#COMMAND SQL_FIND_BEGIN R R "BUFFER_TO"""
30205>>>>>
30205>>>>>//#COMMAND SQL_FIND_BREAK R  
30205>>>>>//    Move (True) to bBreak!1
30205>>>>>//#ENDCOMMAND
30205>>>>>
30205>>>>>
30205>>>>>Function SqlFind_ConvertToDFType Integer iDFType String sValor Returns String
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30207>>>>>    
30207>>>>>    If (iDFType = DF_Date) Begin
30209>>>>>       Move (SQLToDfDate(sValor)) to sValor
30210>>>>>    End
30210>>>>>>
30210>>>>>     
30210>>>>>    If (iDFType = DF_BCD) Begin
30212>>>>>       Move (SQLToDfNum(sValor)) to sValor
30213>>>>>    End
30213>>>>>>
30213>>>>>     
30213>>>>>    Function_Return sValor
30214>>>>>End_Function // SqlFind_ConvertToDFType 
30215>>>>>
30215>>>>>Function SqlFindValue Global Handle hStmt Integer iColumn Returns String
30217>>>>>    String sResult
30217>>>>>    //
30217>>>>>    Get SqlFind_ConvertToDFType (SQLColAttribute(hStmt, iColumn, SQLCOLATTRIB_DFTYPE)) (SQLColumnValue(hStmt,iColumn)) to sResult
30218>>>>>    //
30218>>>>>    Function_Return sResult
30219>>>>>End_Function // SqlFindValue
30220>>>>>
30220>>>>>Function SqlFindValueByName Global Handle hStmt String sColumnName Returns String
30222>>>>>    Function_Return (SqlFindValue(hStmt, SQLColumnMap(hStmt, sColumnName))) 
30223>>>>>End_Function // SqlFindValueByName
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>//**#COMMAND SAVE_SQL R
30224>>>>>//**    API_SAVERECORD !1 !2 !3 !4 !5 !6 !7 !8 !9    
30224>>>>>//**#ENDCOMMAND 
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>>>
30224>>>Use DebugLog.pkg
30224>>>
30224>>>// *********************************************************************************
30224>>>//   MACRO PARA SEREM USADAS NA CLASSE TDICTIONARY DOS RELATORIO QUE USAM CONSTRAIN 
30224>>>// *********************************************************************************
30224>>>
30224>>>register_Procedure BackupFilterState
30224>>>register_Procedure RestoreFilterState
30224>>>register_Procedure Set pbFilter_ACTIVE Boolean bON
30224>>>Register_Function isFilter_No_Server Returns Boolean  
30224>>>
30224>>>
30224>>>
30224>>>//Inicio da Instancia do DD do cWebReport
30224>>>
30224>>>
30224>>>
30224>>>//Dentro de onContrain
30224>>>
30224>>>
30224>>>
30224>>>
30224>>>
30224>>>
30224>>>
30224>>>// *********************************************************************************
30224>>>//   CLASSE EXTENDIDAS PARA USO DO FILTER_CONTRAIN 
30224>>>// *********************************************************************************
30224>>>// 
30224>>>
30224>>>//#COMMAND DoRunReport_REDEFINE
30224>>>//    Function DoRunReport Returns Integer
30224>>>//        Integer iResult
30224>>>//        Handle hDD
30224>>>//        Integer iBkp 
30224>>>//        Boolean bFilterNoServer
30224>>>//        //
30224>>>//        Get Server to hDD
30224>>>//        //
30224>>>//        If hDD Set pbFilter_ACTIVE of (Server(Self)) to True
30224>>>//        //   
30224>>>//        Get pbFilter_No_Server of (Server(Self)) to bFilterNoServer
30224>>>//        //
30224>>>//        If bFilterNoServer Begin
30224>>>//           Get No_Constrained_Find_State to iBkp
30224>>>//           Set No_Constrained_Find_State to False
30224>>>//           //  
30224>>>//           Set Server to 0 //A classe reportDS, trabalhar direto com o buffer
30224>>>//        End
30224>>>//        //
30224>>>//        Forward Get DoRunReport to iResult
30224>>>//        //  
30224>>>//        If bFilterNoServer Begin
30224>>>//           Set Server to hDD //A classe reportDS, volta a trabalhar conectado com DD
30224>>>//           Set No_Constrained_Find_State to iBkp
30224>>>//        End
30224>>>//        //
30224>>>//        If hDD Set pbFilter_ACTIVE of (Server(Self)) to False
30224>>>//        //
30224>>>//        Function_Return iResult
30224>>>//    End_Function //DoRunReport
30224>>>//#ENDCOMMAND
30224>>>
30224>>>
30224>>>Use cReportDS.pkg
30224>>>Use cHtmlReport.pkg
30224>>>Use cWebReport.pkg
30224>>>Use cAutoWebReport.pkg
Including file: cAutoWebreport.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\cAutoWebreport.pkg)
30224>>>>>//****************************************************************************//
30224>>>>>//                                                                            //
30224>>>>>// $File name  : cAutoWebReport.PKG                                           //
30224>>>>>// $File title : cAutoWebreport class                                         //
30224>>>>>// $Author     : John Tuohy                                                   //
30224>>>>>//                                                                            //
30224>>>>>// Confidential Trade Secret.                                                 //
30224>>>>>// Copyright 1999 Data Access Corporation, Miami FL, USA                      //
30224>>>>>// All Rights reserved                                                        //
30224>>>>>// DataFlex is a registered trademark of Data Access Corporation.             //
30224>>>>>//                                                                            //
30224>>>>>//                                                                            //
30224>>>>>// $Rev History                                                               //
30224>>>>>//   8/12/98 jjt - created                                                    //
30224>>>>>//                                                                            //
30224>>>>>//****************************************************************************//
30224>>>>>Use cWebReport.pkg
30224>>>>>
30224>>>>>Class cAutoWebReport is a cWebReport
30225>>>>>
30225>>>>>    Procedure Construct_Object
30227>>>>>        Forward send construct_object
30229>>>>>        Delegate Set phAutoWebReport to self
30231>>>>>        Property Boolean pbUseRowIds True
30232>>>>>        // If an auto-report is created, register it in its parent WBO
30232>>>>>        Send RegisterInterface get_AutoReport "get_AutoReport" "string sTable integer iIndex String hRef Integer iMax Integer iStart returns integer" ;                                              "Obsolete (use AutoReport1). Create an auto-report for every field in the DD"
30233>>>>>    End_Procedure
30234>>>>>
30234>>>>>    Procedure OnPageTop
30236>>>>>        integer iFile iFields iField iType
30236>>>>>        integer hDD
30236>>>>>        string sValue sAlign
30236>>>>>        Get server to hDD
30237>>>>>        Get Main_file of hDD to iFile
30238>>>>>        Get_Attribute DF_FILE_NUMBER_FIELDS of iFile to iFields
30241>>>>>
30241>>>>>        Send WriteHtmlTableBegin 'Class="ReportTable"'
30242>>>>>
30242>>>>>        Send WriteHtmlRowBegin
30243>>>>>        For iField from 1 to iFields
30249>>>>>>
30249>>>>>            Get_Attribute DF_FIELD_TYPE of iFile iField to iType
30252>>>>>            If (iType<>DF_OVERLAP and iType<>DF_BINARY) Begin
30254>>>>>                Case Begin
30254>>>>>                    Case (iType=DF_BCD)  move '"right"' to sAlign
30257>>>>>                    Case (iType=DF_TEXT) Move '"left" width="40%"' to sAlign
30261>>>>>                    Case (iType=DF_Date or iType=DF_DateTime) Move '"center"' to sAlign
30265>>>>>                    Case else            Move '"left"' to sAlign
30267>>>>>                Case End
30267>>>>>                Move ('align='-sAlign * 'vAlign="top" bgcolor="Silver" Class="Header"') to sAlign
30268>>>>>                Get File_Field_Label of hDD iFile iField DD_LABEL_SHORT to sValue
30269>>>>>                Send WriteHtmlCellHeader (HtmlEncode(sValue)) sAlign
30270>>>>>            End
30270>>>>>>
30270>>>>>        Loop
30271>>>>>>
30271>>>>>        Send WriteHtmlRowEnd
30272>>>>>    End_Procedure
30273>>>>>
30273>>>>>    Procedure OnBody
30275>>>>>        integer iFile iFields iField iType iPoints
30275>>>>>        integer hDD
30275>>>>>        string sValue sAlign
30275>>>>>        Boolean bUseRowIds
30275>>>>>        Get server to hDD
30276>>>>>        Get Main_file of hDD to iFile
30277>>>>>        Get_Attribute DF_FILE_NUMBER_FIELDS of iFile to iFields
30280>>>>>        Get pbUseRowIds to bUseRowIds
30281>>>>>
30281>>>>>        Send WriteHtmlRowBegin
30282>>>>>        For iField from 1 to iFields
30288>>>>>>
30288>>>>>            Get_Attribute DF_FIELD_TYPE of iFile iField to iType
30291>>>>>            If (iType<>DF_OVERLAP and iType<>DF_BINARY) Begin
30293>>>>>                Case Begin
30293>>>>>                    Case (iType=DF_BCD)  move '"right"' to sAlign
30296>>>>>                    Case (iType=DF_TEXT) Move '"left" width="40%"' to sAlign
30300>>>>>                    Case (iType=DF_Date or iType=DF_Datetime) Move '"center"' to sAlign
30304>>>>>                    Case else            Move '"left"' to sAlign
30306>>>>>                Case End
30306>>>>>                Move ('align='-sAlign * 'vAlign="top" Class="Data"')  to sAlign
30307>>>>>                If (iType<>DF_Text) ;                    Get File_Field_Current_Description of hDD iFile iField to sValue
30310>>>>>                Else ;                    Get File_Field_Current_Value of hDD iFile iField to sValue
30312>>>>>
30312>>>>>                If (iType=DF_BCD) Begin
30314>>>>>                    Get_Attribute DF_FIELD_PRECISION of iFile iField to iPoints
30317>>>>>                    Move (FormatNumber(sValue,iPoints)) to sValue
30318>>>>>                end
30318>>>>>>
30318>>>>>                else ;                    get HtmlEncode sValue to sValue
30320>>>>>                //
30320>>>>>                If (iField=1) Begin
30322>>>>>                    If bUseRowIds begin
30324>>>>>                        Get AddRowIdLink sValue to sValue //
30325>>>>>                    end
30325>>>>>>
30325>>>>>                    else begin                             // we must support old because pages may be
30326>>>>>                        Get AddRecordLink sValue to sValue // created that need recnum
30327>>>>>                    end
30327>>>>>>
30327>>>>>                end
30327>>>>>>
30327>>>>>                //
30327>>>>>                Send WriteHtmlCell  sValue sAlign
30328>>>>>            End
30328>>>>>>
30328>>>>>        Loop
30329>>>>>>
30329>>>>>        Send WriteHtmlRowEnd
30330>>>>>    End_Procedure
30331>>>>>
30331>>>>>    Procedure OnPageBottom
30333>>>>>        Send WriteHtmlTableEnd
30334>>>>>    End_Procedure
30335>>>>>
30335>>>>>    Function DoAutoReport integer iIndex string sHref integer iMax integer iStart Returns integer
30337>>>>>        boolean bUseRowIdsOld
30337>>>>>        If (Server(self)=0) Begin
30339>>>>>            Error DFERR_PROGRAM C_$NoDDOForReport
30340>>>>>>
30340>>>>>            Function_return 0
30341>>>>>        end
30341>>>>>>
30341>>>>>        Get pbUseRowIds to bUseRowIdsOld
30342>>>>>        Set pbUseRowIds to False
30343>>>>>        Set piMaxCount to iMax
30344>>>>>        Set priStartRowId to (NullRowId())
30345>>>>>        Set piStartRecord to iStart
30346>>>>>        Set piOrdering to iIndex
30347>>>>>        set psHRefName to sHref
30348>>>>>        Send Run_Report
30349>>>>>        Set pbUseRowIds to bUseRowIdsOld
30350>>>>>        Function_return (piLastRecord(self))
30351>>>>>    End_Function
30352>>>>>
30352>>>>>    Function DoAutoReport1 integer iIndex string sHref integer iMax String sStart Returns string
30354>>>>>        boolean bUseRowIdsOld
30354>>>>>        RowId riLast
30354>>>>>        string sLast
30354>>>>>        If (Server(self)=0) Begin
30356>>>>>            Error DFERR_PROGRAM C_$NoDDOForReport
30357>>>>>>
30357>>>>>            Function_return ""
30358>>>>>        end
30358>>>>>>
30358>>>>>        Get pbUseRowIds to bUseRowIdsOld
30359>>>>>        Set pbUseRowIds to True
30360>>>>>        Set piMaxCount to iMax
30361>>>>>        Set priStartRowId to (if(sStart="", NullRowId(), DeserializeRowId(sStart)))
30362>>>>>        Set piStartRecord to 0
30363>>>>>        Set piOrdering to iIndex
30364>>>>>        set psHRefName to sHref
30365>>>>>        Send Run_Report
30366>>>>>        Get priLastRowId to riLast
30367>>>>>        Move (if(isNullRowId(riLast), "", SerializeRowId(riLast) )) to sLast
30368>>>>>        Set pbUseRowIds to bUseRowIdsOld
30369>>>>>        Function_return sLast
30370>>>>>    End_Function
30371>>>>>
30371>>>>>
30371>>>>>End_Class
30372>>>//
30372>>>Class cReportDS_Filter is a cReportDS
30373>>>    DoRunReport_REDEFINE
30398>>>End_Class // cReportDS_Filter
30399>>>
30399>>>Class cHtmlReport_Filter is a cHtmlReport
30400>>>    DoRunReport_REDEFINE
30425>>>End_Class // cHtmlReport_Filter
30426>>>
30426>>>Class cWebReport_Filter is a cWebReport
30427>>>    DoRunReport_REDEFINE
30452>>>End_Class // cWebReport_Filter
30453>>>
30453>>>Class cAutoWebReport_Filter is a cAutoWebReport
30454>>>    DoRunReport_REDEFINE
30479>>>End_Class // cAutoWebReport_Filter
30480>>>
30480>
30480>Object oApplication is a cApplication
30482>    Use ..\PkgSrc\ApplicationMessages.pkg
Including file: ..\PkgSrc\ApplicationMessages.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\..\PkgSrc\ApplicationMessages.pkg)
30482>>>//-2WA
30482>>>//- deve estar dentro do objeto da classe cApplication do WebApp.
30482>>>//- 32-character base32-encoded string, allowed chars: A-Z and 2-7
30482>>>    Property String psOneTimePasswordSecret "5OCORRO3U5UBINUMONIBU53MMARROCO5" 
30484>>>    Property String ppTimeStamp 
30486>>>    Property String ppUrl 
30488>>>    Property String ppHashdata 
30490>>>    Property String ppHashcode 
30492>>>
30492>>>    Function f_Decode_Period String slCode Returns Integer
30495>>>        Move (Uppercase(slCode)) to slCode
30496>>>    
30496>>>        If (slCode='M') Function_Return 1
30499>>>        If (slCode='H') Function_Return Hour_Length
30502>>>        If (slCode='D') Function_Return Day_Length
30505>>>        If (slCode='W') Function_Return (Week_Length*Day_Length)
30508>>>    
30508>>>    End_Function // f_Decode_Period
30509>>>    
30509>>>    Function f_Decode_Day String slDay Returns Integer
30512>>>        Move (Uppercase(slDay)) to slDay
30513>>>    
30513>>>        If (slDay='SU') Function_Return 0
30516>>>        If (slDay='MO') Function_Return 1
30519>>>        If (slDay='TU') Function_Return 2
30522>>>        If (slDay='WD') Function_Return 3
30525>>>        If (slDay='TH') Function_Return 4
30528>>>        If (slDay='FR') Function_Return 5
30531>>>        If (slDay='SA') Function_Return 6
30534>>>    
30534>>>    End_Function// f_Decode_Day
30535>>>    
30535>>>//- Purpose: Translate an integer between 0 and 15 
30535>>>//           into a hexadecimal format.
30535>>>    Function Integer2Hex Integer iInput Returns String
30538>>>        String sOutStr
30538>>>        
30538>>>        Move "0" to sOutStr
30539>>>        If (iInput=1) Move "1" to sOutStr
30542>>>        Else If (iInput=2) Move "2" to sOutStr
30546>>>        Else If (iInput=3) Move "3" to sOutStr
30550>>>        Else If (iInput=4) Move "4" to sOutStr
30554>>>        Else If (iInput=5) Move "5" to sOutStr
30558>>>        Else If (iInput=6) Move "6" to sOutStr
30562>>>        Else If (iInput=7) Move "7" to sOutStr
30566>>>        Else If (iInput=8) Move "8" to sOutStr
30570>>>        Else If (iInput=9) Move "9" to sOutStr
30574>>>        Else If (iInput=10) Move "A" to sOutStr
30578>>>        Else If (iInput=11) Move "B" to sOutStr
30582>>>        Else If (iInput=12) Move "C" to sOutStr
30586>>>        Else If (iInput=13) Move "D" to sOutStr
30590>>>        Else If (iInput=14) Move "E" to sOutStr
30594>>>        Else If (iInput=15) Move "F" to sOutStr
30598>>>        Function_Return sOutStr
30599>>>    End_Function
30600>>>
30600>>>//- Purpose: Translate a character into a hexadecimal format.
30600>>>    Function Ascii2Hex String sInStr Returns String
30603>>>        String  sFirstChar
30603>>>        String  sSecondChar
30603>>>        Integer iAscii
30603>>>        Integer iFirstNumber
30603>>>        Integer iSecondNumber
30603>>>        
30603>>>        Move (Ascii(sInStr)) to iAscii
30604>>>        Move (Mod(iAscii, 16)) to iSecondNumber
30605>>>        Move ((iAscii-iSecondNumber)/16) to iFirstNumber
30606>>>        Move (Integer2Hex(Self,iFirstNumber)) to sFirstChar
30607>>>        Move (Integer2Hex(Self,iSecondNumber)) to sSecondChar
30608>>>        Function_Return (Append(sFirstChar, sSecondChar))
30609>>>    End_Function
30610>>>
30610>>>//- Purpose: Convert a string into a string consisting of Hexadecimal characters.
30610>>>    Function DaiEncode String sInStr Returns String
30613>>>        String  sChar
30613>>>        String  sOutStr
30613>>>        String  sHexStr
30613>>>        Integer iCounter
30613>>>        Integer iLength
30613>>>
30613>>>        Move (Length(sInStr)) to iLength
30614>>>        Move "" to sOutStr
30615>>>        For iCounter from 1 to iLength
30621>>>>
30621>>>            Move (Mid(sInStr, 1, iCounter)) to sChar
30622>>>            Move (Ascii2Hex(Self,sChar)) to sHexStr
30623>>>            Move (Append(sOutStr, sHexStr)) to sOutStr
30624>>>        Loop
30625>>>>
30625>>>        Function_Return sOutStr
30626>>>    End_Function
30627>>>    
30627>>>//- Purpose: Returns a string of two digits so 7 is returned 
30627>>>//           as "07" and 14 is returned as "14". 213 would be returned
30627>>>//           as "13".
30627>>>    Function TwoDigits Integer iNumber Returns String
30630>>>        String sResult
30630>>>        
30630>>>        Move (Append("00", String(iNumber))) to sResult
30631>>>        Move (Right(sResult, 2)) to sResult
30632>>>        Function_Return sResult
30633>>>    End_Function
30634>>>
30634>>>//- Purpose: Creates a timestamp Returns a string formatted as "YYYY-MM-DDTHH:MM:SS"
30634>>>    Function CreateTimestamp Returns String
30637>>>        DateTime dtCurrentDateTime
30637>>>        Integer  iYear
30637>>>        Integer  iMonth
30637>>>        Integer  iDay
30637>>>        Integer  iHour
30637>>>        Integer  iMinute
30637>>>        Integer  iSecond
30637>>>        String   sResult
30637>>>        
30637>>>        Move (CurrentDateTime()) to dtCurrentDateTime
30638>>>        
30638>>>        Move (DateGetYear  (dtCurrentDateTime)) to iYear
30639>>>        Move (DateGetMonth (dtCurrentDateTime)) to iMonth
30640>>>        Move (DateGetDay   (dtCurrentDateTime)) to iDay
30641>>>        Move (DateGetHour  (dtCurrentDateTime)) to iHour
30642>>>        Move (DateGetMinute(dtCurrentDateTime)) to iMinute
30643>>>        Move (DateGetSecond(dtCurrentDateTime)) to iSecond
30644>>>
30644>>>        Move  "%1-%2-%3T%4:%5:%6" to sResult
30645>>>        Move (SFormat(sResult, iYear, TwoDigits(Self,iMonth);                                    , TwoDigits(Self,iDay);                                    , TwoDigits(Self,iHour);                                    , TwoDigits(Self,iMinute);                                    , TwoDigits(Self,iSecond))) to sResult
30646>>>        
30646>>>        Function_Return sResult
30647>>>    End_Function //CreateTimestamp
30648>>>
30648>>>//- Generates a timestamp and stores it in a private property.
30648>>>    Procedure Generate_Timestamp
30651>>>        String sTimeStamp
30651>>>        Get CreateTimestamp to sTimeStamp
30652>>>        Set ppTimeStamp to sTimeStamp
30653>>>    End_Procedure //Generate_Timestamp
30654>>>    
30654>>>//- AR20170531 - Insert left zeroes
30654>>>    Function InsertLeftZeroes String sValue Integer iLength Returns String
30657>>>        Move (Rtrim(sValue)) to sValue
30658>>>        While (Length(sValue) < iLength)
30662>>>            Move ("0" + sValue) to sValue
30663>>>        Loop    
30664>>>>
30664>>>        Function_Return sValue
30665>>>    End_Function //InsertLeftZeroes
30666>>>    
30666>>>//- AR20170531 - Remove spaces and punctuation
30666>>>    Function RemoveSpacesAndPunctuation String sValue Returns String
30669>>>        Move (Replaces(" ", sValue, "")) to sValue
30670>>>        Move (Replaces(".", sValue, "")) to sValue
30671>>>        Move (Replaces("&", sValue, "")) to sValue
30672>>>        Move (Replaces("-", sValue, "")) to sValue
30673>>>        Move (Replaces("_", sValue, "")) to sValue
30674>>>        Move (Replaces(",", sValue, "")) to sValue
30675>>>        Move (Replaces(":", sValue, "")) to sValue
30676>>>        Move (Replaces("?", sValue, "")) to sValue
30677>>>        Move (Replaces("/", sValue, "")) to sValue
30678>>>        Move (Replaces("'", sValue, "")) to sValue
30679>>>        Move (Replaces("%", sValue, "")) to sValue
30680>>>        Move (Replaces("$", sValue, "")) to sValue
30681>>>        Move (Replaces("#", sValue, "")) to sValue
30682>>>        Move (Replaces("!", sValue, "")) to sValue
30683>>>        Move (Replaces("+", sValue, "")) to sValue
30684>>>        Move (Replaces("=", sValue, "")) to sValue
30685>>>        Move (Replaces(";", sValue, "")) to sValue
30686>>>        Move (Replaces("|", sValue, "")) to sValue
30687>>>        Move (Replaces("\", sValue, "")) to sValue
30688>>>        //
30688>>>        Function_Return sValue
30689>>>    End_Function //RemoveSpacesAndPunctuation
30690>>>
30690>>>//- AR20170531 - Verify/Create the WebAppOut folder
30690>>>//  Folder location for saving any/all PDF output from web order entry application.
30690>>>//  a subfolder named: WebAppOut located directly under whatever is the data folder for the workspace
30690>>>    Function ReportOutPutPath Returns String
30693>>>        String  sDataPath sReportOutPutPath
30693>>>        Integer iHasFolder iHasError
30693>>>        Get psDataPath  of (phoWorkspace(ghoApplication)) to sDataPath
30694>>>        Get PathAtIndex of (phoWorkspace(ghoApplication)) sDataPath 1 to sReportOutPutPath
30695>>>        Move (sReportOutPutPath + "\WebAppOut") to sReportOutPutPath
30696>>>        //Does the directory exist? - No = 0, Yes = 1
30696>>>        Move (vFolderExists(sReportOutPutPath)) to iHasFolder
30697>>>        If (not(iHasFolder)) Begin
30699>>>            // 0 if the folder is created.
30699>>>            // 1 if the API-call returned an error.
30699>>>            Move (vCreateDirectory(sReportOutPutPath)) to iHasError
30700>>>            If (iHasError) Move "" to sReportOutPutPath
30703>>>        End
30703>>>>
30703>>>        If (not(iHasError) and iHasFolder) Begin
30705>>>            Send RegisterDownloadFolder of ghoWebResourceManager sReportOutPutPath
30706>>>        End
30706>>>>
30706>>>        Function_Return sReportOutPutPath
30707>>>    End_Function //ReportOutPutPath
30708>>>
30708>>>    Function ValidarSessaoUsuario String aUsuarioSessao String aFingerPrint Returns stDefaultMessage
30711>>>        stDefaultMessage stDefaultMsg
30711>>>        stDefaultMessage stDefaultMsg
30711>>>        String aUsuarioIP
30711>>>        String aRemoteAddress
30711>>>        //-
30711>>>        Clear CSAG311
Including file: CSAG311.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG311.fd)
30712>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
30713>>>        Find EQ CSAG311 by 1
30714>>>>
30714>>>        If (not(Found)) Begin
30716>>>            Move True to stDefaultMsg.hasError
30717>>>            Move 'SESSAO INVALIDA/INVALID SESSION.' to stDefaultMsg.msgError
30718>>>            Function_Return stDefaultMsg
30719>>>        End
30719>>>>
30719>>>
30719>>>        //- VALIDACAO DO IP
30719>>>        //Get ServerVariable  of ghoWebServiceDispatcher "REMOTE_ADDR" to aRemoteAddress
30719>>>        //Move (Rtrim(CSAG311.USUARIOIP)) to aUsuarioIP
30719>>>        //If (aUsuarioIP <> aRemoteAddress) Begin
30719>>>        //    Move True to stDefaultMsg.hasError
30719>>>        //    Move 'IP INVALIDO' to stDefaultMsg.msgError
30719>>>        //    Function_Return stDefaultMsg
30719>>>        //End
30719>>>
30719>>>        //- VALIDACAO DO FINGERPRINT
30719>>>        Clear HSAG300
Including file: HSAG300.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HSAG300.fd)
30720>>>        Move CSAG311.USUARIONUMERO  to HSAG300.USUARIONUMERO
30721>>>        Move aFingerPrint           to HSAG300.FINGERPRINT
30722>>>        Find Eq HSAG300 by 1
30723>>>>
30723>>>        If (not(Found)) Begin
30725>>>            Move True to stDefaultMsg.hasError
30726>>>            Move 'FINGERPRINT NAO ENCONTRADO' to stDefaultMsg.msgError
30727>>>            Function_Return stDefaultMsg
30728>>>        End
30728>>>>
30728>>>        
30728>>>        If (Rtrim(CSAG311.FINGERPRINT) <> aFingerPrint) Begin
30730>>>            Move True to stDefaultMsg.hasError
30731>>>            Move 'FINGERPRINT INVALIDO' to stDefaultMsg.msgError
30732>>>            Function_Return stDefaultMsg
30733>>>        End
30733>>>>
30733>>>        
30733>>>
30733>>>    //- variables ------
30733>>>        DateTime dtVar
30733>>>        Date     dlToday
30733>>>        Date     dDtLastRun
30733>>>        String   slTime
30733>>>        String   slHH slMM
30733>>>        String   sHrLastRun
30733>>>        String   slPeriodType
30733>>>        String   slDay
30733>>>        Integer  ilTodayDay
30733>>>        Integer  ilMultiplier
30733>>>        Integer  ilSchedDay
30733>>>        Integer  idTime
30733>>>        Integer  ilPeriod
30733>>>        Handle   hObj
30733>>>        Boolean  bError
30733>>>        
30733>>>        Sysdate dlToday slHH slMM
30736>>>    
30736>>>        If (Integer(slMM)<10) Move (Insert('0', slMM, 1)) to slMM
30739>>>        If (Integer(slHH)<10) Move (Insert('0', slHH, 1)) to slHH
30742>>>    
30742>>>        Move (slHH + slMM) to slTime
30743>>>    
30743>>>        Move dlToday           to dDtLastRun
30744>>>        Move (slHH +':'+ slMM) to sHrLastRun
30745>>>    
30745>>>        //- WE NEED AN INTEGER TO REPRESENT THE TIME OF DAY TO ELIMINATE CROSS MIDNIGHT PROBLEMS.
30745>>>        //  WE CREATED A SINGLE INTEGER FROM THE DATE, HOUR AND MINUTES THAT DOES NOT HAVE TO GO
30745>>>        //  BACK TO 0 AT THE BEGINNING OF THE DAY OR HOUR.
30745>>>        Move (Integer(dlToday)*1440 + (Integer(slHH)*60) + Integer(slMM)) to idTime
30746>>>
30746>>>        //- WE NEED THE DAY OF THE WEEK. 1=SUNDAY, 2=MONDAY, ETC.
30746>>>        Move (CurrentDateTime())       to dtVar
30747>>>        Move (DateGetDayOfWeek(dtVar)) to ilTodayDay
30748>>>
30748>>>        Clear TSMG800
30749>>>        Smart_Find GE TSMG800 by 0
30760>>>        
30760>>>        Move (Rtrim(TSMG800.DAY_OF_WEEK)) to slDay
30761>>>        Move (Right(Trim(TSMG800.PERIOD_SESSION_TIMEOUT),1)) to slPeriodType
30762>>>        Move (Replace(slPeriodType,Trim(TSMG800.PERIOD_SESSION_TIMEOUT),'')) to ilMultiplier
30763>>>
30763>>>        //- DAY CODE, SU, MO, ETC.
30763>>>        //  DAY SPECIFIED IN THE SCHEDULE.
30763>>>        If (slDay<>'') Move (f_Decode_Day(Self, Uppercase(slDay))) to ilSchedDay
30766>>>
30766>>>        //- DO SOME ACTION
30766>>>        Move ((f_Decode_Period(Self, slPeriodType))*ilMultiplier) to ilPeriod
30767>>>        If ((idTime <= Integer(CSAG311.LASTRUN)+ilPeriod) or Integer(CSAG311.LASTRUN) = 0) Begin
30769>>>            If (slDay = '' or (slDay <> '' and ilSchedDay = ilTodayDay)) Begin
30771>>>               //- WRITE THE CURRENT DATE/TIME BACK TO THE DATA FILE
30771>>>                Get Create (RefClass(DataDictionary)) to hObj
30772>>>                Set Main_File of hObj to CSAG311.File_Number
30773>>>                Send Request_Assign of hObj
30774>>>                Set Field_Changed_Value of hObj Field CSAG311.LASTRUN to idTime
30775>>>                Set Field_Changed_Value of hObj Field CSAG311.LASTACCESSDATE to dDtLastRun
30776>>>                Set Field_Changed_Value of hObj Field CSAG311.LASTACCESSTIME to sHrLastRun
30777>>>                Get Request_Validate of hObj to bError
30778>>>                If (not(bError)) Send Request_Save of hObj
30781>>>                Send Destroy of hObj
30782>>>            End
30782>>>>
30782>>>        End
30782>>>>
30782>>>        Else Begin
30783>>>            //- DO SOME ACTION. USE OF DTIME HERE IS CRITICAL AS IT PREVENTS THE REPETITIVE CALLING
30783>>>            //  OF THE PROCESS WITHIN THE SAME MINUTE.
30783>>>            If (TSMG800.PERIOD_SESSION_TIMEOUT <> '' and idTime > (Integer(CSAG311.LASTRUN)+ilPeriod)) Begin
30785>>>                If (slDay = '' or (slDay <> '' and ilSchedDay = ilTodayDay)) Begin
30787>>>                    Get Create (RefClass(DataDictionary)) to hObj
30788>>>                    Set Main_File of hObj to CSAG311.File_Number
30789>>>                    Send Request_Assign of hObj
30790>>>                    Send Request_Delete of hObj
30791>>>                    Send Destroy of hObj
30792>>>                    //-
30792>>>                    Move True to stDefaultMsg.hasError
30793>>>                    Move 'SESSAO EXPIRADA' to stDefaultMsg.msgError
30794>>>                End
30794>>>>
30794>>>            End
30794>>>>
30794>>>        End
30794>>>>
30794>>>        
30794>>>        Function_Return stDefaultMsg
30795>>>    End_Function //ValidarSessaoUsuario
30796>>>    
30796>>>    Function KillSessaoUsuario String aUsuarioSessao String aFingerPrint Returns stDefaultMessage
30799>>>        stDefaultMessage stDefaultMsg
30799>>>        stDefaultMessage stDefaultMsg
30799>>>        String aUsuarioIP
30799>>>        String aRemoteAddress
30799>>>        //-
30799>>>        Clear CSAG311
30800>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
30801>>>        Find EQ CSAG311 by 1
30802>>>>
30802>>>        If (not(Found)) Begin
30804>>>            Move True to stDefaultMsg.hasError
30805>>>            Move 'SESSAO INVALIDA/INVALID SESSION.' to stDefaultMsg.msgError
30806>>>            Function_Return stDefaultMsg
30807>>>        End
30807>>>>
30807>>>
30807>>>        //- VALIDACAO DO IP
30807>>>        //Get ServerVariable  of ghoWebServiceDispatcher "REMOTE_ADDR" to aRemoteAddress
30807>>>        //Move (Rtrim(CSAG311.USUARIOIP)) to aUsuarioIP
30807>>>        //If (aUsuarioIP <> aRemoteAddress) Begin
30807>>>        //    Move True to stDefaultMsg.hasError
30807>>>        //    Move 'IP INVALIDO' to stDefaultMsg.msgError
30807>>>        //    Function_Return stDefaultMsg
30807>>>        //End
30807>>>
30807>>>        //- VALIDACAO DO FINGERPRINT
30807>>>        Clear HSAG300
30808>>>        Move CSAG311.USUARIONUMERO  to HSAG300.USUARIONUMERO
30809>>>        Move aFingerPrint           to HSAG300.FINGERPRINT
30810>>>        Find Eq HSAG300 by 1
30811>>>>
30811>>>        If (not(Found)) Begin
30813>>>            Move True to stDefaultMsg.hasError
30814>>>            Move 'FINGERPRINT NAO ENCONTRADO' to stDefaultMsg.msgError
30815>>>            Function_Return stDefaultMsg
30816>>>        End
30816>>>>
30816>>>        
30816>>>        If (Rtrim(CSAG311.FINGERPRINT) <> aFingerPrint) Begin
30818>>>            Move True to stDefaultMsg.hasError
30819>>>            Move 'FINGERPRINT INVALIDO' to stDefaultMsg.msgError
30820>>>            Function_Return stDefaultMsg
30821>>>        End
30821>>>>
30821>>>        
30821>>>
30821>>>    //- variables ------
30821>>>        DateTime dtVar
30821>>>        Date     dlToday
30821>>>        Date     dDtLastRun
30821>>>        String   slTime
30821>>>        String   slHH slMM
30821>>>        String   sHrLastRun
30821>>>        String   slPeriodType
30821>>>        String   slDay
30821>>>        Integer  ilTodayDay
30821>>>        Integer  ilMultiplier
30821>>>        Integer  ilSchedDay
30821>>>        Integer  idTime
30821>>>        Integer  ilPeriod
30821>>>        Handle   hObj
30821>>>        Boolean  bError
30821>>>        
30821>>>        Sysdate dlToday slHH slMM
30824>>>    
30824>>>        If (Integer(slMM)<10) Move (Insert('0', slMM, 1)) to slMM
30827>>>        If (Integer(slHH)<10) Move (Insert('0', slHH, 1)) to slHH
30830>>>    
30830>>>        Move (slHH + slMM) to slTime
30831>>>    
30831>>>        Move dlToday           to dDtLastRun
30832>>>        Move (slHH +':'+ slMM) to sHrLastRun
30833>>>    
30833>>>        //- WE NEED AN INTEGER TO REPRESENT THE TIME OF DAY TO ELIMINATE CROSS MIDNIGHT PROBLEMS.
30833>>>        //  WE CREATED A SINGLE INTEGER FROM THE DATE, HOUR AND MINUTES THAT DOES NOT HAVE TO GO
30833>>>        //  BACK TO 0 AT THE BEGINNING OF THE DAY OR HOUR.
30833>>>        Move (Integer(dlToday)*1440 + (Integer(slHH)*60) + Integer(slMM)) to idTime
30834>>>
30834>>>        //- WE NEED THE DAY OF THE WEEK. 1=SUNDAY, 2=MONDAY, ETC.
30834>>>        Move (CurrentDateTime())       to dtVar
30835>>>        Move (DateGetDayOfWeek(dtVar)) to ilTodayDay
30836>>>
30836>>>        Clear TSMG800
30837>>>        Smart_Find GE TSMG800 by 0
30848>>>        
30848>>>        Move (Rtrim(TSMG800.DAY_OF_WEEK)) to slDay
30849>>>        Move (Right(Trim(TSMG800.PERIOD_SESSION_TIMEOUT),1)) to slPeriodType
30850>>>        Move (Replace(slPeriodType,Trim(TSMG800.PERIOD_SESSION_TIMEOUT),'')) to ilMultiplier
30851>>>
30851>>>        //- DAY CODE, SU, MO, ETC.
30851>>>        //  DAY SPECIFIED IN THE SCHEDULE.
30851>>>        If (slDay<>'') Move (f_Decode_Day(Self, Uppercase(slDay))) to ilSchedDay
30854>>>
30854>>>        //- DO SOME ACTION
30854>>>        Move ((f_Decode_Period(Self, slPeriodType))*ilMultiplier) to ilPeriod
30855>>>        If (not((idTime <= Integer(CSAG311.LASTRUN)+ilPeriod) or Integer(CSAG311.LASTRUN) = 0)) Begin
30857>>>            //- DO SOME ACTION. USE OF DTIME HERE IS CRITICAL AS IT PREVENTS THE REPETITIVE CALLING
30857>>>            //  OF THE PROCESS WITHIN THE SAME MINUTE.
30857>>>            If (TSMG800.PERIOD_SESSION_TIMEOUT <> '' and idTime > (Integer(CSAG311.LASTRUN)+ilPeriod)) Begin
30859>>>                If (slDay = '' or (slDay <> '' and ilSchedDay = ilTodayDay)) Begin
30861>>>                    Get Create (RefClass(DataDictionary)) to hObj
30862>>>                    Set Main_File of hObj to CSAG311.File_Number
30863>>>                    Send Request_Assign of hObj
30864>>>                    Send Request_Delete of hObj
30865>>>                    Send Destroy of hObj
30866>>>                    //-
30866>>>                    Move True to stDefaultMsg.hasError
30867>>>                    Move 'SESSAO EXPIRADA' to stDefaultMsg.msgError
30868>>>                End
30868>>>>
30868>>>            End
30868>>>>
30868>>>        End
30868>>>>
30868>>>        Else Begin
30869>>>            Move False to stDefaultMsg.hasError
30870>>>            Move ((Trim(Integer(CSAG311.LASTRUN)+ilPeriod))-idTime) to stDefaultMsg.msgInfo
30871>>>        End
30871>>>>
30871>>>        
30871>>>        Function_Return stDefaultMsg
30872>>>    End_Function //KillSessaoUsuario
30873>>>    
30873>>>    Procedure pLogSQLCROSS String sIndeficador String sQuery
30876>>>        Handle  hoWorkspace
30876>>>        Integer iChnOut
30876>>>        String  logPath
30876>>>        
30876>>>        Get phoWorkspace of ghoApplication to hoWorkspace
30877>>>        Get psProgramPath of hoWorkspace to logPath
30878>>>        Get PathAtIndex of hoWorkspace logPath 1 to logPath
30879>>>        
30879>>>        Move (logPath + "\SQL-CROSS.log" ) to logPath
30880>>>
30880>>>        If (TSMG800.LOGQUERY_YN = "Y") Begin
30882>>>           Move (Seq_New_Channel()) to iChnOut
30883>>>           Append_Output channel iChnOut logPath
30885>>>               Writeln   channel iChnOut ("/*[" + String(CurrentDateTime()) + "]" * Trim(sIndeficador) + "*/")
30888>>>               Writeln   channel iChnOut  "--[bgn]-----------------------------------"
30891>>>               Writeln   channel iChnOut  sQuery
30894>>>               Writeln   channel iChnOut  "--[end]-----------------------------------"
30897>>>           Close_Output  channel iChnOut
30899>>>           Send Seq_Release_Channel iChnOut 
30900>>>        End
30900>>>>
30900>>>    End_Procedure //pLogSQLCROSS
30901>>>
30901>End_Object    // oApplication
30902>
30902>Use SQLServer.pkg            //--- Conexao via ODBC com o SQL Server
Including file: SQLServer.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\SQLServer.pkg)
30902>>>//-2WA
30902>>>Procedure pTRUNCATETABLE String sTabela
#REM AMBIGUOUS METHODS ON .DESKTOP. ARE .NOT. RECOMMENDED (OBSOLETE TECHNIQUE)
30904>>>    Integer hoSQL
30904>>>    String  sConnect
30904>>>    String  sDatabase
30904>>>    String  sSQL
30904>>>    Integer hdbc
30904>>>    Integer hstmt
30904>>>    Integer iFetchResult
30904>>>    
30904>>>    Open    TSMG800
30906>>>    Clear   TSMG800
30907>>>    Smart_Find Ge TSMG800   by 0
30918>>>      If (not(Found)) Clear TSMG800
30921>>>      
30921>>>    Object oEnumDBSQLmanager is a cSQLHandleManager
30923>>>        Move Current_Object to hoSQL
30924>>>    End_Object // oEnumDBSQLManager
30925>>>   
30925>>>    If (hoSQL <> 0) Begin
30927>>>        Get SQLConnect of hoSQL "MSSQLDRV" (Trim(TSMG800.SIDI_DSN)) to hdbc
30928>>>        If (hdbc <> 0) Begin
30930>>>            Get SQLOpen of hdbc to hstmt
30931>>>            If (hstmt <> 0) Begin
30933>>>                
30933>>>                Move ('TRUNCATE TABLE '+(Trim(TSMG800.SIDI_SCHEMA) + (Trim(sTabela)))) to sSQL
30934>>>                Send SQLExecDirect of hstmt sSQL
30935>>>
30935>>>                Send SQLClose to hstmt
30936>>>            End
30936>>>>
30936>>>            Send SQLDisconnect to hdbc
30937>>>        End
30937>>>>
30937>>>    End
30937>>>>
30937>>>    Send Destroy_Object to hoSQL
30938>>>
30938>>>End_Procedure
30939>
30939>Object oWebApp is a cWebApp
30941>    Register_Object oPAG800_01
30941>    Open LOGMAIL
Including file: LOGMAIL.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\LOGMAIL.fd)
30943>    Open HSAG300
30945>    
30945>    Use AllSets.pkg
Including file: AllSets.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\AllSets.pkg)
30945>>>//-2WA
30945>>>Property String  pnUsuarioNumero      ""
30947>>>Property String  pnUsuarioSenha       ""
30949>>>Property Integer piUsuarioIdioma      0
30951>>>Property String  psUsuarioModoSeguro  ""
30953>>>
30953>>>Property String   psUsuarioSessao
30955>>>Property String   psPrograma
30957>>>Property String   psPARAMETRO
30959>>>
30959>>>Property String  psASC_PRINCIPAL      ""
30961>>>Property String  psADS_DESKTOPSIS     ""
30963>>>Property String  psABA_01             ""
30965>>>Property String  psABA_02             ""
30967>>>Property String  psABA_03             ""
30969>>>Property String  psABA_04             ""
30971>>>Property String  psABA_05             ""
30973>>>Property String  psABA_06             ""
30975>>>Property String  psABA_07             ""
30977>>>Property String  psABA_08             ""
30979>>>Property String  psABA_09             ""
30981>>>Property String  psABA_10             ""
30983>>>
30983>>>Property String  psUSUARIOCLASSE      ""
30985>>>Property Date    pdULTIMOACESSO_DATA  ""
30987>>>Property String  psULTIMOACESSO_HORA  ""
30989>>>
30989>>>Property String  psGERAIS_PAG300_00   ""
30991>>>Property String  psGERAIS_PAG301_00   ""
30993>>>Property String  psGERAIS_PAG305_00   ""
30995>>>Property String  psGERAIS_PAG332_00   ""
30997>>>Property String  psGERAIS_PAG333_00   ""
30999>>>Property String  psGERAIS_PAG334_00   ""
31001>>>
31001>>>Property String  psEMPRESA_Logo       ""
31003>>>Property String  psEMPRESA_LogoCor    ""
31005>>>Property String  psEMPRESA_LogoSite   ""
31007>>>Property String  psEMPRESA_Fundo      ""
31009>>>Property String  psVIRGULAPONTO       ""
31011>>>
31011>>>Property String psDecimalSeparator ","    // The decimal separator character to us on the client when formating numeric masks. 
31015>>>//(see DF_DECIMAL_SEPARATOR)
31015>>>Property String psThousandsSeparator "."  // The thousands separator character to us on the client when formating numeric masks.
31019>>>// (see DF_THOUSANDS_SEPARATOR)
31019>>>        
31019>>>Use LoadHTML_CSAG344.pkg
Including file: LoadHTML_CSAG344.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\LoadHTML_CSAG344.pkg)
31019>>>>>//-2WA
31019>>>>>//--- ANDERSON RODRIGUES - 06.04.2014 - 13:08
31019>>>>>//--- STRUCT GLOBAL CSAG344
31019>>>>>Open CSAG344
Including file: CSAG344.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG344.fd)
31021>>>>>
31021>>>>>Struct tgRegistroSQL_344
31021>>>>>    Number  ngSQL_CSAG344RECNUM
31021>>>>>End_Struct // tgRegistroSQL_344
31021>>>>>
31021>>>>>//--- ANDERSON RODRIGUES - 06.04.2014 - 13:08
31021>>>>>Function fLoadHTML_CSAG344 Global String sCSAG308_NR String sPROGRAMA String sSEQUENCIA Returns String
31023>>>>>    String  sQuery
31023>>>>>    String  sCSAG344RECNUM
31023>>>>>    String  sCSAG344CONTEUDO
31023>>>>>    
31023>>>>>    Integer iIndex
31023>>>>>    Integer iSEQUENCIA
31023>>>>>    
31023>>>>>    Move sSEQUENCIA to iSEQUENCIA
31024>>>>>    
31024>>>>>    tgRegistroSQL_344[] vtRegistroSQL_344
31024>>>>>    tgRegistroSQL_344[] vtRegistroSQL_344
31025>>>>>    
31025>>>>>    Move "" to sQuery
31026>>>>>    Move (ResizeArray(vtRegistroSQL_344, 0)) to vtRegistroSQL_344
31027>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG344
31032>>>>>>
31032>>>>>    //--- MONTADO A QUERY
31032>>>>>    Move "select RECNUM from dbo.CSAG344 where CSAG308_NR=%1 and PROGRAMA='%2'" to sQuery
31033>>>>>    If (iSEQUENCIA>0) Begin
31035>>>>>        Move (sQuery*'and SEQUENCIA='+ToSQLNumber(iSEQUENCIA)) to sQuery
31036>>>>>    End
31036>>>>>>
31036>>>>>    Move (sQuery*'order by CSAG308_NR, PROGRAMA, SEQUENCIA') to sQuery
31037>>>>>    
31037>>>>>    Move (SFormat (sQuery, ToSQLNumber(sCSAG308_NR), Trim(sPROGRAMA))) to sQuery
31038>>>>>    SQL_FIND_BEGIN hStmt_CSAG344_99 sQuery
Including file: CSAG300.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG300.fd)
31057>>>>>>
31057>>>>>        //SqlFindValueByName
31057>>>>>        Move (SizeOfArray(vtRegistroSQL_344))          to iIndex
31058>>>>>        Move      (SqlFindValue(hStmt_CSAG344_99,1))   to vtRegistroSQL_344[iIndex].ngSQL_CSAG344RECNUM
31059>>>>>    SQL_FIND_END hStmt_CSAG344_99
31066>>>>>>
31066>>>>>    
31066>>>>>    //--- MONTADO AS MATRIZES
31066>>>>>    For iIndex from 0 to (SizeOfArray(vtRegistroSQL_344)-1)
31072>>>>>>
31072>>>>>            
31072>>>>>        //--- OBTER O RECNUM DO CSAG325
31072>>>>>        Move vtRegistroSQL_344[iIndex].ngSQL_CSAG344RECNUM to sCSAG344RECNUM
31073>>>>>       //--- CARREGAR O CONTEUDO DO HTML -------------------------------
31073>>>>>       Clear   CSAG344
31074>>>>>       Move sCSAG344RECNUM  to CSAG344.RECNUM
31075>>>>>       Find Eq CSAG344      by 0
31076>>>>>>
31076>>>>>       If (Found) Begin
31078>>>>>           Move (sCSAG344CONTEUDO + Trim(CSAG344.CONTEUDO)) to sCSAG344CONTEUDO
31079>>>>>       End
31079>>>>>>
31079>>>>>        
31079>>>>>    Loop        
31080>>>>>>
31080>>>>>    
31080>>>>>    Function_Return sCSAG344CONTEUDO
31081>>>>>        
31081>>>>>End_Function // fLoadHTML_CSAG344
31082>>>Use LoadHTML_CSAG339.pkg
Including file: LoadHTML_CSAG339.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\LoadHTML_CSAG339.pkg)
31082>>>>>//-2WA
31082>>>>>//--- ANDERSON RODRIGUES - 27.08.2015 - 23:03
31082>>>>>Open CSAG339
Including file: CSAG339.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG339.fd)
31084>>>>>
31084>>>>>Function fLoadHTML_CSAG339 Global String sPROGRAMAACAO Returns String
31086>>>>>    String sHTML_RETORNO
31086>>>>>    
31086>>>>>    Clear CSAG339
31087>>>>>    Move sPROGRAMAACAO to CSAG339.PROGRAMAACAO
31088>>>>>    Find Eq CSAG339 by 1
31089>>>>>>
31089>>>>>    If (Found and CSAG339.STATUS = 1);        Move (Trim(CSAG339.PROGRAMALINK)) to sHTML_RETORNO
31092>>>>>        
31092>>>>>    Function_Return sHTML_RETORNO
31093>>>>>End_Function //fLoadHTML_CSAG339
31094>>>Use LOADSQL_CSAG367.pkg
Including file: LOADSQL_CSAG367.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\LOADSQL_CSAG367.pkg)
31094>>>>>//-2WA
31094>>>>>//--- ANDERSON RODRIGUES - 10.10.2015
31094>>>>>//--- ANDERSON RODRIGUES - 02.02.2017 
31094>>>>>//    - INDICE 1 ERA PROGRAMA + DATABASE
31094>>>>>//    - AGORA APENAS PROGRAMA
31094>>>>>//    - ESTA FUNCAO FOI SUBSTITUIDA PELA FIND_CODE_DESCRIPTION
31094>>>>>
31094>>>>>Open CSAG367
Including file: CSAG367.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG367.fd)
31096>>>>>CREATE_MAIN_CONNECTION BYFILE CSAG367
31101>>>>>>
31101>>>>>Function fLoadSQL_CSAG367 Global String sPROGRAM_ID String sDATABASE_ID Returns String
31103>>>>>    String sQUERY
31103>>>>>    
31103>>>>>    Clear   CSAG367
31104>>>>>    Move sPROGRAM_ID    to CSAG367.PROGRAMA
31105>>>>>  //Move sDATABASE_ID   to CSAG367.DATABASE
31105>>>>>    Find Eq CSAG367 by 1
31106>>>>>>
31106>>>>>    If (Found) Begin
31108>>>>>        Move (Trim(CSAG367.CONTEUDO)) to sQUERY
31109>>>>>    End
31109>>>>>>
31109>>>>>    Function_Return sQUERY
31110>>>>>End_Function //fLoadSQL_CSAG367
31111>>>
31111>>>//Object oMensagem is an Edit
31111>>>//End_Object // oMensagem
31111>>>
31111>>>
31111>>>//****************************************************************************
31111>>>// Description
31111>>>//    This function will use the Windows API function to copy the data from
31111>>>//    the editor window into a DataFlex string.
31111>>>//
31111>>>// $Rev History
31111>>>//    04/25/00 VO Module header created
31111>>>//****************************************************************************
31111>>>//Function EditWindowText Returns String
31111>>>//   Integer iTextLen iRetval
31111>>>//   Handle hWnd
31111>>>//   String sFullText
31111>>>//   Pointer lpsFullText
31111>>>
31111>>>//   Get Window_Handle of (oMensagem(Self)) To hWnd
31111>>>//   If (hWnd <> 0) Begin
31111>>>//      Move (SendMessage (hWnd, WM_GETTEXTLENGTH, 0, 0)) To iTextLen
31111>>>//      If (iTextLen <> 0) Begin
31111>>>//         Increment iTextLen
31111>>>//         ZeroString iTextLen To sFullText
31111>>>//         GetAddress Of sFullText To lpsFullText
31111>>>//         Move (SendMessage (hWnd, WM_GETTEXT, iTextLen, lpsFullText)) To iRetval
31111>>>//      End
31111>>>//   End
31111>>>
31111>>>//   Function_Return sFullText
31111>>>//End_Function // EditWindowText
31111>>>
31111>>>USE      CSAG300.DD
Including file: CSAG300.DD    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG300.DD)
31111>>>>>//-2WA
31111>>>>>// Class Name: Csag300_DataDictionary
31111>>>>>// Revision  : 101
31111>>>>>// Version   : 2
31111>>>>>
31111>>>>>Use CtrlData.PKG
Including file: CtrlData.PKG    (C:\Program Files (x86)\DataFlex 18.2\Pkg\CtrlData.PKG)
31111>>>>>>>//-----------------------------------------------------------------
31111>>>>>>>// 2WA TECNOLOGIA DA INFORMACAO
31111>>>>>>>//-----------------------------------------------------------------
31111>>>>>>>// Author: Anderson Rodrigues - 21.01.2014
31111>>>>>>>// Comments: Esta classe tem o objetivo de registrar/controlar os
31111>>>>>>>//           modulos de Inclusao/Altercao/Exclusao. Foi modificada
31111>>>>>>>//           com base na classe anterior DATACTRL.PKG
31111>>>>>>>//-----------------------------------------------------------------
31111>>>>>>>// Author: Anderson Rodrigues - 22.01.2014
31111>>>>>>>// Comments: Trabalhar com uma Array com duas dimensoes
31111>>>>>>>//           Formula Generica: Pos = (((x-1)*dim_1)+y)
31111>>>>>>>//     Onde:
31111>>>>>>>//           Pos = Posicao absoluta dentro da matriz sequencial
31111>>>>>>>//             x = Numero da linha a ser manipulada
31111>>>>>>>//             y = Numero da coluna a der manipulada
31111>>>>>>>//         Dim_1 = Maximo de colunas
31111>>>>>>>//-----------------------------------------------------------------
31111>>>>>>>//-2WA
31111>>>>>>>Use Func.pkg
31111>>>>>>>Use WebEdit.pkg
Including file: WEBEDIT.PKG    (C:\Program Files (x86)\DataFlex 18.2\Pkg\WEBEDIT.PKG)
31111>>>>>>>>>// ANDERSON RODRIGUES 27.07.2004 17:31
31111>>>>>>>>>
31111>>>>>>>>>// Class: Edit
31111>>>>>>>>>//
31111>>>>>>>>>//  1. Add Standard entry support
31111>>>>>>>>>//
31111>>>>>>>>>
31111>>>>>>>>>Use Dfbase.pkg
31111>>>>>>>>>
31111>>>>>>>>>Class c_Edit Is A DfBaseEdit
31112>>>>>>>>>
31112>>>>>>>>>    Procedure Construct_Object
31114>>>>>>>>>        Forward Send Construct_Object
31116>>>>>>>>>        Send Define_Standard_Object_Mixin
31117>>>>>>>>>        Send Define_Dflabel_Mixin
31118>>>>>>>>>        set file_name to ""
31119>>>>>>>>>    End_Procedure // Construct_Object
31120>>>>>>>>>
31120>>>>>>>>>    Import_Class_Protocol Standard_Object_Mixin
31121>>>>>>>>>    Import_Class_Protocol Dflabel_Mixin
31122>>>>>>>>>    Import_Class_Protocol Shadow_Mixin
31123>>>>>>>>>
31123>>>>>>>>>End_Class // Edit
31124>>>>>>>Use DataDict.pkg 
31124>>>>>>>Use SqlFind.pkg
31124>>>>>>>
31124>>>>>>>// LOGDATA.fd - CTRL DAS TRANSACOES
31124>>>>>>>
31124>>>>>>>
31124>>>>>>>//LOGTEXT - CTRL DE LOG TRANS TXT
31124>>>>>>>
31124>>>>>>>Struct tFieldTypeofGrid      
31124>>>>>>>    Integer igridFieldNum        
31124>>>>>>>    String  sgridFieldType       
31124>>>>>>>    String  sgridFieldParam      
31124>>>>>>>End_Struct //tFieldTypeofGrid
31124>>>>>>>
31124>>>>>>>Class c_DataDictionary is a DataDictionary
31125>>>>>>>
31125>>>>>>>    Procedure Construct_Object
31127>>>>>>>
31127>>>>>>>        String[] saDDValue
31128>>>>>>>        Forward Send Construct_Object
31130>>>>>>>             
31130>>>>>>>        Property String[] psaDDValue
31131>>>>>>>        Property String   psProgramName
31132>>>>>>>
31132>>>>>>>        Object oChgd_Fld_A is an Array
31134>>>>>>>        // Array com duas dimensoes
31134>>>>>>>        // Formula: (((x-1)*dim_1)+y)
31134>>>>>>>        End_Object  // oChgd_Fld_A
31135>>>>>>>
31135>>>>>>>        Object oChgd_Fld_B is an Array
31137>>>>>>>        // Array com duas dimensoes
31137>>>>>>>        // Formula: (((x-1)*dim_1)+y)
31137>>>>>>>        End_Object  // oChgd_Fld_B
31138>>>>>>>    
31138>>>>>>>        Object oChgd_Fld_C is an Array
31140>>>>>>>        // Array com duas dimensoes
31140>>>>>>>        // Formula: (((x-1)*dim_1)+y)
31140>>>>>>>        End_Object  // oChgd_Fld_C
31141>>>>>>>    
31141>>>>>>>        Object oChgd_Fld_D is an Array
31143>>>>>>>        // Array com duas dimensoes
31143>>>>>>>        // Formula: (((x-1)*dim_1)+y)
31143>>>>>>>        End_Object  // oChgd_Fld_D
31144>>>>>>>    
31144>>>>>>>//        Object oRascunho is a c_Edit
31144>>>>>>>//        End_Object // oRascunho
31144>>>>>>>    
31144>>>>>>>        Move "" to saDDValue[0]
31145>>>>>>>        Move "" to saDDValue[1]
31146>>>>>>>        Move "" to saDDValue[2]
31147>>>>>>>        Move "" to saDDValue[3]
31148>>>>>>>        Move "" to saDDValue[4]
31149>>>>>>>        Move 0  to saDDValue[5]
31150>>>>>>>        Move 0  to saDDValue[6]
31151>>>>>>>        Move 0  to saDDValue[7]
31152>>>>>>>        Move 0  to saDDValue[8]
31153>>>>>>>        Move 0  to saDDValue[9]
31154>>>>>>>    
31154>>>>>>>        Set psaDDValue to saDDValue
31155>>>>>>>        
31155>>>>>>>        //DEFINE EXTERNAL FILE
31155>>>>>>>        Set Add_System_File to (Eval('LOGDATA.FILE_NUMBER')) DD_LOCK_ON_ALL  
31156>>>>>>>        Set Add_System_File to (Eval('LOGTEXT.FILE_NUMBER')) DD_LOCK_ON_ALL 
31157>>>>>>>        
31157>>>>>>>    End_Procedure // Construct_Object 
31158>>>>>>>    
31158>>>>>>>    Use CtrlOperac.pkg
Including file: CtrlOperac.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\CtrlOperac.pkg)
31158>>>>>>>>>//********************************************************************************************
31158>>>>>>>>>//** Author..: Anderson
31158>>>>>>>>>//** Date....: 21/01/2014
31158>>>>>>>>>//** Revision: 3.0
31158>>>>>>>>>//** Comment.: Esta versao visa atender tambem os campos do tipo texto. 
31158>>>>>>>>>//             Passa a trabalhar com campos do tipo DATETIME.
31158>>>>>>>>>//             Homologada para banco de dados SQLSERVER
31158>>>>>>>>>//********************************************************************************************
31158>>>>>>>>>//** Author..: Anderson Rodrigues
31158>>>>>>>>>//** Date....: 23/01/2014
31158>>>>>>>>>//** Comment.: Trabalhar com uma Array com duas dimensoes
31158>>>>>>>>>//             Formula Generica: Pos = (((x-1)*dim_1)+y)
31158>>>>>>>>>//             Onde:
31158>>>>>>>>>//                  Pos = Posicao absoluta dentro da matriz sequencial
31158>>>>>>>>>//                    x = Numero da linha a ser manipulada
31158>>>>>>>>>//                    y = Numero da coluna a der manipulada
31158>>>>>>>>>//                Dim_1 = Maximo de colunas
31158>>>>>>>>>//********************************************************************************************
31158>>>>>>>>>//** Author..: Anderson Rodrigues
31158>>>>>>>>>//** Date....: 23/01/2014
31158>>>>>>>>>//** Comment.: Chamar a procedure p_FileFieldOperation e passar os seguintes parametros:
31158>>>>>>>>>//              {NUMERO_OPERACAO} - 0 (armazenar o conteudo dos campos numa matriz)
31158>>>>>>>>>//                                     uso: BACKOUT
31158>>>>>>>>>//                                - 1 (ALTERACAO)
31158>>>>>>>>>//                                     uso: SAVE_MAIN_FILE
31158>>>>>>>>>//                                - 2 (INCLUSAO)
31158>>>>>>>>>//                                     uso: SAVE_MAIN_FILE
31158>>>>>>>>>//                                - 3 (EXCLUSAO)
31158>>>>>>>>>//                                     uso: DELETING
31158>>>>>>>>>//             "{NOMEDOPROGRAMA}" - Nome do programa que executou a operacao.
31158>>>>>>>>>//             "{CSAG308_NR}"     - Numero da empresa que administra toda a cadeia.
31158>>>>>>>>>//             "{CSAG308_NM}"     - Nome da empresa que administra toda a cadeia.
31158>>>>>>>>>//             "{CSAG300_ID}"     - Identificador do usuario que executou a operacao.
31158>>>>>>>>>//             "{CSAG300_DS}"     - Descricao do usuario que executou a operacao.
31158>>>>>>>>>//             "{SESSIONID}"      - Identificador da sessao usada pelo usuario para executar a acao.
31158>>>>>>>>>//             "{IPADDRESS}"      - Numero endereco IP usado pelo usuario para executar a acao.
31158>>>>>>>>>//
31158>>>>>>>>>//** Exemplo.:
31158>>>>>>>>>//
31158>>>>>>>>>//            Deleting:
31158>>>>>>>>>//            
31158>>>>>>>>>//            Procedure Deleting
31158>>>>>>>>>//               Forward Send Deleting
31158>>>>>>>>>//               Send p_FileFieldOperation 3 "PCGDI0060_1" "8" "2WA" "114" "JOAQUIM CRUZ" "bc96ddcabbb18be26b3a6fa38ca678afb8112e15182811e3dde5eab8cbb00107" "192:168:1:1"
31158>>>>>>>>>//            End_Procedure   // Deleting
31158>>>>>>>>>//
31158>>>>>>>>>//
31158>>>>>>>>>//            Save_Main_File:
31158>>>>>>>>>//            
31158>>>>>>>>>//            Procedure Save_Main_File
31158>>>>>>>>>//               Integer iRECNUM
31158>>>>>>>>>//               Move TABELA.RECNUM to iRECNUM
31158>>>>>>>>>//               Forward Send Save_Main_File
31158>>>>>>>>>//               If (iRECNUM=0) Begin
31158>>>>>>>>>//                  //--- NOVO REGISTRO
31158>>>>>>>>>//                  Send p_FileFieldOperation 2 "PCGDI0060_1" "8" "2WA" "114" "JOAQUIM CRUZ" "bc96ddcabbb18be26b3a6fa38ca678afb8112e15182811e3dde5eab8cbb00107" "192:168:1:1"
31158>>>>>>>>>//               End
31158>>>>>>>>>//               Else Begin
31158>>>>>>>>>//                  //--- REGISTRO ALTERADO
31158>>>>>>>>>//                  Send p_FileFieldOperation 1 "PCGDI0060_1" "8" "2WA" "114" "JOAQUIM CRUZ" "bc96ddcabbb18be26b3a6fa38ca678afb8112e15182811e3dde5eab8cbb00107" "192:168:1:1"
31158>>>>>>>>>//               End
31158>>>>>>>>>//            End_Procedure   // Save_Main_File
31158>>>>>>>>>//
31158>>>>>>>>>//
31158>>>>>>>>>//            Backout:
31158>>>>>>>>>//            
31158>>>>>>>>>//            Procedure Backout
31158>>>>>>>>>//               Forward Send Backout
31158>>>>>>>>>//                  Send p_FileFieldOperation 0 "PCGDI0060_1" "8" "2WA" "114" "JOAQUIM CRUZ" "bc96ddcabbb18be26b3a6fa38ca678afb8112e15182811e3dde5eab8cbb00107" "192:168:1:1"
31158>>>>>>>>>//            End_Procedure   // Backout
31158>>>>>>>>>//
31158>>>>>>>>>//********************************************************************************************
31158>>>>>>>>>
31158>>>>>>>>>Procedure p_FileFieldOperation Integer iOper ;                                String sProgDS ;                                String sCSAG308NR ;                                String sCSAG308NM ;                                String sUsuarioID ;                                String sUsuarioDS ;                                String sSessionID ;                                String sAddress
31160>>>>>>>>>    
31160>>>>>>>>>    //DECLARACAO DAS VARIAVES LOCAIS
31160>>>>>>>>>    Integer iNrFld 
31160>>>>>>>>>    Integer iTtFld 
31160>>>>>>>>>    Integer iType 
31160>>>>>>>>>    Integer iQtdA
31160>>>>>>>>>    Integer iQtdB
31160>>>>>>>>>    Integer iRecID 
31160>>>>>>>>>
31160>>>>>>>>>    Integer iFileID
31160>>>>>>>>>    Handle  hObjA 
31160>>>>>>>>>    Handle  hObjB 
31160>>>>>>>>>    
31160>>>>>>>>>    String  sFieldA 
31160>>>>>>>>>    String  sFieldB 
31160>>>>>>>>>    String  sFileDS 
31160>>>>>>>>>    String  sFieldD 
31160>>>>>>>>>    String  sLocal 
31160>>>>>>>>>    String  sOperTP
31160>>>>>>>>>    
31160>>>>>>>>>    //--- IDENTIFICAR A TABELA PRINCIPAL DO DICIONARIO DE DADOS
31160>>>>>>>>>    Move (Main_File(Self))       to iFileID
31161>>>>>>>>>    
31161>>>>>>>>>    //--- IDENTIFICAR OS OBJETOS DE ARRAY
31161>>>>>>>>>    Get Object_Id of oChgd_Fld_A to hObjA
31162>>>>>>>>>    Get Object_Id of oChgd_Fld_B to hObjB
31163>>>>>>>>>    
31163>>>>>>>>>    //--- OBTER INFORMACOES SONRE A TABELA PRINCIPAL
31163>>>>>>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS of iFileID to iTtFld
31166>>>>>>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  of iFileID to sFileDS
31169>>>>>>>>>    
31169>>>>>>>>>    //--- UPPERCASE
31169>>>>>>>>>    Move (UpperCase(sProgDS)) to sProgDS
31170>>>>>>>>>    Move (UpperCase(sFileDS)) to sFileDS
31171>>>>>>>>>    
31171>>>>>>>>>    //--- SABER SE A ARRAY CONTEM INFORMACAO
31171>>>>>>>>>    Get Item_Count of hObjA to iQtdA
31172>>>>>>>>>    Get Item_Count of hObjB to iQtdB
31173>>>>>>>>>    
31173>>>>>>>>>    If (iOper=0) Begin
31175>>>>>>>>>        Send Delete_Data of hObjA  
31176>>>>>>>>>        Send Delete_Data of hObjB  
31177>>>>>>>>>        For iNrFld from 1 to iTtFld
31183>>>>>>>>>>
31183>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31186>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31188>>>>>>>>>                
31188>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldB
31191>>>>>>>>>                
31191>>>>>>>>>                Move (Trim(sFieldB)) to sFieldB
31192>>>>>>>>>                
31192>>>>>>>>>                If (iType=DF_TEXT) ;                    Set Value of hObjB item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31195>>>>>>>>>                Else ;                    Set Value of hObjA item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31197>>>>>>>>>            End
31197>>>>>>>>>>
31197>>>>>>>>>        Loop
31198>>>>>>>>>>
31198>>>>>>>>>    End
31198>>>>>>>>>>
31198>>>>>>>>>    Else If (iOper=1 and (iQtdA>0 or iQtdB>0)) Begin
31201>>>>>>>>>        Move "ALTERACAO" to sOperTP
31202>>>>>>>>>        For iNrFld from 1 to iTtFld
31208>>>>>>>>>>
31208>>>>>>>>>            
31208>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31211>>>>>>>>>            
31211>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin 
31213>>>>>>>>>                
31213>>>>>>>>>               Get_Field_Value iFileID iNrFld to sFieldA
31216>>>>>>>>>               Get_Field_Value iFileID 0      to iRecID
31219>>>>>>>>>               
31219>>>>>>>>>               If (iType=DF_TEXT) ;                   Get Value of hObjB item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31222>>>>>>>>>               Else ;                   Get Value of hObjA item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31224>>>>>>>>>               
31224>>>>>>>>>               Move (Trim(sFieldB))           to sFieldB
31225>>>>>>>>>               Move (Trim(sFieldA))           to sFieldA
31226>>>>>>>>>               
31226>>>>>>>>>               If (sFieldA<>sFieldB) Begin
31228>>>>>>>>>                    Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31231>>>>>>>>>                    If (iType=DF_TEXT) ;                        Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31234>>>>>>>>>                    Else ;                        Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31236>>>>>>>>>               End
31236>>>>>>>>>>
31236>>>>>>>>>            End
31236>>>>>>>>>>
31236>>>>>>>>>        Loop
31237>>>>>>>>>>
31237>>>>>>>>>        Send Delete_Data to hObjA
31238>>>>>>>>>        Send Delete_Data to hObjB
31239>>>>>>>>>    End
31239>>>>>>>>>>
31239>>>>>>>>>    Else If (iOper=2) Begin
31242>>>>>>>>>        Move "INCLUSAO" to sOperTP
31243>>>>>>>>>        For iNrFld from 1 to iTtFld
31249>>>>>>>>>>
31249>>>>>>>>>            
31249>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31252>>>>>>>>>            
31252>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31254>>>>>>>>>                
31254>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldA       
31257>>>>>>>>>                Get_Field_Value iFileID 0      to iRecID
31260>>>>>>>>>                
31260>>>>>>>>>                Move ""                        to sFieldB
31261>>>>>>>>>                Move (Trim(sFieldA))           to sFieldA
31262>>>>>>>>>                
31262>>>>>>>>>                Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31265>>>>>>>>>                If (iType=DF_TEXT) ;                    Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31268>>>>>>>>>                Else ;                    Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31270>>>>>>>>>            End
31270>>>>>>>>>>
31270>>>>>>>>>        Loop
31271>>>>>>>>>>
31271>>>>>>>>>        Send Delete_Data to hObjA
31272>>>>>>>>>        Send Delete_Data to hObjB
31273>>>>>>>>>    End
31273>>>>>>>>>>
31273>>>>>>>>>    Else If (iOper=3) Begin
31276>>>>>>>>>        Move "EXCLUSAO" to sOperTP
31277>>>>>>>>>        For iNrFld from 1 to iTtFld
31283>>>>>>>>>>
31283>>>>>>>>>            
31283>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31286>>>>>>>>>            
31286>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31288>>>>>>>>>        
31288>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldB
31291>>>>>>>>>                Get_Field_Value iFileID 0      to iRecID
31294>>>>>>>>>                
31294>>>>>>>>>                Move (Trim(sFieldB))           to sFieldB
31295>>>>>>>>>                Move ""                        to sFieldA
31296>>>>>>>>>                
31296>>>>>>>>>                Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31299>>>>>>>>>                
31299>>>>>>>>>                If (iType=DF_TEXT) ;                    Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31302>>>>>>>>>                Else ;                    Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31304>>>>>>>>>            End
31304>>>>>>>>>>
31304>>>>>>>>>        Loop
31305>>>>>>>>>>
31305>>>>>>>>>        Send Delete_Data to hObjA
31306>>>>>>>>>        Send Delete_Data to hObjB
31307>>>>>>>>>    End
31307>>>>>>>>>>
31307>>>>>>>>>End_Procedure //p_FFOperation
31308>>>>>>>>>
31308>>>>>>>>>
31308>>>>>>>>>Procedure p_FileFieldOperationTable Integer iFileID;                                    Integer iOper ;                                    String sProgDS ;                                    String sCSAG308NR ;                                    String sCSAG308NM ;                                    String sUsuarioID ;                                    String sUsuarioDS ;                                    String sSessionID ;                                    String sAddress
31310>>>>>>>>>    
31310>>>>>>>>>    //DECLARACAO DAS VARIAVES LOCAIS
31310>>>>>>>>>    Integer iNrFld 
31310>>>>>>>>>    Integer iTtFld 
31310>>>>>>>>>    Integer iType 
31310>>>>>>>>>    Integer iQtdA
31310>>>>>>>>>    Integer iQtdB
31310>>>>>>>>>    Integer iRecID 
31310>>>>>>>>>
31310>>>>>>>>>    Handle  hObjC 
31310>>>>>>>>>    Handle  hObjD 
31310>>>>>>>>>    
31310>>>>>>>>>    String  sFieldA 
31310>>>>>>>>>    String  sFieldB 
31310>>>>>>>>>    String  sFileDS 
31310>>>>>>>>>    String  sFieldD 
31310>>>>>>>>>    String  sLocal 
31310>>>>>>>>>    String  sOperTP
31310>>>>>>>>>    
31310>>>>>>>>>    //--- IDENTIFICAR OS OBJETOS DE ARRAY
31310>>>>>>>>>    Get Object_Id of oChgd_Fld_C to hObjC
31311>>>>>>>>>    Get Object_Id of oChgd_Fld_D to hObjD
31312>>>>>>>>>    
31312>>>>>>>>>    //--- OBTER INFORMACOES SONRE A TABELA PRINCIPAL
31312>>>>>>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS of iFileID to iTtFld
31315>>>>>>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  of iFileID to sFileDS
31318>>>>>>>>>    
31318>>>>>>>>>    //--- UPPERCASE
31318>>>>>>>>>    Move (UpperCase(sProgDS)) to sProgDS
31319>>>>>>>>>    Move (UpperCase(sFileDS)) to sFileDS
31320>>>>>>>>>    
31320>>>>>>>>>    //--- SABER SE A ARRAY CONTEM INFORMACAO
31320>>>>>>>>>    Get Item_Count of hObjC to iQtdA
31321>>>>>>>>>    Get Item_Count of hObjD to iQtdB
31322>>>>>>>>>    
31322>>>>>>>>>    If (iOper=0) Begin
31324>>>>>>>>>        Send Delete_Data of hObjC  
31325>>>>>>>>>        Send Delete_Data of hObjD  
31326>>>>>>>>>        For iNrFld from 1 to iTtFld
31332>>>>>>>>>>
31332>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31335>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31337>>>>>>>>>                
31337>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldB
31340>>>>>>>>>                
31340>>>>>>>>>                Move (Trim(sFieldB)) to sFieldB
31341>>>>>>>>>                
31341>>>>>>>>>                If (iType=DF_TEXT) ;                    Set Value of hObjD item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31344>>>>>>>>>                Else ;                    Set Value of hObjC item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31346>>>>>>>>>            End
31346>>>>>>>>>>
31346>>>>>>>>>        Loop
31347>>>>>>>>>>
31347>>>>>>>>>    End
31347>>>>>>>>>>
31347>>>>>>>>>    Else If (iOper=1 and (iQtdA>0 or iQtdB>0)) Begin
31350>>>>>>>>>        Move "ALTERACAO" to sOperTP
31351>>>>>>>>>        For iNrFld from 1 to iTtFld
31357>>>>>>>>>>
31357>>>>>>>>>            
31357>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31360>>>>>>>>>            
31360>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin 
31362>>>>>>>>>                
31362>>>>>>>>>               Get_Field_Value iFileID iNrFld to sFieldA
31365>>>>>>>>>               Get_Field_Value iFileID 0      to iRecID
31368>>>>>>>>>               
31368>>>>>>>>>               If (iType=DF_TEXT) ;                   Get Value of hObjD item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31371>>>>>>>>>               Else ;                   Get Value of hObjC item (((iFileID-1)*iTtFld)+iNrFld) to sFieldB
31373>>>>>>>>>               
31373>>>>>>>>>               Move (Trim(sFieldB))           to sFieldB
31374>>>>>>>>>               Move (Trim(sFieldA))           to sFieldA
31375>>>>>>>>>               
31375>>>>>>>>>               If (sFieldA<>sFieldB) Begin
31377>>>>>>>>>                    Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31380>>>>>>>>>                    If (iType=DF_TEXT) ;                        Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31383>>>>>>>>>                    Else ;                        Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31385>>>>>>>>>               End
31385>>>>>>>>>>
31385>>>>>>>>>            End
31385>>>>>>>>>>
31385>>>>>>>>>        Loop
31386>>>>>>>>>>
31386>>>>>>>>>        Send Delete_Data to hObjC
31387>>>>>>>>>        Send Delete_Data to hObjD
31388>>>>>>>>>    End
31388>>>>>>>>>>
31388>>>>>>>>>    Else If (iOper=2) Begin
31391>>>>>>>>>        Move "INCLUSAO" to sOperTP
31392>>>>>>>>>        For iNrFld from 1 to iTtFld
31398>>>>>>>>>>
31398>>>>>>>>>            
31398>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31401>>>>>>>>>            
31401>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31403>>>>>>>>>                
31403>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldA       
31406>>>>>>>>>                Get_Field_Value iFileID 0      to iRecID
31409>>>>>>>>>                
31409>>>>>>>>>                Move ""                        to sFieldB
31410>>>>>>>>>                Move (Trim(sFieldA))           to sFieldA
31411>>>>>>>>>                
31411>>>>>>>>>                Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31414>>>>>>>>>                If (iType=DF_TEXT) ;                    Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31417>>>>>>>>>                Else ;                    Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31419>>>>>>>>>            End
31419>>>>>>>>>>
31419>>>>>>>>>        Loop
31420>>>>>>>>>>
31420>>>>>>>>>        Send Delete_Data to hObjC
31421>>>>>>>>>        Send Delete_Data to hObjD
31422>>>>>>>>>    End
31422>>>>>>>>>>
31422>>>>>>>>>    Else If (iOper=3) Begin
31425>>>>>>>>>        Move "EXCLUSAO" to sOperTP
31426>>>>>>>>>        For iNrFld from 1 to iTtFld
31432>>>>>>>>>>
31432>>>>>>>>>            
31432>>>>>>>>>            Get_Attribute DF_FIELD_TYPE of iFileID iNrFld to iType
31435>>>>>>>>>            
31435>>>>>>>>>            If (iType=DF_ASCII or iType=DF_BCD or iType=DF_DATE or iType=DF_DATETIME or iType=DF_TEXT) Begin
31437>>>>>>>>>        
31437>>>>>>>>>                Get_Field_Value iFileID iNrFld to sFieldB
31440>>>>>>>>>                Get_Field_Value iFileID 0      to iRecID
31443>>>>>>>>>                
31443>>>>>>>>>                Move (Trim(sFieldB))           to sFieldB
31444>>>>>>>>>                Move ""                        to sFieldA
31445>>>>>>>>>                
31445>>>>>>>>>                Get_Attribute DF_FIELD_NAME of iFileID iNrFld to sFieldD
31448>>>>>>>>>                
31448>>>>>>>>>                If (iType=DF_TEXT) ;                    Send p_Log_LOGTEXT sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31451>>>>>>>>>                Else ;                    Send p_Log_LOGDATA sOperTP sFileDS iFileID iRecID sFieldB sFieldA sFieldD iNrFld sProgDS sCSAG308NR sCSAG308NM sUsuarioID sUsuarioDS sSessionID sAddress
31453>>>>>>>>>            End
31453>>>>>>>>>>
31453>>>>>>>>>        Loop
31454>>>>>>>>>>
31454>>>>>>>>>        Send Delete_Data to hObjC
31455>>>>>>>>>        Send Delete_Data to hObjD
31456>>>>>>>>>    End
31456>>>>>>>>>>
31456>>>>>>>>>End_Procedure //p_FileFieldOperationTable
31457>>>>>>>>>
31457>>>>>>>>>
31457>>>>>>>>>Procedure p_Log_LOGDATA String sOperTP ;                         String sFileDS ;                         Integer iFileID ;                         Integer iRecID ;                         String sFieldB ;                         String sFieldA ;                         String sFieldD ;                         Integer iNrFld ;                         String sProgDS ;                         String sCSAG308NR ;                         String sCSAG308NM ;                         String sUsuarioID ;                         String sUsuarioDS ;                         String sSessionID ;                         String sAddress
31459>>>>>>>>>    
31459>>>>>>>>>    
31459>>>>>>>>>    //---REGISTRANDO LOG DA INFORMACAO
31459>>>>>>>>>    Clear LOGDATA
31460>>>>>>>>>    Move sCSAG308NR                 to LOGDATA.CSAG308_NR    
31461>>>>>>>>>    Move sCSAG308NM                 to LOGDATA.CSAG308_NM
31462>>>>>>>>>    Move sUsuarioID                 to LOGDATA.CSAG300_ID    
31463>>>>>>>>>    Move sUsuarioDS                 to LOGDATA.CSAG300_DS
31464>>>>>>>>>    Move sProgDS                    to LOGDATA.PROGRAMA_NM
31465>>>>>>>>>    Move (CurrentDateTime())        to LOGDATA.DATE_TIME
31466>>>>>>>>>    Move sOperTP                    to LOGDATA.TIPO 
31467>>>>>>>>>    Move iFileID                    to LOGDATA.FILE_ID
31468>>>>>>>>>    Move sFileDS                    to LOGDATA.FILE_DS
31469>>>>>>>>>    Move iRecID                     to LOGDATA.FILE_RECNUM
31470>>>>>>>>>    Move iNrFld                     to LOGDATA.FIELD_ID
31471>>>>>>>>>    Move sFieldD                    to LOGDATA.FIELD_DS
31472>>>>>>>>>    Move sFieldB                    to LOGDATA.FIELD_BEFORE
31473>>>>>>>>>    Move sFieldA                    to LOGDATA.FIELD_AFTER
31474>>>>>>>>>    Move sAddress                   to LOGDATA.IP_ADDRESS
31475>>>>>>>>>    Move sSessionID                 to LOGDATA.SESSIONID
31476>>>>>>>>>    SaveRecord LOGDATA
31477>>>>>>>>>    
31477>>>>>>>>>End_Procedure //p_Log_LOGDATA       
31478>>>>>>>>>
31478>>>>>>>>>Procedure p_Log_LOGTEXT String sOperTP ;                         String sFileDS ;                         Integer iFileID ;                         Integer iRecID ;                         String sFieldB ;                         String sFieldA ;                         String sFieldD ;                         Integer iNrFld ;                         String sProgDS ;                         String sCSAG308NR ;                         String sCSAG308NM ;                         String sUsuarioID ;                         String sUsuarioDS ;                         String sSessionID ;                         String sAddress
31480>>>>>>>>>    
31480>>>>>>>>>    //---REGISTRANDO LOG DA INFORMACAO
31480>>>>>>>>>    Clear LOGTEXT
31481>>>>>>>>>    Move sCSAG308NR                 to LOGTEXT.CSAG308_NR    
31482>>>>>>>>>    Move sCSAG308NM                 to LOGTEXT.CSAG308_NM
31483>>>>>>>>>    Move sUsuarioID                 to LOGTEXT.CSAG300_ID    
31484>>>>>>>>>    Move sUsuarioDS                 to LOGTEXT.CSAG300_DS
31485>>>>>>>>>    Move sProgDS                    to LOGTEXT.PROGRAMA_NM
31486>>>>>>>>>    Move (CurrentDateTime())        to LOGTEXT.DATE_TIME
31487>>>>>>>>>    Move sOperTP                    to LOGTEXT.TIPO 
31488>>>>>>>>>    Move iFileID                    to LOGTEXT.FILE_ID
31489>>>>>>>>>    Move sFileDS                    to LOGTEXT.FILE_DS
31490>>>>>>>>>    Move iRecID                     to LOGTEXT.FILE_RECNUM
31491>>>>>>>>>    Move iNrFld                     to LOGTEXT.FIELD_ID
31492>>>>>>>>>    Move sFieldD                    to LOGTEXT.FIELD_DS
31493>>>>>>>>>    Move sFieldB                    to LOGTEXT.FIELD_BEFORE
31494>>>>>>>>>    Move sFieldA                    to LOGTEXT.FIELD_AFTER
31495>>>>>>>>>    Move sAddress                   to LOGTEXT.IP_ADDRESS
31496>>>>>>>>>    Move sSessionID                 to LOGTEXT.SESSIONID
31497>>>>>>>>>    SaveRecord LOGTEXT
31498>>>>>>>>>    
31498>>>>>>>>>End_Procedure //p_Log_LOGTEXT       
31499>>>>>>>    Use CtrlUsr.pkg
Including file: CtrlUsr.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\CtrlUsr.pkg)
31499>>>>>>>>>//********************************************************************************************
31499>>>>>>>>>//** Author..: Anderson Rodrigues
31499>>>>>>>>>//** Date....: 02/01/2002
31499>>>>>>>>>//** Revisao.: 2.1
31499>>>>>>>>>//** Comment.: Esta procedure tem por definicao guardar automaticamente
31499>>>>>>>>>//             o nome do usuario que fez qualquer alteracao/inclusao no registro
31499>>>>>>>>>//             a data e a hora da alteracao.
31499>>>>>>>>>//********************************************************************************************
31499>>>>>>>>>//** Author..: Anderson Rodrigues
31499>>>>>>>>>//** Date....: 22/11/2009
31499>>>>>>>>>//** Revisao.: 3.1
31499>>>>>>>>>//********************************************************************************************
31499>>>>>>>>>//** Author..: Anderson Rodrigues
31499>>>>>>>>>//** Date....: 22/01/2014
31499>>>>>>>>>//** Revisao.: 4.1
31499>>>>>>>>>//********************************************************************************************
31499>>>>>>>>>
31499>>>>>>>>>Procedure p_RegistraAcessoUsuario String sField String sUsuario
31501>>>>>>>>>    
31501>>>>>>>>>    Integer  iFile 
31501>>>>>>>>>    Integer  iField
31501>>>>>>>>>    
31501>>>>>>>>>    String   sFile
31501>>>>>>>>>    
31501>>>>>>>>>    DateTime dtCurrentDateTime
31501>>>>>>>>>       
31501>>>>>>>>>    Move (CurrentDateTime())       to dtCurrentDateTime
31502>>>>>>>>>    //Move (CurrentSystemTime())       to dtCurrentDateTime
31502>>>>>>>>>    
31502>>>>>>>>>    // Extrair da variavel sField o "NOME DO ARQUIVO." -----------------
31502>>>>>>>>>    Move (Left(sField,(Pos(".",sField))))   to sFile
31503>>>>>>>>>    
31503>>>>>>>>>    // Remover da variavel sField o "NOME DO ARQUIVO." -----------------
31503>>>>>>>>>    Move (Replace(sFile,sField,""))         to sField
31504>>>>>>>>>    
31504>>>>>>>>>    // Concatenar o NOME DO ARQUIVO. + FILE_NUMBER ---------------------
31504>>>>>>>>>    Move (sFile+"File_Number")              to sFile
31505>>>>>>>>>    
31505>>>>>>>>>    // Pegar o numero do arquivo ---------------------------------------
31505>>>>>>>>>    Move (Eval(sFile))                      to iFile
31506>>>>>>>>>
31506>>>>>>>>>    // Pegar o numero do campo no arquivo ------------------------------
31506>>>>>>>>>    Field_Map iFile sField                  to iField      
31508>>>>>>>>>    
31508>>>>>>>>>    Set_Field_Value iFile  iField           to sUsuario
31511>>>>>>>>>    Set_Field_Value iFile (iField+1)        to dtCurrentDateTime
31514>>>>>>>>>    
31514>>>>>>>>>End_Procedure // p_RegistraAcessoUsuario
31515>>>>>>>>>    
31515>>>>>>>
31515>>>>>>>End_Class // c_DataDictionary
31516>>>>>Use Ddvaltbl.pkg          // Validation Table Class Definitions
31516>>>>>
31516>>>>>Open CSAG300
31518>>>>>Open TSMG801
Including file: TSMG801.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\TSMG801.fd)
31520>>>>>Open TSMG802
Including file: TSMG802.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\TSMG802.fd)
31522>>>>>Open CSAG315
Including file: CSAG315.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG315.fd)
31524>>>>>Open CSAG326
Including file: CSAG326.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG326.fd)
31526>>>>>Open CSAG361
Including file: CSAG361.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG361.fd)
31528>>>>>Open CSAG368
Including file: CSAG368.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG368.fd)
31530>>>>>Open CSAG398
Including file: CSAG398.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG398.fd)
31532>>>>>Open LOGDATA
31534>>>>>Open LOGTEXT
31536>>>>>Open CSAG311
31538>>>>>Open CSAG332
Including file: CSAG332.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG332.fd)
31540>>>>>Open CSAG333
Including file: CSAG333.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG333.fd)
31542>>>>>Open CSAG334
Including file: CSAG334.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG334.fd)
31544>>>>>Open CSAG400
Including file: CSAG400.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG400.fd)
31546>>>>>Open CSAG361
31548>>>>>Open CSAG363
Including file: CSAG363.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG363.fd)
31550>>>>>Open CSAG369
Including file: CSAG369.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG369.fd)
31552>>>>>Open CSAG374
Including file: CSAG374.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG374.fd)
31554>>>>>Open CSAG378
Including file: CSAG378.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG378.fd)
31556>>>>>Open CSAG316
Including file: CSAG316.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG316.fd)
31558>>>>>Open CSAG364
Including file: CSAG364.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG364.fd)
31560>>>>>Open CSAG400
31562>>>>>Open CSAG332
31564>>>>>Open CSAG362
Including file: CSAG362.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG362.fd)
31566>>>>>Open CSAG314
Including file: CSAG314.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG314.fd)
31568>>>>>Open Tgrupo_economico
Including file: Tgrupo_economico.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\Tgrupo_economico.fd)
31570>>>>>Open Tgrupo_economico_pessoas
Including file: Tgrupo_economico_pessoas.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\Tgrupo_economico_pessoas.fd)
31572>>>>>
31572>>>>>Use TabelasdeValidacao.pkg
Including file: TabelasdeValidacao.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\TabelasdeValidacao.pkg)
31572>>>>>>>//-2WA
31572>>>>>>>Use ddvaltbl.pkg
31572>>>>>>>
31572>>>>>>>Open CSAG329
Including file: CSAG329.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG329.fd)
31574>>>>>>>Open CSAG379
Including file: CSAG379.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG379.fd)
31576>>>>>>>Open CSAG331
Including file: CSAG331.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG331.fd)
31578>>>>>>>Open CCGS204
Including file: CCGS204.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS204.fd)
31580>>>>>>>Open CCGS206
Including file: CCGS206.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS206.fd)
31582>>>>>>>Open CCGS221
Including file: CCGS221.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS221.fd)
31584>>>>>>>Open CCGS223
Including file: CCGS223.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS223.fd)
31586>>>>>>>Open CCGS224
Including file: CCGS224.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS224.fd)
31588>>>>>>>Open MSAG362
Including file: MSAG362.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\MSAG362.fd)
31590>>>>>>>Open CCGS225
Including file: CCGS225.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS225.fd)
31592>>>>>>>Open CCGS226
Including file: CCGS226.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS226.fd)
31594>>>>>>>Open CSAG367
31596>>>>>>>Open CSAG325
Including file: CSAG325.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG325.fd)
31598>>>>>>>Open CCGS247
Including file: CCGS247.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS247.fd)
31600>>>>>>>
31600>>>>>>>Register_Object oCLASSES_TAXA_FVT
31600>>>>>>>Register_Object oTRADES_FVT
31600>>>>>>>Register_Object oPAISES_FVT
31600>>>>>>>Register_Object oUF_FVT
31600>>>>>>>Register_Object oCARAC_EMBARQUE_FVT
31600>>>>>>>Register_Object oMODAL_PAGTO_FVT
31600>>>>>>>Register_Object oINCOTERMS_FVT
31600>>>>>>>Register_Object oTYPESOFDATE_FVT
31600>>>>>>>Register_Object oFREQUENCIA_FVT
31600>>>>>>>Register_Object oMSAG362_SISTEMA_FVT
31600>>>>>>>Register_Object oDESCRICOES_TARIFARIO_FVT
31600>>>>>>>Register_Object oHCGS3003_STATUS_VT
31600>>>>>>>Register_Object oCSAG367_FVT
31600>>>>>>>Register_Object oCSAG325_FVT
31600>>>>>>>Register_Object oIMO_PKG_FVT
31600>>>>>>>Register_Object oDensidadeUnit_VT
31600>>>>>>>Register_Object oIMO_PackingGroup_VT
31600>>>>>>>Register_Object oVolumeUnit_VT
31600>>>>>>>Register_Object oGrossUnit_VT
31600>>>>>>>Register_Object oUOMUnit_VT
31600>>>>>>>
31600>>>>>>>Object oCLASSES_TAXA_FVT is a FileValidationTable
31602>>>>>>>    Set Main_File           to CCGS221.File_Number
31603>>>>>>>    Set Code_Field          to 1
31604>>>>>>>    Set Description_Field   to 2
31605>>>>>>>    Set Ordering            to 2
31606>>>>>>>End_Object //oCLASSES_TAXA_FVT
31607>>>>>>>
31607>>>>>>>Object oCSAG367_FVT is a FileValidationTable
31609>>>>>>>    Set Validate_State      to False
31610>>>>>>>    Set Main_File           to CSAG367.File_Number
31611>>>>>>>    Set Code_Field          to 1
31612>>>>>>>    Set Description_Field   to 4
31613>>>>>>>    Set Ordering            to 1
31614>>>>>>>End_Object //oCSAG367_FVT
31615>>>>>>>
31615>>>>>>>Object oPAISES_FVT is a FileValidationTable
31617>>>>>>>    Set Validate_State      to False
31618>>>>>>>    Set Main_File           to CSAG329.File_Number
31619>>>>>>>    Set Code_Field          to 1
31620>>>>>>>    Set Description_Field   to 2
31621>>>>>>>    Set Ordering            to 2
31622>>>>>>>End_Object //oPAISES_FVT
31623>>>>>>>
31623>>>>>>>Object oTRADES_FVT is a FileValidationTable
31625>>>>>>>    Set Validate_State      to False
31626>>>>>>>    Set Main_File           to CSAG379.File_Number
31627>>>>>>>    Set Code_Field          to 1
31628>>>>>>>    Set Description_Field   to 2
31629>>>>>>>    Set Ordering            to 2
31630>>>>>>>End_Object //oTRADES_FVT
31631>>>>>>>
31631>>>>>>>//Object oUF_FVT is a FileValidationTable
31631>>>>>>>//    Set Main_File           to CSAG331.File_Number
31631>>>>>>>//    Set Code_Field          to 1
31631>>>>>>>//    Set Description_Field   to 2
31631>>>>>>>//    Set Ordering            to 2
31631>>>>>>>//End_Object //oUF_FVT
31631>>>>>>>
31631>>>>>>>Object oCARAC_EMBARQUE_FVT is a FileValidationTable
31633>>>>>>>    Set Main_File           to CCGS204.File_Number
31634>>>>>>>    Set Code_Field          to 1
31635>>>>>>>    Set Description_Field   to 2
31636>>>>>>>    Set Ordering            to 2
31637>>>>>>>End_Object //oCARAC_EMBARQUE_FVT
31638>>>>>>>
31638>>>>>>>Object oMODAL_PAGTO_FVT is a FileValidationTable
31640>>>>>>>    Set Main_File           to CCGS206.File_Number
31641>>>>>>>    Set Code_Field          to 1
31642>>>>>>>    Set Description_Field   to 2
31643>>>>>>>    Set Ordering            to 2
31644>>>>>>>End_Object //oMODAL_PAGTO_FVT
31645>>>>>>>
31645>>>>>>>Object oINCOTERMS_FVT is a FileValidationTable
31647>>>>>>>    Set Validate_State      to False
31648>>>>>>>    Set Main_File           to CCGS223.File_Number
31649>>>>>>>    Set Code_Field          to 1
31650>>>>>>>    Set Description_Field   to 2
31651>>>>>>>    Set Ordering            to 2
31652>>>>>>>End_Object //oINCOTERMS_FVT
31653>>>>>>>
31653>>>>>>>Object oTYPESOFDATE_FVT is a FileValidationTable
31655>>>>>>>    Set Validate_State      to False
31656>>>>>>>    Set Main_File           to CCGS224.File_Number
31657>>>>>>>    Set Code_Field          to 1
31658>>>>>>>    Set Description_Field   to 2
31659>>>>>>>    Set Ordering            to 2
31660>>>>>>>End_Object //oTYPESOFDATE_FVT
31661>>>>>>>
31661>>>>>>>Object oFREQUENCIA_FVT is a FileValidationTable
31663>>>>>>>    Set Validate_State      to False
31664>>>>>>>    Set Main_File           to CCGS226.File_Number
31665>>>>>>>    Set Code_Field          to 1
31666>>>>>>>    Set Description_Field   to 2
31667>>>>>>>    Set Ordering            to 2
31668>>>>>>>End_Object //oFREQUENCIA_FVT
31669>>>>>>>
31669>>>>>>>Object oMSAG362_SISTEMA_FVT is a FileValidationTable
31671>>>>>>>    Set Validate_State      to False
31672>>>>>>>    Set Main_File           to MSAG362.File_Number
31673>>>>>>>    Set Code_Field          to 1
31674>>>>>>>    Set Description_Field   to 2
31675>>>>>>>    Set Ordering            to 2
31676>>>>>>>End_Object //oMSAG362_SISTEMA_FVT
31677>>>>>>>
31677>>>>>>>Object oDESCRICOES_TARIFARIO_FVT is a FileValidationTable
31679>>>>>>>    Set Validate_State      to False
31680>>>>>>>    Set Main_File           to CCGS225.File_Number
31681>>>>>>>    Set Code_Field          to 1
31682>>>>>>>    Set Description_Field   to 1
31683>>>>>>>    Set Ordering            to 1
31684>>>>>>>End_Object //oDESCRICOES_TARIFARIO_FVT
31685>>>>>>>
31685>>>>>>>Object oHCGS3003_STATUS_VT is a DescriptionValidationTable
31687>>>>>>>    Procedure Fill_List
31690>>>>>>>        Forward Send Fill_List
31692>>>>>>>        Send Add_Table_Value "A" "Ativo"
31693>>>>>>>        Send Add_Table_Value "I" "Inativo"
31694>>>>>>>    End_Procedure
31695>>>>>>>End_Object //oHCGS3003_STATUS_VT
31696>>>>>>>
31696>>>>>>>Object oCSAG325_FVT is a FileValidationTable
31698>>>>>>>    Set Validate_State      to False
31699>>>>>>>    Set Main_File           to CSAG325.File_Number
31700>>>>>>>    Set Code_Field          to 1
31701>>>>>>>    Set Description_Field   to 2
31702>>>>>>>    Set Ordering            to 2
31703>>>>>>>End_Object //oCSAG325_FVT
31704>>>>>>>
31704>>>>>>>Object oIMO_PKG_FVT is a FileValidationTable
31706>>>>>>>    Set Main_File           to CCGS247.File_Number
31707>>>>>>>    Set Code_Field          to 1
31708>>>>>>>    Set Description_Field   to 2
31709>>>>>>>    Set Ordering            to 1
31710>>>>>>>End_Object //oIMO_PKG_FVT
31711>>>>>>>
31711>>>>>>>Object oDensidadeUnit_VT is a DescriptionValidationTable
31713>>>>>>>    Set Allow_Blank_State to True
31714>>>>>>>    Procedure Fill_List
31717>>>>>>>        Forward Send Fill_List
31719>>>>>>>        Send Add_Table_Value "cbmkg" "CBM/KG"
31720>>>>>>>        Send Add_Table_Value "cbmlb" "CBM/LB"
31721>>>>>>>        Send Add_Table_Value "cftkg" "CFT/KG"
31722>>>>>>>        Send Add_Table_Value "cftlb" "CFT/LB"
31723>>>>>>>    End_Procedure
31724>>>>>>>End_Object
31725>>>>>>>
31725>>>>>>>Object oIMO_PackingGroup_VT is a DescriptionValidationTable
31727>>>>>>>    Set Allow_Blank_State to True
31728>>>>>>>    Procedure Fill_List
31731>>>>>>>        Forward Send Fill_List
31733>>>>>>>        Send Add_Table_Value "1" "Packing Group I"
31734>>>>>>>        Send Add_Table_Value "2" "Packing Group II"
31735>>>>>>>        Send Add_Table_Value "3" "Packing Group III"
31736>>>>>>>    End_Procedure
31737>>>>>>>End_Object
31738>>>>>>>
31738>>>>>>>Object oVolumeUnit_VT is a DescriptionValidationTable
31740>>>>>>>    Set Allow_Blank_State to True
31741>>>>>>>    Procedure Fill_List
31744>>>>>>>        Forward Send Fill_List
31746>>>>>>>        Send Add_Table_Value "CBM" "CBM"
31747>>>>>>>        Send Add_Table_Value "CFT" "CFT"
31748>>>>>>>    End_Procedure
31749>>>>>>>End_Object
31750>>>>>>>
31750>>>>>>>Object oGrossUnit_VT is a DescriptionValidationTable
31752>>>>>>>    Set Allow_Blank_State to True
31753>>>>>>>    Procedure Fill_List
31756>>>>>>>        Forward Send Fill_List
31758>>>>>>>        Send Add_Table_Value "KG" "KG"
31759>>>>>>>        Send Add_Table_Value "LB" "LB"
31760>>>>>>>    End_Procedure
31761>>>>>>>End_Object
31762>>>>>>>
31762>>>>>>>Object oUOMUnit_VT is a DescriptionValidationTable
31764>>>>>>>    Set Allow_Blank_State to True
31765>>>>>>>    Procedure Fill_List
31768>>>>>>>        Forward Send Fill_List
31770>>>>>>>        Send Add_Table_Value "CM" "CM"
31771>>>>>>>        Send Add_Table_Value "Inches" "Inches"
31772>>>>>>>    End_Procedure
31773>>>>>>>End_Object
31774>>>>>>>
31774>>>>>>>Object oEmbalagemColetaRefrigerada_VT is a DescriptionValidationTable
31776>>>>>>>    Set Allow_Blank_State to True
31777>>>>>>>    Procedure Fill_List
31780>>>>>>>        Forward Send Fill_List
31782>>>>>>>        Send Add_Table_Value "GELPACK" "GELPACK"
31783>>>>>>>        Send Add_Table_Value "FRY" "FRY ICE"
31784>>>>>>>        Send Add_Table_Value "MANTA" "MANTA TERMICA"
31785>>>>>>>    End_Procedure
31786>>>>>>>End_Object
31787>>>>>
31787>>>>>Register_Object Csag300_Usuarioclasse_VT
31787>>>>>Register_Object Csag300_Usuariostatus_VT
31787>>>>>Register_Object Csag300_Usuarioslogin_VT
31787>>>>>Register_Object Csag300_Remailconfirma_VT
31787>>>>>Register_Object Csag300_Usuariomodose_VT
31787>>>>>Register_Object Csag300_Usuariomenu_S_VT
31787>>>>>
31787>>>>>Object Csag300_Usuarioclasse_VT  is a DescriptionValidationTable
31789>>>>>    //trocado master para Aplicacao
31789>>>>>    Procedure Fill_List 
31792>>>>>        Forward Send Fill_List
31794>>>>>        Send Add_Table_Value "1" "ADMINISTRADOR"
31795>>>>>        Send Add_Table_Value "2" "SUPERVISOR"
31796>>>>>        Send Add_Table_Value "3" "APLICACAO SEM SESSAO"
31797>>>>>        Send Add_Table_Value "4" "DIRETOR"
31798>>>>>        Send Add_Table_Value "5" "GERENTE"
31799>>>>>        Send Add_Table_Value "6" "OPERADOR COMUM"
31800>>>>>        Send Add_Table_Value "7" "GUEST"
31801>>>>>        Send Add_Table_Value "8" "SEM CLASSIFICACAO"
31802>>>>>        Send Add_Table_Value "9" "GUEST2"
31803>>>>>        Send Add_Table_Value "10" "APLICACAO COM SESSAO"
31804>>>>>    End_Procedure    // Fill_List
31805>>>>>End_Object   // Csag300_Usuarioclasse_VT
31806>>>>>
31806>>>>>Object Csag300_Usuariostatus_VT  is a DescriptionValidationTable
31808>>>>>    Procedure Fill_List
31811>>>>>        Forward Send Fill_List
31813>>>>>        Send Add_Table_Value  "1"  "LIBERADO"
31814>>>>>        Send Add_Table_Value  "2"  "BLOQUEADO"
31815>>>>>//        Send Add_Table_Value  "3"  "INATIVO"
31815>>>>>//        Send Add_Table_Value  "4"  "EXCLUIDO"
31815>>>>>    End_Procedure    // Fill_List
31816>>>>>End_Object   // Csag300_Usuariostatus_VT
31817>>>>>
31817>>>>>Object Csag300_Usuarioslogin_VT  is a DescriptionValidationTable
31819>>>>>    Procedure Fill_List
31822>>>>>        Forward Send Fill_List
31824>>>>>        Send Add_Table_Value  "1"  "On-Line"
31825>>>>>        Send Add_Table_Value  "2"  "Ocupado"
31826>>>>>        Send Add_Table_Value  "3"  "Off-Line"
31827>>>>>        Send Add_Table_Value  "4"  "Volto Logo"
31828>>>>>        Send Add_Table_Value  "5"  "Ausente"
31829>>>>>        Send Add_Table_Value  "6"  "Ao Telefone"
31830>>>>>        Send Add_Table_Value  "7"  "Almocando"
31831>>>>>        Send Add_Table_Value  "8"  "Em Reuniao"
31832>>>>>    End_Procedure    // Fill_List
31833>>>>>End_Object   // Csag300_Usuarioslogin_VT
31834>>>>>
31834>>>>>Object Csag300_Remailconfirma_VT  is a DescriptionValidationTable
31836>>>>>
31836>>>>>    Procedure Fill_List
31839>>>>>        Forward Send Fill_List
31841>>>>>        Send Add_Table_Value  "1"  "Sim"
31842>>>>>        Send Add_Table_Value  "2"  "Nao"
31843>>>>>    End_Procedure    // Fill_List
31844>>>>>End_Object   // Csag300_Remailconfirma_VT
31845>>>>>
31845>>>>>Object Csag300_Usuariomodose_VT  is a DescriptionValidationTable
31847>>>>>
31847>>>>>    Procedure Fill_List
31850>>>>>        Forward Send Fill_List
31852>>>>>        Send Add_Table_Value  "1"  "Nao"
31853>>>>>        Send Add_Table_Value  "2"  "Sim"
31854>>>>>    End_Procedure    // Fill_List
31855>>>>>End_Object   // Csag300_Usuariomodose_VT
31856>>>>>
31856>>>>>Object Csag300_Usuariomenu_S_VT  is a DescriptionValidationTable
31858>>>>>
31858>>>>>    Procedure Fill_List
31861>>>>>        Forward Send Fill_List
31863>>>>>        Send Add_Table_Value  "S"  "Sim"
31864>>>>>        Send Add_Table_Value  "N"  "Nao"
31865>>>>>    End_Procedure    // Fill_List
31866>>>>>    
31866>>>>>End_Object   // Csag300_Usuariomenu_S_VT
31867>>>>>
31867>>>>>Object Csag300_UsuarioSexo_VT is a DescriptionValidationTable
31869>>>>>    Procedure Fill_List
31872>>>>>        Forward Send Fill_List
31874>>>>>        Send Add_Table_Value "F" "FEMININO"
31875>>>>>        Send Add_Table_Value "M" "MASCULINO"
31876>>>>>        Send Add_Table_Value "J" "JURIDICA"
31877>>>>>        Send Add_Table_Value "I" "INDEFINIDO"
31878>>>>>    End_Procedure
31879>>>>>End_Object
31880>>>>>
31880>>>>>Object Csag300_Permiteachalo_VT is a DescriptionValidationTable
31882>>>>>    Procedure Fill_List
31885>>>>>        Forward Send Fill_List
31887>>>>>        Send Add_Table_Value "S" "Sim"
31888>>>>>        Send Add_Table_Value "N" "Nao"
31889>>>>>    End_Procedure
31890>>>>>End_Object
31891>>>>>
31891>>>>>//Object Csag300_Usuariopais_VT is a DescriptionValidationTable
31891>>>>>//    Procedure Fill_List
31891>>>>>//        Forward Send Fill_List
31891>>>>>//        Send Add_Table_Value "BRA" "BRASIL"
31891>>>>>//        Send Add_Table_Value "URY" "URUGUAY"
31891>>>>>//        Send Add_Table_Value "CHL" "CHILE"
31891>>>>>//        Send Add_Table_Value "ARG" "ARGENTINA"
31891>>>>>//        Send Add_Table_Value "COL" "COLOMBIA"
31891>>>>>//        Send Add_Table_Value "PRY" "PARAGUAY"
31891>>>>>//        Send Add_Table_Value "PER" "PERU"
31891>>>>>//    End_Procedure
31891>>>>>//End_Object
31891>>>>>
31891>>>>>Object Csag300_Usuariopais_VT is a FileValidationTable
31893>>>>>    Set Validate_State      to False
31894>>>>>    Set Main_File           to CSAG329.File_Number
31895>>>>>    Set Code_Field          to 1
31896>>>>>    Set Description_Field   to 2
31897>>>>>    Set Ordering            to 2
31898>>>>>End_Object //Csag300_Usuariopais_VT
31899>>>>>
31899>>>>>Class Csag300_DataDictionary is a c_DataDictionary
31900>>>>>
31900>>>>>    // Define_Fields:
31900>>>>>    // This procedure is used to set up all data-dictionary rules.
31900>>>>>
31900>>>>>    Procedure Construct_Object
31902>>>>>        Forward Send Construct_Object
31904>>>>>
31904>>>>>
31904>>>>>        Set Main_File To Csag300.File_Number
31905>>>>>
31905>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
31906>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
31907>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
31908>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
31909>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
31910>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
31911>>>>>
31911>>>>>        // External (System) file structure.............
31911>>>>>        Set Add_System_File to TSMG801.File_Number DD_LOCK_ON_ALL
31912>>>>>        Set Add_System_File to TSMG802.File_Number DD_LOCK_ON_ALL
31913>>>>>        Set Add_System_File to CSAG315.File_Number DD_LOCK_ON_ALL
31914>>>>>        Set Add_System_File to CSAG326.File_Number DD_LOCK_ON_ALL
31915>>>>>        Set Add_System_File to CSAG361.File_Number DD_LOCK_ON_ALL
31916>>>>>        Set Add_System_File to CSAG398.File_Number DD_LOCK_ON_ALL
31917>>>>>        
31917>>>>>
31917>>>>>        Set Field_Auto_Increment Field Csag300.Usuarionumero to File_Field TSMG801.USUARIOS
31918>>>>>
31918>>>>>        // Field-based properties.......................
31918>>>>>
31918>>>>>        Set Field_Label_Long Field Csag300.Usuarioecodigo to "Select Company"
31919>>>>>//        Set Field_Option Field Csag300.Usuarioecodigo DD_RETAINALL to True
31919>>>>>
31919>>>>>        Set Field_Label_Long Field Csag300.Usuarioempresa To "Razao Social"
31920>>>>>//        Set Field_Option Field Csag300.Usuarioempresa DD_RETAINALL to True
31920>>>>>        Set Field_Option Field Csag300.Usuarioempresa DD_CAPSLOCK to True
31921>>>>>
31921>>>>>
31921>>>>>        Set Field_Label_Long Field Csag300.Usuarionumero to "Id"
31922>>>>>//        Set Field_Option Field Csag300.Usuarionumero DD_RETAINALL to True
31922>>>>>
31922>>>>>        Set Field_Label_Long Field Csag300.Usuarioemail to "e-Mail"
31923>>>>>
31923>>>>>        Set Field_Label_Long Field Csag300.Usuariosenha to "Password"
31924>>>>>
31924>>>>>        Set Field_Label_Long Field Csag300.Usuariosenhain to "Password"
31925>>>>>//        Set Field_Option Field Csag300.Usuariosenhain DD_RETAINALL to True
31925>>>>>
31925>>>>>        Set Field_Label_Long Field Csag300.Usuarionome to "Full Name"
31926>>>>>        Set Field_Option Field Csag300.Usuarionome DD_CAPSLOCK to True
31927>>>>>
31927>>>>>        Set Field_Label_Long Field Csag300.Usuarioclasse To "Classe "
31928>>>>>        Set Field_Value_Table Field Csag300.Usuarioclasse to Csag300_Usuarioclasse_VT
31929>>>>>
31929>>>>>        Set Field_Label_Long Field Csag300.Usuariostatus To "Status"
31930>>>>>        Set Field_Value_Table Field Csag300.Usuariostatus to Csag300_Usuariostatus_VT
31931>>>>>
31931>>>>>        Set Field_Label_Long Field Csag300.Usuarioslogin to "Informe o Estado de Conexao -Usuario-"
31932>>>>>        Set Field_Value_Table Field Csag300.Usuarioslogin to Csag300_Usuarioslogin_VT
31933>>>>>
31933>>>>>        Set Field_Label_Long Field Csag300.Usuariochave to "Security Key"
31934>>>>>        Set Field_Option Field Csag300.Usuariochave DD_CAPSLOCK to True
31935>>>>>
31935>>>>>        Set Field_Label_Long Field Csag300.Usuariopnome To "Primeiro Nome"
31936>>>>>        Set Field_Option Field Csag300.Usuariopnome DD_CAPSLOCK to True
31937>>>>>
31937>>>>>        Set Field_Label_Long Field Csag300.Usuarioidioma to "Select Language"
31938>>>>>
31938>>>>>        Set Field_Label_Long Field Csag300.Usuarioidiomanm To "Idioma"
31939>>>>>        Set Field_Option Field Csag300.Usuarioidiomanm DD_CAPSLOCK to True
31940>>>>>
31940>>>>>        Set Field_Label_Long Field Csag300.Usuariocpf to "Social Security Number, RUC, CPF ..."
31941>>>>>        Set Status_Help Field CSAG300.USUARIOCPF to "(Enter your CPF, RUC, Social Security Number...)"
31942>>>>>
31942>>>>>        Set Field_Label_Long Field CSAG300.USUARIODTNASFUN to "Birthday (DD/MM/YYYY)"
31943>>>>>
31943>>>>>        Set Field_Label_Long Field Csag300.Usuariovs To "Vencimento Senha"
31944>>>>>
31944>>>>>        Set Field_Label_Long Field Csag300.Usuariota to "Tempo em Segundos da Ultima Conexao "
31945>>>>>
31945>>>>>        Set Field_Label_Long Field CSAG300.USUARIOCELNR to "Cel. number"
31946>>>>>
31946>>>>>        Set Field_Label_Long Field CSAG300.USUARIOCELID to "Telefone id"
31947>>>>>
31947>>>>>        Set Field_Label_Long Field CSAG300.USUARIOCELTP to "Cel Plataforma (iOS,Android)"
31948>>>>>
31948>>>>>        Set Field_Label_Long Field Csag300.Dtaultlogin to "Dt. Ult. Login"
31949>>>>>
31949>>>>>        Set Field_Label_Long Field Csag300.Horultlogin to "Hr. Ult. Login"
31950>>>>>
31950>>>>>        Set Field_Label_Long Field Csag300.Dtloginanterior to "Dt. Login Anterior"
31951>>>>>
31951>>>>>        Set Field_Label_Long Field Csag300.Hrloginanterior to "Hr. Login Ant."
31952>>>>>
31952>>>>>        Set Field_Label_Long Field Csag300.Dtaultlogout to "Dt. Ult. LOGOUT"
31953>>>>>
31953>>>>>        Set Field_Label_Long Field Csag300.Horultlogout to "HR. Ult. LOGOUT"
31954>>>>>
31954>>>>>        Set Field_Label_Long Field Csag300.Asc_Principal to "Acesso ao Cross"
31955>>>>>
31955>>>>>        Set Field_Label_Long Field Csag300.Ads_Desktopsis to "Acesso ao Dashboard"
31956>>>>>
31956>>>>>        Set Field_Label_Long Field CSAG300.ABA_01 to "01-Acesso"
31957>>>>>        Set Field_Label_Long Field CSAG300.ABA_02 to "02-Acesso"
31958>>>>>        Set Field_Label_Long Field CSAG300.ABA_03 to "03-Acesso"
31959>>>>>        Set Field_Label_Long Field CSAG300.ABA_04 to "04-Acesso"
31960>>>>>        Set Field_Label_Long Field CSAG300.ABA_05 to "05-Acesso"
31961>>>>>        Set Field_Label_Long Field CSAG300.ABA_06 to "06-Acesso"
31962>>>>>        Set Field_Label_Long Field CSAG300.ABA_07 to "07-Acesso"
31963>>>>>        Set Field_Label_Long Field CSAG300.ABA_08 to "08-Acesso"
31964>>>>>        Set Field_Label_Long Field CSAG300.ABA_09 to "09-Acesso"
31965>>>>>        Set Field_Label_Long Field CSAG300.ABA_10 to "10-Acesso"
31966>>>>>
31966>>>>>        Set Field_Label_Long Field Csag300.Recebeemail to "Recebe Email de Confirmacao"
31967>>>>>        Set Field_Value_Table Field Csag300.Recebeemail to Csag300_Remailconfirma_VT
31968>>>>>
31968>>>>>        Set Field_Label_Long Field Csag300.Usuariomodose to "Usuario em Modo de Seguranca"
31969>>>>>        Set Field_Value_Table Field Csag300.Usuariomodose to Csag300_Usuariomodose_VT
31970>>>>>
31970>>>>>        Set Field_Label_Long Field Csag300.Usuariomenu_S To "Ativar Menu Sistema"
31971>>>>>        Set Field_Value_Table Field Csag300.Usuariomenu_S to Csag300_Usuariomenu_S_VT
31972>>>>>
31972>>>>>        Set Field_Value_Table Field CSAG300.USUARIOSEXO to Csag300_UsuarioSexo_VT
31973>>>>>        Set Field_Label_Long Field CSAG300.USUARIOSEXO to "Sexo"
31974>>>>>        Set Field_Option Field CSAG300.USUARIOSEXO DD_CAPSLOCK to True
31975>>>>>
31975>>>>>        Set Field_Value_Table Field CSAG300.PERMITEACHALO to Csag300_Permiteachalo_VT
31976>>>>>        Set Field_Label_Long Field CSAG300.PERMITEACHALO to "Permissao para Visualizar Minha Conta"
31977>>>>>
31977>>>>>        Set Field_Label_Long Field CSAG300.CF_USUARIOFOTO to "Usuario Foto (Caminho Fisico)"
31978>>>>>
31978>>>>>        Set Field_Label_Long Field CSAG300.CL_USUARIOFOTO to "Usuario Foto (Caminho Logico)"
31979>>>>>
31979>>>>>        Set Field_Label_Long Field CSAG300.USUARIOPAIS to "Select Country"
31980>>>>>        Set Field_Value_Table Field CSAG300.USUARIOPAIS to Csag300_Usuariopais_VT
31981>>>>>        Set Field_Option Field CSAG300.USUARIOPAIS DD_CAPSLOCK to True
31982>>>>>
31982>>>>>        Set Field_Label_Long Field CSAG300.USUARIOAPELIDO to "Nick Name"
31983>>>>>
31983>>>>>    End_Procedure    // Construct_Object
31984>>>>>
31984>>>>>    // Field_Defaults:
31984>>>>>    // This procedure is used to establish default field values.
31984>>>>>
31984>>>>>    Procedure Field_Defaults
31986>>>>>        Forward Send Field_Defaults
31988>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOECODIGO to 1
31989>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOCLASSE to 8
31990>>>>>        Set Field_Changed_Value Field CSAG300.RECEBEEMAIL to "2"
31991>>>>>        Set Field_Changed_Value   Field Csag300.Usuariomodose To "1"
31992>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOMENU_S to "N"
31993>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOSEXO to "I"
31994>>>>>        Set Field_Changed_Value Field CSAG300.PERMITEACHALO to "N"
31995>>>>>        Set Field_Changed_Value Field CSAG300.USUARIOPAIS to "BRA"
31996>>>>>    End_Procedure    // Field_Defaults
31997>>>>>
31997>>>>>    Procedure Save_Main_File_Pag300_01
31999>>>>>        Integer iPos
31999>>>>>        String sName sApelido_Name
31999>>>>>        
31999>>>>>        Forward Send Save_Main_File
32001>>>>>        
32001>>>>>        //--Verifica se o Primeiro nome e se o Nick Name est em branco, 
32001>>>>>        //  identifica o primeiro nome e separa
32001>>>>>        //  cria automaticamente um nick, sendo (Primeiro Nome+Codigo)
32001>>>>>        If (CSAG300.USUARIOPNOME = "") Begin
32003>>>>>            Move CSAG300.USUARIONOME to sName
32004>>>>>            Move (Pos (" ", sName)) to iPos
32005>>>>>            If (iPos > 0) Begin
32007>>>>>              Move (Left (sName, iPos - 1)) to CSAG300.USUARIOPNOME
32008>>>>>              SaveRecord CSAG300
32009>>>>>            End
32009>>>>>>
32009>>>>>        End
32009>>>>>>
32009>>>>>        If (CSAG300.USUARIOAPELIDO = "") Begin
32011>>>>>            Move CSAG300.USUARIONOME to sName
32012>>>>>            Move (Pos (" ", sName)) to iPos
32013>>>>>            If (iPos > 0) Begin
32015>>>>>              Move (Left (sName, iPos - 1)) to sApelido_Name
32016>>>>>              Move (sApelido_Name+String(CSAG300.USUARIOECODIGO))to sApelido_Name
32017>>>>>              Move sApelido_Name to CSAG300.USUARIOAPELIDO
32018>>>>>              SaveRecord CSAG300
32019>>>>>            End
32019>>>>>>
32019>>>>>        End
32019>>>>>>
32019>>>>>        
32019>>>>>        //Fim da Verificaao
32019>>>>>        
32019>>>>>    End_Procedure //Save_Main_File_Pag300_01
32020>>>>>
Including file: p_FFOperation.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\p_FFOperation.inc)
32020>>>>>>//ANDERSON RODRIGUES - 02.02.2014 - 13:40
32020>>>>>>//-2WA    
32020>>>>>>    //PROCEDURE USADA PELA TABELA PRINCIPAL DO DICIONARIO DE DADOS
32020>>>>>>    Procedure p_FFOperation Integer iOper
32022>>>>>>
32022>>>>>>        //------------------------------------------------------------
32022>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
32022>>>>>>
32022>>>>>>        Clear   CSAG311
32023>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
32024>>>>>>        Find Eq CSAG311                      by 1
32025>>>>>>>
32025>>>>>>        If (Found) Begin
32027>>>>>>            Send p_FileFieldOperation ;                 iOper ;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
32028>>>>>>        End
32028>>>>>>>
32028>>>>>>    End_Procedure // p_FFOperation
32029>>>>>>
32029>>>>>>    
32029>>>>>>    //PROCEDURE USADA PELA(S) TABELA(S) SECUNDARIA(S) DO DICIONARIO DE DADOS
32029>>>>>>    //UTILIZE ESTA PROCEDURE PARA ARMAZENAR LOG(S) DA(S) TABELA(S) SECUNDARIA(S)
32029>>>>>>    //VIDE EXEMPLO cCSAG371DataDictionary.dd
32029>>>>>>    Procedure p_FFOperationTable Integer iOper Integer iTable
32031>>>>>>
32031>>>>>>        //------------------------------------------------------------
32031>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
32031>>>>>>
32031>>>>>>        Clear   CSAG311
32032>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
32033>>>>>>        Find Eq CSAG311                      by 1
32034>>>>>>>
32034>>>>>>        If (Found) Begin
32036>>>>>>            Send p_FileFieldOperationTable;                 iTable;                 iOper;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
32037>>>>>>        End
32037>>>>>>>
32037>>>>>>    End_Procedure // p_FFOperationTable
32038>>>>>>    
32038>>>>>>
32038>>>>>    
32038>>>>>End_Class
32039>>>>>
32039>>>USE      CSAG304.DD
Including file: CSAG304.DD    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG304.DD)
32039>>>>>// Class Name: Csag304_DataDictionary
32039>>>>>// Revision  : 28
32039>>>>>// Version   : 2
32039>>>>>//-2WA
32039>>>>>Use  Windows           // Basic Definitions
32039>>>>>Use  DataDict.pkg          // DataDictionary Class Definition
32039>>>>>Use  DDvalTbl          // Validation Table Class Definitions
32039>>>>>
32039>>>>>Open Csag304
Including file: CSAG304.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG304.fd)
32041>>>>>
32041>>>>>
32041>>>>>Register_Object Csag304_Tipo_VT
32041>>>>>Register_Object Csag304_Localizacao_VT
32041>>>>>Register_Object Csag304_Status_VT
32041>>>>>Register_Object Csag304_Classe_VT
32041>>>>>
32041>>>>>Object Csag304_Tipo_VT  is a DescriptionValidationTable
32043>>>>>
32043>>>>>    Procedure Fill_List
32046>>>>>        Forward Send Fill_List
32048>>>>>        Send Add_Table_Value  "1"  "PROGRAMA"
32049>>>>>        Send Add_Table_Value  "2"  "MENU"
32050>>>>>        Send Add_Table_Value  "3"  "TITULO"
32051>>>>>        Send Add_Table_Value  "4"  "SUBTITULO"
32052>>>>>    End_Procedure    // Fill_List
32053>>>>>End_Object   // Csag304_Tipo_VT
32054>>>>>
32054>>>>>Object Csag304_Localizacao_VT  is a DescriptionValidationTable
32056>>>>>
32056>>>>>    Procedure Fill_List
32059>>>>>        Forward Send Fill_List
32061>>>>>        Send Add_Table_Value "F" "ABAS"
32062>>>>>        Send Add_Table_Value "W" "WINDOW"
32063>>>>>        Send Add_Table_Value "S" "SITE"
32064>>>>>    End_Procedure    // Fill_List
32065>>>>>End_Object   // Csag304_Localizacao_VT
32066>>>>>
32066>>>>>Object Csag304_Status_VT  is a DescriptionValidationTable
32068>>>>>
32068>>>>>    Procedure Fill_List
32071>>>>>        Forward Send Fill_List
32073>>>>>        Send Add_Table_Value  "1"  "Ativo"
32074>>>>>        Send Add_Table_Value  "2"  "Inativo"
32075>>>>>    End_Procedure    // Fill_List
32076>>>>>End_Object   // Csag304_Status_VT
32077>>>>>
32077>>>>>Object Csag304_Classe_VT  is a DescriptionValidationTable
32079>>>>>
32079>>>>>    Procedure Fill_List
32082>>>>>        Forward Send Fill_List
32084>>>>>        Send Add_Table_Value  "1"  "ADMINISTRADOR"
32085>>>>>        Send Add_Table_Value  "2"  "SUPERVISOR"
32086>>>>>        Send Add_Table_Value  "3"  "MASTER"
32087>>>>>        Send Add_Table_Value  "4"  "DIRETOR"
32088>>>>>        Send Add_Table_Value  "5"  "GERENTE"
32089>>>>>        Send Add_Table_Value  "6"  "OPERADOR COMUM"
32090>>>>>        Send Add_Table_Value  "7"  "CLIENTE"
32091>>>>>        Send Add_Table_Value  "8"  "SEM CLASSIFICACAO"
32092>>>>>    End_Procedure    // Fill_List
32093>>>>>End_Object   // Csag304_Classe_VT
32094>>>>>
32094>>>>>Class Csag304_DataDictionary  is a DataDictionary
32095>>>>>
32095>>>>>    // Define_Fields:
32095>>>>>    // This procedure is used to set up all data-dictionary rules.
32095>>>>>
32095>>>>>    Procedure Construct_Object
32097>>>>>        Forward Send Construct_Object
32099>>>>>
32099>>>>>
32099>>>>>        Set Main_File To Csag304.File_Number
32100>>>>>
32100>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
32101>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
32102>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
32103>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
32104>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
32105>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
32106>>>>>
32106>>>>>        // Field-based properties.......................
32106>>>>>
32106>>>>>        Set Field_Label_Long Field Csag304.Idioma To "Codigo"
32107>>>>>
32107>>>>>        Set Field_Label_Long Field Csag304.Idiomanm To "Idioma"
32108>>>>>        Set Field_Option Field Csag304.Idiomanm DD_CAPSLOCK to True
32109>>>>>
32109>>>>>        Set Field_Label_Long Field Csag304.Menuclasse To "Classe do Menu"
32110>>>>>
32110>>>>>        Set Field_Label_Long Field Csag304.Menunumero To "Numero do Menu"
32111>>>>>
32111>>>>>        Set Field_Label_Long Field Csag304.Titulo To "Titulo"
32112>>>>>
32112>>>>>        Set Field_Label_Long Field Csag304.Tituloidioma To "Titulo Idioma"
32113>>>>>
32113>>>>>        Set Field_Label_Long Field Csag304.Tipo To "Tipo"
32114>>>>>        Set Field_Value_Table Field Csag304.Tipo to Csag304_Tipo_VT
32115>>>>>
32115>>>>>        Set Field_Label_Long Field Csag304.Programa To "Programa"
32116>>>>>
32116>>>>>        Set Field_Label_Long Field Csag304.Localizacao To "Localizacao"
32117>>>>>        Set Field_Value_Table Field Csag304.Localizacao to Csag304_Localizacao_VT
32118>>>>>
32118>>>>>        Set Field_Label_Long Field Csag304.Mcchamada To "Menu de Chamada"
32119>>>>>
32119>>>>>        Set Field_Label_Long Field Csag304.Programacodigo To "Codigo do Programa"
32120>>>>>
32120>>>>>        Set Field_Label_Long Field Csag304.Status To "Status"
32121>>>>>        Set Field_Value_Table Field Csag304.Status to Csag304_Status_VT
32122>>>>>
32122>>>>>        Set Field_Label_Long Field Csag304.Classe To "Classe"
32123>>>>>        Set Field_Value_Table Field Csag304.Classe to Csag304_Classe_VT
32124>>>>>
32124>>>>>        Set Field_Label_Long Field Csag304.Imagem_Fisico To "Imagem Caminho Fisico"
32125>>>>>
32125>>>>>        Set Field_Label_Long Field Csag304.Imagem_Logico To "Imagem Caminho Logico"
32126>>>>>
32126>>>>>        Set Field_Label_Long Field Csag304.Tipomenu To "Tipo de Menu"
32127>>>>>
32127>>>>>        Set Field_Label_Long Field CSAG304.ICONEB00TSP to "Icone Bootstrap"
32128>>>>>
32128>>>>>    End_Procedure    // Construct_Object
32129>>>>>
32129>>>>>    // Field_Defaults:
32129>>>>>    // This procedure is used to establish default field values.
32129>>>>>
32129>>>>>    Procedure Field_Defaults
32131>>>>>        Forward Send Field_Defaults
32133>>>>>    End_Procedure    // Field_Defaults
32134>>>>>
32134>>>>>End_Class    // Csag304_DataDictionary
32135>>>>>
32135>>>USE      CSAG310.DD
Including file: CSAG310.DD    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG310.DD)
32135>>>>>// Class Name: Csag310_DataDictionary
32135>>>>>// Revision  : 15
32135>>>>>// Version   : 2
32135>>>>>//-2WA
32135>>>>>Use  Windows           // Basic Definitions
32135>>>>>Use  DataDict.pkg          // DataDictionary Class Definition
32135>>>>>Use  DDvalTbl          // Validation Table Class Definitions
32135>>>>>
32135>>>>>Open Csag310
Including file: CSAG310.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG310.fd)
32137>>>>>
32137>>>>>
32137>>>>>Class Csag310_DataDictionary  is a DataDictionary
32138>>>>>
32138>>>>>    // Define_Fields:
32138>>>>>    // This procedure is used to set up all data-dictionary rules.
32138>>>>>
32138>>>>>    Procedure Construct_Object
32140>>>>>        Forward Send Construct_Object
32142>>>>>
32142>>>>>
32142>>>>>        Set Main_File To Csag310.File_Number
32143>>>>>
32143>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
32144>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
32145>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
32146>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
32147>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
32148>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
32149>>>>>
32149>>>>>        // Field-based properties.......................
32149>>>>>
32149>>>>>        Set Field_Label_Long Field Csag310.Tabela To "Tabela"
32150>>>>>        Set Field_Option Field Csag310.Tabela DD_CAPSLOCK to True
32151>>>>>
32151>>>>>        Set Field_Label_Long Field Csag310.Campo To "Campo"
32152>>>>>
32152>>>>>        Set Field_Label_Long Field Csag310.Idioma To "Idioma"
32153>>>>>        Set Field_Option Field Csag310.Idioma DD_RETAINALL to True
32154>>>>>
32154>>>>>        Set Field_Label_Long Field Csag310.Idiomanm To "Idioma"
32155>>>>>        Set Field_Option Field Csag310.Idiomanm DD_RETAINALL to True
32156>>>>>        Set Field_Option Field Csag310.Idiomanm DD_CAPSLOCK to True
32157>>>>>
32157>>>>>        Set Field_Label_Long Field Csag310.Appearance To "Descricao"
32158>>>>>        Set Field_Option Field Csag310.Appearance DD_RETAINALL to True
32159>>>>>
32159>>>>>    End_Procedure    // Construct_Object
32160>>>>>
32160>>>>>    // Field_Defaults:
32160>>>>>    // This procedure is used to establish default field values.
32160>>>>>
32160>>>>>    Procedure Field_Defaults
32162>>>>>        Forward Send Field_Defaults
32164>>>>>    End_Procedure    // Field_Defaults
32165>>>>>
32165>>>>>End_Class    // Csag310_DataDictionary
32166>>>>>
32166>>>
32166>>>
32166>    Use bfGlobal.inc
Including file: bfGlobal.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\bfGlobal.inc)
32166>>>//-2WA
32166>>>Use btGlobal.pkg
32166>>>Use EditaCpfCnpj.Pkg    
Including file: EditaCpfCnpj.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\EditaCpfCnpj.pkg)
32166>>>>>// EditaCpfCnpj.pkg
32166>>>>>//
32166>>>>>// Verso 1.0
32166>>>>>// ltima alterao: 15/06/2007
32166>>>>>// Autor: Ivan Kaupa (ivankaupa@gmail.com)
32166>>>>>// Function ColocaZerosEsquerda: Recebe uma string e um integer e acrescenta zeros  esqueda na String at que fique com o tamanho
32166>>>>>//                               especificado no integer.
32166>>>>>//
32166>>>>>// Instrues de uso:
32166>>>>>// *) Copie o pacote para o diretrio AppSrc da sua Workspace
32166>>>>>// *) Adicione o pacote em seu programa ou componente atravs do comando Use (Use ColocaZerosEsquerda.pkg).
32166>>>>>// *) Exemplo de chamada: Move (ColocaZerosEsquerda(Cliente.CNPJ,14)) to sResultado
32166>>>>>
32166>>>>>// Histrico de alteraes
32166>>>>>//
32166>>>>>// Verso #.# - Nenhuma alterao aps a criao
32166>>>>>//-2WA
32166>>>>>Function EditaCpfCnpj Global String sCPFCNPJ Integer iTamanho String sTipo Returns String
32168>>>>>    Boolean bOK
32168>>>>>    If (sTipo="J") Begin
32170>>>>>        Move (Length(sCPFCNPJ)=iTamanho) to bOK
32171>>>>>        If (not(bOK)) Begin
32173>>>>>            Move (Right(sCPFCNPJ, iTamanho)) to sCPFCNPJ
32174>>>>>            Move (Length(sCPFCNPJ)=iTamanho) to bOK
32175>>>>>        End
32175>>>>>>
32175>>>>>        If (bOK) Begin
32177>>>>>            Move (Insert(".", sCPFCNPJ, 3))    to sCPFCNPJ
32178>>>>>            Move (Insert(".", sCPFCNPJ, 7))    to sCPFCNPJ
32179>>>>>            Move (Insert("/", sCPFCNPJ, 11))   to sCPFCNPJ
32180>>>>>            Move (Insert("-", sCPFCNPJ, 16))   to sCPFCNPJ
32181>>>>>        End
32181>>>>>>
32181>>>>>    End
32181>>>>>>
32181>>>>>    
32181>>>>>    If (sTipo="F") Begin
32183>>>>>        Move (Length(sCPFCNPJ)=iTamanho) to bOK
32184>>>>>        If (not(bOK)) Begin
32186>>>>>            Move (Right(sCPFCNPJ, iTamanho)) to sCPFCNPJ
32187>>>>>            Move (Length(sCPFCNPJ)=iTamanho) to bOK
32188>>>>>        End
32188>>>>>>
32188>>>>>        If (bOK) Begin
32190>>>>>            Move (Insert(".", sCPFCNPJ, 4))    to sCPFCNPJ 
32191>>>>>            Move (Insert(".", sCPFCNPJ, 8))    to sCPFCNPJ
32192>>>>>            Move (Insert("-", sCPFCNPJ, 12))   to sCPFCNPJ
32193>>>>>        End
32193>>>>>>
32193>>>>>    End
32193>>>>>>
32193>>>>>    Function_Return sCPFCNPJ
32194>>>>>End_Function // EditaCpfCnpj
32195>>>>>//
32195>>>>>// Pacote de Comandos / Procedures / Funcoes Genericas
32195>>>>>//
32195>>>>>// Comando Mod
32195>>>>>//
32195>>>>>//
32195>>>>>// Comando Remove
32195>>>>>//
32195>>>>>//
32195>>>>>// Comando Remove_Char
32195>>>>>//
32195>>>>>//
32195>>>>>// Comando Check_Char
32195>>>>>//
32195>>>>>//
32195>>>>>// Comando Ncgc_Check
32195>>>>>//
32195>>>>>//
32195>>>>>// Comando Ncic_Check
32195>>>>>//
32195>>>>>
32195>>>>>//
32195>>>>>// Funcao Roundall
32195>>>>>//
32195>>>>>Function ROUNDALL Global Number LN_VALOR Integer LI_CASAS Returns Number
32197>>>>>
32197>>>>>         LOCAL Number TMP$AUX
32197>>>>>         LOCAL Number TMP$
32197>>>>>         LOCAL Number LN_RESULT
32197>>>>>         LOCAL Integer POS$PONTO
32197>>>>>         LOCAL Integer QTDDIG$
32197>>>>>
32197>>>>>         INDICATE LT$ as LI_CASAS LT 0
32198>>>>>         INDICATE GT$ as LI_CASAS GT 0
32199>>>>>         INDICATE EQ$ as LI_CASAS EQ 0
32200>>>>>
32200>>>>>         Move (5 / (10. ^ (LI_CASAS + 1))) to TMP$
32201>>>>>         [not EQ$] Move (LN_VALOR + TMP$)  to TMP$
32202>>>>>                     POS "." IN TMP$
32203>>>>>>
32203>>>>>         [not Found] POS "," IN TMP$
32204>>>>>>
32204>>>>>         [not Found] Move (LENGTH (TMP$) ) to STRMARK
32205>>>>>         [LT$] [    Found] LEFT TMP$ to QTDDIG$  ((STRMARK - 1) + LI_CASAS)
32207>>>>>>
32207>>>>>         [LT$] [not Found] LEFT TMP$ to QTDDIG$  ((STRMARK    ) + LI_CASAS)
32209>>>>>>
32209>>>>>         [LT$] Move (QTDDIG$ * (10. ^ (ABS(LI_CASAS)))) to LN_RESULT
32210>>>>>         [GT$] Move (STRMARK + (ABS(LI_CASAS))) to STRMARK
32211>>>>>         [GT$] LEFT TMP$ to LN_RESULT
32212>>>>>>
32212>>>>>         [EQ$] [    Found] MOVEINT (LN_VALOR + TMP$) to LN_RESULT
32213>>>>>>
32213>>>>>         [EQ$] [not Found] Move     LN_VALOR         to LN_RESULT
32214>>>>>
32214>>>>>         Function_Return LN_RESULT
32215>>>>>
32215>>>>>End_Function // ROUNDALL
32216>>>>>
32216>>>>>//calcula arredondamento
32216>>>>>Use gFormatNumbers.pkg
32216>>>>>
32216>>>>>Function ROUNDVAL Global Number LN_VALOR Number LN_TAXA Returns Number
32218>>>>>     LOCAL Number LN_RESULT
32218>>>>>     LOCAL String SROUND SDIGITO
32218>>>>>
32218>>>>>     Move (LN_VALOR*LN_TAXA) to SROUND
32219>>>>>     
32219>>>>>     Move (Mid(sRound, 1, Pos(",",sRound)+3)) to sDigito
32220>>>>>     If (sDigito>4);        Move (sRound+0.01) to sRound
32223>>>>>
32223>>>>>     Move SROUND to LN_RESULT
32224>>>>>     
32224>>>>>     Function_Return LN_RESULT
32225>>>>>End_Function // ROUNDALL
32226>>>>>
32226>>>>>//calcula arredondamento
32226>>>>>Function ROUNDVAL2 Global Number LN_VALOR Number LN_TAXA Returns String
32228>>>>>     LOCAL String SROUND SDIGITO LN_RESULT
32228>>>>>
32228>>>>>     Move (LN_VALOR*LN_TAXA) to SROUND
32229>>>>>     
32229>>>>>     Move (Mid(sRound, 1, Pos(",",sRound)+3)) to sDigito
32230>>>>>     If (sDigito>4);        Move (sRound+0.01) to sRound
32233>>>>>
32233>>>>>     Move (formatNumber(SROUND,2)) to LN_RESULT
32234>>>>>     
32234>>>>>     Function_Return LN_RESULT
32235>>>>>End_Function // ROUNDALL
32236>>>>>
32236>>>>>//
32236>>>>>// Function Validate_CNPJ_CPF
32236>>>>>//
32236>>>>>Function Validate_CNPJ_CPF Global String sCNPJCPF Returns Integer
32238>>>>>    Boolean bLimpa
32238>>>>>    Boolean bIsCPF
32238>>>>>    Integer iReturnVal
32238>>>>>    Integer iError_Id
32238>>>>>    String  sError_Ds
32238>>>>>    String  sError_Tabela
32238>>>>>    
32238>>>>>    If (sCNPJCPF = "")  Function_Return iReturnVal
32241>>>>>    
32241>>>>>    Move (Length(sCNPJCPF)>14) to bLimpa
32242>>>>>    If (not(bLimpa)) Move (Length(sCNPJCPF)>11) to bLimpa
32245>>>>>    If (bLimpa) Begin
32247>>>>>        Move (Replaces("/",sCNPJCPF,"")) to sCNPJCPF
32248>>>>>        Move (Replaces("-",sCNPJCPF,"")) to sCNPJCPF
32249>>>>>        Move (Replaces(".",sCNPJCPF,"")) to sCNPJCPF
32250>>>>>    End
32250>>>>>>
32250>>>>>    
32250>>>>>    Check_Char sCNPJCPF
32260>>>>>>
32260>>>>>    If (not(Err)) Move (sCNPJCPF="") to Err
32263>>>>>    
32263>>>>>    Move (Length(sCNPJCPF)=11) to bIsCPF
32264>>>>>    If (bIsCPF)      Ncic_Check sCNPJCPF
32304>>>>>    If (not(bIsCPF)) Ncgc_Check sCNPJCPF
32352>>>>>    
32352>>>>>    If (not(Err)) Move (sCNPJCPF="00000000000000") to Err
32355>>>>>    If (not(Err)) Move (sCNPJCPF="") to Err
32358>>>>>    If (not(Err)) Move (sCNPJCPF="00000000000") to Err
32361>>>>>    
32361>>>>>    If (Err) Begin
32363>>>>>        Move 800099     to iError_Id
32364>>>>>        Move 'TSMG800'  to sError_Tabela
32365>>>>>        //CNPJ/CPF INVALIDO. PROCESSO CANCELADO.
32365>>>>>        Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
32366>>>>>        Error iError_Id sError_Ds
32367>>>>>>
32367>>>>>        Move 1 to iReturnVal 
32368>>>>>    End
32368>>>>>>
32368>>>>>    
32368>>>>>    Function_Return iReturnVal
32369>>>>>End_Function // Validate_CNPJ_CPF
32370>>>>>
32370>>>>>
32370>>>>>
32370>>>>>// O QUE FAZ: Converte HORAS em MINUTOS
32370>>>>>// EXEMPLO  : CONVHORAMINUTO HORAS TO MINUTOS
32370>>>>>//            HORA: 3:58 - MINUTOS apos a conversao: 238
32370>>>>>
32370>>>>>// O QUE FAZ: Converte MINUTOS em HORAS
32370>>>>>// EXEMPLO  : CONVMINUTOHORA MINUTOS TO HORAS 8 
32370>>>>>//            MINUTOS: 238 - HORAS apos a conversao: 00003:58
32370>>>>>// OBSERVAC.: CUIDADO !!! Nao use no ultimo argumento um numero MAIOR que o ta-
32370>>>>>//            manho declarado da STRING que recebera a hora convertida. Se isso
32370>>>>>//            ocorrer, o programa entrara num LOOP. Abaixo, vem um exemplo de
32370>>>>>//            como NAO SE DEVE FAZER: 
32370>>>>>//                                    STRING HORAS 8
32370>>>>>//                                    CONVMINUTOHORA MINUTOS TO HORAS 9
32370>>>>>
32370>>>>>
32370>>>>>
32370>>>>>// DIF_DATA DATA1 HORARIO1 DATA2 HORARIO2 RESULTADO
32370>>>>>//      !1 - data final ---> DATA1
32370>>>>>//      !2 - hora final ---> HORARIO1
32370>>>>>//      !3 - data inicial -> DATA2
32370>>>>>//      !4 - hora inicial -> HORARIO2
32370>>>>>//      !5 - RESULTADO
32370>>>>>//
32370>>>>>// EXEMPLO:
32370>>>>>// DIF_DATA 10/11/97 14:15 08/11/97 18:00 RESULT
32370>>>>>//
32370>>>>>// OBSERVACAO:
32370>>>>>// A VARIAVEL RESULT DEVE SER DO TIPO STRING
32370>>>>>// O RESULTADO SERA NO FORMATO HHHH:MM 
32370>>>>>
32370>>>>>
32370>>>>>// O QUE FAZ: COLOCA UM NUMERO NO FORMATO HORA (HH:MM).
32370>>>>>// EXEMPLO  : FORMAT_HOUR NUMERO
32370>>>>>// NUMERO   : 1 - 1.1 ONDE O VALOR 1 PASSA PARA 01:00 - VALOR 1.1 PASSA PARA 01:10
32370>>>>>
32370>>>>>// O QUE FAZ: Atraves de uma DATA/HORA inicial e DATA/HORA final, encontra-se a
32370>>>>>//            diferenca entre HORAS.
32370>>>>>// !1 - DATA INICIAL (DD/MM/AAAA)
32370>>>>>// !2 - HORA INICIAL (HH:MM)
32370>>>>>// !3 - DATA FINAL   (DD/MM/AAAA)
32370>>>>>// !4 - HORA FINAL   (HH:MM)
32370>>>>>// !5 - "TO"
32370>>>>>// !6 - DIFER.HORAS  (HHHHHHH:MM)
32370>>>>>// !7 - TAMANHO (LENGTH) DA VARIAVEL QUE RECEBERA A DIFERENCA DE HORAS
32370>>>>>//
32370>>>>>// EXEMPLO: /TELA
32370>>>>>//          DATA INICIAL     : __/__/____ _____
32370>>>>>//          DATA FINAL       : __/__/____ _____
32370>>>>>//          DIFERENCA (HORAS): __________
32370>>>>>//          /*
32370>>>>>//          CLEARSCREEN 
32370>>>>>//   REPEAT
32370>>>>>//              ACCEPT TELA.1
32370>>>>>//              ACCEPT TELA.2
32370>>>>>//              ACCEPT TELA.3
32370>>>>>//              ACCEPT TELA.4
32370>>>>>//              DIF_TIME TELA.1 TELA.2 TELA.3 TELA.4 TO TELA.5 10
32370>>>>>//          LOOP
32370>>>>>// RESULT.: DATA INICIAL     : 28/02/1994 23:58
32370>>>>>//          DATA FINAL       : 01/03/1994 16:45
32370>>>>>//          DIFERENCA (HORAS): 0000016:47
32370>>>>>//
32370>>>>>// OBSERV.: A DATA/HORA final pode ser menor que DATA/HORA inicial. Neste caso,
32370>>>>>//          o resultado sera negativo.
32370>>>>>//          Nas DATAS inicial e final, pode haver uma grande diferenca entre os
32370>>>>>//          anos. Exemplo: DATA INICIAL: 01/01/1980 - DATA FINAL: 31/12/1994
32370>>>>>//          O resultado deste commando , parecido com o resultado do comando
32370>>>>>//          DIF_HORA (Topclass 3). A diferenca , que o comando DIF_HORA  nao
32370>>>>>//          calcula a diferenca entre horas de datas diferentes.
32370>>>>>
32370>>>>>
32370>>>
32370>>>//------------------------------------------------------------------------
32370>>>// Biblioteca fgRetErroDescricao Global: Retorna Descricao Do Erro usado
32370>>>//                                       em dicionario de dados
32370>>>//------------------------------------------------------------------------
32370>>>     Function fgRetErroDescricao Global Number aNumeroErro String sTabela Returns String
32372>>>             Clear    CSAG317
Including file: CSAG317.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG317.fd)
32373>>>             Move sTabela                                to CSAG317.TABELA
32374>>>             Move aNumeroErro                            to CSAG317.CODIGO
32375>>>             Move (piUsuarioIdioma(oPAG800_01(Self)))    to CSAG317.IDIOMA
32376>>>             Find Eq  CSAG317 by 1
32377>>>>
32377>>>                 If not (Found)  Function_Return "Erro Nao Cadastrado"
32380>>>
32380>>>             Function_Return (Trim(CSAG317.Descricao))
32381>>>     End_Function // fgRetErroDescricao
32382>>>     
32382>>>//------------------------------------------------------------------------
32382>>>// Biblioteca fgRetConversion_measures Global: Retorna a Conversao 
32382>>>//                                             de Valores.
32382>>>//------------------------------------------------------------------------
32382>>>     Function fgRetConversion_measures Global Number aValue String aMeasure Returns Number
32384>>>        
32384>>>        Number nReturn
32384>>>        Move (Uppercase(aMeasure)) to aMeasure
32385>>>                
32385>>>        Case Begin
32385>>>            Case (aMeasure = 'CM')
32387>>>                Move (aValue / 2.54) to nReturn
32388>>>            Case Break
32389>>>            Case (aMeasure = 'INCH')
32392>>>                Move (aValue * 2.54) to nReturn
32393>>>            Case Break
32394>>>            Case (aMeasure = 'KG')
32397>>>                Move (aValue / 0.45359237) to nReturn
32398>>>            Case Break
32399>>>            Case (aMeasure = 'LBS')
32402>>>                Move (aValue * 0.45359237) to nReturn
32403>>>            Case Break
32404>>>        Case End
32404>>>        
32404>>>        Move (ROUNDALL(nReturn,4)) to nReturn
32405>>>
32405>>>        Function_Return nReturn
32406>>>     
32406>>>    End_Function // fgRetConversion_measures
32407>>>
32407>>>//------------------------------------------------------------------------
32407>>>// Biblioteca fgRetCalc_measures Global: Recebe as dimensoes e de acordo
32407>>>//                                       com o tipo apura o volume em CBM
32407>>>//                                       ou CFT.
32407>>>//------------------------------------------------------------------------
32407>>>    Function fgRetCalc_measures Global Number aValue1 Number aValue2 Number aValue3 String aMeasure Returns Number
32409>>>        
32409>>>        Number nReturn
32409>>>        Move (Uppercase(aMeasure)) to aMeasure        
32410>>>        Case Begin
32410>>>            Case (aMeasure = 'CBM')
32412>>>                Move ((aValue1 * aValue2 * aValue3) * 1) to nReturn
32413>>>            Case Break //Case (aMeasure = 'CBM')
32414>>>            Case (aMeasure = 'CFT')
32417>>>                Move (((aValue1/12) * (aValue2/12) * (aValue3/12)) * 1) to nReturn
32418>>>            Case Break //Case (aMeasure = 'CFT')
32419>>>        Case End
32419>>>        
32419>>>        Move (ROUNDALL(nReturn,4)) to nReturn
32420>>>                
32420>>>    Function_Return nReturn
32421>>>     
32421>>>    End_Function // fgRetCalc_measures
32422>>>
32422>>>//------------------------------------------------------------------------
32422>>>// Biblioteca fGetLabelLangofTable Global: Retorna o Idioma da label 
32422>>>//                                         de um campo.
32422>>>//------------------------------------------------------------------------
32422>>>    Function fGetLabelLangofTable Global String sTableName String sTableFieldName String sIdioma Returns String
32424>>>        
32424>>>        Clear   CSAG310
32425>>>        Move sTableName         to CSAG310.TABELA
32426>>>        Move sTableFieldName    to CSAG310.CAMPO
32427>>>        Move sIdioma            to CSAG310.IDIOMA
32428>>>        Find Eq CSAG310   by 1
32429>>>>
32429>>>        Function_Return (Trim(CSAG310.APPEARANCE))
32430>>>        
32430>>>    End_Function // fGetLabelLangofTable
32431>>>
32431>>>//------------------------------------------------------------------------
32431>>>// Biblioteca IntSplitToArray Global: Splits a string into an array 
32431>>>//                                     of Integer using the given delimiter.
32431>>>//
32431>>>// Params:
32431>>>//     sString     The string to split.
32431>>>//     sDel        The delimiter (like "," or "|")
32431>>>// Returns:
32431>>>//     Array of strings (not including the delimiters itself.
32431>>>//------------------------------------------------------------------------
32431>>>    Function IntSplitToArray Global String sString String sDel Returns Integer[]
32433>>>        Integer[] asResult
32434>>>        Integer iStart iEnd iDel
32434>>>        
32434>>>        If (sString <> "") Begin
32436>>>            
32436>>>            Move 1 to iStart
32437>>>            
32437>>>            Move (Length(sDel)) to iDel
32438>>>            Move (Pos(sDel, sString, iStart)) to iEnd
32439>>>            
32439>>>            If (iEnd > 0) Begin
32441>>>                While (iEnd > 0)
32445>>>                    Move (Mid(sString,  iEnd - iStart, iStart)) to asResult[SizeOfArray(asResult)]
32446>>>                    
32446>>>                    Move (iEnd + iDel) to iStart
32447>>>                    Move (Pos(sDel, sString, iStart)) to iEnd
32448>>>                Loop
32449>>>>
32449>>>                
32449>>>                Move (Right(sString,  Length(sString) - iStart + 1)) to asResult[SizeOfArray(asResult)]
32450>>>            End
32450>>>>
32450>>>            Else Begin
32451>>>                Move sString to asResult[0]
32452>>>            End
32452>>>>
32452>>>        End
32452>>>>
32452>>>        
32452>>>        
32452>>>        Function_Return asResult
32453>>>    End_Function //IntSplitToArray
32454>>>    
32454>>>
32454>>>//------------------------------------------------------------------------
32454>>>// Biblioteca fregistraLOGMAIL Global: Recebe os parametros e registra
32454>>>//                                     na tabela que controla os emails
32454>>>//                                     que serao disparados via sistema.
32454>>>//                                     Retrona uma msg no padrao JSON.
32454>>>//------------------------------------------------------------------------
32454>>>    Function fregistraLOGMAIL Global String sUsuarioNumero;                                     String sFrom;                                     String sReplayTo;                                     String sTo;                                     String sCC;                                     String sBCC;                                     String sSubjetc;                                     String sMsg;                                     String sAnexo;                                     String sHtmlBody;                                     String sIpAddress;                                    Returns stDefaultMessage
32456>>>        
32456>>>             Handle hObj_logmail
32456>>>            Boolean bError
32456>>>             String sHtml
32456>>>             String sReturn
32456>>>             Number nAnexo
32456>>>  stDefaultMessage stDefaultMsg
32456>>>  stDefaultMessage stDefaultMsg
32456>>>  
32456>>>        Move (Trim(sFrom))      to sFrom
32457>>>        Move (Trim(sReplayTo))  to sReplayTo
32458>>>        Move (Trim(sTo))        to sTo
32459>>>        Move (Trim(sCC))        to sCC
32460>>>        Move (Trim(sBCC))       to sBCC
32461>>>        Move (Trim(sSubjetc))   to sSubjetc
32462>>>        Move (Trim(sMsg))       to sMsg
32463>>>        Move (Trim(sAnexo))     to sAnexo
32464>>>        Move (Trim(sHtmlBody))  to sHtmlBody
32465>>>        
32465>>>        Move (Replaces(',',sTo,';')) to sTo
32466>>>        Move (Replaces(',',sCC,';')) to sCC
32467>>>        Move (Replaces(',',sBCC,';')) to sBCC
32468>>>        
32468>>>        Get Create (RefClass(DataDictionary)) to hObj_logmail
32469>>>        Set Main_File of hObj_logmail to LOGMAIL.File_Number 
32470>>>        Send DefineAllExtendedFields of hObj_logmail
32471>>>        
32471>>>        Clear CSAG300
32472>>>        Move sUsuarioNumero to CSAG300.USUARIONUMERO
32473>>>        Find EQ CSAG300 by 3
32474>>>>
32474>>>        If (sFrom = '') Move (Trim(CSAG300.USUARIOEMAIL)) to sFrom
32477>>>        If (sReplayTo = '' and sBCC <> '') Move sBCC to sReplayTo
32480>>>        If (sReplayTo = '') Move (Trim(CSAG300.USUARIOEMAIL)) to sReplayTo
32483>>>
32483>>>        Send Clear of hObj_logmail
32484>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.from to sFrom
32485>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.REPLAYTO to sReplayTo
32486>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.to to sTo
32487>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.CC to sCC
32488>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.BCC to sBCC
32489>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.SUBJECT to sSubjetc
32490>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.MSG to sMsg
32491>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.USUARIO_ID_C to sUsuarioNumero
32492>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.DATE_TIME_C to (CurrentDateTime())
32493>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.IP_USUARIO to sIpAddress
32494>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.ID_ENVIADO to '0'
32495>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.ANEXO to sAnexo
32496>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.ID_ANEXO to nAnexo
32497>>>        Set Field_Changed_Value of hObj_logmail Field LOGMAIL.HTML_BODY to sHtmlBody
32498>>>        
32498>>>        Get Request_Validate of hObj_logmail to bError
32499>>>        If (not(bError)) Begin
32501>>>            Send Request_Save of hObj_logmail
32502>>>            Move (Err) to stDefaultMsg.hasError
32503>>>            If (Err) Move 'Could not send Email. Please verify!' to stDefaultMsg.msgError
32506>>>            Else Move 'Email sent with success!' to stDefaultMsg.msgInfo
32508>>>        End
32508>>>>
32508>>>        Else Begin
32509>>>            Move True to stDefaultMsg.hasError
32510>>>            Move 'Could not send Email. Please verify!' to stDefaultMsg.msgError
32511>>>        End
32511>>>>
32511>>>            
32511>>>        Send Destroy of hObj_logmail
32512>>>        Function_Return stDefaultMsg
32513>>>        
32513>>>    End_Function //fregistraLOGMAIL
32514>>>
32514>>>//------------------------------------------------------------------------
32514>>>// Biblioteca fCreateFolderToday Global: Recebe um diretorio e dentro
32514>>>//                                       dele verifica se existe uma pasta
32514>>>//                                       do ano corrente (se nao existir cria)
32514>>>//                                       dentro o ano o mes e depois o dia. 
32514>>>//------------------------------------------------------------------------
32514>>>    Function fCreateFolderToday Global String sDiretorio Returns String  
32516>>>        Boolean bFileExist
32516>>>        String  sParametro     
32516>>>        String  sHoje
32516>>>        String  sDia
32516>>>        String  sMes
32516>>>        String  sAno
32516>>>        
32516>>>        Move (Get_Sysdate(False)) to sHoje  
32517>>>        Move (Mid(sHoje,2,1))     to sDia   
32518>>>        Move (Mid(sHoje,2,4))     to sMes 
32519>>>        Move (Mid(sHoje,4,7))     to sAno  
32520>>>        
32520>>>        File_Exist sDiretorio bFileExist
32521>>>        If (not(bFileExist)) Make_Directory sDiretorio
32524>>>        File_Exist sDiretorio bFileExist
32525>>>        If (not(bFileExist)) Begin
32527>>>            Function_Return
32528>>>        End //If (not(bFileExist)) Begin
32528>>>>
32528>>>    
32528>>>        Move (sDiretorio+"\"+sAno) to sDiretorio
32529>>>        File_Exist sDiretorio bFileExist
32530>>>        If (not(bFileExist)) Make_Directory sDiretorio
32533>>>        File_Exist sDiretorio bFileExist
32534>>>        If (not(bFileExist)) Begin
32536>>>            Function_Return
32537>>>        End //If (not(bFileExist)) Begin
32537>>>>
32537>>>        
32537>>>        Move (sDiretorio+"\"+sMes) to sDiretorio
32538>>>        File_Exist sDiretorio bFileExist
32539>>>        If (not(bFileExist)) Make_Directory sDiretorio
32542>>>        File_Exist sDiretorio bFileExist
32543>>>        If (not(bFileExist)) Begin
32545>>>            Function_Return
32546>>>        End //If (not(bFileExist)) Begin            
32546>>>>
32546>>>        
32546>>>        Move (sDiretorio+"\"+sDia) to sDiretorio
32547>>>        File_Exist sDiretorio bFileExist
32548>>>        If (not(bFileExist)) Make_Directory sDiretorio
32551>>>        File_Exist sDiretorio bFileExist
32552>>>        If (not(bFileExist)) Begin
32554>>>            Function_Return
32555>>>        End //If (not(bFileExist)) Begin  
32555>>>>
32555>>>        
32555>>>        //DEVOLVER O DIRETORIO PRONTO
32555>>>        Move (sDiretorio+"\") to sDiretorio
32556>>>        
32556>>>        Function_Return sDiretorio    
32557>>>    End_Function //fCreateFolderToday
32558>>>    
32558>>>//------------------------------------------------------------------------
32558>>>// Biblioteca fRemoveCharEmail Global: Recebe um email
32558>>>//                                     e remove caracteres que nao
32558>>>//                                     pertencam ao email
32558>>>//------------------------------------------------------------------------
32558>>>    Function fRemoveCharEmail Global String sEmail Returns String     
32560>>>        
32560>>>        Move (Replaces("~",sEmail,"")) to sEmail
32561>>>        Move (Replaces("/",sEmail,"")) to sEmail 
32562>>>        Move (Replaces("\",sEmail,"")) to sEmail 
32563>>>        Move (Replaces("|",sEmail,"")) to sEmail   
32564>>>        Move (Replaces(":",sEmail,"")) to sEmail  
32565>>>        Move (Replaces("?",sEmail,"")) to sEmail  
32566>>>        Move (Replaces("^",sEmail,"")) to sEmail  
32567>>>        Move (Replaces("",sEmail,"")) to sEmail 
32568>>>        Move (Replaces("`",sEmail,"")) to sEmail    
32569>>>        Move (Replaces(" ",sEmail,"")) to sEmail
32570>>>        
32570>>>        Function_Return sEmail
32571>>>    End_Function //fRemoveCharEmail
32572>>>        
32572>>>//------------------------------------------------------------------------
32572>>>// Biblioteca doUppLTrim Global: Recebe uma string e aplica Rtrim,
32572>>>//                               Ltrim e Uppercase e devolve a string
32572>>>//------------------------------------------------------------------------
32572>>>    Function doUppLTrim Global String sCAMPO Returns String
32574>>>        Move (Rtrim(sCAMPO)) to sCAMPO
32575>>>        Move (Ltrim(sCAMPO)) to sCAMPO
32576>>>        Move (Uppercase(sCAMPO)) to sCAMPO
32577>>>        Function_Return sCAMPO
32578>>>    End_Function //doUppLTrim
32579>>>
32579>>>//------------------------------------------------------------------------
32579>>>// Biblioteca doNumber Global: recebe um valor como string 
32579>>>//                             e devolve como numero
32579>>>//------------------------------------------------------------------------
32579>>>    Function doNumber Global String sValue Returns Number
32581>>>        Integer iTypeThousandsSeparator
32581>>>        Integer iTypeDecimalSeparator
32581>>>        
32581>>>        //-- PADRONIZANDO OS DADOS NUMERICOS
32581>>>        Get_Attribute DF_THOUSANDS_SEPARATOR  to iTypeThousandsSeparator  
32584>>>        Get_Attribute DF_DECIMAL_SEPARATOR    to iTypeDecimalSeparator    
32587>>>
32587>>>        If (Pos(Character(iTypeDecimalSeparator), sValue)) 
32589>>>        Else If (Pos('.', sValue)) Begin
32592>>>                Move (Replace('.', sValue, Character(iTypeDecimalSeparator))) to sValue
32593>>>             End
32593>>>>
32593>>>        Else If (Pos(',', sValue)) Begin
32596>>>                Move (Replace(',', sValue, Character(iTypeDecimalSeparator))) to sValue
32597>>>        End
32597>>>>
32597>>>        Function_Return sValue
32598>>>    End_Function //doNumber
32599>>>
32599>>>//------------------------------------------------------------------------
32599>>>// Biblioteca fGetNewDate Global: Retorna a data de inicio 
32599>>>//                                ou final do ms informado
32599>>>//------------------------------------------------------------------------
32599>>>    Function fGetNewDate Global Date dData Boolean bFinaldoMes Returns Date
32601>>>        Integer iMes 
32601>>>        Integer iAno 
32601>>>        Integer iDate_Tp
32601>>>        Date    dNewDate
32601>>>        
32601>>>        Get_Attribute DF_DATE_FORMAT to iDate_Tp
32604>>>        Set_Attribute DF_DATE_FORMAT to DF_DATE_USA //-- mm/dd/yyyy
32607>>>        
32607>>>        Move (Mid(dData, 2, 1)) to iMes
32608>>>        Move (Mid(dData, 4, 7)) to iAno
32609>>>        If (bFinaldoMes) Begin
32611>>>            Add 1 to iMes
32612>>>            If (iMes > 12) Begin
32614>>>               Move 1 to iMes 
32615>>>               Add  1 to iAno 
32616>>>            End
32616>>>>
32616>>>            Move (If(iMes<10, '0', '')+String(iMes)+'/01/'+String(iAno)) to dNewDate
32617>>>            Subtract 1 from dNewDate
32618>>>        End
32618>>>>
32618>>>        Else Begin
32619>>>            Move (If(iMes<10, '0', '')+String(iMes)+'/01/'+String(iAno)) to dNewDate
32620>>>        End
32620>>>>
32620>>>
32620>>>        Set_Attribute DF_DATE_FORMAT to iDate_Tp
32623>>>
32623>>>        Function_Return dNewDate            
32624>>>    End_Function //fGetNewDate        
32625>>>
32625>>>//------------------------------------------------------------------------
32625>>>// Biblioteca RemoveAcentos Global: Recebe uma string e devolve a mesma 
32625>>>//                                  trocanto todos os caracteres 
32625>>>//                                  acentuados pelo correspondente sem 
32625>>>//                                  acento.
32625>>>//------------------------------------------------------------------------
32625>>>Function RemoveAcentos Global String sValue$ Returns String
32627>>>    Integer iPos iAscii
32627>>>    String sLetra sRetorno
32627>>>    
32627>>>    Move (ToAnsi(sValue$)) to sValue$
32628>>>    Move "" to sRetorno
32629>>>    
32629>>>    For iPos from 1 to (Length(sValue$))
32635>>>>
32635>>>        Move (Mid(sValue$,1,iPos)) to sLetra
32636>>>        Move (Ascii(sLetra)) to iAscii
32637>>>        
32637>>>        If ((iAscii>=224) and (iAscii<=228)) Move 97 to iAscii
32640>>>        Else If ((iAscii>=192) and (iAscii<=196)) Move 65 to iAscii
32644>>>        Else If ((iAscii>=232) and (iAscii<=235)) Move 101 to iAscii
32648>>>        Else If ((iAscii>=200) and (iAscii<=203)) Move 69 to iAscii
32652>>>        Else If ((iAscii>=236) and (iAscii<=239)) Move 105 to iAscii
32656>>>        Else If ((iAscii>=204) and (iAscii<=207)) Move 73 to iAscii
32660>>>        Else If ((iAscii>=242) and (iAscii<=246)) Move 111 to iAscii
32664>>>        Else If ((iAscii>=210) and (iAscii<=214)) Move 79 to iAscii
32668>>>        Else If ((iAscii>=249) and (iAscii<=252)) Move 117 to iAscii
32672>>>        Else If ((iAscii>=217) and (iAscii<=220)) Move 85 to iAscii
32676>>>        Else If (iAscii=231) Move 99 to iAscii
32680>>>        Else If (iAscii=199) Move 67 to iAscii
32684>>>        Else If (iAscii=241) Move 110 to iAscii
32688>>>        Else If (iAscii=209) Move 78 to iAscii
32692>>>        
32692>>>        Move (Character(iAscii)) to sLetra
32693>>>        Move (Append(sRetorno,sLetra)) to sRetorno
32694>>>    Loop
32695>>>>
32695>>>
32695>>>    Function_Return (ToOEM(sRetorno))
32696>>>End_Function // RemoveAcentos
32697>>>
32697>>>//---------------------------------------------------------------------------------------
32697>>>// Biblioteca NFeRemoveCaracteresEspeciais Global: Recebe uma string e devolve a mesma 
32697>>>//                                                 trocanto todos os caracteres especiais
32697>>>//                                                 pelo correspondente em HTML.
32697>>>//---------------------------------------------------------------------------------------
32697>>>Function NFeRemoveCaracteresEspeciais Global String sTexto Returns String
32699>>>    Move (Trim(RemoveAcentos(sTexto))) to sTexto  
32700>>>    Move (Replaces(Character(166),sTexto,".o"))               to sTexto // 
32701>>>    Move (Replaces(Character(167),sTexto,".o"))               to sTexto // o
32702>>>    Move (Replaces(Character(248),sTexto,".a"))               to sTexto // 
32703>>>    Move (Replaces(Character(245),sTexto,""))                 to sTexto // o
32704>>>    Move (Replaces(Character(38),sTexto ,"&amp;"))            to sTexto // &
32705>>>    Move (Replaces(Character(60),sTexto ,"&lt;"))             to sTexto // <
32706>>>    Move (Replaces(Character(62),sTexto ,"&gt;"))             to sTexto // >
32707>>>    Move (Replaces(Character(34),sTexto ,"&quot;"))           to sTexto // "
32708>>>    Move (Replaces(Character(39),sTexto ,"&#39;"))            to sTexto // '
32709>>>    Move (Replaces(Character(13)+Character(10),sTexto," / ")) to sTexto // Quebra de Linha
32710>>>    Move (Replaces(Character(9),sTexto," "))                  to sTexto // TAB
32711>>>    Move (Replaces(Character(239),sTexto,"&#39"))             to sTexto // 
32712>>>    Move (Replaces(Character(96),sTexto,"&#39"))              to sTexto // `
32713>>>
32713>>>    Function_Return sTexto
32714>>>End_Function // NFeRemoveCaracteresEspeciais
32715>>>
32715>>>// Generates a string of 40 random characters between ASCII 33 & ASCII 126
32715>>>// This should produce a unique string suitable for a 16 character encryption key.
32715>>>// Excludes the ;"' characters
32715>>>// Used by WebApps to give the psEncryptPassword property a unique value.
32715>>>Function GenerateEncryptString Global Returns String
32717>>>    Integer i iASCII
32717>>>    String sChar sKey
32717>>>    
32717>>>    For i from 0 to 39
32723>>>>
32723>>>        Move (Random(93)) to iASCII
32724>>>        Move (iASCII + 34) to iASCII
32725>>>        
32725>>>        If (iASCII = 34 or iASCII = 39 or iASCII = 59) Begin
32727>>>            Increment iASCII
32728>>>        End
32728>>>>
32728>>>        
32728>>>        Move (Character(iASCII)) to sChar
32729>>>        Move (sKey + sChar) to sKey
32730>>>    Loop
32731>>>>
32731>>>    
32731>>>    Function_Return sKey
32732>>>End_Function //GenerateEncryptString
32733>>>
32733>>>Procedure InitPassword
32736>>>    // Note to the developer: For security purposes each installation of the WebOrder workspace must
32736>>>    // contain a unique value for the framework's encryption key. This value is stored in the cWebApp
32736>>>    // object's psEncryptPassword property.
32736>>>    //
32736>>>    // To ensure each running installation of WebOrder is different we have modified the Web App's OnLoad
32736>>>    // event to generate a random psEncryptPassword value the first time that the web app is run. This 
32736>>>    // value is then used and is stored in the OrdSys system table so that it does not get re-generated
32736>>>    // in subsequent instances of this web application.
32736>>>    //
32736>>>    // Since WebOrder is installed and run automatically when you install DataFlex we are required to 
32736>>>    // ensure that the encryption password cannot be guessed. Normally you would not need, or want, 
32736>>>    // to Use this technique in your own web applications. Instead you would manually set psEncryptPassword
32736>>>    // to a trusted, unique value for each web application that you deploy.
32736>>>    
32736>>>    Handle hObj
32736>>>    Boolean bErro
32736>>>    String  encryptPassword
32736>>>    // Test if an encryption password has already been generated.
32736>>>    If (Trim(TSMG800.ENCRYPTPASSWORD) = "") Begin
32738>>>        Get Create (RefClass(DataDictionary)) to hObj
32739>>>        Set Main_File of hObj to TSMG800.File_Number
32740>>>        Send Request_Assign of hObj TSMG800.File_Number
32741>>>        //Reread TSMG800
32741>>>        // Just in case another instance wrote to OrdSys.EncryptPassword in the millisecond
32741>>>        // between the above two lines of code we will test this value again
32741>>>        If (Trim(TSMG800.ENCRYPTPASSWORD) = "") Begin
32743>>>            Get GenerateEncryptString to encryptPassword
32744>>>            Set Field_Changed_Value of hObj Field TSMG800.ENCRYPTPASSWORD to encryptPassword
32745>>>            Get Request_Validate of hObj to bErro
32746>>>            If (not(bErro)) Begin
32748>>>                Send Request_Save of hObj
32749>>>                Send Refind_Records of hObj
32750>>>            End
32750>>>>
32750>>>            //SaveRecord TSMG800
32750>>>        End
32750>>>>
32750>>>        //Unlock
32750>>>        Send Destroy of hObj
32751>>>    End
32751>>>>
32751>>>
32751>>>    String sPath
32751>>>    Move (Rtrim(TSMG800.COPY_FOTOS)) to sPath 
32752>>>    Send RegisterDownloadFolder of ghoWebResourceManager (sPath+"Download")
32753>>>    Send RegisterUploadFolder   of ghoWebResourceManager (sPath+"Upload")
32754>>>    
32754>>>    Set psEncryptPassword of ghoWebApp to (Trim(TSMG800.ENCRYPTPASSWORD))
32755>>>End_Procedure //InitPassword
32756>>>
32756>>>
32756>>>
32756>>>//------------------------------------------------------------------------
32756>>>// Biblioteca onLogMail Global: Guardar LOG dos e-mail disparados.
32756>>>//                                 
32756>>>//                                   
32756>>>// ANDERSON RODRIGUES - 2021.04.08
32756>>>//------------------------------------------------------------------------
32756>>>
32756>>>Procedure onLogMail Global stLogMail tDados String aUsuarioSessao
32758>>>    Boolean bErr
32758>>>    Handle  hoLogMail
32758>>>    DateTime dtUsuario
32758>>>    //-
32758>>>    Clear CSAG311
32759>>>    Move aUsuarioSessao to CSAG311.USUARIOSESSAO
32760>>>    Find Eq CSAG311 by 1
32761>>>>
32761>>>    If (not(Found)) Procedure_Return
32764>>>    //-
32764>>>    Get Create (RefClass(DataDictionary)) to hoLogMail
32765>>>    Set Main_File of hoLogMail to LOGMAIL.File_Number
32766>>>    //-
32766>>>    Move (CurrentDateTime()) to dtUsuario
32767>>>    //-
32767>>>    Send Clear of hoLogMail
32768>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.from          to tDados.fromMail
32769>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.REPLAYTO      to tDados.replaytoMail
32770>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.to            to tDados.toMail
32771>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.CC            to tDados.ccMail
32772>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.BCC           to tDados.bccMail
32773>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.SUBJECT       to tDados.subjectMail
32774>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.MSG           to tDados.msgMail
32775>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.IP_USUARIO    to tDados.ipusuarioMail
32776>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.ID_ENVIADO    to tDados.idenviadoMail
32777>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.DT_HR_ENVIADO to tDados.dthrenviadoMail
32778>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.ANEXO         to tDados.anexoMail
32779>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.ID_ANEXO      to tDados.idanexoMail
32780>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.HTML_BODY     to tDados.htmlbodyMaIL
32781>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.USUARIO_ID_C  to CSAG311.USUARIONUMERO
32782>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.DATE_TIME_C   to dtUsuario
32783>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.USUARIO_ID_A  to CSAG311.USUARIONUMERO
32784>>>    Set Field_Changed_Value of hoLogMail Field LOGMAIL.DATE_TIME_A   to dtUsuario
32785>>>    //-
32785>>>    Get Request_Validate of hoLogMail to bErr
32786>>>    If (not(bErr)) Send Request_Save of hoLogMail
32789>>>    //-
32789>>>    Send Destroy of hoLogMail
32790>>>End_Procedure
32791>>>
32791>>>
32791>>>//------------------------------------------------------------------------
32791>>>// Biblioteca fSanitizarTexto Global: Recebe um texto e procura remover  
32791>>>//                                    caracteres indesejaveis.
32791>>>//                                   
32791>>>// ANDERSON RODRIGUES - 2021.04.08
32791>>>//------------------------------------------------------------------------
32791>>>Function fSanitizarTexto Global String sParameter Returns String
32793>>>    //SANITIZACAO
32793>>>    Boolean bOk
32793>>>    Integer iAsc
32793>>>    Integer iIndex
32793>>>    String sReturn
32793>>>    
32793>>>    Move (Trim(sParameter)) to sParameter
32794>>>    
32794>>>    For iIndex from 1 to (Length(sParameter))
32800>>>>
32800>>>        Move (Ascii(Mid(sParameter, 1, iIndex))) to iAsc
32801>>>        Move False to bOk
32802>>>        
32802>>>        Case Begin
32802>>>            Case (iAsc = 128) //
32804>>>                Move 67 to iAsc
32805>>>                Move True to bOk
32806>>>                Case Break
32807>>>            Case (iAsc = 135) //
32810>>>                Move 99 to iAsc
32811>>>                Move True to bOk
32812>>>                Case Break
32813>>>            Case ((iAsc >= 131 and iAsc <= 134) or iAsc = 160 or iAsc = 198) //     a
32816>>>                Move 97 to iAsc
32817>>>                Move True to bOk
32818>>>                Case Break
32819>>>            Case ((iAsc >= 181 and iAsc <= 183) or iAsc = 142 or iAsc = 143 or iAsc = 199) //  A A A A
32822>>>                Move 65 to iAsc
32823>>>                Move True to bOk
32824>>>                Case Break
32825>>>            Case ((iAsc >= 147 and iAsc <= 149) or iAsc = 162 or iAsc = 228) //    o
32828>>>                Move 111 to iAsc
32829>>>                Move True to bOk
32830>>>                Case Break
32831>>>            Case ((iAsc >= 226 and iAsc <= 229) or iAsc = 224 or iAsc = 153) // O O O O
32834>>>                Move 79 to iAsc
32835>>>                Move True to bOk
32836>>>                Case Break
32837>>>            Case ((iAsc >= 150 and iAsc <= 151) or iAsc = 129 or iAsc = 163) //   
32840>>>                Move 117 to iAsc
32841>>>                Move True to bOk
32842>>>                Case Break
32843>>>            Case ((iAsc >= 233 and iAsc <= 235) or iAsc = 154) // U U U
32846>>>                Move 85 to iAsc
32847>>>                Move True to bOk
32848>>>                Case Break
32849>>>            Case ((iAsc >= 136 and iAsc <= 138) or iAsc = 130) //   
32852>>>                Move 101 to iAsc
32853>>>                Move True to bOk
32854>>>                Case Break
32855>>>            Case ((iAsc >= 210 and iAsc <= 212) or iAsc = 144) // E E E
32858>>>                Move 69 to iAsc
32859>>>                Move True to bOk
32860>>>                Case Break
32861>>>            Case ((iAsc >= 139 and iAsc <= 141) or iAsc = 161) //   
32864>>>                Move 105 to iAsc
32865>>>                Move True to bOk
32866>>>                Case Break
32867>>>            Case ((iAsc >= 214 and iAsc <= 216) or iAsc = 222) //I I I I
32870>>>                Move 73 to iAsc
32871>>>                Move True to bOk
32872>>>                Case Break
32873>>>            Case (iAsc >= 32 and iAsc <= 126)  //numerais e carcateres validos
32876>>>                Move True to bOk
32877>>>                Case Break
32878>>>        Case End
32878>>>        
32878>>>        If (bOk) Add (Character(iAsc)) to sReturn
32881>>>    Loop
32882>>>>
32882>>>    
32882>>>    Function_Return sReturn
32883>>>
32883>>>End_Function //fSanitizarTexto
32884>>>
32884>>>//------------------------------------------------------------------------
32884>>>// Biblioteca fIsNumber Global: Confirma True/False se o valor e um  
32884>>>//                              numero.
32884>>>//                                   
32884>>>// ANDERSON RODRIGUES - 2021.04.29
32884>>>//------------------------------------------------------------------------
32884>>>Function fIsNumber Global String sParameter Returns Boolean
32886>>>    Boolean bOk
32886>>>    Integer iAsc
32886>>>    Integer iIndex
32886>>>    
32886>>>    Move (Trim(sParameter)) to sParameter
32887>>>    
32887>>>    For iIndex from 1 to (Length(sParameter))
32893>>>>
32893>>>        Move (Ascii(Mid(sParameter, 1, iIndex))) to iAsc
32894>>>        Move False to bOk
32895>>>        
32895>>>        Case Begin
32895>>>            Case (iAsc >= 44 and iAsc <= 46)  // , - . (comma, minus, dot)
32897>>>                Move True to bOk
32898>>>                Case Break
32899>>>            Case (iAsc >= 48 and iAsc <= 57)  //numerais
32902>>>                Move True to bOk
32903>>>                Case Break
32904>>>            Case Else
32904>>>                Move False to bOk
32905>>>                Case Break
32906>>>        Case End
32906>>>        
32906>>>        If (not(bOk)) Function_Return False
32909>>>    Loop
32910>>>>
32910>>>    
32910>>>    Function_Return True
32911>>>
32911>>>End_Function //fIsNumber
32912>>>
32912>>>//------------------------------------------------------------------------
32912>>>// Biblioteca fFindElement Global: Procura por um valor dentro de um 
32912>>>//                                 array.
32912>>>//                                   
32912>>>// ANDERSON RODRIGUES - 2021.05.26
32912>>>//------------------------------------------------------------------------
32912>>>Function fFindElement Global String[] aStrArray String sElemtStr Returns Integer
32914>>>    Integer ndx 
32914>>>    Integer retVal 
32914>>>    Integer arrMax
32914>>>    Integer elementStr
32914>>>    String  arrVal
32914>>>    
32914>>>    Move (SizeOfArray(aStrArray))   to arrMax
32915>>>    Move -1                         to retVal
32916>>>    Move 0                          to ndx
32917>>>    Move (Integer(sElemtStr))       to elementStr
32918>>>    
32918>>>    While (ndx < arrMax and retVal = -1)
32922>>>        //If (elementStr = ndx) Move ndx to retVal
32922>>>        Move aStrArray[ndx] to arrVal
32923>>>        If (arrVal <> "") Move ndx to retVal
32926>>>        Add 1 to ndx
32927>>>    End
32928>>>>
32928>>>    Function_Return retVal
32929>>>End_Function //fFindElement
32930>>>
32930>>>//------------------------------------------------------------------------
32930>>>// Biblioteca fMinutes2Hours Global: Recebe o total em minutos e converte 
32930>>>//                                   para horas trabalhando com
32930>>>//                                   0.25, 0.50, 0.75 e 1.00
32930>>>//
32930>>>// ANDERSON RODRIGUES - 2025.01.24
32930>>>//------------------------------------------------------------------------
32930>>>Function fMinutes2Hours Global String sTempoApurado Returns Number
32932>>>    Number nHours
32932>>>    String[] aTempoApurado
32933>>>    Number nDd
32933>>>    Number nHr
32933>>>    Number nMn
32933>>>    
32933>>>    Move (ResizeArray(aTempoApurado,0)) to aTempoApurado
32934>>>    
32934>>>    Move (StrSplitToArray(sTempoApurado,':')) to aTempoApurado
32935>>>    
32935>>>    Move (aTempoApurado[0]) to nDd
32936>>>    Move (aTempoApurado[1]) to nHr
32937>>>    Move (aTempoApurado[2]) to nMn
32938>>>    
32938>>>    Move (nDd * 24) to nHours
32939>>>    Add  nHr        to nHours
32940>>>    
32940>>>    Case Begin
32940>>>        Case (nMn >= 59)
32942>>>            Add 1 to nHours
32943>>>            Case Break
32944>>>        Case (nMn >= 45 and nMn < 59)
32947>>>            Add 0.75 to nHours
32948>>>            Case Break
32949>>>        Case (nMn >= 30 and nMn < 45)
32952>>>            Add 0.50 to nHours
32953>>>            Case Break
32954>>>        Case (nMn >= 15 and nMn < 30)
32957>>>            Add 0.25 to nHours
32958>>>            Case Break
32959>>>    Case End
32959>>>
32959>>>    Function_Return nHours
32960>>>End_Function //fMinutes2Hours
32961>>>
32961>>>  
32961>    Use ColocaZerosEsquerda.pkg
Including file: ColocaZerosEsquerda.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\ColocaZerosEsquerda.pkg)
32961>>>// ColocaZerosEsquerda.pkg
32961>>>//
32961>>>// Verso 1.0
32961>>>// ltima alterao: 15/06/2007
32961>>>// Autor: Ivan Kaupa (ivankaupa@gmail.com)
32961>>>// Function ColocaZerosEsquerda: Recebe uma string e um integer e acrescenta zeros  esqueda na String at que fique com o tamanho
32961>>>//                               especificado no integer.
32961>>>//
32961>>>// Instrues de uso:
32961>>>// *) Copie o pacote para o diretrio AppSrc da sua Workspace
32961>>>// *) Adicione o pacote em seu programa ou componente atravs do comando Use (Use ColocaZerosEsquerda.pkg).
32961>>>// *) Exemplo de chamada: Move (ColocaZerosEsquerda(Cliente.CNPJ,14)) to sResultado
32961>>>
32961>>>// Histrico de alteraes
32961>>>//
32961>>>// Verso #.# - Nenhuma alterao aps a criao
32961>>>//-2WA
32961>>>Function ColocaZerosEsquerda Global String sValor Integer iTamanho Returns String
32963>>>    Move (Trim(sValor)) to sValor
32964>>>    While (Length(sValor) < iTamanho)
32968>>>        Move ("0" + sValor) to sValor
32969>>>    Loop    
32970>>>>
32970>>>    Function_Return sValor
32971>>>End_Function // ColocaZerosEsquerda
32972>    Use cszJSONParser.pkg
Including file: cszJSONParser.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\cszJSONParser.pkg)
32972>>>//-2WA
32972>>>Use UI
32972>>>Use szJSONParser.pkg
Including file: szJSONParser.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\szJSONParser.pkg)
32972>>>>>//-2WA
32972>>>>>// Visual DataFlex COM proxy classes generated from C:\WWW.SISTEMAS.COM.BR\WEB.CRAFT.COM.BR\WVDF_CAC_v8r0\Deploy\szJSONParser.tlb
32972>>>>>Use FlexCom20.pkg
Including file: FlexCOM20.pkg    (C:\Program Files (x86)\DataFlex 18.2\Pkg\FlexCOM20.pkg)
32972>>>>>>>
32972>>>>>>>//
32972>>>>>>>// Full Flexcom support for automation (cComAutomationObject),
32972>>>>>>>// activeX (cComActiveXControl and document objects (cComDocumentObject)
32972>>>>>>>//
32972>>>>>>>
32972>>>>>>>Use FlexCOM20_Base.pkg // defines basic flexcom symbols and class cComAutomationObject
32972>>>>>>>
32972>>>>>>>Class cComDocumentObject Is a DFComDocumentObject
32973>>>>>>>    Procedure Construct_Object
32975>>>>>>>        Forward Send Construct_Object
32977>>>>>>>        Send RegisterComEvents
32978>>>>>>>        Send Define_Standard_Object_Mixin
32979>>>>>>>        Send Define_Shadow_Mixin
32980>>>>>>>    End_Procedure
32981>>>>>>>    Import_Class_Protocol Standard_Object_Mixin
32982>>>>>>>    Import_Class_Protocol Shadow_Mixin
32983>>>>>>>
32983>>>>>>>    // It is expected that the Com class will augment this with useful event definitions
32983>>>>>>>    Procedure RegisterComEvents
32985>>>>>>>    End_Procedure
32986>>>>>>>
32986>>>>>>>    // returns true if the control is created.
32986>>>>>>>    Function IsComObjectCreated Returns Boolean
32988>>>>>>>        Variant vComObject
32988>>>>>>>        Get pvComObject to vComObject
32989>>>>>>>        Function_Return (Not(IsNullComObject(vComObject)))
32990>>>>>>>    End_Function
32991>>>>>>>
32991>>>>>>>End_Class
32992>>>>>>>
32992>>>>>>>Class cComActiveXControl Is a DFComActiveXControl
32993>>>>>>>    Procedure Construct_Object
32995>>>>>>>        Forward Send Construct_Object
32997>>>>>>>        Send RegisterComEvents
32998>>>>>>>        Send Define_Standard_Object_Mixin
32999>>>>>>>        Send Define_Single_Item_Navigate_Mixin
33000>>>>>>>        Send Define_Dflabel_Mixin
33001>>>>>>>
33001>>>>>>>        // If set true, then the control will attempt to bind the value property in the object to the
33001>>>>>>>        // comValue in the control. It will try to keep these values in synch at all times. This allows a
33001>>>>>>>        // control to be used as a Form style value control. the default is true. Even when true if the
33001>>>>>>>        // get/set ComValue methods are not set up to do anything, this will do nothing.
33001>>>>>>>        Property boolean pbBindValue True
33002>>>>>>>
33002>>>>>>>        // internal: set true object is notified that the OCX value has changed.
33002>>>>>>>        Property Boolean pbPrivateControlChanging false
33003>>>>>>>
33003>>>>>>>        // Class sets this true when making a local (externally triggered) change. This is
33003>>>>>>>        // set when a Set Value change is made to prevent recursion
33003>>>>>>>        property Boolean pbPrivateControlRefresh false
33004>>>>>>>
33004>>>>>>>        // added to eumlate a single item form support
33004>>>>>>>        property Boolean pbPrivateItem_Changed_State false
33005>>>>>>>
33005>>>>>>>        // This keeps track of value, even when control is not created
33005>>>>>>>        Property String psPrivateValue ''
33006>>>>>>>
33006>>>>>>>    End_Procedure
33007>>>>>>>
33007>>>>>>>    Import_Class_Protocol Standard_Object_Mixin
33008>>>>>>>    Import_Class_Protocol Single_Item_Navigate_Mixin
33009>>>>>>>    Import_Class_Protocol Dflabel_Mixin
33010>>>>>>>
33010>>>>>>>    // It is expected that the Com class will augment this with useful event definitions
33010>>>>>>>    Procedure RegisterComEvents
33012>>>>>>>    End_Procedure
33013>>>>>>>
33013>>>>>>>    // added to eumlate a single item form support
33013>>>>>>>    Function Item_Count returns integer
33015>>>>>>>        function_return 1
33016>>>>>>>    end_function
33017>>>>>>>
33017>>>>>>>    // added to eumlate a single item form support
33017>>>>>>>    Procedure Set Item_Changed_State integer iItem integer iState
33019>>>>>>>       Set pbPrivateItem_changed_state to iState
33020>>>>>>>        If (iState and changed_state(self)=false) set changed_state to true
33023>>>>>>>    end_procedure
33024>>>>>>>
33024>>>>>>>    Function Item_Changed_State integer iItem returns integer
33026>>>>>>>        function_return (pbPrivateItem_changed_state(self))
33027>>>>>>>    end_function
33028>>>>>>>
33028>>>>>>>
33028>>>>>>>    // augment to set the label's appearance
33028>>>>>>>    Procedure Shadow_Display
33030>>>>>>>        forward send Shadow_display
33032>>>>>>>        Send Label_Shadow_Display
33033>>>>>>>    End_Procedure // Shadow_Display
33034>>>>>>>
33034>>>>>>>    // Created to simulate get/Set value.
33034>>>>>>>    Procedure set Value integer iItem string sVal
33036>>>>>>>        If not (pbPrivateControlChanging(self)) ;            Send OnRefreshControl sVal
33039>>>>>>>        Set psPrivateValue to sVal
33040>>>>>>>        Send OnChange
33041>>>>>>>        //Set changed_state to True
33041>>>>>>>        set item_changed_state 0 to true
33042>>>>>>>    End_Procedure
33043>>>>>>>
33043>>>>>>>    Function Value integer iItem returns string
33045>>>>>>>        function_return (psPrivateValue(self))
33046>>>>>>>        //function_return (Controlvalue(self))
33046>>>>>>>    end_function
33047>>>>>>>
33047>>>>>>>    Procedure OnChange
33049>>>>>>>    End_Procedure
33050>>>>>>>
33050>>>>>>>
33050>>>>>>>    // It is expected that the sub-class will provide functionality
33050>>>>>>>    // for these messages. This gets and sets the value of the actual
33050>>>>>>>    // window control. These should only be used to synchronize the window
33050>>>>>>>    // control and the DF side. Do not use for any other purpose.
33050>>>>>>>    Procedure Set ControlValue string sVal
33052>>>>>>>    End_Procedure
33053>>>>>>>
33053>>>>>>>    Function ControlValue Returns String
33055>>>>>>>    End_Function
33056>>>>>>>
33056>>>>>>>   Procedure OnCreate
33058>>>>>>>       // if we are binding value to comValue, do so upon creation
33058>>>>>>>       If (pbBindValue(self)) ;           Set ControlValue to (Value(self))
33061>>>>>>>       Forward Send OnCreate
33063>>>>>>>   End_Procedure
33064>>>>>>>
33064>>>>>>>
33064>>>>>>>    // returns true if the control is created.
33064>>>>>>>    Function IsComObjectCreated Returns Boolean
33066>>>>>>>        Variant vComObject
33066>>>>>>>        Get pvComObject to vComObject
33067>>>>>>>        Function_Return (Not(IsNullComObject(vComObject)))
33068>>>>>>>    End_Function
33069>>>>>>>
33069>>>>>>>    // Notification that the control's value has been changed
33069>>>>>>>    // externally by the program (via set value). Use to synchronize
33069>>>>>>>    // OCX control value.
33069>>>>>>>    Procedure OnRefreshControl string sVal
33071>>>>>>>        Boolean bOld
33071>>>>>>>        If (pbBindValue(self) and pbPrivateControlChanging(self)=0 And IsComObjectCreated(self)) Begin
33073>>>>>>>            Get pbPrivateControlRefresh to bOld
33074>>>>>>>            Set pbPrivateControlRefresh to True
33075>>>>>>>            set ControlValue to sval
33076>>>>>>>            Set pbPrivateControlRefresh to bOld
33077>>>>>>>        end
33077>>>>>>>>
33077>>>>>>>    End_Procedure
33078>>>>>>>
33078>>>>>>>    // notification that the control has changed its value. Used to
33078>>>>>>>    // synchronize the object with the change.
33078>>>>>>>    Procedure OnControlValueChanged
33080>>>>>>>        String sVal
33080>>>>>>>        Boolean bOld
33080>>>>>>>        If (pbBindValue(self) and pbPrivateControlRefresh(self)=0) Begin
33082>>>>>>>            Get pbPrivateControlChanging to bOld
33083>>>>>>>            Set pbPrivateControlChanging to True
33084>>>>>>>            Get ControlValue to sVal
33085>>>>>>>            Set Value to sVal
33086>>>>>>>            Set Item_Changed_State 0 to True
33087>>>>>>>            Set pbPrivateControlChanging to bOld
33088>>>>>>>        end
33088>>>>>>>>
33088>>>>>>>    End_Procedure
33089>>>>>>>
33089>>>>>>>    Procedure Delete_Data
33091>>>>>>>        Forward Send Delete_Data
33093>>>>>>>        Set Value to ''
33094>>>>>>>        Set Changed_state to False
33095>>>>>>>        Set Item_changed_state 0 to false
33096>>>>>>>    End_Procedure
33097>>>>>>>
33097>>>>>>>End_Class
33098>>>>>>>
33098>>>>>
33098>>>>>
33098>>>>>// CLSID: {41402F76-51B2-4FE5-B0CA-EC5C0DCDCB25}
33098>>>>>Class cComIszJSONParser is a Mixin
33099>>>>>
33099>>>>>    Function ComDeserializeString String lljson Returns Variant
33101>>>>>        Handle hDispatchDriver
33101>>>>>        Variant retVal
33101>>>>>        Get phDispatchDriver to hDispatchDriver
33102>>>>>        Send PrepareParams to hDispatchDriver 1
33103>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR lljson
33104>>>>>        Get InvokeComMethod of hDispatchDriver 1 OLE_VT_UNKNOWN to retVal
33105>>>>>        Function_Return retVal
33106>>>>>    End_Function
33107>>>>>
33107>>>>>    Function ComSerialize Variant llobj Returns String
33109>>>>>        Handle hDispatchDriver
33109>>>>>        String retVal
33109>>>>>        Get phDispatchDriver to hDispatchDriver
33110>>>>>        Send PrepareParams to hDispatchDriver 1
33111>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llobj
33112>>>>>        Get InvokeComMethod of hDispatchDriver 2 OLE_VT_BSTR to retVal
33113>>>>>        Function_Return retVal
33114>>>>>    End_Function
33115>>>>>
33115>>>>>    Function ComGetTokenType Variant lltkn Returns Integer
33117>>>>>        Handle hDispatchDriver
33117>>>>>        Integer retVal
33117>>>>>        Get phDispatchDriver to hDispatchDriver
33118>>>>>        Send PrepareParams to hDispatchDriver 1
33119>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33120>>>>>        Get InvokeComMethod of hDispatchDriver 3 OLE_VT_I4 to retVal
33121>>>>>        Function_Return retVal
33122>>>>>    End_Function
33123>>>>>
33123>>>>>    Function ComGetTokenTypeAsString Variant lltkn Returns String
33125>>>>>        Handle hDispatchDriver
33125>>>>>        String retVal
33125>>>>>        Get phDispatchDriver to hDispatchDriver
33126>>>>>        Send PrepareParams to hDispatchDriver 1
33127>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33128>>>>>        Get InvokeComMethod of hDispatchDriver 4 OLE_VT_BSTR to retVal
33129>>>>>        Function_Return retVal
33130>>>>>    End_Function
33131>>>>>
33131>>>>>    Function ComGetTokenChildCount Variant lltkn Returns Integer
33133>>>>>        Handle hDispatchDriver
33133>>>>>        Integer retVal
33133>>>>>        Get phDispatchDriver to hDispatchDriver
33134>>>>>        Send PrepareParams to hDispatchDriver 1
33135>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33136>>>>>        Get InvokeComMethod of hDispatchDriver 5 OLE_VT_I4 to retVal
33137>>>>>        Function_Return retVal
33138>>>>>    End_Function
33139>>>>>
33139>>>>>    Function ComGetChild Variant lltkn Integer llindex Returns Variant
33141>>>>>        Handle hDispatchDriver
33141>>>>>        Variant retVal
33141>>>>>        Get phDispatchDriver to hDispatchDriver
33142>>>>>        Send PrepareParams to hDispatchDriver 2
33143>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33144>>>>>        Send DefineParam to hDispatchDriver OLE_VT_I4 llindex
33145>>>>>        Get InvokeComMethod of hDispatchDriver 6 OLE_VT_UNKNOWN to retVal
33146>>>>>        Function_Return retVal
33147>>>>>    End_Function
33148>>>>>
33148>>>>>    Function ComGetPropertyName Variant llprop Returns String
33150>>>>>        Handle hDispatchDriver
33150>>>>>        String retVal
33150>>>>>        Get phDispatchDriver to hDispatchDriver
33151>>>>>        Send PrepareParams to hDispatchDriver 1
33152>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llprop
33153>>>>>        Get InvokeComMethod of hDispatchDriver 7 OLE_VT_BSTR to retVal
33154>>>>>        Function_Return retVal
33155>>>>>    End_Function
33156>>>>>
33156>>>>>    Function ComGetHasValues Variant lltkn Returns Boolean
33158>>>>>        Handle hDispatchDriver
33158>>>>>        Boolean retVal
33158>>>>>        Get phDispatchDriver to hDispatchDriver
33159>>>>>        Send PrepareParams to hDispatchDriver 1
33160>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33161>>>>>        Get InvokeComMethod of hDispatchDriver 8 OLE_VT_BOOL to retVal
33162>>>>>        Function_Return retVal
33163>>>>>    End_Function
33164>>>>>
33164>>>>>    Function ComGetTokenValueAsString Variant lltkn Returns String
33166>>>>>        Handle hDispatchDriver
33166>>>>>        String retVal
33166>>>>>        Get phDispatchDriver to hDispatchDriver
33167>>>>>        Send PrepareParams to hDispatchDriver 1
33168>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33169>>>>>        Get InvokeComMethod of hDispatchDriver 9 OLE_VT_BSTR to retVal
33170>>>>>        Function_Return retVal
33171>>>>>    End_Function
33172>>>>>
33172>>>>>    Function ComGetTokenPath Variant lltkn Returns String
33174>>>>>        Handle hDispatchDriver
33174>>>>>        String retVal
33174>>>>>        Get phDispatchDriver to hDispatchDriver
33175>>>>>        Send PrepareParams to hDispatchDriver 1
33176>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33177>>>>>        Get InvokeComMethod of hDispatchDriver 10 OLE_VT_BSTR to retVal
33178>>>>>        Function_Return retVal
33179>>>>>    End_Function
33180>>>>>
33180>>>>>    Function ComGetTokenParent Variant lltkn Returns Variant
33182>>>>>        Handle hDispatchDriver
33182>>>>>        Variant retVal
33182>>>>>        Get phDispatchDriver to hDispatchDriver
33183>>>>>        Send PrepareParams to hDispatchDriver 1
33184>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33185>>>>>        Get InvokeComMethod of hDispatchDriver 11 OLE_VT_UNKNOWN to retVal
33186>>>>>        Function_Return retVal
33187>>>>>    End_Function
33188>>>>>
33188>>>>>    Function ComGetAtPath Variant llstart String llpath Returns Variant
33190>>>>>        Handle hDispatchDriver
33190>>>>>        Variant retVal
33190>>>>>        Get phDispatchDriver to hDispatchDriver
33191>>>>>        Send PrepareParams to hDispatchDriver 2
33192>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llstart
33193>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpath
33194>>>>>        Get InvokeComMethod of hDispatchDriver 12 OLE_VT_UNKNOWN to retVal
33195>>>>>        Function_Return retVal
33196>>>>>    End_Function
33197>>>>>
33197>>>>>    Function ComGetValue Variant lltkn String llfieldname Returns String
33199>>>>>        Handle hDispatchDriver
33199>>>>>        String retVal
33199>>>>>        Get phDispatchDriver to hDispatchDriver
33200>>>>>        Send PrepareParams to hDispatchDriver 2
33201>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33202>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llfieldname
33203>>>>>        Get InvokeComMethod of hDispatchDriver 13 OLE_VT_BSTR to retVal
33204>>>>>        Function_Return retVal
33205>>>>>    End_Function
33206>>>>>
33206>>>>>    Function ComGetChildByName Variant lltkn String llfieldname Returns Variant
33208>>>>>        Handle hDispatchDriver
33208>>>>>        Variant retVal
33208>>>>>        Get phDispatchDriver to hDispatchDriver
33209>>>>>        Send PrepareParams to hDispatchDriver 2
33210>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33211>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llfieldname
33212>>>>>        Get InvokeComMethod of hDispatchDriver 14 OLE_VT_UNKNOWN to retVal
33213>>>>>        Function_Return retVal
33214>>>>>    End_Function
33215>>>>>
33215>>>>>    Function ComNewJSONObject Returns Variant
33217>>>>>        Handle hDispatchDriver
33217>>>>>        Variant retVal
33217>>>>>        Get phDispatchDriver to hDispatchDriver
33218>>>>>        Get InvokeComMethod of hDispatchDriver 15 OLE_VT_UNKNOWN to retVal
33219>>>>>        Function_Return retVal
33220>>>>>    End_Function
33221>>>>>
33221>>>>>    Procedure ComAddString Variant llcont String llpropName String llpropval
33223>>>>>        Handle hDispatchDriver
33223>>>>>        Get phDispatchDriver to hDispatchDriver
33224>>>>>        Send PrepareParams to hDispatchDriver 3
33225>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
33226>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
33227>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropval
33228>>>>>        Send InvokeComMethod to hDispatchDriver 16 OLE_VT_VOID
33229>>>>>    End_Procedure
33230>>>>>
33230>>>>>    Function ComNewJSONArray Returns Variant
33232>>>>>        Handle hDispatchDriver
33232>>>>>        Variant retVal
33232>>>>>        Get phDispatchDriver to hDispatchDriver
33233>>>>>        Get InvokeComMethod of hDispatchDriver 17 OLE_VT_UNKNOWN to retVal
33234>>>>>        Function_Return retVal
33235>>>>>    End_Function
33236>>>>>
33236>>>>>    Procedure ComAddObject Variant llcont String llpropName Variant lltoadd
33238>>>>>        Handle hDispatchDriver
33238>>>>>        Get phDispatchDriver to hDispatchDriver
33239>>>>>        Send PrepareParams to hDispatchDriver 3
33240>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
33241>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
33242>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltoadd
33243>>>>>        Send InvokeComMethod to hDispatchDriver 18 OLE_VT_VOID
33244>>>>>    End_Procedure
33245>>>>>
33245>>>>>    Procedure ComAddNull Variant llcont String llpropName
33247>>>>>        Handle hDispatchDriver
33247>>>>>        Get phDispatchDriver to hDispatchDriver
33248>>>>>        Send PrepareParams to hDispatchDriver 2
33249>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
33250>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
33251>>>>>        Send InvokeComMethod to hDispatchDriver 19 OLE_VT_VOID
33252>>>>>    End_Procedure
33253>>>>>
33253>>>>>    Procedure ComAddBoolean Variant llcont String llpropName Boolean llpropval
33255>>>>>        Handle hDispatchDriver
33255>>>>>        Get phDispatchDriver to hDispatchDriver
33256>>>>>        Send PrepareParams to hDispatchDriver 3
33257>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
33258>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
33259>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BOOL llpropval
33260>>>>>        Send InvokeComMethod to hDispatchDriver 20 OLE_VT_VOID
33261>>>>>    End_Procedure
33262>>>>>
33262>>>>>    Procedure ComAddInteger Variant llcont String llpropName Integer llpropval
33264>>>>>        Handle hDispatchDriver
33264>>>>>        Get phDispatchDriver to hDispatchDriver
33265>>>>>        Send PrepareParams to hDispatchDriver 3
33266>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llcont
33267>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
33268>>>>>        Send DefineParam to hDispatchDriver OLE_VT_I4 llpropval
33269>>>>>        Send InvokeComMethod to hDispatchDriver 21 OLE_VT_VOID
33270>>>>>    End_Procedure
33271>>>>>
33271>>>>>    Procedure ComRemoveFromParent Variant lltkn
33273>>>>>        Handle hDispatchDriver
33273>>>>>        Get phDispatchDriver to hDispatchDriver
33274>>>>>        Send PrepareParams to hDispatchDriver 1
33275>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33276>>>>>        Send InvokeComMethod to hDispatchDriver 22 OLE_VT_VOID
33277>>>>>    End_Procedure
33278>>>>>
33278>>>>>    Procedure ComRemoveChild Variant lltkn String llpropName
33280>>>>>        Handle hDispatchDriver
33280>>>>>        Get phDispatchDriver to hDispatchDriver
33281>>>>>        Send PrepareParams to hDispatchDriver 2
33282>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33283>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpropName
33284>>>>>        Send InvokeComMethod to hDispatchDriver 23 OLE_VT_VOID
33285>>>>>    End_Procedure
33286>>>>>
33286>>>>>    Procedure ComRemoveAllChildren Variant lltkn
33288>>>>>        Handle hDispatchDriver
33288>>>>>        Get phDispatchDriver to hDispatchDriver
33289>>>>>        Send PrepareParams to hDispatchDriver 1
33290>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN lltkn
33291>>>>>        Send InvokeComMethod to hDispatchDriver 24 OLE_VT_VOID
33292>>>>>    End_Procedure
33293>>>>>
33293>>>>>    Function ComDeepClone Variant llsrc Returns Variant
33295>>>>>        Handle hDispatchDriver
33295>>>>>        Variant retVal
33295>>>>>        Get phDispatchDriver to hDispatchDriver
33296>>>>>        Send PrepareParams to hDispatchDriver 1
33297>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llsrc
33298>>>>>        Get InvokeComMethod of hDispatchDriver 25 OLE_VT_UNKNOWN to retVal
33299>>>>>        Function_Return retVal
33300>>>>>    End_Function
33301>>>>>
33301>>>>>    Function ComSelectTokens Variant llsrc String llpath Returns Variant[]
33303>>>>>        Handle hDispatchDriver
33303>>>>>        Variant[] retVal
33304>>>>>        Get phDispatchDriver to hDispatchDriver
33305>>>>>        Send PrepareParams to hDispatchDriver 2
33306>>>>>        Send DefineParam to hDispatchDriver OLE_VT_UNKNOWN llsrc
33307>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llpath
33308>>>>>        Get InvokeComMethod of hDispatchDriver 26 (OLE_VT_ARRAY ior OLE_VT_UNKNOWN) to retVal
33309>>>>>        Function_Return retVal
33310>>>>>    End_Function
33311>>>>>
33311>>>>>    Function ComXMLToJSON String llxmlsrc Returns String
33313>>>>>        Handle hDispatchDriver
33313>>>>>        String retVal
33313>>>>>        Get phDispatchDriver to hDispatchDriver
33314>>>>>        Send PrepareParams to hDispatchDriver 1
33315>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR llxmlsrc
33316>>>>>        Get InvokeComMethod of hDispatchDriver 27 OLE_VT_BSTR to retVal
33317>>>>>        Function_Return retVal
33318>>>>>    End_Function
33319>>>>>
33319>>>>>    Function ComJSONToXML String lljsonsrc Returns String
33321>>>>>        Handle hDispatchDriver
33321>>>>>        String retVal
33321>>>>>        Get phDispatchDriver to hDispatchDriver
33322>>>>>        Send PrepareParams to hDispatchDriver 1
33323>>>>>        Send DefineParam to hDispatchDriver OLE_VT_BSTR lljsonsrc
33324>>>>>        Get InvokeComMethod of hDispatchDriver 28 OLE_VT_BSTR to retVal
33325>>>>>        Function_Return retVal
33326>>>>>    End_Function
33327>>>>>End_Class
33328>>>>>
33328>>>>>// CoClass
33328>>>>>// ProgID: szJSONParser
33328>>>>>// CLSID: {82EE46EF-D273-419E-842F-255C280D3DD9}
33328>>>>>Class cComcszJSONParser is a cComAutomationObject
33329>>>>>    Import_Class_Protocol cComIszJSONParser
33330>>>>>
33330>>>>>    Procedure Construct_Object
33332>>>>>        Forward Send Construct_Object
33334>>>>>        Set psProgID to "{82EE46EF-D273-419E-842F-255C280D3DD9}"
33335>>>>>        Set peAutoCreate to acNoAutoCreate
33336>>>>>    End_Procedure
33337>>>>>End_Class
33338>>>Use cszJSONObject.pkg
Including file: cszJSONObject.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\cszJSONObject.pkg)
33338>>>>>//-2WA
33338>>>>>Use UI 
33338>>>>>
33338>>>>>Enum_List   // JToken Type
33338>>>>>    // Summary:
33338>>>>>    //     No token type has been set.
33338>>>>>    Define JTokenType_None 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A JSON object.
33338>>>>>    Define JTokenType_Object
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A JSON array.
33338>>>>>    Define JTokenType_Array 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A JSON constructor.
33338>>>>>    Define JTokenType_Constructor 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A JSON object property.
33338>>>>>    Define JTokenType_Property 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A comment.
33338>>>>>    Define JTokenType_Comment 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     An integer value.
33338>>>>>    Define JTokenType_Integer 
33338>>>>>
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A float value.
33338>>>>>    Define JTokenType_Float 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A string value.
33338>>>>>    Define JTokenType_String 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A boolean value.
33338>>>>>    Define JTokenType_Boolean 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A null value.
33338>>>>>    Define JTokenType_Null 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     An undefined value.
33338>>>>>    Define JTokenType_Undefined 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A date value.
33338>>>>>    Define JTokenType_Date 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A raw JSON value.
33338>>>>>    Define JTokenType_Raw 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A collection of bytes value.
33338>>>>>    Define JTokenType_Bytes 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A Guid value.
33338>>>>>    Define JTokenType_Guid 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A Uri value.
33338>>>>>    Define JTokenType_Uri 
33338>>>>>    //
33338>>>>>    // Summary:
33338>>>>>    //     A TimeSpan value.
33338>>>>>    Define JTokenType_TimeSpan     
33338>>>>>End_Enum_List
33338>>>>>
33338>>>>>//  Function:       IsJSONValueType
33338>>>>>//  Author:         Michael Salzlechner
33338>>>>>//  Copyright:      2016 StarZen Technologies, Inc.
33338>>>>>//  Web:            www.starzen.com
33338>>>>>//  Description:    tests a passed token type and returns true or false depending on type
33338>>>>>
33338>>>>>Function IsJSONValueType Global Integer iType Returns Integer
33340>>>>>    Case Begin
33340>>>>>        Case (iType=JTokenType_Object)
33342>>>>>        Case (iType=JTokenType_Property)
33345>>>>>        Case (iType=JTokenType_Array)
33348>>>>>        Case (iType=JTokenType_None)
33351>>>>>        Case (iType=JTokenType_Constructor)
33354>>>>>        Case (iType=JTokenType_Null)
33357>>>>>            Function_Return (False)
33358>>>>>            Case Break
33359>>>>>        
33359>>>>>        Case (iType=JTokenType_Comment    )
33362>>>>>        Case (iType=JTokenType_Integer)
33365>>>>>        Case (iType=JTokenType_Float)
33368>>>>>        Case (iType=JTokenType_String)
33371>>>>>        Case (iType=JTokenType_Boolean)
33374>>>>>        Case (iType=JTokenType_Date)
33377>>>>>        Case (iType=JTokenType_Raw)
33380>>>>>        Case (iType=JTokenType_Bytes)
33383>>>>>        Case (iType=JTokenType_Guid)
33386>>>>>        Case (iType=JTokenType_Uri)
33389>>>>>        Case (iType=JTokenType_TimeSpan)
33392>>>>>            Function_Return (True)
33393>>>>>            Case Break
33394>>>>>    Case End       
33394>>>>>    
33394>>>>>    Function_Return (False)
33395>>>>>End_Function
33396>>>>>    
33396>>>>>//  Class:          cszJSONObject
33396>>>>>//  Author:         Michael Salzlechner
33396>>>>>//  Copyright:      2016 StarZen Technologies, Inc.
33396>>>>>//  Web:            www.starzen.com
33396>>>>>//  Description:    a JSON Object
33396>>>>>    
33396>>>>>Class cszJSONObject is a cObject
33397>>>>>    Procedure Construct_Object
33399>>>>>        Forward Send Construct_Object
33401>>>>>        
33401>>>>>        Property Variant pvJSONObject 
33402>>>>>        Property Integer phoParser Public 0
33403>>>>>    End_Procedure
33404>>>>>
33404>>>>>    //  Function:       Serialize
33404>>>>>    //  Author:         Michael Salzlechner
33404>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33404>>>>>    //  Web:            www.starzen.com
33404>>>>>    //  Description:    serializes this object into a string containing the JSON data
33404>>>>>    //                  on success this function will return a string containing the object
33404>>>>>    //                  on failure the return value is ""
33404>>>>>        
33404>>>>>    Function Serialize Returns String
33406>>>>>        Integer hoParser
33406>>>>>        Get phoParser to hoParser
33407>>>>>        
33407>>>>>        Variant vJSONObject
33407>>>>>        Get pvJSONObject to vJSONObject
33408>>>>>
33408>>>>>        String sJSON
33408>>>>>        Get ComSerialize vJSONObject to sJSON
33409>>>>>        
33409>>>>>        Function_Return sJSON
33410>>>>>    End_Function
33411>>>>>
33411>>>>>    
33411>>>>>    //  Function:       ChildCount
33411>>>>>    //  Author:         Michael Salzlechner
33411>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33411>>>>>    //  Web:            www.starzen.com
33411>>>>>    //  Description:    returns the number of child tokens in this object
33411>>>>>    
33411>>>>>    Function ChildCount Returns Integer
33413>>>>>        Integer hoParser
33413>>>>>        Get phoParser to hoParser
33414>>>>>        Variant vJSONObject
33414>>>>>        Get pvJSONObject to vJSONObject
33415>>>>>
33415>>>>>        Integer iRetVal
33415>>>>>        Get ComGetTokenChildCount of hoParser vJSONObject to iRetVal
33416>>>>>        
33416>>>>>        Function_Return iRetVal
33417>>>>>    End_Function
33418>>>>>
33418>>>>>    //  Function:       TokenType
33418>>>>>    //  Author:         Michael Salzlechner
33418>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33418>>>>>    //  Web:            www.starzen.com
33418>>>>>    //  Description:    returns the token type for the current JSON object
33418>>>>>        
33418>>>>>    Function TokenType Returns Integer
33420>>>>>        Integer hoParser
33420>>>>>        Get phoParser to hoParser
33421>>>>>        Variant vJSONObject
33421>>>>>        Get pvJSONObject to vJSONObject
33422>>>>>
33422>>>>>        Integer iType
33422>>>>>        Get ComGetTokenType of hoParser vJSONObject to iType
33423>>>>>        
33423>>>>>        Function_Return iType
33424>>>>>    End_Function
33425>>>>>
33425>>>>>    //  Function:       TokenTypeAsString
33425>>>>>    //  Author:         Michael Salzlechner
33425>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33425>>>>>    //  Web:            www.starzen.com
33425>>>>>    //  Description:    returns the token type in text form for the current JSON object
33425>>>>>
33425>>>>>    Function TokenTypeAsString Returns String
33427>>>>>        Integer hoParser
33427>>>>>        Get phoParser to hoParser
33428>>>>>        Variant vJSONObject
33428>>>>>        Get pvJSONObject to vJSONObject
33429>>>>>
33429>>>>>        String sType
33429>>>>>        Get ComGetTokenTypeAsString of hoParser vJSONObject to sType
33430>>>>>        
33430>>>>>        Function_Return sType
33431>>>>>    End_Function
33432>>>>>
33432>>>>>    //  Function:       HasValues
33432>>>>>    //  Author:         Michael Salzlechner
33432>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33432>>>>>    //  Web:            www.starzen.com
33432>>>>>    //  Description:    returns True or False depending on the type of object
33432>>>>>    //                  true means the object has child objects/values
33432>>>>>        
33432>>>>>    Function HasValues Returns Integer
33434>>>>>        Integer hoParser
33434>>>>>        Get phoParser to hoParser
33435>>>>>        Variant vJSONObject
33435>>>>>        Get pvJSONObject to vJSONObject
33436>>>>>
33436>>>>>        Boolean bHasValues
33436>>>>>        Get ComGetHasValues of hoParser vJSONObject to bHasValues
33437>>>>>        Function_Return bHasValues
33438>>>>>    End_Function
33439>>>>>
33439>>>>>    //  Function:       PropertyName
33439>>>>>    //  Author:         Michael Salzlechner
33439>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33439>>>>>    //  Web:            www.starzen.com
33439>>>>>    //  Description:    returns the name of a property token
33439>>>>>        
33439>>>>>    Function PropertyName Returns String
33441>>>>>        Integer hoParser
33441>>>>>        Get phoParser to hoParser
33442>>>>>        Variant vJSONObject
33442>>>>>        Get pvJSONObject to vJSONObject
33443>>>>>            
33443>>>>>        String sPropName            
33443>>>>>        If (TokenType(Self)=JTokenType_Property) Begin
33445>>>>>            Get ComGetPropertyName of hoParser vJSONObject to sPropName 
33446>>>>>            Function_Return sPropName
33447>>>>>        End
33447>>>>>>
33447>>>>>        Function_Return ""
33448>>>>>    End_Function
33449>>>>>    
33449>>>>>    //  Function:       TokenPath
33449>>>>>    //  Author:         Michael Salzlechner
33449>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33449>>>>>    //  Web:            www.starzen.com
33449>>>>>    //  Description:    returns the path for the current token
33449>>>>>    
33449>>>>>    Function TokenPath Returns String
33451>>>>>        Integer hoParser
33451>>>>>        Get phoParser to hoParser
33452>>>>>        Variant vJSONObject
33452>>>>>        Get pvJSONObject to vJSONObject
33453>>>>>        
33453>>>>>        String sPath
33453>>>>>        Get ComGetTokenPath of hoParser vJSONObject to sPath
33454>>>>>        Function_Return sPath
33455>>>>>    End_Function
33456>>>>>    
33456>>>>>    //  Function:       ChildTokenByIndex
33456>>>>>    //  Author:         Michael Salzlechner
33456>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33456>>>>>    //  Web:            www.starzen.com
33456>>>>>    //  Description:    returns a child token at the given index
33456>>>>>    
33456>>>>>    Function ChildTokenByIndex Integer iIndex Returns Integer
33458>>>>>        Integer hoParser
33458>>>>>        Get phoParser to hoParser
33459>>>>>        Variant vJSONObject
33459>>>>>        Get pvJSONObject to vJSONObject
33460>>>>>
33460>>>>>        Variant vChild
33460>>>>>        Get ComGetChild of hoParser vJSONObject iIndex to vChild        
33461>>>>>        If (not(IsNullComObject(vChild))) Begin
33463>>>>>            Integer hoJSONObject
33463>>>>>            Get Create (RefClass(cszJSONObject)) to hoJSONObject
33464>>>>>            Set pvJSONObject of hoJSONObject to vChild
33465>>>>>            Set phoParser of hoJSONObject to hoParser
33466>>>>>            Function_Return hoJSONObject
33467>>>>>        End
33467>>>>>>
33467>>>>>        Else Function_Return 0
33469>>>>>    End_Function
33470>>>>>
33470>>>>>    //  Function:       ChildTokenByName
33470>>>>>    //  Author:         Michael Salzlechner
33470>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33470>>>>>    //  Web:            www.starzen.com
33470>>>>>    //  Description:    returns the child token with a given name
33470>>>>>
33470>>>>>    Function ChildTokenByName String sFieldName Returns Integer
33472>>>>>        Integer hoParser
33472>>>>>        Get phoParser to hoParser
33473>>>>>        Variant vJSONObject
33473>>>>>        Get pvJSONObject to vJSONObject
33474>>>>>
33474>>>>>        Variant vChild
33474>>>>>        Get ComGetChildByName of hoParser vJSONObject sFieldName to vChild   
33475>>>>>        If (not(IsNullComObject(vChild))) Begin
33477>>>>>            Integer hoJSONObject
33477>>>>>            Get Create (RefClass(cszJSONObject)) to hoJSONObject
33478>>>>>            Set pvJSONObject of hoJSONObject to vChild
33479>>>>>            Set phoParser of hoJSONObject to hoParser
33480>>>>>            Function_Return hoJSONObject
33481>>>>>        End
33481>>>>>>
33481>>>>>        Else Function_Return 0
33483>>>>>    End_Function
33484>>>>>
33484>>>>>    //  Function:       ChildValueByName
33484>>>>>    //  Author:         Michael Salzlechner
33484>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33484>>>>>    //  Web:            www.starzen.com
33484>>>>>    //  Description:    returns the value of a child token by name
33484>>>>>
33484>>>>>    Function ChildValueByName String sFieldName Returns String
33486>>>>>        Integer hoParser
33486>>>>>        Get phoParser to hoParser
33487>>>>>        Variant vJSONObject
33487>>>>>        Get pvJSONObject to vJSONObject
33488>>>>>
33488>>>>>        Variant vChild
33488>>>>>        Get ComGetChildByName of hoParser vJSONObject sFieldName to vChild   
33489>>>>>        If (not(IsNullComObject(vChild))) Begin
33491>>>>>            Integer iType
33491>>>>>            Get ComGetTokenType of hoParser vChild to iType
33492>>>>>            If (IsJSONValueType(iType)) Begin
33494>>>>>                String sVal
33494>>>>>                Get ComGetTokenValueAsString of hoParser vChild to sVal
33495>>>>>                Function_Return sVal
33496>>>>>            End
33496>>>>>>
33496>>>>>            Else Begin
33497>>>>>                Function_Return ""
33498>>>>>            End
33498>>>>>>
33498>>>>>        End       
33498>>>>>>
33498>>>>>        Else Function_Return ""
33500>>>>>    End_Function    
33501>>>>>
33501>>>>>    //  Function:       ChildValueByIndex
33501>>>>>    //  Author:         Michael Salzlechner
33501>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33501>>>>>    //  Web:            www.starzen.com
33501>>>>>    //  Description:    returns the value of a child token by index
33501>>>>>
33501>>>>>    Function ChildValueByIndex Integer iIndex Returns String
33503>>>>>        Integer hoParser
33503>>>>>        Get phoParser to hoParser
33504>>>>>        Variant vJSONObject
33504>>>>>        Get pvJSONObject to vJSONObject
33505>>>>>
33505>>>>>        Variant vChild
33505>>>>>        Get ComGetChild of hoParser vJSONObject iIndex to vChild   
33506>>>>>        If (not(IsNullComObject(vChild))) Begin
33508>>>>>            Integer iType
33508>>>>>            Get ComGetTokenType of hoParser vChild to iType
33509>>>>>            If (IsJSONValueType(iType)) Begin
33511>>>>>                String sVal
33511>>>>>                Get ComGetTokenValueAsString of hoParser vChild to sVal
33512>>>>>                Function_Return sVal
33513>>>>>            End
33513>>>>>>
33513>>>>>            Else Begin
33514>>>>>                Function_Return ""
33515>>>>>            End
33515>>>>>>
33515>>>>>        End       
33515>>>>>>
33515>>>>>        Else Function_Return ""
33517>>>>>    End_Function    
33518>>>>>
33518>>>>>    //  Function:       TokenValue
33518>>>>>    //  Author:         Michael Salzlechner
33518>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33518>>>>>    //  Web:            www.starzen.com
33518>>>>>    //  Description:    returns the value of the token 
33518>>>>>
33518>>>>>    Function TokenValue Returns String
33520>>>>>        Integer hoParser
33520>>>>>        Get phoParser to hoParser
33521>>>>>        Variant vJSONObject
33521>>>>>        Get pvJSONObject to vJSONObject
33522>>>>>
33522>>>>>        Integer iType
33522>>>>>        Get ComGetTokenType of hoParser vJSONObject to iType
33523>>>>>        If (IsJSONValueType(iType)) Begin
33525>>>>>            String sVal
33525>>>>>            Get ComGetTokenValueAsString of hoParser vJSONObject to sVal
33526>>>>>            Function_Return sVal
33527>>>>>        End
33527>>>>>>
33527>>>>>        Else Begin
33528>>>>>            Function_Return ""
33529>>>>>        End
33529>>>>>>
33529>>>>>
33529>>>>>        Function_Return ""
33530>>>>>    End_Function
33531>>>>>
33531>>>>>    //  Function:       GetAtPath
33531>>>>>    //  Author:         Michael Salzlechner
33531>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33531>>>>>    //  Web:            www.starzen.com
33531>>>>>    //  Description:    returns the token with the given path starting at the current token
33531>>>>>    
33531>>>>>    Function GetAtPath String sPath Returns Integer
33533>>>>>        Integer hoParser
33533>>>>>        Get phoParser to hoParser
33534>>>>>        Variant vJSONObject
33534>>>>>        Get pvJSONObject to vJSONObject
33535>>>>>        
33535>>>>>        Variant vToken
33535>>>>>        Get ComGetAtPath of hoParser vJSONObject sPath to vToken
33536>>>>>        If (not(IsNullComObject(vToken))) Begin
33538>>>>>            Integer hoJSON 
33538>>>>>            
33538>>>>>            Get Create (RefClass(cszJSONObject)) to hoJSON 
33539>>>>>            Set pvJSONObject of hoJSON to vToken
33540>>>>>            Set phoParser of hoJSON to hoParser
33541>>>>>            
33541>>>>>            Function_Return hoJSON
33542>>>>>        End
33542>>>>>>
33542>>>>>        Else Function_Return 0
33544>>>>>    End_Function
33545>>>>>
33545>>>>>    //  Function:       GetValueAtPath
33545>>>>>    //  Author:         Michael Salzlechner
33545>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33545>>>>>    //  Web:            www.starzen.com
33545>>>>>    //  Description:    returns the value of a token with the given path starting at the current token
33545>>>>>
33545>>>>>    Function GetValueAtPath String sPath Returns Integer
33547>>>>>        Integer hoParser
33547>>>>>        Get phoParser to hoParser
33548>>>>>        Variant vJSONObject
33548>>>>>        Get pvJSONObject to vJSONObject
33549>>>>>        
33549>>>>>        Variant vToken
33549>>>>>        Get ComGetAtPath of hoParser vJSONObject sPath to vToken
33550>>>>>        If (not(IsNullComObject(vToken))) Begin
33552>>>>>            Integer iType
33552>>>>>            Get ComGetTokenType of hoParser vToken to iType
33553>>>>>            If (IsJSONValueType(iType)) Begin
33555>>>>>                String sVal
33555>>>>>                Get ComGetTokenValueAsString of hoParser vToken to sVal
33556>>>>>                Function_Return sVal
33557>>>>>            End
33557>>>>>>
33557>>>>>            Else Begin
33558>>>>>                Function_Return ""
33559>>>>>            End
33559>>>>>>
33559>>>>>        End
33559>>>>>>
33559>>>>>        Else Function_Return ""
33561>>>>>    End_Function
33562>>>>>
33562>>>>>    //  Procedure:      AddString
33562>>>>>    //  Author:         Michael Salzlechner
33562>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33562>>>>>    //  Web:            www.starzen.com
33562>>>>>    //  Description:    adds a strongly typed string value with a given property name to this object
33562>>>>>    //                  in case this object is an array the property name is ignored
33562>>>>>        
33562>>>>>    Procedure AddString String propName String propVal
33564>>>>>        Integer hoParser
33564>>>>>        Get phoParser to hoParser
33565>>>>>        Variant vJSONObject
33565>>>>>        Get pvJSONObject to vJSONObject
33566>>>>>        
33566>>>>>        Send ComAddString to hoParser vJSONObject propName propVal
33567>>>>>    End_Procedure
33568>>>>>
33568>>>>>    //  Procedure:      AddObject
33568>>>>>    //  Author:         Michael Salzlechner
33568>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33568>>>>>    //  Web:            www.starzen.com
33568>>>>>    //  Description:    adds a JSON object with a given property name to this object
33568>>>>>    //                  in case this object is an array the property name is ignored
33568>>>>>
33568>>>>>    Procedure AddObject String propName Integer hoJSONObj
33570>>>>>        Integer hoParser
33570>>>>>        Get phoParser to hoParser
33571>>>>>        Variant vJSONObject vJSONObjectToAdd
33571>>>>>        Get pvJSONObject to vJSONObject
33572>>>>>        
33572>>>>>        Get pvJSONObject of hoJSONObj to vJSONObjectToAdd
33573>>>>>        Send ComAddObject to hoParser vJSONObject propName vJSONObjectToAdd
33574>>>>>    End_Procedure
33575>>>>>
33575>>>>>    //  Procedure:      AddInteger
33575>>>>>    //  Author:         Michael Salzlechner
33575>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33575>>>>>    //  Web:            www.starzen.com
33575>>>>>    //  Description:    adds a strongly typed integer value with a given property name to this object
33575>>>>>    //                  in case this object is an array the property name is ignored
33575>>>>>
33575>>>>>    Procedure AddInteger String propName Integer propVal
33577>>>>>        Integer hoParser
33577>>>>>        Get phoParser to hoParser
33578>>>>>        Variant vJSONObject
33578>>>>>        Get pvJSONObject to vJSONObject
33579>>>>>        
33579>>>>>        Send ComAddInteger to hoParser vJSONObject propName propVal
33580>>>>>    End_Procedure
33581>>>>>
33581>>>>>    //  Procedure:      AddNull
33581>>>>>    //  Author:         Michael Salzlechner
33581>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33581>>>>>    //  Web:            www.starzen.com
33581>>>>>    //  Description:    adds a null value object with a given property name to this object
33581>>>>>    //                  in case this object is an array the property name is ignored
33581>>>>>
33581>>>>>    Procedure AddNull String propName 
33583>>>>>        Integer hoParser
33583>>>>>        Get phoParser to hoParser
33584>>>>>        Variant vJSONObject
33584>>>>>        Get pvJSONObject to vJSONObject
33585>>>>>        
33585>>>>>        Send ComAddNull to hoParser vJSONObject propName
33586>>>>>    End_Procedure
33587>>>>>
33587>>>>>    //  Procedure:      AddBoolean
33587>>>>>    //  Author:         Michael Salzlechner
33587>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33587>>>>>    //  Web:            www.starzen.com
33587>>>>>    //  Description:    adds a strongly typed boolean value with a given property name to this object
33587>>>>>    //                  in case this object is an array the property name is ignored
33587>>>>>
33587>>>>>    Procedure AddBoolean String propName Boolean propVal
33589>>>>>        Integer hoParser
33589>>>>>        Get phoParser to hoParser
33590>>>>>        Variant vJSONObject
33590>>>>>        Get pvJSONObject to vJSONObject
33591>>>>>        
33591>>>>>        Send ComAddBoolean to hoParser vJSONObject propName propVal
33592>>>>>    End_Procedure
33593>>>>>
33593>>>>>    //  Function:       DeepClone
33593>>>>>    //  Author:         Michael Salzlechner
33593>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33593>>>>>    //  Web:            www.starzen.com
33593>>>>>    //  Description:    creates a deep clone of this object meaning descendents are deep cloned as well
33593>>>>>    //                  on success returns new dynamic JSON object that needs to be destroyed
33593>>>>>
33593>>>>>    Function DeepClone Returns Integer
33595>>>>>        Integer hoParser
33595>>>>>        Get phoParser to hoParser
33596>>>>>        Variant vJSONObject
33596>>>>>        Get pvJSONObject to vJSONObject
33597>>>>>
33597>>>>>        Variant vNewObj
33597>>>>>        Get ComDeepClone of hoParser vJSONObject to vNewObj
33598>>>>>        If (not(IsNullComObject(vNewObj))) Begin
33600>>>>>            Integer hoJSON 
33600>>>>>            
33600>>>>>            Get Create (RefClass(cszJSONObject)) to hoJSON 
33601>>>>>            Set pvJSONObject of hoJSON to vNewObj
33602>>>>>            Set phoParser of hoJSON to hoParser
33603>>>>>            
33603>>>>>            Function_Return hoJSON            
33604>>>>>        End
33604>>>>>>
33604>>>>>    End_Function
33605>>>>>
33605>>>>>    //  Procedure:      RemoveFromParent
33605>>>>>    //  Author:         Michael Salzlechner
33605>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33605>>>>>    //  Web:            www.starzen.com
33605>>>>>    //  Description:    do not use at this time
33605>>>>>
33605>>>>>//    Procedure RemoveFromParent 
33605>>>>>//        Integer hoParser
33605>>>>>//        Get phoParser to hoParser
33605>>>>>//        Variant vJSONObject
33605>>>>>//        Get pvJSONObject to vJSONObject
33605>>>>>//        
33605>>>>>//        Send ComRemoveFromParent of hoParser vJSONObject
33605>>>>>//    End_Procedure
33605>>>>>
33605>>>>>    //  Procedure:      RemoveChild 
33605>>>>>    //  Author:         Michael Salzlechner
33605>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33605>>>>>    //  Web:            www.starzen.com
33605>>>>>    //  Description:    will remove the child item with the given property name
33605>>>>>
33605>>>>>    Procedure RemoveChild String propName
33607>>>>>        Integer hoParser
33607>>>>>        Get phoParser to hoParser
33608>>>>>        Variant vJSONObject
33608>>>>>        Get pvJSONObject to vJSONObject
33609>>>>>        
33609>>>>>        Send ComRemoveChild of hoParser vJSONObject propName
33610>>>>>    End_Procedure
33611>>>>>
33611>>>>>    //  Procedure:      RemoveAllChildren
33611>>>>>    //  Author:         Michael Salzlechner
33611>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33611>>>>>    //  Web:            www.starzen.com
33611>>>>>    //  Description:    removes all child objects from this object
33611>>>>>
33611>>>>>    Procedure RemoveAllChildren
33613>>>>>        Integer hoParser
33613>>>>>        Get phoParser to hoParser
33614>>>>>        Variant vJSONObject
33614>>>>>        Get pvJSONObject to vJSONObject
33615>>>>>        
33615>>>>>        Send ComRemoveAllChildren of hoParser vJSONObject 
33616>>>>>    End_Procedure
33617>>>>>
33617>>>>>    //  Function:       SelectToken
33617>>>>>    //  Author:         Michael Salzlechner
33617>>>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33617>>>>>    //  Web:            www.starzen.com
33617>>>>>    //  Description:    uses JPath queries to select tokens 
33617>>>>>    //                  returns an array of dynamic JSON objects that need to be destroyed
33617>>>>>    
33617>>>>>    Function SelectTokens String sPath Returns Integer[]
33619>>>>>        Integer hoParser
33619>>>>>        Get phoParser to hoParser
33620>>>>>        Variant vJSONObject
33620>>>>>        Get pvJSONObject to vJSONObject
33621>>>>>
33621>>>>>        Variant[] vTokens
33622>>>>>        Get ComSelectTokens of hoParser vJSONObject sPath to vTokens
33623>>>>>        Integer iLoop iCount
33623>>>>>        Move (SizeOfArray(vTokens)-1) to iCount
33624>>>>>        
33624>>>>>        Integer[] jsonObjs
33625>>>>>        For iLoop from 0 to iCount
33631>>>>>>
33631>>>>>            If (not(IsNullComObject(vTokens[iLoop]))) Begin
33633>>>>>                Get Create (RefClass(cszJSONObject)) to jsonObjs[iLoop]
33634>>>>>                Set pvJSONObject of jsonObjs[iLoop] to vTokens[iLoop]
33635>>>>>                Set phoParser of jsonObjs[iLoop] to hoParser                
33636>>>>>            End
33636>>>>>>
33636>>>>>            Else Move 0 to jsonObjs[iLoop]
33638>>>>>        Loop
33639>>>>>>
33639>>>>>        Function_Return jsonObjs
33640>>>>>    End_Function
33641>>>>>    
33641>>>>>    Procedure End_Construct_Object
33643>>>>>        Forward Send End_Construct_Object
33645>>>>>
33645>>>>>    End_Procedure
33646>>>>>
33646>>>>>
33646>>>>>End_Class
33647>>>
33647>>>//  Class:          cszJSONParser
33647>>>//  Author:         Michael Salzlechner
33647>>>//  Copyright:      2016 StarZen Technologies, Inc.
33647>>>//  Web:            www.starzen.com
33647>>>//  Description:
33647>>>
33647>>>Class cszJSONParser is a cComcszJSONParser
33648>>>    
33648>>>    Procedure Construct_Object
33650>>>        Forward Send Construct_Object
33652>>>
33652>>>    End_Procedure
33653>>>
33653>>>    //  Function:       DeserializeString
33653>>>    //  Author:         Michael Salzlechner
33653>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33653>>>    //  Web:            www.starzen.com
33653>>>    //  Description:    deserializes a string into a JSON object
33653>>>    //                  on success this function will create and return a dynamic JSON object that needs to be destroyed
33653>>>    //                  on failure the return value is 0
33653>>>    
33653>>>    Function DeserializeString String sJSON Returns Integer
33655>>>        Variant vJSONObj
33655>>>        
33655>>>        Get ComDeserializeString sJSON to vJSONObj
33656>>>        
33656>>>        If (not(IsNullComObject(vJSONObj))) Begin
33658>>>            Integer hoJSON
33658>>>            Get Create (RefClass(cszJSONObject)) to hoJSON
33659>>>            Set pvJSONObject of hoJSON to vJSONObj
33660>>>            Set phoParser of hoJSON to (Self)
33661>>>            Function_Return hoJSON
33662>>>        End
33662>>>>
33662>>>        Else Function_Return 0
33664>>>    End_Function
33665>>>        
33665>>>    //  Function:       NewJSONObject
33665>>>    //  Author:         Michael Salzlechner
33665>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33665>>>    //  Web:            www.starzen.com
33665>>>    //  Description:    creates a new empty JSON object
33665>>>    //                  on success this function will create and return a dynamic JSON object that needs to be destroyed
33665>>>    //                  on failure the return value is 0
33665>>>    
33665>>>    Function NewJSONObject Returns Integer
33667>>>        Variant vJSONObj 
33667>>>        Get ComNewJSONObject to vJSONObj
33668>>>        If (not(IsNullComObject(vJSONObj))) Begin
33670>>>            Integer hoJSON
33670>>>            Get Create (RefClass(cszJSONObject)) to hoJSON
33671>>>            Set pvJSONObject of hoJSON to vJSONObj
33672>>>            Set phoParser of hoJSON to (Self)
33673>>>            Function_Return hoJSON
33674>>>        End
33674>>>>
33674>>>        Function_Return 0
33675>>>    End_Function
33676>>>
33676>>>    //  Function:       NewJSONArray
33676>>>    //  Author:         Michael Salzlechner
33676>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33676>>>    //  Web:            www.starzen.com
33676>>>    //  Description:    creates a new empty JSON Array
33676>>>    //                  on success this function will create and return a dynamic JSON object that needs to be destroyed
33676>>>    //                  on failure the return value is 0
33676>>>    
33676>>>    Function NewJSONArray Returns Integer
33678>>>        Variant vJSONArr
33678>>>        Get ComNewJSONArray to vJSONArr
33679>>>        If (not(IsNullComObject(vJSONArr))) Begin
33681>>>            Integer hoJSON
33681>>>            Get Create (RefClass(cszJSONObject)) to hoJSON
33682>>>            Set pvJSONObject of hoJSON to vJSONArr
33683>>>            Set phoParser of hoJSON to (Self)
33684>>>            Function_Return hoJSON
33685>>>        End
33685>>>>
33685>>>        Function_Return 0
33686>>>    End_Function
33687>>>
33687>>>    //  Function:       XMLToJSON
33687>>>    //  Author:         Michael Salzlechner
33687>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33687>>>    //  Web:            www.starzen.com
33687>>>    //  Description:    converts an XML string to a JSON string
33687>>>    //                  on success this function will return string
33687>>>    //                  on failure the return value is ""
33687>>>    
33687>>>    Function XMLToJSON String sXML Returns String
33689>>>        String sJSON
33689>>>        Get ComXMLToJSON sXML to sJSON
33690>>>        Function_Return sJSON
33691>>>    End_Function
33692>>>
33692>>>    //  Function:       JSONToXML
33692>>>    //  Author:         Michael Salzlechner
33692>>>    //  Copyright:      2016 StarZen Technologies, Inc.
33692>>>    //  Web:            www.starzen.com
33692>>>    //  Description:    converts a JSON string to an XML string
33692>>>    //                  on success this function will return string
33692>>>    //                  on failure the return value is ""
33692>>>    
33692>>>    Function JSONToXML String sJSON Returns String
33694>>>        String sXML
33694>>>        Get ComJSONToXML sJSON to sXML
33695>>>        Function_Return sXML
33696>>>    End_Function
33697>>>    
33697>>>    Procedure End_Construct_Object
33699>>>        Forward Send End_Construct_Object
33701>>>
33701>>>    End_Procedure
33702>>>
33702>>>End_Class
33703>>>
33703>>>Object oParser is a cszJSONParser
33705>>>End_Object //oParser
33706>    Use cszJSONObject.pkg
33706>
33706>    Use ..\..\WVDF_WS\AppSrc\SessionManager.wo
Including file: ..\..\WVDF_WS\AppSrc\SessionManager.wo    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\..\..\WVDF_WS\AppSrc\SessionManager.wo)
33706>>>//-2WA
33706>>>Use cWebSessionManager2WA.pkg
Including file: cWebSessionManager2WA.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\cWebSessionManager2WA.pkg)
33706>>>>>//-2WA
33706>>>>>Use cWebSessionManager.pkg
33706>>>>>Use CSAG300.DD
33706>>>>>Use CSAG311.DD
Including file: CSAG311.DD    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG311.DD)
33706>>>>>>>//-2WA
33706>>>>>>>// Class Name: Csag311_DataDictionary
33706>>>>>>>// Revision  : 28
33706>>>>>>>// Version   : 2
33706>>>>>>>//-2WA
33706>>>>>>>Use  Windows.pkg           // Basic Definitions
33706>>>>>>>Use  CtrlData.PKG          // DataDictionary Class Definition
33706>>>>>>>Use  Ddvaltbl.pkg          // Validation Table Class Definitions
33706>>>>>>>
33706>>>>>>>Open CSAG311
33708>>>>>>>Open CSAG300
33710>>>>>>>
33710>>>>>>>
33710>>>>>>>Class Csag311_DataDictionary  is a c_DataDictionary
33711>>>>>>>
33711>>>>>>>    // Define_Fields:
33711>>>>>>>    // This procedure is used to set up all data-dictionary rules.
33711>>>>>>>
33711>>>>>>>    Procedure Construct_Object
33713>>>>>>>        Forward Send Construct_Object
33715>>>>>>>
33715>>>>>>>
33715>>>>>>>        Set Main_File To Csag311.File_Number
33716>>>>>>>
33716>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
33717>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
33718>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
33719>>>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
33720>>>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
33721>>>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
33722>>>>>>>
33722>>>>>>>        // Field-based properties.......................
33722>>>>>>>
33722>>>>>>>        Set Field_Label_Long Field Csag311.Usuariosessao To "Sessao"
33723>>>>>>>        Set Field_Option Field Csag311.Usuariosessao DD_CAPSLOCK to True
33724>>>>>>>
33724>>>>>>>        Set Field_Label_Long Field Csag311.Usuarioecodigo to "CODIGO"
33725>>>>>>>        Set Field_Option Field Csag311.Usuarioecodigo DD_CAPSLOCK to True
33726>>>>>>>
33726>>>>>>>        Set Field_Label_Long Field Csag311.Usuarioempresa To "Empresa"
33727>>>>>>>        Set Field_Option Field Csag311.Usuarioempresa DD_CAPSLOCK to True
33728>>>>>>>
33728>>>>>>>        Set Field_Label_Long Field Csag311.Usuarionumero To "ID"
33729>>>>>>>
33729>>>>>>>        Set Field_Label_Long Field Csag311.Usuarionome To "Nome"
33730>>>>>>>        Set Field_Option Field Csag311.Usuarionome DD_CAPSLOCK to True
33731>>>>>>>
33731>>>>>>>        Set Field_Label_Long Field Csag311.Usuarioemail To "E-Mail"
33732>>>>>>>
33732>>>>>>>        Set Field_Label_Long Field Csag311.Usuariosenha To "Senha"
33733>>>>>>>        Set Field_Option Field Csag311.Usuariosenha DD_CAPSLOCK to True
33734>>>>>>>
33734>>>>>>>        Set Field_Label_Long Field Csag311.Usuarioip To "IP.Servidor"
33735>>>>>>>
33735>>>>>>>        Set Field_Label_Long Field Csag311.Data To "Data"
33736>>>>>>>
33736>>>>>>>        Set Field_Label_Long Field Csag311.Horario To "Horario"
33737>>>>>>>
33737>>>>>>>    End_Procedure    // Construct_Object
33738>>>>>>>
33738>>>>>>>
33738>>>>>>>    Procedure End_Construct_Object
33740>>>>>>>        Forward Send End_Construct_Object
33742>>>>>>>
33742>>>>>>>        //REMOVE EXTERNAL FILE
33742>>>>>>>        Send Remove_System_File LOGDATA.FILE_NUMBER
33743>>>>>>>        Send Remove_System_File LOGTEXT.FILE_NUMBER
33744>>>>>>>    End_Procedure
33745>>>>>>>
33745>>>>>>>    //Procedure Creating
33745>>>>>>>    //    DateTime dtCurrentDateTime
33745>>>>>>>    //    
33745>>>>>>>    //    Forward Send Creating
33745>>>>>>>    //    
33745>>>>>>>    //    //  Init usecounter
33745>>>>>>>    //    Move 0 to WebAppSession.UseCount
33745>>>>>>>    //    
33745>>>>>>>    //    //  Set the creation and access time to the current time
33745>>>>>>>    //    Move (CurrentDateTime()) to dtCurrentDateTime
33745>>>>>>>    //
33745>>>>>>>    //    Get TimeToString dtCurrentDateTime to CSAG311.DATA
33745>>>>>>>    //    Get TimeToString dtCurrentDateTime to CSAG311.HORARIO
33745>>>>>>>    //    
33745>>>>>>>    //    Move dtCurrentDateTime to CSAG311.DATA
33745>>>>>>>    //    Move dtCurrentDateTime to WebAppSession.LastAccessDate
33745>>>>>>>    //End_Procedure
33745>>>>>>>
33745>>>>>>>    //
33745>>>>>>>    //  Converts the given time to an string that can be saved in the database.
33745>>>>>>>    //
33745>>>>>>>    //  Params:
33745>>>>>>>    //      dtTime  Time to convert
33745>>>>>>>    //  Returns:
33745>>>>>>>    //      String with "HH:MM:SS" format
33745>>>>>>>    //
33745>>>>>>>    Function TimeToString DateTime dtTime Returns String
33747>>>>>>>        String sHours sMinutes sSeconds
33747>>>>>>>        
33747>>>>>>>        //  Extract parts
33747>>>>>>>        Move (String(DateGetHour(dtTime))) to sHours
33748>>>>>>>        Move (String(DateGetMinute(dtTime))) to sMinutes
33749>>>>>>>        Move (String(DateGetSecond(dtTime))) to sSeconds
33750>>>>>>>        
33750>>>>>>>        //  Fill out with 0
33750>>>>>>>        If (Length(sHours) = 1) Move ("0" + sHours) to sHours
33753>>>>>>>        If (Length(sMinutes) = 1) Move ("0" + sMinutes) to sMinutes
33756>>>>>>>        If (Length(sSeconds) = 1) Move ("0" + sSeconds) to sSeconds
33759>>>>>>>        
33759>>>>>>>        Function_Return (sHours + ":" + sMinutes + ":" + sSeconds)
33760>>>>>>>    End_Function
33761>>>>>>>    
33761>>>>>>>    //
33761>>>>>>>    //  Sets the time of the datetime variable to the time in the string.
33761>>>>>>>    //
33761>>>>>>>    //  Params:
33761>>>>>>>    //      dtTime  Datetime variable to add time to
33761>>>>>>>    //      sTimeString String with time in the format "HH:MM:SS"
33761>>>>>>>    //  Returns:
33761>>>>>>>    //      dtDateTime with the loaded time
33761>>>>>>>    //
33761>>>>>>>    Function StringToTime DateTime dtTime String sTimeString Returns DateTime
33763>>>>>>>        String sHours sMinutes sSeconds
33763>>>>>>>        
33763>>>>>>>        //  Extract parts
33763>>>>>>>        Move (Mid(sTimeString, 2, 1)) to sHours
33764>>>>>>>        Move (Mid(sTimeString, 2, 4)) to sMinutes
33765>>>>>>>        Move (Mid(sTimeString, 2, 7)) to sSeconds
33766>>>>>>>        
33766>>>>>>>        //  Set to DateTime
33766>>>>>>>        Move (DateSetHour(dtTime, (Integer(sHours)))) to dtTime
33767>>>>>>>        Move (DateSetMinute(dtTime, (Integer(sMinutes)))) to dtTime
33768>>>>>>>        Move (DateSetSecond(dtTime, (Integer(sSeconds)))) to dtTime
33769>>>>>>>        
33769>>>>>>>        Function_Return dtTime
33770>>>>>>>    End_Function
33771>>>>>>>
33771>>>>>>>    // Field_Defaults:
33771>>>>>>>    // This procedure is used to establish default field values.
33771>>>>>>>
33771>>>>>>>    Procedure Field_Defaults
33773>>>>>>>        Forward Send Field_Defaults
33775>>>>>>>    End_Procedure    // Field_Defaults
33776>>>>>>>
33776>>>>>>>End_Class    // Csag311_DataDictionary
33777>>>>>>>
33777>>>>>
33777>>>>>Class cWebSessionManager2WA is a cWebSessionManager
33778>>>>>    
33778>>>>>    Procedure Construct_Object
33780>>>>>        Handle hoUserDD hoSessionDD
33780>>>>>        
33780>>>>>        Forward Send Construct_Object
33782>>>>>        
33782>>>>>        Property Handle phoUserDD 0      // Handle to the WebAppUser DDO
33783>>>>>        Property Handle phoSessionDD 0   // Handle to the WebAppSession DDO        
33784>>>>>        
33784>>>>>        Get Create (RefClass(Csag300_DataDictionary)) to hoUserDD
33785>>>>>        Get Create (RefClass(Csag311_DataDictionary)) to hoSessionDD
33786>>>>>        //Set DDO_Server of hoSessionDD to hoUserDD
33786>>>>>        
33786>>>>>        Set phoUserDD to hoUserDD
33787>>>>>        Set phoSessionDD to hoSessionDD
33788>>>>>        Property Boolean pbCreatingNewSession False
33789>>>>>        Property Integer piSessionTimeout 480        
33790>>>>>        Property String  psLoginName
33791>>>>>        Property String  psUserName ""
33792>>>>>        Property Integer piUserRights 0
33793>>>>>    End_Procedure //Construct_Object
33794>>>>>    
33794>>>>>    Function CreateSession String sRemoteAddress String sFingerPrint Returns String
33796>>>>>        String sSessionKey
33796>>>>>        Integer iErr
33796>>>>>        Boolean bLogWebSession
33796>>>>>        Handle hoSessionDD       
33796>>>>>        Get phoSessionDD to hoSessionDD
33797>>>>>        
33797>>>>>        //  Get session key
33797>>>>>        Forward Get CreateSession sRemoteAddress to sSessionKey
33799>>>>>        
33799>>>>>        Get pbLogWebSession to bLogWebSession
33800>>>>>        If (not(bLogWebSession)) Begin
33802>>>>>            Function_Return sSessionKey        
33803>>>>>        End
33803>>>>>>
33803>>>>>
33803>>>>>        Date dlToday dDtLastRun
33803>>>>>        String slHH slMM sHrLastRun slTime
33803>>>>>        Integer idTime
33803>>>>>        Sysdate dlToday slHH slMM
33806>>>>>    
33806>>>>>        If (Integer(slMM)<10) Move (Insert('0', slMM, 1)) to slMM
33809>>>>>        If (Integer(slHH)<10) Move (Insert('0', slHH, 1)) to slHH
33812>>>>>    
33812>>>>>        Move (slHH + slMM) to slTime
33813>>>>>    
33813>>>>>        Move dlToday           to dDtLastRun
33814>>>>>        Move (slHH +':'+ slMM) to sHrLastRun
33815>>>>>    
33815>>>>>        //- WE NEED AN INTEGER TO REPRESENT THE TIME OF DAY TO ELIMINATE CROSS MIDNIGHT PROBLEMS.
33815>>>>>        //  WE CREATED A SINGLE INTEGER FROM THE DATE, HOUR AND MINUTES THAT DOES NOT HAVE TO GO
33815>>>>>        //  BACK TO 0 AT THE BEGINNING OF THE DAY OR HOUR.
33815>>>>>        Move (Integer(dlToday)*1440 + (Integer(slHH)*60) + Integer(slMM)) to idTime
33816>>>>>
33816>>>>>        //  Store session
33816>>>>>        Send Clear of hoSessionDD
33817>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOSESSAO  to sSessionKey
33818>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOIP      to sRemoteAddress
33819>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOECODIGO to CSAG300.USUARIOECODIGO
33820>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOEMAIL   to CSAG300.USUARIOEMAIL
33821>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOEMPRESA to CSAG300.USUARIOEMPRESA
33822>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIONOME    to CSAG300.USUARIONOME
33823>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.USUARIOSENHA   to CSAG300.USUARIOSENHA
33824>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.ACTIVE         to "Y"
33825>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.FINGERPRINT    to sFingerPrint
33826>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTRUN        to idTime
33827>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTACCESSDATE to dDtLastRun
33828>>>>>        Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTACCESSTIME to sHrLastRun
33829>>>>>        
33829>>>>>        Get Request_Validate of hoSessionDD to iErr
33830>>>>>        If (iErr) Begin
33832>>>>>            // this should not happen. If it does its a programming error
33832>>>>>            Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
33833>>>>>>
33833>>>>>            Function_Return ""
33834>>>>>        End
33834>>>>>>
33834>>>>>        Send Request_Save of hoSessionDD
33835>>>>>       
33835>>>>>        Function_Return sSessionKey        
33836>>>>>    End_Function //CreateSession
33837>>>>>    
33837>>>>>    
33837>>>>>    Function ValidateSession String sSessionKey Returns Boolean
33839>>>>>        DateTime dtLastAccess dtCurrent
33839>>>>>        TimeSpan tsDiff
33839>>>>>        Integer iErr iSessionTimeout iSpanMinutes
33839>>>>>        Boolean bResult bCreatingNewSession
33839>>>>>        Boolean bLogWebSession 
33839>>>>>        Integer eLoginMode
33839>>>>>        String sTime
33839>>>>>        Handle hoSessionDD hoUserDD       
33839>>>>>        
33839>>>>>        Get phoSessionDD to hoSessionDD
33840>>>>>        Get phoUserDD to hoUserDD
33841>>>>>        
33841>>>>>        Get pbLogWebSession to bLogWebSession
33842>>>>>        Get peLoginMode to eLoginMode
33843>>>>>        
33843>>>>>        // for this object, you can only disable logging if login completely is disabled
33843>>>>>        If (not(bLogWebSession) and (eLoginMode<>lmLoginNone)) Begin
33845>>>>>            Error DFERR_PROGRAM C_$WebSessionLoggingMustBeEnabled
33846>>>>>>
33846>>>>>            Function_Return False
33847>>>>>        End
33847>>>>>>
33847>>>>>
33847>>>>>        //  Clear session properties
33847>>>>>        Set psUsername to ""
33848>>>>>        Set psLoginName to ""
33849>>>>>        Set piUserrights to 0
33850>>>>>        
33850>>>>>        If not bLogWebSession Begin
33852>>>>>            Forward Get ValidateSession sSessionKey to bResult
33854>>>>>            Function_Return bResult
33855>>>>>        End        
33855>>>>>>
33855>>>>>        
33855>>>>>        Move False to bResult
33856>>>>>        Get piSessionTimeout to iSessionTimeout 
33857>>>>>        
33857>>>>>        //  Check if session exists
33857>>>>>        Send Clear of hoSessionDD
33858>>>>>        Move sSessionKey to CSAG311.USUARIOSESSAO
33859>>>>>        Send Find of hoSessionDD EQ 1
33860>>>>>        If (Found) Begin
33862>>>>>            //  Calculate timespan between now and last access time
33862>>>>>            Move (CurrentDateTime()) to dtCurrent
33863>>>>>            Move CSAG311.LASTACCESSDATE to dtLastAccess
33864>>>>>            Get StringToTime of hoSessionDD dtLastAccess CSAG311.LASTACCESSTIME to dtLastAccess
33865>>>>>            Move (dtCurrent - dtLastAccess) to tsDiff
33866>>>>>            Move (SpanTotalMinutes(tsDiff)) to iSpanMinutes
33867>>>>>            
33867>>>>>            //  Check if session didn't time out
33867>>>>>            If ((iSessionTimeout <= 0 or (iSpanMinutes < iSessionTimeout)) and CSAG311.ACTIVE = "Y") Begin
33869>>>>>                Forward Get ValidateSession sSessionKey to bResult
33871>>>>>                   
33871>>>>>                If (bResult) Begin
33873>>>>>                    //  Update session record
33873>>>>>                    Get TimeToString of hoSessionDD dtCurrent to sTime 
33874>>>>>                    Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTACCESSDATE to dtCurrent
33875>>>>>                    Set Field_Changed_Value of hoSessionDD Field CSAG311.LASTACCESSTIME to sTime
33876>>>>>                    Set Field_Changed_Value of hoSessionDD Field CSAG311.USECOUNT to (CSAG311.USECOUNT + 1)
33877>>>>>                    Get Request_Validate of hoSessionDD to iErr
33878>>>>>                    If (iErr) Begin
33880>>>>>                        // this should not happen. If it does its a programming error
33880>>>>>                        Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
33881>>>>>>
33881>>>>>                        Function_Return False
33882>>>>>                    End
33882>>>>>>
33882>>>>>                    Send Request_Save of hoSessionDD
33883>>>>>                    
33883>>>>>                    //  Update user properties
33883>>>>>                    If (HasRecord(hoUserDD)) Begin
33885>>>>>                        Set psUsername to (Rtrim(CSAG300.USUARIONOME))
33886>>>>>                        Set psLoginName to (Rtrim(CSAG300.USUARIOEMAIL))
33887>>>>>                        Set piUserRights to (Rtrim(CSAG300.USUARIOCLASSE))
33888>>>>>                    End
33888>>>>>>
33888>>>>>                End
33888>>>>>>
33888>>>>>            End
33888>>>>>>
33888>>>>>            Else Begin
33889>>>>>                // Test the Creating New Session Flag to protect against infinite recursion....
33889>>>>>                Get pbCreatingNewSession to bCreatingNewSession
33890>>>>>                
33890>>>>>                If (not(bCreatingNewSession)) Begin
33892>>>>>                    Set pbCreatingNewSession to True                    
33893>>>>>                    Send RecreateSession to ghoWebApp
33894>>>>>                    Error 950 "Your application session has timed out or is inactive, please login again."
33895>>>>>>
33895>>>>>                    Send NavigateRefresh of ghoWebApp          // refresh the WebApp at the client (triggers a login)
33896>>>>>                    Set pbCreatingNewSession to False
33897>>>>>                End
33897>>>>>>
33897>>>>>            End
33897>>>>>>
33897>>>>>        End
33897>>>>>>
33897>>>>>        Else Begin
33898>>>>>            Error 951 "Session key not known (reload page to recreate session)"
33899>>>>>>
33899>>>>>        End
33899>>>>>>
33899>>>>>        
33899>>>>>        Function_Return bResult
33900>>>>>    End_Function //ValidateSession
33901>>>>>    
33901>>>>>    Function UserLogin String sLoginName String sPassword Returns Boolean
33903>>>>>        String sSessionKey sUserPassword
33903>>>>>        Handle hoSessionDD hoUserDD       
33903>>>>>        DateTime dtCurrentDateTime
33903>>>>>        String sCurrentTime
33903>>>>>        
33903>>>>>        Get phoSessionDD to hoSessionDD
33904>>>>>        Get phoUserDD to hoUserDD
33905>>>>>        Integer iErr eLoginMode
33905>>>>>        
33905>>>>>        // Refind session record
33905>>>>>        Get psSessionKey to sSessionKey
33906>>>>>        Send Clear of hoSessionDD
33907>>>>>        Move sSessionKey to CSAG311.USUARIOSESSAO
33908>>>>>        Send Find of hoSessionDD EQ 1
33909>>>>>        
33909>>>>>        If (Found and CSAG311.USUARIOSESSAO = sSessionKey) Begin
33911>>>>>            Get peLoginMode to eLoginMode
33912>>>>>            
33912>>>>>            // if login is not required, we will allow for a blank name and password, which gives you access to whatever
33912>>>>>            // your have access to with not being logged in. We consider this to be a success, even if you are not logged in.
33912>>>>>            If (eLoginMode <> lmLoginRequired and Trim(sLoginName) = "" and Trim(sPassword) = "") Begin
33914>>>>>                Set psUsername to ""
33915>>>>>                Set psLoginName to ""
33916>>>>>                Set piUserrights to 0
33917>>>>>                Send NotifyChangeRights
33918>>>>>                Function_Return True
33919>>>>>            End
33919>>>>>>
33919>>>>>            
33919>>>>>            //  Find the user
33919>>>>>            Move sLoginName to CSAG300.USUARIOEMAIL
33920>>>>>            Send Find of hoUserDD EQ 7
33921>>>>>            
33921>>>>>            // Check username and password
33921>>>>>            Get Field_Current_Value of hoUserDD Field CSAG300.USUARIOSENHA to sUserPassword
33922>>>>>            
33922>>>>>            If (Found and (Lowercase(sLoginName) = Lowercase(Trim(CSAG300.USUARIOEMAIL))) and Trim(sUserPassword) = Trim(sPassword)) Begin
33924>>>>>                // Store the login
33924>>>>>                Move (CurrentDateTime()) to dtCurrentDateTime
33925>>>>>                Get TimeToString of hoSessionDD dtCurrentDateTime to sCurrentTime
33926>>>>>                Set Field_Changed_Value of hoUserDD Field CSAG300.DTAULTLOGIN to dtCurrentDateTime
33927>>>>>                Set Field_Changed_Value of hoUserDD Field CSAG300.HORULTLOGIN to sCurrentTime
33928>>>>>                Get Request_Validate of hoSessionDD to iErr
33929>>>>>                If (iErr) Begin
33931>>>>>                    // this should not happen. If it does its a programming error
33931>>>>>                    Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
33932>>>>>>
33932>>>>>                    Function_Return False
33933>>>>>                End
33933>>>>>>
33933>>>>>                
33933>>>>>                Set Field_Changed_Value of hoSessionDD Field CSAG311.DATA    to dtCurrentDateTime
33934>>>>>                Set Field_Changed_Value of hoSessionDD Field CSAG311.HORARIO to sCurrentTime
33935>>>>>                Send Request_Save of hoSessionDD
33936>>>>>                
33936>>>>>                // Update session properties
33936>>>>>                Set psUsername to (Rtrim(CSAG300.USUARIONOME))
33937>>>>>                Set psLoginName to (Rtrim(CSAG300.USUARIOEMAIL))
33938>>>>>                Set piUserrights to (Rtrim(CSAG300.USUARIOCLASSE))
33939>>>>>                Send NotifyChangeRights
33940>>>>>                Function_Return True
33941>>>>>            End
33941>>>>>>
33941>>>>>        End
33941>>>>>>
33941>>>>>          
33941>>>>>        Function_Return False
33942>>>>>    End_Function //UserLogin
33943>>>>>    
33943>>>>>    Function IsLoggedIn Returns Boolean
33945>>>>>        String sLoginName
33945>>>>>        Boolean bLogWebSession bLoggedIn
33945>>>>>        
33945>>>>>        Get pbLogWebSession to bLogWebSession
33946>>>>>        If not bLogWebSession Begin
33948>>>>>            Forward Get IsLoggedIn to bLoggedIn
33950>>>>>            Function_Return bLoggedIn
33951>>>>>        End
33951>>>>>>
33951>>>>>        
33951>>>>>        Get psLoginName to sLoginName
33952>>>>>        
33952>>>>>        Function_Return (sLoginName <> "")
33953>>>>>    End_Function //IsLoggedIn
33954>>>>>    
33954>>>>>    
33954>>>>>    Procedure EndSession
33956>>>>>        Integer iErr
33956>>>>>        Boolean bLogWebSession
33956>>>>>        Handle hoSessionDD       
33956>>>>>        
33956>>>>>        Get phoSessionDD to hoSessionDD
33957>>>>>        Get pbLogWebSession to bLogWebSession
33958>>>>>        If not bLogWebSession Begin
33960>>>>>            Forward Send EndSession
33962>>>>>            Procedure_Return
33963>>>>>        End
33963>>>>>>
33963>>>>>            
33963>>>>>        //  Check if session exists
33963>>>>>        Send Clear of hoSessionDD
33964>>>>>        Get psSessionKey to CSAG311.USUARIOSESSAO
33965>>>>>        Send Find of hoSessionDD EQ 1
33966>>>>>        If (Found) Begin
33968>>>>>            Set Field_Changed_Value of hoSessionDD Field CSAG311.ACTIVE to "N"
33969>>>>>            Get Request_Validate of hoSessionDD to iErr
33970>>>>>            If (iErr) Begin
33972>>>>>                // this should not happen. If it does its a programming error
33972>>>>>                Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
33973>>>>>>
33973>>>>>                Procedure_Return
33974>>>>>            End
33974>>>>>>
33974>>>>>            Send Request_Save of hoSessionDD
33975>>>>>        End
33975>>>>>>
33975>>>>>    End_Procedure //EndSession
33976>>>>>
33976>>>>>End_Class //cWebSessionManager2WA
33977>>>>>
33977>>>Use cOneTimePassword.pkg
Including file: cOneTimePassword.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\cOneTimePassword.pkg)
33977>>>>>// File name  : cOneTimePassword.pkg                                          //
33977>>>>>// File title : One Time Password (OTP) generator                             //
33977>>>>>// Author(s)  : Ulbe Stellema, Eddy Kleinjan                                  //
33977>>>>>//                                                                            //
33977>>>>>// Confidential Trade Secret.                                                 //
33977>>>>>// Copyright 1999 Data Access Corporation, Miami FL, USA                      //
33977>>>>>// All Rights reserved                                                        //
33977>>>>>// DataFlex is a registered trademark of Data Access Corporation.             //
33977>>>>>//                                                                            //
33977>>>>>// This package implements 
33977>>>>>// - HOTP: an HMAC-Based One-Time Password Algorithm
33977>>>>>// - TOTP: Time-Based One-Time Password Algorithm
33977>>>>>// password RFC 6238 and RFC 4226
33977>>>>>// https://tools.ietf.org/html/rfc4226
33977>>>>>// https://tools.ietf.org/html/rfc6238
33977>>>>>//
33977>>>>>// Example:
33977>>>>>//    Object oOneTimePassword is a cOneTimePassword
33977>>>>>//    End_Object
33977>>>>>//    
33977>>>>>//    Function GetTOTP Returns String
33977>>>>>//        Integer iOtp
33977>>>>>//        Get TOTP of oOneTimePassword "12345678901234567890" to iOtp
33977>>>>>//    End_Procedure
33977>>>>>//    
33977>>>>>//    
33977>>>>>//
33977>>>>>// $Rev History                                                               //
33977>>>>>//                                                                            //
33977>>>>>// US 2015-11-27 Initial version                                              //
33977>>>>>// EK 2015-11-27 Integrated                                                   //
33977>>>>>//****************************************************************************//
33977>>>>>
33977>>>>>Use UI
33977>>>>>
33977>>>>>Define otpDecodeNone     for 0
33977>>>>>Define otpDecodeBase16   for 1
33977>>>>>Define otpDecodeBase32   for 2
33977>>>>>Define otpDecodeBase64   for 3
33977>>>>>
33977>>>>>Define otpHmacSha1       for 160
33977>>>>>Define otpHmacSha256     for 256
33977>>>>>Define otpHmacSha512     for 512
33977>>>>>
33977>>>>>//OATH_API LPCSTR Base16Encode(LPCSTR sString)
33977>>>>>External_Function otpBase16Encode "Base16Encode" oath.dll ;    Pointer sString ;    Integer iLength ;    Returns Address
33978>>>>>
33978>>>>>//OATH_API LPCSTR Base32Encode(LPCSTR sString)
33978>>>>>External_Function otpBase32Encode "Base32Encode" oath.dll ;    Pointer sString ;    Integer iLength ;    Returns Address
33979>>>>>
33979>>>>>// OATH_API int HOTP(LPCSTR sSecret, int decodetype, int bitcount, int counter)
33979>>>>>External_Function HOTP "HOTP" oath.dll ;    Pointer sSecret ;    Integer iDecodeType ;    Integer iDigitCount ;    Pointer iCounter ;    Returns Integer
33980>>>>>//-2WA
33980>>>>>// OATH_API int TOTP(LPCSTR sSecret, int decodetype, int bitcount, int hmactype, int epoch, int Time, int step)
33980>>>>>External_Function TOTP "TOTP" oath.dll ;    Pointer sSecret ;    Integer iDecodeType ;    Integer iDigitCount ;    Integer iHMACType ;    Pointer iEpoch ;    Pointer iTime ;    Pointer iStep ;    Returns Integer
33981>>>>>
33981>>>>>Class cOneTimePassword is a cObject
33982>>>>>    
33982>>>>>    Procedure Construct_Object
33984>>>>>        Forward Send Construct_Object
33986>>>>>        Property Integer piSecretCodeType otpDecodeNone // Default None; options otpDecodeBase16, otpDecodeBase32 or otpDecodeBase64
33987>>>>>        Property Integer piDigitCount 6                 // Default = 6 bit; options 6, 7 or 8
33988>>>>>        Property BigInt  piCounter  0                   // Default = 0
33989>>>>>        Property Integer piHmacType otpHmacSha1         // Default = otpHmacSha1; options otpHmacSha1, otpHmacSha256, otpHmacSha512
33990>>>>>        Property BigInt  piEpoch    0                   // Default = 0; options 0 or 1
33991>>>>>        Property BigInt  piTime     0                   // Default = 0 (now); otherwise number of seconds since unix time
33992>>>>>        // next 2 settings will define a 10-minute window
33992>>>>>        Property BigInt  piStep     60                  // Default = 30 sec; step size for factor
33993>>>>>        Property Integer piStepGraceCount 10             // Default = 2; Defines the maximum number of piSteps a code might fall outside the current time when validating
33994>>>>>    End_Procedure // Construct_Object                  
33995>>>>>    
33995>>>>>
33995>>>>>
33995>>>>>    // Function : HOTP
33995>>>>>    // Purpose  : HMAC-based One-time Password Algorithm
33995>>>>>    Function HOTP String sSecret Returns String
33997>>>>>        Integer iResult iDigitCount iType 
33997>>>>>        BigInt iCounter
33997>>>>>        Get piSecretCodeType to iType
33998>>>>>        Get piDigitCount to iDigitCount
33999>>>>>        Get piCounter to iCounter
34000>>>>>        Move (HOTP(AddressOf(sSecret),iType,iDigitCount,AddressOf(iCounter))) to iResult
34001>>>>>        Function_Return (Right("00000000" + String(iResult), iDigitCount))
34002>>>>>    End_Function // HOTP
34003>>>>>    
34003>>>>>
34003>>>>>
34003>>>>>    // Function : TOTP
34003>>>>>    // Purpose  : Time-based One-time Password Algorithm
34003>>>>>    Function TOTP String sSecret Returns String
34005>>>>>        Integer iType iResult iDigitCount iHMACType 
34005>>>>>        BigInt iEpoch iTime iStep
34005>>>>>        If (sSecret = "") Begin
34007>>>>>            Error 999 "TOTP: There is no secret!"
34008>>>>>>
34008>>>>>            Function_Return ""
34009>>>>>        End
34009>>>>>>
34009>>>>>        Get piSecretCodeType to iType
34010>>>>>        Get piDigitCount to iDigitCount
34011>>>>>        Get piHMACType to iHMACType
34012>>>>>        Get piEpoch to iEpoch
34013>>>>>        Get piTime to iTime
34014>>>>>        Get piStep to iStep
34015>>>>>        Move (TOTP(AddressOf(sSecret),iType,iDigitCount,iHMACType,AddressOf(iEpoch),AddressOf(iTime),AddressOf(iStep))) to iResult
34016>>>>>        Function_Return (Right("00000000" + String(iResult), iDigitCount))
34017>>>>>    End_Function // TOTP
34018>>>>>
34018>>>>>
34018>>>>>    // Function : Base16Encode
34018>>>>>    // Purpose  : Returns base16 encoded string
34018>>>>>    Function Base16Encode String sInput Returns String
34020>>>>>        String sResult
34020>>>>>        Address pResult
34020>>>>>        Boolean bOk
34020>>>>>        Move (otpBase16Encode(AddressOf(sInput),Length(sInput))) to pResult
34021>>>>>        Move pResult to sResult
34022>>>>>        Move (Free(pResult)) to bOk
34023>>>>>        Function_Return sResult
34024>>>>>    End_Function // Base16Encode
34025>>>>>
34025>>>>>    // Function : Base32Encode
34025>>>>>    // Purpose  : Returns base32 encoded string
34025>>>>>    Function Base32Encode String sInput Returns String
34027>>>>>        String sResult
34027>>>>>        Address pResult
34027>>>>>        Boolean bOk
34027>>>>>        Move (otpBase32Encode(AddressOf(sInput),Length(sInput))) to pResult
34028>>>>>        Move pResult to sResult
34029>>>>>        Move (Free(pResult)) to bOk
34030>>>>>        Function_Return sResult
34031>>>>>    End_Function // Base32Encode
34032>>>>>
34032>>>>>    // Function : IsValidOneTimePassword
34032>>>>>    // Purpose  : Validates the passed code based on the current time or time window
34032>>>>>    Function IsValidTimeBasedOneTimePassword String sSecret String sCode Returns Boolean
34034>>>>>        Boolean bIsValid
34034>>>>>        Integer iStep iCount iOldEpoch
34034>>>>>        String sCurrentCode
34034>>>>>        
34034>>>>>        Get piEpoch to iOldEpoch
34035>>>>>        Set piEpoch to 0 // Make sure it's 0 when starting
34036>>>>>        Get piStep to iStep
34037>>>>>        
34037>>>>>        // Get the current code
34037>>>>>        Get TOTP sSecret to sCurrentCode
34038>>>>>        If (sCode = sCurrentCode) Move True to bIsValid
34041>>>>>
34041>>>>>        // If not valid, try validating next and previous steps
34041>>>>>        While (not(bIsValid) and iCount < piStepGraceCount(Self))
34045>>>>>
34045>>>>>            // Try previous time window
34045>>>>>            Set piEpoch to (iStep * (iCount + 1))
34046>>>>>            Get TOTP sSecret to sCurrentCode
34047>>>>>            If (sCode = sCurrentCode) Begin
34049>>>>>                Move True to bIsValid
34050>>>>>            End
34050>>>>>>
34050>>>>>            Else Begin
34051>>>>>                // Try next time window
34051>>>>>                Set piEpoch to (iStep * (iCount + 1) * -1)
34052>>>>>                Get TOTP sSecret to sCurrentCode
34053>>>>>                If (sCode = sCurrentCode) Move True to bIsValid
34056>>>>>            End
34056>>>>>>
34056>>>>>
34056>>>>>            Increment iCount
34057>>>>>
34057>>>>>        Loop
34058>>>>>>
34058>>>>>        
34058>>>>>        // Reset piEpoch
34058>>>>>        Set piEpoch to iOldEpoch
34059>>>>>        
34059>>>>>        Function_Return bIsValid
34060>>>>>        
34060>>>>>    End_Function
34061>>>>>    
34061>>>>>    
34061>>>>>    // Function : RandomBase32Secret
34061>>>>>    // Purpose  : HMAC-based One-time Password Algorithm
34061>>>>>    Function otpRandomBase32Secret Integer iSecretCodeType Integer iHmacType Returns String
34063>>>>>        Integer i iLen iAlphabetLength
34063>>>>>        String sSecret sFiller sAlphabet
34063>>>>>        If (iSecretCodeType <> otpDecodeBase32) Begin
34065>>>>>            Error 999 "Only BASE32 is implemented at this time."
34066>>>>>>
34066>>>>>            Function_Return ""
34067>>>>>        End
34067>>>>>>
34067>>>>>        Move "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567" to sAlphabet
34068>>>>>        Move (Length(sAlphabet)) to iAlphabetLength
34069>>>>>        Case Begin
34069>>>>>            Case (iHmacType = otpHmacSha1) 
34071>>>>>                Move 32 to iLen
34072>>>>>                Move "" to sFiller
34073>>>>>                Case Break
34074>>>>>            Case (iHmacType = otpHmacSha256) 
34077>>>>>                Move 52 to iLen
34078>>>>>                Move "====" to sFiller
34079>>>>>                Case Break
34080>>>>>            Case (iHmacType = otpHmacSha512) 
34083>>>>>                Move 104 to iLen
34084>>>>>                Move "=" to sFiller
34085>>>>>                Case Break
34086>>>>>        Case End
34086>>>>>        For i from 1 to iLen
34092>>>>>>
34092>>>>>            Move (sSecret + Mid(sAlphabet, 1, Random(iAlphabetLength) + 1)) to sSecret
34093>>>>>        Loop
34094>>>>>>
34094>>>>>        Move (sSecret + sFiller) to sSecret
34095>>>>>        Function_Return sSecret
34096>>>>>    End_Function
34097>>>>>    
34097>>>>>    
34097>>>>>End_Class // cOATH
34098>>>>>
34098>>>
34098>>>Object oSessionManager is a cWebSessionManager
34100>>>    Object oOneTimePassword is a cOneTimePassword
34102>>>        Set piSecretCodeType to otpDecodeBase32
34103>>>    End_Object
34104>>>    
34104>>>End_Object //oSessionManager
34105>>>
34105>    Use WebServiceDispatcher.wo
34105>    Use ..\..\WVDF_WS\AppSrc\WebResourceManager.wo
Including file: ..\..\WVDF_WS\AppSrc\WebResourceManager.wo    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\..\..\WVDF_WS\AppSrc\WebResourceManager.wo)
34105>>>//-2WA
34105>>>Use cWebResourceManager.pkg
34105>>>
34105>>>Register_Object oWS_LOG3040
34105>>>
34105>>>Object oWebResourceManager is a cWebResourceManager
34107>>>    Function UpdloadDestinoProposta String aUsuarioSessao String aFingerprint String aPasta String aPropostaId Returns String
34110>>>        Declare_Datafile TSMG800
34110>>>        Declare_Datafile HCGS3004
Including file: HCGS3004.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HCGS3004.fd)
34110>>>        
34110>>>         String loadPath
34110>>>        Boolean bExist
34110>>>        
34110>>>        stDefaultMessage myMsg
34110>>>        stDefaultMessage myMsg
34110>>>
34110>>>        Get ValidarSessaoUsuario of ghoApplication aUsuarioSessao aFingerPrint to myMsg
34111>>>        If (myMsg.hasError) Function_Return ""
34114>>>        
34114>>>//        Clear HCGS3004
34114>>>//        Move aPropostaId to HCGS3004.PROPOSTA
34114>>>//        Find EQ HCGS3004 by 1
34114>>>//        If (not(Found)) Function_Return ""
34114>>>
34114>>>        Move (Rtrim(TSMG800.COPY_FOTOS))    to loadPath
34115>>>        
34115>>>        If (Right(loadPath, 1) <> "\") Move (loadPath + "\") to loadPath
34118>>>        
34118>>>        If (aPasta = '') Move (loadPath + "propostas")       to loadPath
34121>>>        Else Move (loadPath + aPasta) to loadPath
34123>>>        
34123>>>        
34123>>>        File_Exist loadPath bExist
34124>>>        If (not(bExist)) Begin
34126>>>            Make_Directory loadPath
34127>>>            File_Exist loadPath bExist
34128>>>            If (not(bExist)) Function_Return "[invalid folder]"
34131>>>        End
34131>>>>
34131>>>
34131>>>        Move (loadPath + "\" + aPropostaId) to loadPath
34132>>>        
34132>>>        File_Exist loadPath bExist
34133>>>        If (not(bExist)) Begin
34135>>>            Make_Directory loadPath
34136>>>            File_Exist loadPath bExist
34137>>>            If (not(bExist)) Function_Return "[invalid folder]"
34140>>>        End
34140>>>>
34140>>>        
34140>>>        Move (loadPath+"\") to loadPath
34141>>>        
34141>>>        Function_Return loadPath
34142>>>    End_Function //UpdloadDestinoProposta
34143>>>    Send RegisterInterface (RefFunc(UpdloadDestinoProposta)) "Get_UpdloadDestinoProposta" "String aUsuarioSessao String aFingerprint String aPropostaId String aPasta Returns String" ""
34144>>>
34144>>>    Function UpdloadDestino String aUsuarioSessao Returns String
34147>>>        Declare_Datafile TSMG800
34147>>>
34147>>>        Clear CSAG311
34148>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34149>>>        Find Eq CSAG311 by 1
34150>>>>
34150>>>        If (not(Found)) Function_Return ""
34153>>>        
34153>>>        Function_Return (Rtrim(TSMG800.COPY_FOTOS))
34154>>>    End_Function //UpdloadDestino
34155>>>    Send RegisterInterface (RefFunc(UpdloadDestino)) "Get_UpdloadDestino" "String aUsuarioSessao Returns String" ""
34156>>>
34156>>>    Function UploadFileFinished String aPath;                               Variant aFileName;                                String aUsuarioSessao;                                String aSize;                                Returns String
34159>>>                                
34159>>>        Declare_Datafile TSMG800
34159>>>        
34159>>>        String urlDownload
34159>>>        String sDados
34159>>>
34159>>>         Handle hoNJSON hoJSONObj
34159>>>        Get NewJSONObject of oParser to hoNJSON
34160>>>        Get NewJSONObject of oParser to hoJSONObj
34161>>>        If (hoNJSON = 0) Function_Return sDados
34164>>>        If (hoJSONObj = 0) Function_Return sDados
34167>>>
34167>>>        Set phoParser     of hoJSONObj  to oParser
34168>>>        Set phoParser     of hoNJSON    to oParser
34169>>>        
34169>>>        Clear CSAG311
34170>>>        Move aUsuarioSessao to CSAG311.USUARIOSESSAO
34171>>>        Find Eq CSAG311 by 1
34172>>>>
34172>>>        If (not(Found)) Begin
34174>>>            Send AddBoolean of hoJSONObj "hasError" True
34175>>>            Send AddString  of hoJSONObj "msgError" "INVALID SESSION"
34176>>>            Send AddString  of hoJSONObj "msgInfo" ""
34177>>>            //-
34177>>>            Send AddObject  of hoNJSON "msg"    hoJSONObj
34178>>>
34178>>>            Get Serialize   of hoNJSON to sDados
34179>>>        End
34179>>>>
34179>>>        
34179>>>        Move (Rtrim(TSMG800.HTTP_FOTOS)) to urlDownload
34180>>>        Move (Replaces('{aHTTP}', urlDownload, Rtrim(TSMG800.HTTP_SITE))) to urlDownload
34181>>>        
34181>>>        Send AddBoolean of hoJSONObj "hasError" False
34182>>>        Send AddString  of hoJSONObj "msgError" ""
34183>>>        Send AddString  of hoJSONObj "msgInfo" "!Completed!"
34184>>>        
34184>>>        Send AddObject  of hoNJSON "msg"    hoJSONObj
34185>>>        
34185>>>        Send AddInteger of hoNJSON "id"     1
34186>>>        Send AddString  of hoNJSON "value"  aFileName
34187>>>        Send AddString  of hoNJSON "url"    (urlDownload + aFileName)
34188>>>        Send AddString  of hoNJSON "size"   aSize
34189>>>        
34189>>>        Get Serialize     of hoNJSON to sDados
34190>>>        
34190>>>        Function_Return sDados
34191>>>        
34191>>>    End_Function //UploadFileFinished
34192>>>    Send RegisterInterface (RefFunc(UploadFileFinished)) "Get_UploadFileFinished" "String sPath Variant sFileName String aUsuarioSessao String aSize Returns String" ""
34193>>>    
34193>>>
34193>>>    Function UploadFileFinishedProposta String aPath;                                       Variant aFileName;                                        String aUsuarioSessao;                                        String aFingerPrint;                                        String aSize;                                        String aPropostaId;                                        String aTipoDocumento;                                        String aTabela;                                        Returns String
34196>>>        Declare_Datafile TSMG800
34196>>>        Declare_Datafile HCGS3004
34196>>>        Declare_Datafile CSAG336
Including file: CSAG336.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG336.fd)
34196>>>        
34196>>>        String aurlDownload
34196>>>        String sDados
34196>>>        String statusId
34196>>>        
34196>>>        String[] aLogFile
34197>>>        
34197>>>        stIdValueURL myFileList
34197>>>        stIdValueURL myFileList
34197>>>        stDefaultMessage myMsg
34197>>>        stDefaultMessage myMsg
34197>>>
34197>>>         Handle hoNJSON hoJSONObj
34197>>>        Get NewJSONObject of oParser to hoNJSON
34198>>>        Get NewJSONObject of oParser to hoJSONObj
34199>>>        If (hoNJSON = 0) Function_Return sDados
34202>>>        If (hoJSONObj = 0) Function_Return sDados
34205>>>
34205>>>        Set phoParser     of hoJSONObj  to oParser
34206>>>        Set phoParser     of hoNJSON    to oParser
34207>>>        
34207>>>        Get ValidarSessaoUsuario of ghoApplication aUsuarioSessao aFingerPrint to myMsg
34208>>>        If (myMsg.hasError) Begin
34210>>>            Send AddBoolean of hoJSONObj "hasError" myMsg.hasError
34211>>>            Send AddString  of hoJSONObj "msgError" myMsg.msgError
34212>>>            Send AddString  of hoJSONObj "msgInfo" ""
34213>>>            //-
34213>>>            Send AddObject  of hoNJSON "msg"    hoJSONObj
34214>>>
34214>>>            Get Serialize   of hoNJSON to sDados
34215>>>            
34215>>>            Function_Return sDados
34216>>>        End
34216>>>>
34216>>>
34216>>>//        Clear HCGS3004
34216>>>//        Move aPropostaId to HCGS3004.PROPOSTA
34216>>>//        Find EQ HCGS3004 by 1
34216>>>//        If (not(Found)) Begin
34216>>>//            Send AddBoolean of hoJSONObj "hasError" True
34216>>>//            Send AddString  of hoJSONObj "msgError" "PROPOSTA INVALIDA"
34216>>>//            Send AddString  of hoJSONObj "msgInfo" ""
34216>>>//            //-
34216>>>//            Send AddObject  of hoNJSON "msg"    hoJSONObj
34216>>>//
34216>>>//            Get Serialize   of hoNJSON to sDados
34216>>>//            
34216>>>//            Function_Return sDados
34216>>>//        End
34216>>>
34216>>>        Move (Rtrim(TSMG800.HTTP_FOTOS))    to aurlDownload
34217>>>
34217>>>        If (Right(aurlDownload, 1) <> "/") Move (aurlDownload + "/") to aurlDownload
34220>>>
34220>>>        Move (aurlDownload + "propostas/" + aPropostaId)  to aurlDownload
34221>>>        
34221>>>        Move (Replaces('{aHTTP}', aurlDownload, Rtrim(TSMG800.HTTP_SITE))) to aurlDownload
34222>>>        Move (aurlDownload + "/" + aFileName) to aurlDownload
34223>>>        
34223>>>        Move (ResizeArray(aLogFile, 0)) to aLogFile
34224>>>        
34224>>>//        Move "HCGS3004"     to aLogFile[0] //tabela
34224>>>        Move aTabela        to aLogFile[0]
34225>>>        Move aPropostaId    to aLogFile[1] //idProposta
34226>>>        
34226>>>        //1-ATIVO
34226>>>        //2-INATIVO
34226>>>        Move "1" to statusId
34227>>>        
34227>>>//        Clear CSAG336
34227>>>//        Move "ATIVO" to CSAG336.DESCRICAO
34227>>>//        Find Eq CSAG336 by 2
34227>>>//        If (Found) Move CSAG336.CODIGO to statusId
34227>>>//        Else Move "1" to statusId
34227>>>        
34227>>>        Move statusId       to aLogFile[2] //aStatus (1)ATIVO (2)INATIVO
34228>>>        
34228>>>        Move aFileName      to aLogFile[3] //aFileName
34229>>>        Move aPath          to aLogFile[4] //aFolder
34230>>>        Move aurlDownload   to aLogFile[5] //aurlDownload
34231>>>        Move aSize          to aLogFile[6] //size
34232>>>        Move aTipoDocumento to aLogFile[7] //tipoDocumento
34233>>>        
34233>>>// ToDo:         Get fLOG3040Register of oWS_LOG3040 aLogFile aUsuarioSessao to myFileList 
34233>>>        
34233>>>        If (not(myFileList.msg.hasError)) Begin
34235>>>            Send AddBoolean of hoJSONObj "hasError" False
34236>>>            Send AddString  of hoJSONObj "msgError" ""
34237>>>            Send AddString  of hoJSONObj "msgInfo" "Upload Completed"
34238>>>            
34238>>>            Send AddObject  of hoNJSON "msg"    hoJSONObj
34239>>>            
34239>>>            Send AddInteger of hoNJSON "id"         myFileList.id
34240>>>            Send AddString  of hoNJSON "value"      myFileList.value
34241>>>            Send AddString  of hoNJSON "url"        myFileList.url
34242>>>            Send AddString  of hoNJSON "size"       myFileList.size
34243>>>            Send AddString  of hoNJSON "tipoDoc"    myFileList.tipoDoc
34244>>>        End
34244>>>>
34244>>>        
34244>>>        Get Serialize     of hoNJSON to sDados
34245>>>        
34245>>>        Function_Return sDados
34246>>>        
34246>>>    End_Function //UploadFileFinished
34247>>>    Send RegisterInterface (RefFunc(UploadFileFinishedProposta)) "Get_UploadFileFinishedProposta" "String sPath Variant sFileName String aUsuarioSessao String aFingerPrint String aSize String aPropostaId String aTipoDocumento String aTabela Returns String" ""
34248>>>
34248>>>    Procedure OnAttachProcess
34251>>>        Forward Send OnAttachProcess
34253>>>    End_Procedure
34254>>>End_Object
34255>    
34255>    Use PAG362_01.wo   //- Atalhos Menu
Including file: PAG362_01.wo    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\PAG362_01.wo)
34255>>>//-2WA--
34255>>>// PAG362_01.wo
34255>>>// PAG362_01
34255>>>Use cWebBusinessProcess.pkg
34255>>>
34255>>>Use cCSAG362_DataDictionary.dd
Including file: cCSAG362_DataDictionary.dd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\cCSAG362_DataDictionary.dd)
34255>>>>>//-2WA
34255>>>>>Use DataDict.pkg
34255>>>>>Use Ddvaltbl.pkg
34255>>>>>Use TabelasdeValidacao.pkg
34255>>>>>
34255>>>>>Open CSAG362
34257>>>>>Open CSAG364
34259>>>>>Open CSAG363
34261>>>>>Open CSAG362Idiomas
Including file: CSAG362Idiomas.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG362Idiomas.fd)
34263>>>>>
34263>>>>>Object Csag362_Localizacao_VT is a DescriptionValidationTable
34265>>>>>    Procedure Fill_List
34268>>>>>        Forward Send Fill_List
34270>>>>>        Send Add_Table_Value "1" "Aba"
34271>>>>>        Send Add_Table_Value "2" "Window"
34272>>>>>        Send Add_Table_Value "3" "Externo"
34273>>>>>    End_Procedure    
34274>>>>>End_Object
34275>>>>>
34275>>>>>Object Csag362_Classe_VT is a DescriptionValidationTable
34277>>>>>    Procedure Fill_List
34280>>>>>        Forward Send Fill_List
34282>>>>>        Send Add_Table_Value "1" "ADMINISTRADOR"
34283>>>>>        Send Add_Table_Value "2" "SUPERVISOR"
34284>>>>>        Send Add_Table_Value "3" "MASTER"
34285>>>>>        Send Add_Table_Value "4" "DIRETOR"
34286>>>>>        Send Add_Table_Value "5" "GERENTE"
34287>>>>>        Send Add_Table_Value "6" "OPERADOR COMUM"
34288>>>>>        Send Add_Table_Value "7" "GUEST"
34289>>>>>    End_Procedure
34290>>>>>End_Object
34291>>>>>
34291>>>>>Object Csag362_Status_VT is a DescriptionValidationTable
34293>>>>>    Procedure Fill_List
34296>>>>>        Forward Send Fill_List
34298>>>>>        Send Add_Table_Value "A" "Ativo"
34299>>>>>        Send Add_Table_Value "D" "Desativo"
34300>>>>>    End_Procedure
34301>>>>>End_Object
34302>>>>>
34302>>>>>Class cCSAG362_DataDictionary is a DataDictionary
34303>>>>>    
34303>>>>>    Procedure Construct_Object
34305>>>>>        Forward Send Construct_Object
34307>>>>>        Set Main_file to CSAG362.File_Number
34308>>>>>
34308>>>>>        Set Add_System_File to CSAG364.File_Number DD_Lock_On_All
34309>>>>>        Set Add_System_File to CSAG363.File_Number DD_Lock_On_All
34310>>>>>        Set Add_System_File to CSAG362Idiomas.File_Number DD_Lock_On_All
34311>>>>>
34311>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
34312>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
34313>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
34314>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
34315>>>>>
34315>>>>>        Set Field_Label_Long Field CSAG362.SISTEMA to "Sistema"
34316>>>>>        Set Field_Value_Table Field CSAG362.SISTEMA to oMSAG362_SISTEMA_FVT
34317>>>>>        Set Field_Option Field CSAG362.SISTEMA DD_RETAINALL to True
34318>>>>>
34318>>>>>        Set Field_Label_Long Field CSAG362.TITULO to "Titulo"
34319>>>>>
34319>>>>>        Set Field_Label_Long Field CSAG362.PROGRAMA to "Programa"
34320>>>>>
34320>>>>>        Set Field_Label_Long Field CSAG362.LOCALIZACAO to "Localizacao"
34321>>>>>        Set Field_Value_Table Field CSAG362.LOCALIZACAO to Csag362_Localizacao_VT
34322>>>>>        Set Field_Option Field CSAG362.LOCALIZACAO DD_RETAINALL to True
34323>>>>>
34323>>>>>        Set Field_Label_Long Field CSAG362.STATUS to "Status"
34324>>>>>        Set Field_Value_Table Field CSAG362.STATUS to Csag362_Status_VT
34325>>>>>        Set Field_Option Field CSAG362.STATUS DD_RETAINALL to True
34326>>>>>
34326>>>>>        Set Field_Label_Long Field CSAG362.CLASSE to "Classe"
34327>>>>>        Set Field_Value_Table Field CSAG362.CLASSE to Csag362_Classe_VT
34328>>>>>        Set Field_Option Field CSAG362.CLASSE DD_RETAINALL to True
34329>>>>>
34329>>>>>        Set Field_Label_Long Field CSAG362.CLASSEMENU to "Endereco WorkSpace"
34330>>>>>        Set Field_Option Field CSAG362.CLASSEMENU DD_RETAINALL to True
34331>>>>>
34331>>>>>        Set Field_Label_Long Field CSAG362.ICONEB00TSP to "Icone Bootstrap"
34332>>>>>        Set Field_Option Field CSAG362.ICONEB00TSP DD_RETAINALL to True
34333>>>>>
34333>>>>>    End_Procedure
34334>>>>>
34334>>>>>    Procedure Field_Defaults
34336>>>>>        Forward Send Field_Defaults
34338>>>>>        Set Field_Changed_Value Field CSAG362.ICONEB00TSP to "btn btn-xs no-hover btn-blue fa fa-arrow-circle-right"
34339>>>>>    End_Procedure
34340>>>>>
34340>>>>>End_Class
34341>>>
34341>>>Object oPAG362_01 Is A cWebBusinessProcess
34343>>>    Set psDescription To "PAG362_01"
34344>>>    Set pbClearAfterSave To False
34345>>>
Including file: USUARIOOPERACAO.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\USUARIOOPERACAO.inc)
34345>>>>//-2WA
34345>>>>//2014-01-20
34345>>>>    Procedure SetUsuariosessao String sStart
#REM SEND REGISTERINTERFACE |CI7301 "msg_SetUsuariosessao" "String sStart" ""
34349>>>>        Set psUsuarioSessao to sStart
34350>>>>        Set psPARAMETRO to ''
34351>>>>    End_Procedure // SetUsuariosessao
34352>>>>
34352>>>>    // Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:11
34352>>>>    Procedure SetPrograma String sStart
#REM SEND REGISTERINTERFACE |CI7302 "msg_SetPrograma" "String sStart" ""
34356>>>>        Set psPrograma to sStart
34357>>>>    End_Procedure // SetUsuariosessao
34358>>>>
34358>>>    
34358>>>    Property String   psUsuarioSessao
34360>>>    Property String   psPrograma
34362>>>    Property Number   pnQuantidadeRegistros
34364>>>    Property Number   pnQuantidadeRegistrosContador
34366>>>
34366>>>    Object oCSAG362_DD is a cCSAG362_DataDictionary
34368>>>        Send DefineAllExtendedFields
Including file: FIELDLABEL.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABEL.INC)
34369>>>>// ANDERSON
34369>>>>// 13.06.2003 - 01:44
34369>>>>// ROTINA PARA SER INCLUIDA EM TODOS OS DDOS DE TODOS WBOS
34369>>>>// 
34369>>>>// PROCEDURE FIELD_DEFAULTS FOI MODIFICADA PARA LER CSAG310
34369>>>>// E EMITIR A LABEL DE CADA CAMPO NA LINGUA INDICADA.
34369>>>>//-2WA
34369>>>>Procedure Field_Defaults
34372>>>>    Forward Send Field_Defaults
34374>>>>
34374>>>>    Handle  hIdiomaFile
34374>>>>    String  sIdiomaFieldName
34374>>>>    String  sIdiomaLogicalName
34374>>>>    Integer iIdiomaNumFields
34374>>>>    Integer iIdiomaX
34374>>>>    
34374>>>>    Get Main_File                       To hIdiomaFile
34375>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  Of hIdiomaFile                To sIdiomaLogicalName
34378>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS Of hIdiomaFile                To iIdiomaNumFields
34381>>>>
34381>>>>    For iIdiomaX from 1 To iIdiomaNumFields
34387>>>>>
34387>>>>
34387>>>>        Get_Attribute DF_FIELD_NAME     Of hIdiomaFile iIdiomaX       To sIdiomaFieldName
34390>>>>
34390>>>>        Clear   CSAG310
34391>>>>        Move sIdiomaLogicalName                     To CSAG310.TABELA
34392>>>>        Move sIdiomaFieldName                       To CSAG310.CAMPO
34393>>>>        Move (piUsuarioIdioma(oPAG800_01(Self)))    To CSAG310.IDIOMA
34394>>>>        Find Eq CSAG310   By 1
34395>>>>>
34395>>>>
34395>>>>        If (CSAG310.APPEARANCE<>"")     Set Field_Label_Long iIdiomaX To (Trim(CSAG310.APPEARANCE))
34398>>>>
34398>>>>    Loop
34399>>>>>
34399>>>>
34399>>>>End_procedure // Field_Defaults
34400>>>>
34400>>>>
34400>>>         
34400>>>        Procedure Save_main_file
34403>>>            Boolean bSai
34403>>>            Forward Send Save_main_file
34405>>>            If (CSAG362.ID = 0) Begin
34407>>>                Move CSAG362.Recnum to CSAG362.ID
34408>>>                SaveRecord CSAG362
34409>>>                //-
34409>>>                Clear CSAG311
34410>>>                Move (psUsuarioSessao(Self)) to CSAG311.USUARIOSESSAO
34411>>>                Find Eq CSAG311 by 1
34412>>>>
34412>>>                
34412>>>                Clear CSAG300
34413>>>                Move CSAG311.USUARIONUMERO to CSAG300.USUARIONUMERO
34414>>>                Find Eq CSAG300 by 3
34415>>>>
34415>>>                //-
34415>>>                Clear CSAG362Idiomas
34416>>>                Move CSAG362.SISTEMA        to CSAG362Idiomas.SISTEMA
34417>>>                Move CSAG300.USUARIOIDIOMA  to CSAG362Idiomas.IDIOMA
34418>>>                Move CSAG362.TITULO         to CSAG362Idiomas.TITULO
34419>>>                Move CSAG362.ID             to CSAG362Idiomas.ID
34420>>>                SaveRecord CSAG362Idiomas
34421>>>            End
34421>>>>
34421>>>            
34421>>>            Number nSISTEMA
34421>>>            
34421>>>            Move CSAG362.SISTEMA to nSISTEMA
34422>>>            
34422>>>            Clear CSAG362
34423>>>            Move nSISTEMA to CSAG362.SISTEMA
34424>>>            Smart_Find Ge CSAG362 by 1
34435>>>            While (Found)
34439>>>               If (nSISTEMA=CSAG362.SISTEMA and CSAG362.STATUS='A') Begin
34441>>>                
34441>>>                   Clear CSAG363
34442>>>                   Move CSAG362.SISTEMA to CSAG363.SISTEMA
34443>>>                   Smart_Find Ge CSAG363      by 2
34454>>>                   While (Found)
34458>>>                      If (CSAG363.SISTEMA=CSAG362.SISTEMA) Begin
34460>>>                        
34460>>>                          Clear CSAG364
34461>>>                          Move CSAG363.USUARIONUMERO    to CSAG364.USUARIONUMERO
34462>>>                          Move CSAG363.SISTEMA          to CSAG364.SISTEMA
34463>>>                          Move CSAG362.TITULO           to CSAG364.TITULO
34464>>>                          Find Eq CSAG364 by 1
34465>>>>
34465>>>                          If (Found) Begin
34467>>>                              //-  
34467>>>                              Move CSAG363.USUARIONOME    to CSAG364.USUARIONOME
34468>>>                              Move CSAG362.TITULO         to CSAG364.TITULO
34469>>>                              Move CSAG362.PROGRAMA       to CSAG364.PROGRAMA
34470>>>                              Move CSAG362.LOCALIZACAO    to CSAG364.LOCALIZACAO
34471>>>                              Move CSAG362.CLASSEMENU     to CSAG364.CLASSEMENU
34472>>>                              Move CSAG362.ICONEB00TSP    to CSAG364.ICONEB00TSP
34473>>>                              //-                                     
34473>>>                              SaveRecord CSAG364      
34474>>>                          End
34474>>>>
34474>>>                          Else Begin
34475>>>                              Clear CSAG364
34476>>>                              //-
34476>>>                              Move CSAG363.USUARIONUMERO  to CSAG364.USUARIONUMERO
34477>>>                              Move CSAG363.USUARIONOME    to CSAG364.USUARIONOME
34478>>>                              Move CSAG362.SISTEMA        to CSAG364.SISTEMA
34479>>>                              Move CSAG362.TITULO         to CSAG364.TITULO
34480>>>                              Move CSAG362.PROGRAMA       to CSAG364.PROGRAMA
34481>>>                              Move CSAG362.LOCALIZACAO    to CSAG364.LOCALIZACAO
34482>>>                              Move CSAG362.CLASSEMENU     to CSAG364.CLASSEMENU
34483>>>                              Move CSAG362.ICONEB00TSP    to CSAG364.ICONEB00TSP
34484>>>                              //-                                      
34484>>>                              SaveRecord CSAG364      
34485>>>                          End
34485>>>>
34485>>>                          //-
34485>>>                      End
34485>>>>
34485>>>                      //-
34485>>>                   Smart_Find Gt CSAG363      by 2
34490>>>                   Loop
34491>>>>
34491>>>                 
34491>>>               End
34491>>>>
34491>>>            Smart_Find Gt CSAG362      by 1
34496>>>            Loop
34497>>>>
34497>>>        
34497>>>        End_Procedure
34498>>>
34498>>>        Procedure Delete_main_file
34501>>>            Boolean bSai
34501>>>            
34501>>>            Number                  nSISTEMA
34501>>>            Move CSAG362.SISTEMA to nSISTEMA
34502>>>            Forward Send Delete_main_file
34504>>>            
34504>>>            
34504>>>            Move False to bSai
34505>>>            Clear   CSAG364
34506>>>            Move nSISTEMA                 to CSAG364.SISTEMA
34507>>>            Smart_Find Ge CSAG364               by 2
34518>>>            Repeat
34518>>>>
34518>>>                 If (Found) Begin
34520>>>                    //-
34520>>>                    If (nSISTEMA=CSAG364.SISTEMA) Begin
34522>>>                        Delete CSAG364      
34523>>>                    End
34523>>>>
34523>>>                    Else Move True to bSai
34525>>>                    Smart_Find Gt CSAG364       by 2
34530>>>                    //-
34530>>>                 End 
34530>>>>
34530>>>                 Else Move True to bSai
34532>>>            Until (bSai)
34534>>>            
34534>>>            Clear   CSAG362
34535>>>            Move nSISTEMA        to CSAG362.SISTEMA
34536>>>            Smart_Find Ge CSAG362      by 1
34547>>>            While (Found)
34551>>>               If (nSISTEMA=CSAG362.SISTEMA and CSAG362.STATUS='A') Begin
34553>>>                   //-
34553>>>                   Clear   CSAG363
34554>>>                   Move CSAG362.SISTEMA to CSAG363.SISTEMA
34555>>>                   Smart_Find Ge CSAG363      by 2
34566>>>                   While (Found)
34570>>>                      If (CSAG363.SISTEMA=CSAG362.SISTEMA) Begin
34572>>>                        
34572>>>                          Clear      CSAG364
34573>>>                          
34573>>>                          Move CSAG363.USUARIONUMERO  to CSAG364.USUARIONUMERO
34574>>>                          Move CSAG363.USUARIONOME    to CSAG364.USUARIONOME
34575>>>                          Move CSAG362.SISTEMA        to CSAG364.SISTEMA
34576>>>                          Move CSAG362.TITULO         to CSAG364.TITULO
34577>>>                          Move CSAG362.PROGRAMA       to CSAG364.PROGRAMA
34578>>>                          Move CSAG362.LOCALIZACAO    to CSAG364.LOCALIZACAO
34579>>>                          Move CSAG362.CLASSEMENU     to CSAG364.CLASSEMENU
34580>>>                          Move CSAG362.ICONEB00TSP    to CSAG364.ICONEB00TSP
34581>>>                                                                
34581>>>                          SaveRecord CSAG364      
34582>>>                        
34582>>>                      End
34582>>>>
34582>>>                   Smart_Find Gt CSAG363      by 2
34587>>>                   Loop
34588>>>>
34588>>>                   //-
34588>>>               End
34588>>>>
34588>>>            Smart_Find Gt CSAG362      by 1
34593>>>            Loop
34594>>>>
34594>>>        
34594>>>        End_Procedure
34595>>>        
34595>>>    End_Object // oCSAG362_DD
34596>>>
34596>>>    Set Main_DD To oCSAG362_DD
34597>>>
34597>>>
34597>>>    Send RegisterStandardInterface
34598>>>    
34598>>>    // Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:09
34598>>>    Function fPAG362_01_ComboCSAG305 String sRowid String sNomeCombo String sClasse Returns String
#REM SEND REGISTERINTERFACE |CI7307 "get_fPAG362_01_ComboCSAG305" "String sRowid String sNomeCombo String sClasse Returns String" ""
34602>>>        String  sRETORNO
34602>>>        Boolean bFOUND
34602>>>        RowID   riROWID
34602>>>    
34602>>>        Integer   iContador
34602>>>        Move 0 to iContador
34603>>>    
34603>>>        Move ""                                                                                                           to sRetorno
34604>>>        Move ('<select name="'+(Trim(sNomeCombo))+'" id="'+(Trim(sNomeCombo))+'" class="col-xs-6">')                      to sRetorno
34605>>>        If   (sRowid="") Move (sRetorno+'<option value="'+(Trim('0'))+'">'+(Trim('Selecione uma WORKSPACE'))+'</option>') to sRetorno
34608>>>    
34608>>>        //---------------------------------------------------------------------------------------------------------------------------------------
34608>>>        //---< INICIO
34608>>>    
34608>>>        Case Begin
34608>>>    
34608>>>            Case (sRowid="" and sClasse="0")
34610>>>    
34610>>>                Clear   CSAG305
Including file: CSAG305.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG305.fd)
34611>>>                Smart_Find Ge CSAG305 by 1
34622>>>                While (Found)
34626>>>
34626>>>                     Move (sRetorno+'<option value="'+(Trim(CSAG305.CLASSEMENU))+'">'+(Trim(CSAG305.DESCRICAO))+'</option>') to sRetorno
34627>>>                     Increment iContador
34628>>>
34628>>>                     Smart_Find Gt CSAG305 by 1
34633>>>                Loop
34634>>>>
34634>>>           
34634>>>            Case Break
34635>>>    
34635>>>    
34635>>>            Case (sRowid="" and sClasse<>"0")
34638>>>    
34638>>>                Clear   CSAG305
34639>>>                Move sClasse     to CSAG305.CLASSEMENU
34640>>>                Find Eq CSAG305  by 1
34641>>>>
34641>>>                  If not (Found) Clear   CSAG305
34644>>>                  Else    Move (sRetorno+'<option selected="selected" value="'+(Trim(CSAG305.CLASSEMENU))+'">'+(Trim(CSAG305.DESCRICAO))+'</option>') to sRetorno
34646>>>    
34646>>>                Clear   CSAG305
34647>>>                Smart_Find Ge CSAG305 by 1
34658>>>                While (Found)
34662>>>                     If (not(sRetorno contains Rtrim(CSAG305.CLASSEMENU))) Begin
34664>>>                         Move (sRetorno+'<option value="'+(Trim(CSAG305.CLASSEMENU))+'">'+(Trim(CSAG305.DESCRICAO))+'</option>') to sRetorno
34665>>>                         Increment iContador
34666>>>                     End
34666>>>>
34666>>>                     Smart_Find Gt CSAG305 by 1
34671>>>                Loop
34672>>>>
34672>>>
34672>>>            Case Break
34673>>>    
34673>>>    
34673>>>            Case (sRowid<>"")
34676>>>    
34676>>>                Move (DeserializeRowId(sRowId))                  to riRowId
34677>>>                Move (FindByRowId(CSAG362.File_Number, riRowId)) to bFound
34678>>>    
34678>>>                If (bFound) Begin
34680>>>    
34680>>>                    Clear   CSAG305
34681>>>                    Move CSAG362.CLASSEMENU  to CSAG305.CLASSEMENU
34682>>>                    Find Eq CSAG305          by 1
34683>>>>
34683>>>                      If not (Found) Clear   CSAG305
34686>>>                      Else    Move (sRetorno+'<option selected="selected" value="'+(Trim(CSAG305.CLASSEMENU))+'">'+(Trim(CSAG305.DESCRICAO))+'</option>') to sRetorno
34688>>>        
34688>>>                    Clear   CSAG305
34689>>>                    Smart_Find Ge CSAG305      by 1
34700>>>                    While (Found)
34704>>>                         If (not(sRetorno contains Rtrim(CSAG305.CLASSEMENU))) Begin
34706>>>                             Move (sRetorno+'<option value="'+(Trim(CSAG305.CLASSEMENU))+'">'+(Trim(CSAG305.DESCRICAO))+'</option>') to sRetorno
34707>>>                             Increment iContador
34708>>>                         End
34708>>>>
34708>>>                         Smart_Find Gt CSAG305 by 1
34713>>>                    Loop
34714>>>>
34714>>>
34714>>>                End
34714>>>>
34714>>>            
34714>>>            Case Break
34715>>>    
34715>>>        Case End
34715>>>    
34715>>>        // FIM --->
34715>>>        //---------------------------------------------------------------------------------------------------------------------------------------
34715>>>    
34715>>>        Move (sRetorno+'</select>') to sRetorno
34716>>>        Function_Return                sRetorno
34717>>>    
34717>>>    End_Function // fPAG362_01_ComboCSAG305
34718>>>    
34718>>>    // Send RegisterDebugInterface
34718>>>    // Send RegisterFullErrorInterface
34718>>>    // Send RegisterAutoEntryInterface
34718>>>
34718>>>    Set pbAllowSaveNew To True
34719>>>    Set pbAllowSaveEdit To True
34720>>>    Set pbAllowDelete To True
34721>>>    Set pbAllowClear To True
34722>>>    Set pbAllowFind To True
34723>>>    Set pbAllowDDUpdate To True
34724>>>
34724>>>End_Object // oPAG362_01
34725>    Use PAG362_02.wo   //- Relatrio Atalhos Menu
Including file: PAG362_02.wo    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\PAG362_02.wo)
34725>>>//-2WA--
34725>>>// PAG362_02.wo
34725>>>// PAG362_02
34725>>>Use cWebBusinessProcess.pkg
34725>>>Use cWebReport.pkg
34725>>>
34725>>>Use cCSAG362_DataDictionary.dd
34725>>>
34725>>>Object oPAG362_02 Is A cWebBusinessProcess
34727>>>    Set psDescription To "PAG362_02"
34728>>>
Including file: VerifyRecs.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\VerifyRecs.inc)
34728>>>>// ESTA PROCEDURE PODE SER USADA PARA EXIBIR UMA MENSAGEM PADRAO
34728>>>>// ONDE O RELATORIO ENCONTROU REGISTROS, POREM SE O REPORT NAO EMITIU NADA
34728>>>>// VAMOS INFOMAR AO USUARIO.
34728>>>>//-2WA
34728>>>>Property String   psUsuarioSessao
34730>>>>Property String   psPrograma
34732>>>>
34732>>>>Procedure NaoPossuiRegistro String sMsg String sClasse
34735>>>>    Send WriteHtmlTableBegin 'border="0" width="95%" class="ReportTable" align="center"'
34736>>>>         Send WriteHtml '<tbody>'    
34737>>>>         Send WriteHtmlRowBegin
34738>>>>               Send WriteHtml '<br />'
34739>>>>         Send WriteHtmlRowEnd
34740>>>>    
34740>>>>         Send WriteHtmlRowBegin
34741>>>>             Send WriteHtmlCellHeader  sMsg  ('class="'+sClasse+'"  align="center"')
34742>>>>         Send WriteHtmlRowEnd
34743>>>>    
34743>>>>         Send WriteHtmlRowBegin
34744>>>>               Send WriteHtml '<br />'
34745>>>>         Send WriteHtmlRowEnd
34746>>>>         Send WriteHtml '</tbody>'    
34747>>>>    
34747>>>>    Send WriteHtmlTableEnd
34748>>>>End_Procedure // NaoPossuiRegistro
34749>>>>
34749>>>>
34749>>>>// Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:08
34749>>>>Procedure SetUsuariosessao String sStart
#REM SEND REGISTERINTERFACE |CI7301 "msg_SetUsuariosessao" "String sStart" ""
34753>>>>    Set psUsuarioSessao to sStart
34754>>>>End_Procedure // SetUsuariosessao
34755>>>>
34755>>>>
34755>>>>// Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:11
34755>>>>Procedure SetPrograma String sStart
#REM SEND REGISTERINTERFACE |CI7302 "msg_SetPrograma" "String sStart" ""
34759>>>>    Set psPrograma to sStart
34760>>>>End_Procedure // SetUsuariosessao
34761>>>>
34761>>>
34761>>>    Object oCSAG362_DD is a cCSAG362_DataDictionary
34763>>>        Send DefineAllExtendedFields
Including file: FIELDLABEL.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABEL.INC)
34764>>>>// ANDERSON
34764>>>>// 13.06.2003 - 01:44
34764>>>>// ROTINA PARA SER INCLUIDA EM TODOS OS DDOS DE TODOS WBOS
34764>>>>// 
34764>>>>// PROCEDURE FIELD_DEFAULTS FOI MODIFICADA PARA LER CSAG310
34764>>>>// E EMITIR A LABEL DE CADA CAMPO NA LINGUA INDICADA.
34764>>>>//-2WA
34764>>>>Procedure Field_Defaults
34767>>>>    Forward Send Field_Defaults
34769>>>>
34769>>>>    Handle  hIdiomaFile
34769>>>>    String  sIdiomaFieldName
34769>>>>    String  sIdiomaLogicalName
34769>>>>    Integer iIdiomaNumFields
34769>>>>    Integer iIdiomaX
34769>>>>    
34769>>>>    Get Main_File                       To hIdiomaFile
34770>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  Of hIdiomaFile                To sIdiomaLogicalName
34773>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS Of hIdiomaFile                To iIdiomaNumFields
34776>>>>
34776>>>>    For iIdiomaX from 1 To iIdiomaNumFields
34782>>>>>
34782>>>>
34782>>>>        Get_Attribute DF_FIELD_NAME     Of hIdiomaFile iIdiomaX       To sIdiomaFieldName
34785>>>>
34785>>>>        Clear   CSAG310
34786>>>>        Move sIdiomaLogicalName                     To CSAG310.TABELA
34787>>>>        Move sIdiomaFieldName                       To CSAG310.CAMPO
34788>>>>        Move (piUsuarioIdioma(oPAG800_01(Self)))    To CSAG310.IDIOMA
34789>>>>        Find Eq CSAG310   By 1
34790>>>>>
34790>>>>
34790>>>>        If (CSAG310.APPEARANCE<>"")     Set Field_Label_Long iIdiomaX To (Trim(CSAG310.APPEARANCE))
34793>>>>
34793>>>>    Loop
34794>>>>>
34794>>>>
34794>>>>End_procedure // Field_Defaults
34795>>>>
34795>>>>
34795>>>                
34795>>>        Property Number pnStartSISTEMA
34797>>>        Property Number pnStopSISTEMA
34799>>>        
34799>>>        FILTER_PREPARE
34860>>>>
34860>>>
34860>>>        Procedure OnFilterConstrain 
34863>>>            Number nStart nStop
34863>>>
34863>>>            Get pnStartSISTEMA to nStart
34864>>>
34864>>>            If (nStart <> 0) Begin
34866>>>                Filter_Constrain (sFormat("SISTEMA = %1", toSqlNumber(nStart)))
34870>>>            End
34870>>>>
34870>>>        End_Procedure // OnConstrain
34871>>>    End_Object // oCSAG362_DD
34872>>>
34872>>>    Set Main_DD To oCSAG362_DD
34873>>>
34873>>>
34873>>>    Object oReport is a cWebReport_Filter
Including file: FIELDLABELRPT.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABELRPT.INC)
34875>>>>// Anderson
34875>>>>// 13.06.2003 - 11:33
34875>>>>// FUNCAO USADA PARA ESCREVER A LABEL DE CADA COLUNA DO RELATORIO
34875>>>>//
34875>>>>// PARA QUE ESTA FUNCAO TRAGA A LABEL CORRESPONDENTE NO IDIOMA
34875>>>>// EH PRECISO QUE NO DDO DO WBO ESTEJA O PACOTE FIELDLABEL.INC
34875>>>>//-2WA
34875>>>>Function ddValueFieldLabel Integer iDDO String sField Returns String 
34878>>>>    Integer iFile 
34878>>>>    Integer iField
34878>>>>    String  sVal
34878>>>>    String  sLabel
34878>>>>    Handle  hFile
34878>>>>    
34878>>>>    Move (Left(sField,(Pos(".",sField)))+"File_Number")      to sVal
34879>>>>    Move (Replace(Left(sField,(Pos(".",sField))),sField,"")) to sField
34880>>>>    
34880>>>>    Move (Eval(sVal)) to hFile
34881>>>>    //Pegar o numero do arquivo
34881>>>>    Get_Attribute DF_FILE_NUMBER Of hFile to iFile
34884>>>>
34884>>>>    //Pegar o numero do campo no arquivo
34884>>>>    Field_Map iFile sField to iField      
34886>>>>    
34886>>>>    Get Field_Label_Long of iDDO iField To sLabel
34887>>>>    Function_Return (HtmlEncode(sLabel))
34888>>>>    
34888>>>>End_Function // ddValueFieldLabel
34889>>>>
34889>>>>
34889>>>                
34889>>>        Procedure OnPageTop
34892>>>            String sText
34892>>>            String sCSAG362SISTEMA
34892>>>            String sCSAG362TITULO
34892>>>            String sCSAG362PROGRAMA
34892>>>            String sCSAG362LOCALIZACAO
34892>>>            String sCSAG362STATUS
34892>>>            String sCSAG362CLASSE
34892>>>
34892>>>            Handle         hDD
34892>>>            Get Main_DD to hDD
34893>>>        
34893>>>            Send WriteHtml '<div class="table-responsive">'
34894>>>            Send WriteHtmlTableBegin 'class="table table-bordered table-striped table-hover"' 
34895>>>                Send WriteHtml '<thead>'
34896>>>
34896>>>                Send WriteHtmlRowBegin
34897>>>                    Get ddValueFieldLabel hDD "CSAG362.SISTEMA" to sCSAG362SISTEMA
34898>>>                    Get ddValueFieldLabel hDD "CSAG362.TITULO" to sCSAG362TITULO
34899>>>                    Get ddValueFieldLabel hDD "CSAG362.PROGRAMA" to sCSAG362PROGRAMA
34900>>>                    Get ddValueFieldLabel hDD "CSAG362.LOCALIZACAO" to sCSAG362LOCALIZACAO
34901>>>                    Get ddValueFieldLabel hDD "CSAG362.STATUS" to sCSAG362STATUS
34902>>>                    Get ddValueFieldLabel hDD "CSAG362.CLASSE" to sCSAG362CLASSE
34903>>>                            
34903>>>                    Send WriteHtmlCellHeader sCSAG362SISTEMA       'class="rptL" style="width: 10% ! important;" ' 
34904>>>                    Send WriteHtmlCellHeader sCSAG362TITULO        'class="rptL" style="width: 20% ! important;" '  
34905>>>                    Send WriteHtmlCellHeader sCSAG362PROGRAMA      'class="rptL" style="width: 10% ! important;" '  
34906>>>                    Send WriteHtmlCellHeader sCSAG362LOCALIZACAO   'class="rptC" style="width: 10% ! important;" '  
34907>>>                    Send WriteHtmlCellHeader sCSAG362STATUS        'class="rptC" style="width: 5% ! important;" '          
34908>>>                    Send WriteHtmlCellHeader sCSAG362CLASSE        'class="rptL" style="width: 10% ! important;" '          
34909>>>                Send WriteHtmlRowEnd
34910>>>                
34910>>>                Send WriteHtml '</thead>'
34911>>>                Send WriteHtml '<tbody>'
34912>>>        End_Procedure // OnPageTop
34913>>>
34913>>>        Procedure OnBody 
34916>>>            String sText
34916>>>            String sCSAG362SISTEMA
34916>>>            String sCSAG362TITULO
34916>>>            String sCSAG362PROGRAMA
34916>>>            String sCSAG362LOCALIZACAO
34916>>>            String sCSAG362STATUS
34916>>>            String sCSAG362CLASSE
34916>>>
34916>>>            Get ddValueEncode "CSAG362.SISTEMA" To sCSAG362SISTEMA
34917>>>            Get ddValueEncode "CSAG362.TITULO" To sCSAG362TITULO
34918>>>            Get ddValueEncode "CSAG362.PROGRAMA" To sCSAG362PROGRAMA
34919>>>            Get ddValueEncode "CSAG362.LOCALIZACAO" To sCSAG362LOCALIZACAO
34920>>>            Get ddValueEncode "CSAG362.STATUS" To sCSAG362STATUS
34921>>>            Get ddValueEncode "CSAG362.CLASSE" To sCSAG362CLASSE
34922>>>
34922>>>            Get Find_Code_Description of oMSAG362_SISTEMA_FVT Csag362.SISTEMA            to sCSAG362SISTEMA
34923>>>            Get Find_Code_Description of Csag362_Localizacao_VT Csag362.LOCALIZACAO    to sCSAG362LOCALIZACAO
34924>>>            Get Find_Code_Description of Csag362_Status_VT Csag362.STATUS              to sCSAG362STATUS
34925>>>            Get Find_Code_Description of Csag362_Classe_VT Csag362.CLASSE              to sCSAG362CLASSE
34926>>>        
34926>>>            String  sRowid
34926>>>            RowID   rFileNumber
34926>>>        
34926>>>            Move (GetRowID(CSAG362.File_Number))       to rFileNumber
34927>>>            Move (SerializeRowId(rFileNumber))         to sRowid
34928>>>        
34928>>>                Send WriteHtml '<tr RecId="'
34929>>>                Send WriteHtml (Trim(sRowid))
34930>>>                Send WriteHtml '"'
34931>>>        
34931>>>                Send WriteHtml ' style="cursor:pointer"'
34932>>>                Send WriteHtml ' onclick="RowClick(this);"'
34933>>>                Send WriteHtml '>'
34934>>>        
34934>>>                Send WriteHtmlCell sCSAG362SISTEMA                    ('class="rptL"')    
34935>>>                Send WriteHtmlCell sCSAG362TITULO                     ('class="rptL"')    
34936>>>                Send WriteHtmlCell sCSAG362PROGRAMA                   ('class="rptL"')    
34937>>>                Send WriteHtmlCell sCSAG362LOCALIZACAO                ('class="rptC"')    
34938>>>                Send WriteHtmlCell sCSAG362STATUS                     ('class="rptC"')    
34939>>>                Send WriteHtmlCell sCSAG362CLASSE                     ('class="rptL"')    
34940>>>            Send WriteHtmlRowEnd
34941>>>        End_Procedure // OnBody
34942>>>
34942>>>        Procedure OnPageBottom
34945>>>                Send WriteHtml '</tbody>'
34946>>>           Send WriteHtmlTableEnd
34947>>>           Send WriteHtml '</div>' 
34948>>>        End_Procedure // OnPageBottom
34949>>>
34949>>>        Function RunPAG362_02 Integer iIndex RowId riStartRowId Integer iMaxCount Returns RowId
34952>>>            RowId   riLastRowId
34952>>>            Integer eStatus
34952>>>
34952>>>            Set piOrdering To iIndex
34953>>>            Set piMaxCount To iMaxCount
34954>>>            Set piMaxCountBreakLevel To 0
34955>>>            Set priStartRowId To riStartRowId
34956>>>
34956>>>            Get DoRunReport To eStatus
34957>>>
34957>>>            Get priLastRowId To riLastRowId
34958>>>
34958>>>            Function_Return riLastRowId
34959>>>        End_Function // RunPAG362_02
34960>>>    End_Object // oReport
34961>>>
34961>>>    Procedure SetHRefName String sName
#REM SEND REGISTERINTERFACE |CI7325 "msg_SetHRefName" "String sName" "Name to link for drill down report"
34965>>>        Set psHRefname of oReport To sName
34966>>>    End_Procedure // SetHRefName
34967>>>
34967>>>    Procedure SetCSAG362_SISTEMA String sStart
#REM SEND REGISTERINTERFACE |CI7326 "msg_SetCSAG362_SISTEMA" "String sStart" "Sets the reports selection criteria"
34971>>>        Set pnStartSISTEMA of oCSAG362_DD To sStart
34972>>>    End_Procedure // SetCSAG362_SISTEMA
34973>>>
34973>>>    Function RunPAG362_02 Integer iIndex String sStartRowId Integer iMaxCount Returns String
#REM SEND REGISTERINTERFACE |CI7324 "get_RunPAG362_02" "Integer iIndex String sStartRowId Integer iMaxCount Returns String" "Run Report"
34977>>>        RowId  riStartRowId riEndRowId
34977>>>        String sEndRowId
34977>>>        Integer iRecordCount        
34977>>>        
34977>>>        Move (DeserializeRowId(sStartRowId)) to riStartRowId
34978>>>        Get RunPAG362_02 of oReport iIndex riStartRowId iMaxCount To riEndRowId
34979>>>        Move (SerializeRowId(riEndRowId)) to sEndRowId
34980>>>
34980>>>        //-- NOVO CONCEITO:
34980>>>        Get piRecordCount of oReport to iRecordCount 
34981>>>        If (iRecordCount=0) Send NaoPossuiRegistro "::NENHUM REGISTRO FOI ENCONTRADO." "Vermelho12"
34984>>>    
34984>>>        Function_Return sEndRowId
34985>>>    End_Function // RunPAG362_02
34986>>>
34986>>>    Set pbAllowSaveNew To False
34987>>>    Set pbAllowSaveEdit To False
34988>>>    Set pbAllowDelete To False
34989>>>
34989>>>End_Object // oPAG362_02
34990>    Use PCGS200_03.wo  //- Operao
Including file: PCGS200_03.wo    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\PCGS200_03.wo)
34990>>>//-2WA--
34990>>>// PCGS200_03.wo
34990>>>// PCGS200_03
34990>>>Use cWebBusinessProcess.pkg
34990>>>
34990>>>Use cCCGS200_DataDictionary.dd
Including file: cCCGS200_DataDictionary.dd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\cCCGS200_DataDictionary.dd)
34990>>>>>Use CtrlData.PKG
34990>>>>>
34990>>>>>Open CCGS200
Including file: CCGS200.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS200.fd)
34992>>>>>Open TSMG801
34994>>>>>
34994>>>>>Class cCCGS200_DataDictionary is a c_DataDictionary
34995>>>>>    
34995>>>>>    Procedure Construct_Object
34997>>>>>        Forward Send Construct_Object
34999>>>>>        Set Main_file to CCGS200.File_Number
35000>>>>>
35000>>>>>        Set Add_System_File to TSMG801.File_Number DD_Lock_On_All
35001>>>>>
35001>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
35002>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
35003>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
35004>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
35005>>>>>
35005>>>>>        Set Field_Label_Long Field CCGS200.CODIGO to "CODIGO"
35006>>>>>        Set Field_Label_Short Field CCGS200.CODIGO to "CODIGO"
35007>>>>>        Set Field_Option Field CCGS200.CODIGO DD_NOENTER to True
35008>>>>>        Set Field_Auto_Increment Field CCGS200.CODIGO to File_Field TSMG801.CCGS200_CODIGO
35009>>>>>
35009>>>>>        Set Field_Label_Long Field CCGS200.DESCRICAO to "DESCRICAO"
35010>>>>>        Set Field_Label_Short Field CCGS200.DESCRICAO to "DESCRICAO"
35011>>>>>        Set Field_Option Field CCGS200.DESCRICAO DD_CAPSLOCK to True
35012>>>>>
35012>>>>>        Set Field_Label_Long Field CCGS200.SIGLA to "SIGLA"
35013>>>>>        Set Field_Label_Short Field CCGS200.SIGLA to "SIGLA"
35014>>>>>        Set Field_Option Field CCGS200.SIGLA DD_CAPSLOCK to True
35015>>>>>
35015>>>>>        Set Field_Label_Long Field CCGS200.USUARIO_ID_C to "CRIADO POR"
35016>>>>>        Set Field_Label_Short Field CCGS200.USUARIO_ID_C to "CRIARO POR"
35017>>>>>        Set Field_Option Field CCGS200.USUARIO_ID_C DD_NOENTER to True
35018>>>>>
35018>>>>>        Set Field_Label_Long Field CCGS200.DATE_TIME_C to "DATA E HORA DA CRIACAO"
35019>>>>>        Set Field_Label_Short Field CCGS200.DATE_TIME_C to "DATA E HORA DA CRIACAO"
35020>>>>>        Set Field_Option Field CCGS200.DATE_TIME_C DD_NOENTER to True
35021>>>>>
35021>>>>>        Set Field_Label_Long Field CCGS200.USUARIO_ID_A to "ALTERADO POR"
35022>>>>>        Set Field_Label_Short Field CCGS200.USUARIO_ID_A to "ALTERADO POR"
35023>>>>>        Set Field_Option Field CCGS200.USUARIO_ID_A DD_NOENTER to True
35024>>>>>
35024>>>>>        Set Field_Label_Long Field CCGS200.DATE_TIME_A to "DATA E HORA DA ALTERACAO"
35025>>>>>        Set Field_Label_Short Field CCGS200.DATE_TIME_A to "DATA E HORA DA ALTERACAO"
35026>>>>>        Set Field_Option Field CCGS200.DATE_TIME_A DD_NOENTER to True
35027>>>>>
35027>>>>>    End_Procedure
35028>>>>>    
35028>>>>>    Procedure Creating_PCGS200_03
35030>>>>>        Forward Send Creating
35032>>>>>        DateTime dtCurrentDateTime
35032>>>>>    
35032>>>>>        //------------------------------------------------------------
35032>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
35032>>>>>    
35032>>>>>            Clear   CSAG311
35033>>>>>            Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
35034>>>>>            Find Eq CSAG311                      by 1
35035>>>>>>
35035>>>>>              If (Found) Begin                   
35037>>>>>                  Send p_RegistraAcessoUsuario "CCGS200.USUARIO_ID_C" CSAG311.USUARIONUMERO
35038>>>>>              End
35038>>>>>>
35038>>>>>    
35038>>>>>    End_Procedure // Creating_PCGS200_03
35039>>>>>
35039>>>>>    Procedure Update_PCGS200_03
35041>>>>>        Forward Send Update
35043>>>>>
35043>>>>>        //------------------------------------------------------------
35043>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
35043>>>>>    
35043>>>>>             Clear   CSAG311
35044>>>>>             Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
35045>>>>>             Find Eq CSAG311                      by 1
35046>>>>>>
35046>>>>>               If (Found) Begin
35048>>>>>                   Send p_RegistraAcessoUsuario "CCGS200.USUARIO_ID_A" CSAG311.USUARIONUMERO
35049>>>>>               End
35049>>>>>>
35049>>>>>    
35049>>>>>    End_Procedure // Update_PCGS200_03
35050>>>>>
35050>>>>>    Procedure Deleting_PCGS200_03
35052>>>>>       Forward Send Deleting
35054>>>>>        Send p_FFOperation 3 
35055>>>>>    End_Procedure   // Deleting_PCGS200_03
35056>>>>>
35056>>>>>    Procedure Save_Main_File_PCGS200_03
35058>>>>>        Integer iRECNUM
35058>>>>>        Move CCGS200.RECNUM to iRECNUM
35059>>>>>        Forward Send Save_Main_File
35061>>>>>        If (iRECNUM=0) Begin
35063>>>>>            //--- NOVO REGISTRO
35063>>>>>            Send p_FFOperation 2
35064>>>>>        End // If (iRECNUM=0) Begin
35064>>>>>>
35064>>>>>        Else Begin
35065>>>>>          //--- REGISTRO ALTERADO
35065>>>>>            Send p_FFOperation 1 
35066>>>>>        End
35066>>>>>>
35066>>>>>                    
35066>>>>>    End_Procedure // Save_Main_File_PCGS200_03
35067>>>>>    
35067>>>>>    Procedure Backout_PCGS200_03
35069>>>>>        Forward Send Backout
35071>>>>>        Send p_FFOperation 0
35072>>>>>    End_Procedure   // Backout_PCGS200_03
35073>>>>>    
35073>>>>>    Function Validate_Save_PCGS200_03 Returns Integer
35075>>>>>        Integer iReturnval
35075>>>>>        Integer iError_Id
35075>>>>>        String  sError_Ds
35075>>>>>        String  sError_Tabela
35075>>>>>        Forward Get Validate_Save to iReturnval
35077>>>>>        If (not(iReturnval)) Begin
35079>>>>>            //Move 308002     to iError_Id
35079>>>>>            //Move 'CSAG308'  to sError_Tabela
35079>>>>>            // //--EMPRESA DO PROCESSO NAO CADASTRADO.
35079>>>>>            //Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
35079>>>>>            //Error iError_Id sError_Ds
35079>>>>>            //Move 1 to iReturnVal 
35079>>>>>        End 
35079>>>>>>
35079>>>>>        Function_Return iReturnval
35080>>>>>    End_Function // Validate_Save_PCGS200_03
35081>>>>>
35081>>>>>    Function Validate_Delete_PCGS200_03 Returns Integer
35083>>>>>        Integer iReturnVal
35083>>>>>        Integer iError_Id
35083>>>>>        String  sError_Ds
35083>>>>>        String  sError_Tabela
35083>>>>>        
35083>>>>>        Forward Get Validate_Delete to iReturnVal
35085>>>>>        If not (iReturnVal) Begin
35087>>>>>            //Move 308003     to iError_Id
35087>>>>>            //Move 'CSAG308'  to sError_Tabela
35087>>>>>            // //--EMPRESA DO PROCESSO NAO PODE SER EXCLUIDO.
35087>>>>>            //Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
35087>>>>>            //Error iError_Id sError_Ds
35087>>>>>            //Move 1 to iReturnVal 
35087>>>>>        End    
35087>>>>>>
35087>>>>>        Function_Return iReturnVal
35088>>>>>    End_Function // Validate_Delete_PCGS200_03
35089>>>>>    
Including file: p_FFOperation.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\p_FFOperation.inc)
35089>>>>>>//ANDERSON RODRIGUES - 02.02.2014 - 13:40
35089>>>>>>//-2WA    
35089>>>>>>    //PROCEDURE USADA PELA TABELA PRINCIPAL DO DICIONARIO DE DADOS
35089>>>>>>    Procedure p_FFOperation Integer iOper
35091>>>>>>
35091>>>>>>        //------------------------------------------------------------
35091>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
35091>>>>>>
35091>>>>>>        Clear   CSAG311
35092>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
35093>>>>>>        Find Eq CSAG311                      by 1
35094>>>>>>>
35094>>>>>>        If (Found) Begin
35096>>>>>>            Send p_FileFieldOperation ;                 iOper ;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
35097>>>>>>        End
35097>>>>>>>
35097>>>>>>    End_Procedure // p_FFOperation
35098>>>>>>
35098>>>>>>    
35098>>>>>>    //PROCEDURE USADA PELA(S) TABELA(S) SECUNDARIA(S) DO DICIONARIO DE DADOS
35098>>>>>>    //UTILIZE ESTA PROCEDURE PARA ARMAZENAR LOG(S) DA(S) TABELA(S) SECUNDARIA(S)
35098>>>>>>    //VIDE EXEMPLO cCSAG371DataDictionary.dd
35098>>>>>>    Procedure p_FFOperationTable Integer iOper Integer iTable
35100>>>>>>
35100>>>>>>        //------------------------------------------------------------
35100>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
35100>>>>>>
35100>>>>>>        Clear   CSAG311
35101>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
35102>>>>>>        Find Eq CSAG311                      by 1
35103>>>>>>>
35103>>>>>>        If (Found) Begin
35105>>>>>>            Send p_FileFieldOperationTable;                 iTable;                 iOper;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
35106>>>>>>        End
35106>>>>>>>
35106>>>>>>    End_Procedure // p_FFOperationTable
35107>>>>>>    
35107>>>>>>
35107>>>>>
35107>>>>>End_Class
35108>>>
35108>>>Object oPCGS200_03 Is A cWebBusinessProcess
35110>>>    Set psDescription To "PCGS200_03"
35111>>>    Set pbClearAfterSave To False
35112>>>    
Including file: USUARIOOPERACAO.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\USUARIOOPERACAO.inc)
35112>>>>//-2WA
35112>>>>//2014-01-20
35112>>>>    Procedure SetUsuariosessao String sStart
#REM SEND REGISTERINTERFACE |CI7301 "msg_SetUsuariosessao" "String sStart" ""
35116>>>>        Set psUsuarioSessao to sStart
35117>>>>        Set psPARAMETRO to ''
35118>>>>    End_Procedure // SetUsuariosessao
35119>>>>
35119>>>>    // Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:11
35119>>>>    Procedure SetPrograma String sStart
#REM SEND REGISTERINTERFACE |CI7302 "msg_SetPrograma" "String sStart" ""
35123>>>>        Set psPrograma to sStart
35124>>>>    End_Procedure // SetUsuariosessao
35125>>>>
35125>>>
35125>>>    Object oCCGS200_DD is a cCCGS200_DataDictionary
35127>>>        Send DefineAllExtendedFields
35128>>>        
35128>>>        Set psProgramName to (psDescription(Self))
35129>>>        
Including file: FIELDLABEL.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABEL.INC)
35129>>>>// ANDERSON
35129>>>>// 13.06.2003 - 01:44
35129>>>>// ROTINA PARA SER INCLUIDA EM TODOS OS DDOS DE TODOS WBOS
35129>>>>// 
35129>>>>// PROCEDURE FIELD_DEFAULTS FOI MODIFICADA PARA LER CSAG310
35129>>>>// E EMITIR A LABEL DE CADA CAMPO NA LINGUA INDICADA.
35129>>>>//-2WA
35129>>>>Procedure Field_Defaults
35132>>>>    Forward Send Field_Defaults
35134>>>>
35134>>>>    Handle  hIdiomaFile
35134>>>>    String  sIdiomaFieldName
35134>>>>    String  sIdiomaLogicalName
35134>>>>    Integer iIdiomaNumFields
35134>>>>    Integer iIdiomaX
35134>>>>    
35134>>>>    Get Main_File                       To hIdiomaFile
35135>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  Of hIdiomaFile                To sIdiomaLogicalName
35138>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS Of hIdiomaFile                To iIdiomaNumFields
35141>>>>
35141>>>>    For iIdiomaX from 1 To iIdiomaNumFields
35147>>>>>
35147>>>>
35147>>>>        Get_Attribute DF_FIELD_NAME     Of hIdiomaFile iIdiomaX       To sIdiomaFieldName
35150>>>>
35150>>>>        Clear   CSAG310
35151>>>>        Move sIdiomaLogicalName                     To CSAG310.TABELA
35152>>>>        Move sIdiomaFieldName                       To CSAG310.CAMPO
35153>>>>        Move (piUsuarioIdioma(oPAG800_01(Self)))    To CSAG310.IDIOMA
35154>>>>        Find Eq CSAG310   By 1
35155>>>>>
35155>>>>
35155>>>>        If (CSAG310.APPEARANCE<>"")     Set Field_Label_Long iIdiomaX To (Trim(CSAG310.APPEARANCE))
35158>>>>
35158>>>>    Loop
35159>>>>>
35159>>>>
35159>>>>End_procedure // Field_Defaults
35160>>>>
35160>>>>
35160>>>        
35160>>>        Function Validate_Save  Returns Integer
35163>>>            Integer iReturnVal
35163>>>            Forward Get Validate_Save_PCGS200_03  to iReturnVal
35165>>>            If (not(iReturnVal)) Begin
35167>>>            End
35167>>>>
35167>>>            Function_Return iReturnVal
35168>>>        End_Function   // Validate_Save
35169>>>
35169>>>        Function Validate_Delete  Returns Integer
35172>>>            Integer iReturnVal
35172>>>            Forward Get Validate_Delete_PCGS200_03 to iReturnVal
35174>>>            If not (iReturnVal) Begin
35176>>>            End    
35176>>>>
35176>>>            Function_Return iReturnVal
35177>>>        End_Function // Validate_Delete
35178>>>        
35178>>>        Procedure Creating
35181>>>            Forward Send Creating_PCGS200_03
35183>>>        End_Procedure // Creating
35184>>>        
35184>>>        Procedure Update
35187>>>            Forward Send Update_PCGS200_03
35189>>>        End_Procedure // Update
35190>>>
35190>>>        Procedure Backout
35193>>>            Forward Send Backout_PCGS200_03
35195>>>        End_Procedure // Backout
35196>>>    
35196>>>        Procedure Deleting
35199>>>            Forward Send Deleting_PCGS200_03
35201>>>        End_Procedure // Deleting
35202>>>    
35202>>>        Procedure Save_Main_File
35205>>>            Forward Send Save_Main_File_PCGS200_03
35207>>>        End_Procedure // Save_Main_File        
35208>>>    End_Object // oCCGS200_DD
35209>>>
35209>>>
35209>>>    Set Main_DD To oCCGS200_DD
35210>>>
35210>>>
35210>>>    Send RegisterStandardInterface
35211>>>    // Send RegisterDebugInterface
35211>>>    Send RegisterFullErrorInterface
35212>>>    // Send RegisterAutoEntryInterface
35212>>>
35212>>>    Set pbAllowSaveNew To True
35213>>>    Set pbAllowSaveEdit To True
35214>>>    Set pbAllowDelete To True
35215>>>    Set pbAllowClear To True
35216>>>    Set pbAllowFind To True
35217>>>    Set pbAllowDDUpdate To True
35218>>>
35218>>>    Use facCCGS200.pkg 
Including file: facCCGS200.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\facCCGS200.pkg)
35218>>>>>//--- ABERTURA DO ARQUIVO
35218>>>>>//-2WA
35218>>>>>Open CCGS200 //CCGS200.DEF
35220>>>>>
35220>>>>>Function f_pgCCGS200_DESCRICAO String sCODIGO Returns String
#REM SEND REGISTERINTERFACE |CI7334 "get_f_pgCCGS200_DESCRICAO" "String sCODIGO Returns String" "f_pgCCGS200_DESCRICAO"
35224>>>>>    Clear CCGS200
35225>>>>>    Move sCODIGO   to CCGS200.CODIGO
35226>>>>>    Find Eq CCGS200 by 1
35227>>>>>>
35227>>>>>    If (not(Found)) Function_Return 'REGISTRO NAO ENCONTRATO. VERIFIQUE!'
35230>>>>>    Else Function_Return (Trim(CCGS200.DESCRICAO))
35232>>>>>End_Function //f_pgCCGS200_DESCRICAO
35233>>>>>
35233>>>>>
35233>>>>>Function f_bccgs200_descricao String sInicial String sSessionId Returns String
#REM SEND REGISTERINTERFACE |CI7335 "get_f_bccgs200_descricao" "String sInicial String sSessionId Returns String" "f_bccgs200_descricao"
35237>>>>>    String  sQuebraLinha
35237>>>>>    String  sQuery
35237>>>>>    String  sLinhaAutoComplete
35237>>>>>    String  sListaAutoComplete
35237>>>>>    String  sCodigo
35237>>>>>    String  sExibeInformacao
35237>>>>>    String  sDescricao
35237>>>>>    String  sRecnum
35237>>>>>    String sCCGS200RECNUM      
35237>>>>>    String sCCGS200CODIGO
35237>>>>>    String sCCGS200DESCRICAO
35237>>>>>    String sCCGS200SIGLA
35237>>>>>    
35237>>>>>    String sCCGS200ROWID
35237>>>>>    RowID  riCCGS200ROWID
35237>>>>>   
35237>>>>>    Move (Character(13)+Character(10)) to sQuebraLinha
35238>>>>>    
35238>>>>>    Move (Uppercase(sInicial)) to sInicial
35239>>>>>    Move (Trim(sInicial))      to sInicial
35240>>>>>        
35240>>>>>        Move "" to sQuery
35241>>>>>    CREATE_MAIN_CONNECTION BYFILE CCGS200
35246>>>>>>
35246>>>>>    Move "SELECT TOP 15 RECNUM, CODIGO, DESCRICAO, SIGLA" to sQuery
35247>>>>>    Move (sQuery*"From dbo.CCGS200 WHERE DESCRICAO LIKE '%1'") to sQuery
35248>>>>>    Move (sQuery*"ORDER BY DESCRICAO") to sQuery
35249>>>>>        Move (SFORMAT(sQuery, ('%'+sInicial+'%'))) to sQuery
35250>>>>>    SQL_FIND_BEGIN hStmt_CCGS200_01 sQuery
35269>>>>>>
35269>>>>>        //SqlFindValueByName
35269>>>>>        Move (SqlFindValue(hStmt_CCGS200_01,1))                            to sCCGS200RECNUM
35270>>>>>        Move (SqlFindValue(hStmt_CCGS200_01,2))                            to sCCGS200CODIGO
35271>>>>>        Move (SqlFindValue(hStmt_CCGS200_01,3))                            to sCCGS200DESCRICAO
35272>>>>>        Move (SqlFindValue(hStmt_CCGS200_01,4))                            to sCCGS200SIGLA
35273>>>>>                                                                           
35273>>>>>        //REMOVER ESPACOS EM BRANCO                                        
35273>>>>>        Move (Trim(sCCGS200DESCRICAO))                                      to sCCGS200DESCRICAO
35274>>>>>        Move (Trim(sCCGS200SIGLA))                                          to sCCGS200SIGLA
35275>>>>>                                                                           
35275>>>>>        //IDENTIFICAR OS CAMPOS                                            
35275>>>>>        Move  sCCGS200RECNUM                                                to sRecnum
35276>>>>>        Move  sCCGS200CODIGO                                                to sCodigo
35277>>>>>        Move  sCCGS200DESCRICAO                                             to sDescricao
35278>>>>>        
35278>>>>>        Move (sCCGS200CODIGO*'-'*sCCGS200DESCRICAO*'-'*sCCGS200SIGLA)       to sExibeInformacao
35279>>>>>        
35279>>>>>        //MONTAR O AUTOCOMPLETE
35279>>>>>        Move '{'                                                            to sLinhaAutoComplete
35280>>>>>        Move (sLinhaAutoComplete+'"id":"'+sCodigo+'"')                      to sLinhaAutoComplete
35281>>>>>        Move (sLinhaAutoComplete+',"label":"'+sExibeInformacao+'"')         to sLinhaAutoComplete
35282>>>>>        Move (sLinhaAutoComplete+',"value":"'+sDescricao+'"')               to sLinhaAutoComplete
35283>>>>>        Move (sLinhaAutoComplete+',"sigla":"'+sCCGS200SIGLA+'"')            to sLinhaAutoComplete
35284>>>>>        Move (sLinhaAutoComplete+',"recnum":"'+sRecnum+'"')                 to sLinhaAutoComplete
35285>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
35286>>>>>        //                                                          
35286>>>>>        Move (sListaAutoComplete+If(sListaAutoComplete<>'',',','')+sLinhaAutoComplete) to sListaAutoComplete                    
35287>>>>>                        
35287>>>>>    SQL_FIND_END hStmt_CCGS200_01 
35294>>>>>>
35294>>>>>        
35294>>>>>        If (sListaAutoComplete='') Begin
35296>>>>>        Move '{'                                                            to sLinhaAutoComplete
35297>>>>>        Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
35298>>>>>        Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
35299>>>>>        Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
35300>>>>>        Move (sLinhaAutoComplete+',"sigla":""')                             to sLinhaAutoComplete
35301>>>>>        Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
35302>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
35303>>>>>        //
35303>>>>>        Move sLinhaAutoComplete to sListaAutoComplete
35304>>>>>        End
35304>>>>>>
35304>>>>>        
35304>>>>>    Function_Return ('['+sListaAutoComplete+']')
35305>>>>>        
35305>>>>>End_Function // f_bccgs200_descricao
35306>>>>>
35306>>>>>Function frCGS200_CODIGO String sNOMECOMBO String aUsuarioSessao Returns String
#REM SEND REGISTERINTERFACE |CI7336 "get_frCGS200_CODIGO" "String sNOMECOMBO String aUsuarioSessao Returns String" ""
35310>>>>>    String    sRetorno
35310>>>>>    String    sQuery
35310>>>>>    String    sCSAG308_NR
35310>>>>>    String    sCCGS200CODIGO
35310>>>>>    String    sCCGS200DESCRICAO 
35310>>>>>
35310>>>>>    Move ('<select name="'+(Trim(sNOMECOMBO))+'" id="'+(Trim(sNOMECOMBO))+'" class="col-xs-6">') to sRetorno
35311>>>>>    
35311>>>>>    Clear    CSAG311
35312>>>>>    Move (Trim(aUsuarioSessao) )  to CSAG311.USUARIOSESSAO
35313>>>>>    Find Eq  CSAG311              by 1
35314>>>>>>
35314>>>>>      If (not(Found)) Begin
35316>>>>>         Move (sRetorno+'<option value="">SESSAO INVALIDA. CONTATE ADMINISTRADOR.</option>') to sRetorno
35317>>>>>         Move (sRetorno+'</select>') to sRetorno
35318>>>>>         Function_Return                sRetorno
35319>>>>>      End
35319>>>>>>
35319>>>>>
35319>>>>>    //--- SE NAO VIER A EMPRESA TOMAR COMO BASE A EMPRESA DO USUARIO
35319>>>>>    Move CSAG311.USUARIOECODIGO to sCSAG308_NR
35320>>>>>
35320>>>>>    //--- TODAS AS OPERACAOES
35320>>>>>    Move (sRetorno+'<option value="">TODAS</option>') to sRetorno
35321>>>>>    
35321>>>>>        Move "" to sQuery
35322>>>>>    CREATE_MAIN_CONNECTION BYFILE CCGS200
35327>>>>>>
35327>>>>>    Move "SELECT CODIGO, DESCRICAO FROM dbo.CCGS200" to sQuery
35328>>>>>    SQL_FIND_BEGIN hStmt_CCGS200_01 sQuery
35347>>>>>>
35347>>>>>        //SqlFindValueByName
35347>>>>>        Move (SqlFindValue(hStmt_CCGS200_01,1)) to sCCGS200CODIGO  
35348>>>>>        Move (SqlFindValue(hStmt_CCGS200_01,2)) to sCCGS200DESCRICAO 
35349>>>>>        
35349>>>>>        Move (Trim(sCCGS200CODIGO))    to sCCGS200CODIGO 
35350>>>>>        Move (Trim(sCCGS200DESCRICAO)) to sCCGS200DESCRICAO
35351>>>>>        
35351>>>>>        Move (sRetorno+'<option value="'+sCCGS200CODIGO+'">'+sCCGS200DESCRICAO+'</option>') to sRetorno
35352>>>>>    SQL_FIND_END hStmt_CCGS200_01
35359>>>>>>
35359>>>>>
35359>>>>>    Move (sRetorno+'</select>') to sRetorno
35360>>>>>    Function_Return                sRetorno
35361>>>>>
35361>>>>>End_Function // frCGS200_CODIGO
35362>>>>>
35362>>>>>Function fCGS200_CODIGO String sCONTEUDO String sNOMECOMBO String aUsuarioSessao Returns String
#REM SEND REGISTERINTERFACE |CI7337 "get_fCGS200_CODIGO" "String sCONTEUDO String sNOMECOMBO String aUsuarioSessao Returns String" ""
35366>>>>>    String    sRetorno
35366>>>>>    String    sQuery
35366>>>>>    String    sCCGS200CODIGO
35366>>>>>    String    sCCGS200DESCRICAO 
35366>>>>>
35366>>>>>    Move ('<select name="'+(Trim(sNOMECOMBO))+'" id="'+(Trim(sNOMECOMBO))+'" class="col-xs-6">') to sRetorno
35367>>>>>    
35367>>>>>    Clear    CSAG311
35368>>>>>    Move (Trim(aUsuarioSessao) )  to CSAG311.USUARIOSESSAO
35369>>>>>    Find Eq  CSAG311              by 1
35370>>>>>>
35370>>>>>    If (not(Found)) Begin
35372>>>>>       Move (sRetorno+'<option value="">SESSAO INVALIDA. CONTATE ADMINISTRADOR.</option>') to sRetorno
35373>>>>>       Move (sRetorno+'</select>') to sRetorno
35374>>>>>       Function_Return                sRetorno
35375>>>>>    End
35375>>>>>>
35375>>>>>    Else Move (sRetorno+'<option value="">SELECIONE.</option>') to sRetorno
35377>>>>>
35377>>>>>        Move "" to sQuery
35378>>>>>    CREATE_MAIN_CONNECTION BYFILE CCGS200
35383>>>>>>
35383>>>>>    Move "SELECT CODIGO, DESCRICAO FROM dbo.CCGS200" to sQuery
35384>>>>>    SQL_FIND_BEGIN hStmt_CCGS200_01 sQuery
35403>>>>>>
35403>>>>>        //SqlFindValueByName
35403>>>>>        Move (SqlFindValue(hStmt_CCGS200_01,1)) to sCCGS200CODIGO  
35404>>>>>        Move (SqlFindValue(hStmt_CCGS200_01,2)) to sCCGS200DESCRICAO 
35405>>>>>        
35405>>>>>        Move (Trim(sCCGS200CODIGO))    to sCCGS200CODIGO 
35406>>>>>        Move (Trim(sCCGS200DESCRICAO)) to sCCGS200DESCRICAO
35407>>>>>        
35407>>>>>        Move (sRetorno+'<option '+If(sCCGS200CODIGO=sCONTEUDO,'selected="selected"','')+' value="'+sCCGS200CODIGO+'">'+sCCGS200DESCRICAO+'</option>') to sRetorno
35408>>>>>    SQL_FIND_END hStmt_CCGS200_01
35415>>>>>>
35415>>>>>
35415>>>>>    Move (sRetorno+'</select>') to sRetorno
35416>>>>>    Function_Return                sRetorno
35417>>>>>
35417>>>>>End_Function // fCGS200_CODIGO
35418>>>      
Including file: GeraLinha.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\GeraLinha.inc)
35418>>>>//-------------------------------------
35418>>>>// ANDERSON RODRIGUES - 13:58 - 08/06/2015
35418>>>>// LEONARDO CAMPOS - 16:50 - 09/07/2015
35418>>>>//-2WA
35418>>>>    Procedure GeraLinha String sRowID tFieldTypeofGrid[] FieldTypeofGrid String sRecNum String sTable Handle hDD
35421>>>>        String  sHTMLPADRAO
35421>>>>        String  sHTML
35421>>>>        String  sFieldName
35421>>>>        String  sFieldValue
35421>>>>        String  sFieldSize
35421>>>>        String  sFieldNumber
35421>>>>        String  sPlaceHolder
35421>>>>        String  sFieldClassName
35421>>>>        
35421>>>>        String  sOption
35421>>>>        String  sParams
35421>>>>        String  sValue
35421>>>>        
35421>>>>        Integer iFieldType
35421>>>>        Integer iColumn
35421>>>>        Integer iNumColumns
35421>>>>        Integer iVType
35421>>>>        Integer icCount
35421>>>>        Integer iFieldCount
35421>>>>        
35421>>>>        Boolean bFOUND
35421>>>>        
35421>>>>        Handle  hTable
35421>>>>
35421>>>>        Move (Lowercase(sTable)) to sTable
35422>>>>        
35422>>>>        Send WriteHtml ('<tr id="'+sRecNum+'"> ')
35423>>>>        Send WriteHtml ('<form action="'+(Lowercase(psDescription(Self)))+'.asp?aUsuarioSessao='+psUsuarioSessao(Self)+psPARAMETRO(Self)+'" method="POST" name="'+sTable+'" onsubmit="SetChangedStates(this)">')
35424>>>>        Send WriteHtml ('<input type="hidden" size="15" name="'+sTable+'__rowid" id="'+sTable+'__rowid" value="'+sRowID+'">')
35425>>>>        
35425>>>>        Move (Eval(sTable+'.FILE_NUMBER')) to hTable
35426>>>>        
35426>>>>        Get_Attribute DF_FILE_NUMBER_FIELDS of hTable to iNumColumns
35429>>>>
35429>>>>        Move (SizeOfArray(FieldTypeofGrid)) to icCount
35430>>>>        
35430>>>>        For iColumn from 1 to iNumColumns
35436>>>>>
35436>>>>            
35436>>>>            Get_Attribute DF_FIELD_NAME             of hTable iColumn to sFieldName
35439>>>>            Get_Attribute DF_FIELD_TYPE             of hTable iColumn to iFieldType
35442>>>>            Get_Attribute DF_FIELD_NATIVE_LENGTH    of hTable iColumn to sFieldSize
35445>>>>
35445>>>>        //- Fazer uma tratativa padro para os campos.
35445>>>>        //- ANDERSON RODRIGUES - 2024-10-21
35445>>>>        //  Case Begin
35445>>>>        //     Case (iFieldType = DF_BCD)
35445>>>>        //          If (Integer(sFieldSize) = 0)   Move 15 to sFieldSize
35445>>>>        //          If (Integer(sFieldSize) <= 10) Move 15 to sFieldSize
35445>>>>        //          Case Break
35445>>>>        //     Case (iFieldType = DF_DATE)
35445>>>>        //          If (Integer(sFieldSize) = 0)   Move 15 to sFieldSize
35445>>>>        //          Case Break
35445>>>>        //     Case (iFieldType = DF_DATETIME)
35445>>>>        //          If (Integer(sFieldSize) = 0)   Move 30 to sFieldSize
35445>>>>        //          Case Break
35445>>>>        //     Case Else
35445>>>>        //          If (Integer(sFieldSize) = 0)   Move 55 to sFieldSize
35445>>>>        //          If (Integer(sFieldSize) <= 10) Move 25  to sFieldSize
35445>>>>        //          If (Integer(sFieldSize) > 100) Move 55 to sFieldSize
35445>>>>        //  Case End
35445>>>>            
35445>>>>            Move (Trim(sFieldName))      to sFieldName
35446>>>>            Move (Lowercase(sFieldName)) to sFieldName
35447>>>>            
35447>>>>            Move '' to sOption
35448>>>>            Move '' to sParams
35449>>>>            
35449>>>>            Move (icCount = 0) to bFOUND
35450>>>>            If (not(bFOUND)) Begin
35452>>>>                For iFieldCount from 0 to (icCount - 1)
35458>>>>>
35458>>>>                    If (FieldTypeofGrid[iFieldCount].igridFieldNum = iColumn) Begin
35460>>>>                        Move True to bFOUND
35461>>>>                        Move FieldTypeofGrid[iFieldCount].sgridFieldType  to sOption
35462>>>>                        Move FieldTypeofGrid[iFieldCount].sgridFieldParam to sParams
35463>>>>                        Move (icCount + 99) to iFieldCount    
35464>>>>                    End //(FieldTypeofGrid[iFieldCount].igridFieldNum = iColumn)
35464>>>>>
35464>>>>                Loop
35465>>>>>
35465>>>>            End //(not(bFOUND))
35465>>>>>
35465>>>>            
35465>>>>            If (bFOUND) Begin
35467>>>>
35467>>>>                Get Field_Validation_Type of hDD iColumn to iVType
35468>>>>                
35468>>>>                If (iVType=FA_VALIDATION_TYPE_CHECKBOX) Begin
35470>>>>                    Case Begin
35470>>>>                       Case (sOption = 'DDCHECKBOXFRM')
35472>>>>                            Get DDFormControlCheckBox hDD hTable iColumn sParams to sHTML
35473>>>>                            Case Break
35474>>>>                       Case Else
35474>>>>                            Get DDCheckboxControl hDD hTable iColumn sParams to sHTML
35475>>>>                    Case End
35475>>>>                End
35475>>>>>
35475>>>>                Else If (iVType=FA_VALIDATION_TYPE_CHECK or iVType=FA_VALIDATION_TYPE_TABLE) ;                   Get DDComboControl hDD hTable iColumn sParams to sHTML
35479>>>>                Else Begin
35480>>>>                    Case Begin
35480>>>>                       Case (sOption = 'DDEXTERNAL')
35482>>>>                            Get_Field_Value hTable  iColumn to sValue
35485>>>>                            Move (SFormat(sParams, sValue)) to sParams
35486>>>>                            Move (Eval(sParams)) to sHTML                            
35487>>>>                            Case Break
35488>>>>                       Case (sOption = 'DDCOMBO')
35491>>>>                            Get DDComboControl hDD hTable iColumn sParams to sHTML
35492>>>>                            Case Break
35493>>>>                       Case (sOption = 'DDEDIT')
35496>>>>                            Get DDEditControl hDD hTable iColumn sParams to sHTML
35497>>>>                            Case Break
35498>>>>                       Case (sOption = 'DDFORM')
35501>>>>                            Get DDFormControl hDD hTable iColumn sParams to sHTML
35502>>>>                            Case Break
35503>>>>                       Case (sOption = 'DDRADIO')
35506>>>>                            Get DDRadioControl hDD hTable iColumn sParams to sHTML
35507>>>>                            Case Break
35508>>>>                       Case (sOption = 'DDPWD')
35511>>>>                            Get DDPwdControl hDD hTable iColumn sParams to sHTML
35512>>>>                            Case Break
35513>>>>                       Case (sOption = 'DDFILE')
35516>>>>                            Get DDFileControl hDD hTable iColumn sParams to sHTML
35517>>>>                            Case Break
35518>>>>                       Case (sOption = 'DDHIDDEN')
35521>>>>                            Get DDHiddenControl hDD hTable iColumn sParams to sHTML
35522>>>>                            Case Break
35523>>>>                       Case (sOption = 'DDDISABLED')
35526>>>>                            Get DDFormControlDisabled hDD hTable iColumn sParams to sHTML
35527>>>>                            Case Break
35528>>>>                       Case (sOption = 'DDCHECKBOX')
35531>>>>                            Get DDCheckboxControl hDD hTable iColumn sParams to sHTML
35532>>>>                            Case Break
35533>>>>                       Case (sOption = 'DDDATEBUTTON')
35536>>>>                            Get DDDateInputForm hDD hTable iColumn sParams to sHTML
35537>>>>                            Case Break
35538>>>>                       Case (sOption = 'DDDATEFRM')
35541>>>>                            Get DDFormControlDate hDD hTable iColumn sParams to sHTML
35542>>>>                            Case Break
35543>>>>                       Case (sOption = 'DDCHECKBOXFRM')
35546>>>>                            Get DDFormControlCheckBox hDD hTable iColumn sParams to sHTML
35547>>>>                            Case Break
35548>>>>                       Case Else
35548>>>>                            Get DDFormControl hDD hTable iColumn sParams to sHTML
35549>>>>                   Case End
35549>>>>                End
35549>>>>>
35549>>>>    
35549>>>>            //- ANDERSON RODRIGUES - 2024-10-21 22:17 ------------
35549>>>>            //  configurar a classe para que o input tambm fique 
35549>>>>            //  alinhado com o cabecalho.
35549>>>>                If (not(Pos('class="%1"',sHTML))) Begin
35551>>>>                  //Move (Replaces('<input',sHTML,'<input class="%1" size="%2"')) to sHTML
35551>>>>                    Move (Replaces('<input',sHTML,'<input class="%1"')) to sHTML
35552>>>>                End
35552>>>>>
35552>>>>                Move ('<td class="%1">'+sHTML+'</td>')  to sHTML
35553>>>>                
35553>>>>                Move '' to sFieldValue
35554>>>>                
35554>>>>                Case Begin
35554>>>>                    Case (iFieldType = DF_BCD)   //Showln " - Numeric"
35556>>>>                          Move  (SFormat(sHTML, 'rptR', sFieldSize)) to sHTML
35557>>>>                          Send WriteHtml sHTML
35558>>>>                        Case Break
35559>>>>                    Case (iFieldType = DF_DATE)  //Showln " - Date"
35562>>>>                          Move  (SFormat(sHTML, 'rptC', sFieldSize)) to sHTML
35563>>>>                          Send WriteHtml sHTML
35564>>>>                        Case Break
35565>>>>                    Case Else 
35565>>>>                          //(iFieldType = DF_TEXT)  //Showln " - Text"
35565>>>>                          //(iFieldType = DF_DATETIME)  //Showln " - DateTime"
35565>>>>                          //(iFieldType = DF_ASCII) //Showln " - Ascii"
35565>>>>                          If (sOption = 'DDCHECKBOXFRM') Begin
35567>>>>                            //Move 60 to sFieldSize
35567>>>>                            Move  (SFormat(sHTML, 'rptC', sFieldSize)) to sHTML
35568>>>>                          End
35568>>>>>
35568>>>>                          Else Move  (SFormat(sHTML, 'rptL', sFieldSize)) to sHTML
35570>>>>                          Send WriteHtml sHTML
35571>>>>                        Case Break
35572>>>>                Case End
35572>>>>                
35572>>>>            End //(bFound)
35572>>>>>
35572>>>>        Loop
35573>>>>>
35573>>>>        
35573>>>>        Send WriteHtml  '<td style="width: 112px;">'
35574>>>>        Send WriteHtml  '<button type="Submit" name="Save" id="Save" value="Save" class="btn btn-success" title="Save"><i class="fa fa-floppy-o"></i></button>&nbsp;'
35575>>>>        Send WriteHtml ('<button type="Submit" name="Delete" id="Delete" value="Delete"' * If(sRecNum='0', 'disabled', '') * 'class="btn btn-danger" title="Delete"><i class="fa fa-trash-o"></i></button>')
35576>>>>        Send WriteHtml  '</td>'
35577>>>>        Send WriteHtml  '</form>'
35578>>>>        Send WriteHtml  '</tr>'
35579>>>>    End_Procedure //GeraLinha
35580>>>>
Including file: GERATABELA.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\GERATABELA.inc)
35580>>>>//-------------------------------------
35580>>>>// ANDERSON RODRIGUES - 13:58 - 08/06/2015
35580>>>>//-2WA
35580>>>>    //Struct tFieldTypeofGrid
35580>>>>    //    Integer iGridFieldNum   
35580>>>>    //    String  sGridFieldType  
35580>>>>    //    String  sgridFieldParam 
35580>>>>    //End_Struct //tFieldTypeofGrid
35580>>>>
Including file: FIELDLABELRPT.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABELRPT.INC)
35580>>>>>// Anderson
35580>>>>>// 13.06.2003 - 11:33
35580>>>>>// FUNCAO USADA PARA ESCREVER A LABEL DE CADA COLUNA DO RELATORIO
35580>>>>>//
35580>>>>>// PARA QUE ESTA FUNCAO TRAGA A LABEL CORRESPONDENTE NO IDIOMA
35580>>>>>// EH PRECISO QUE NO DDO DO WBO ESTEJA O PACOTE FIELDLABEL.INC
35580>>>>>//-2WA
35580>>>>>Function ddValueFieldLabel Integer iDDO String sField Returns String 
35583>>>>>    Integer iFile 
35583>>>>>    Integer iField
35583>>>>>    String  sVal
35583>>>>>    String  sLabel
35583>>>>>    Handle  hFile
35583>>>>>    
35583>>>>>    Move (Left(sField,(Pos(".",sField)))+"File_Number")      to sVal
35584>>>>>    Move (Replace(Left(sField,(Pos(".",sField))),sField,"")) to sField
35585>>>>>    
35585>>>>>    Move (Eval(sVal)) to hFile
35586>>>>>    //Pegar o numero do arquivo
35586>>>>>    Get_Attribute DF_FILE_NUMBER Of hFile to iFile
35589>>>>>
35589>>>>>    //Pegar o numero do campo no arquivo
35589>>>>>    Field_Map iFile sField to iField      
35591>>>>>    
35591>>>>>    Get Field_Label_Long of iDDO iField To sLabel
35592>>>>>    Function_Return (HtmlEncode(sLabel))
35593>>>>>    
35593>>>>>End_Function // ddValueFieldLabel
35594>>>>>
35594>>>>>
35594>>>>
35594>>>>
35594>>>>    Function GeraTabela String sStartRowId Integer iMaximo Integer iIndex Integer iNovo String sFields Returns String
#REM SEND REGISTERINTERFACE |CI7339 "get_GeraTabela" "String sStartRowId Integer iMaximo Integer iIndex Integer iNovo String sFields Returns String" ""
35598>>>>        Handle  hDD
35598>>>>        Handle  hTable
35598>>>>        
35598>>>>        String  sHTML
35598>>>>        String  sRecNum
35598>>>>        String  sTable
35598>>>>        String  sColumnName
35598>>>>        String  sFieldName
35598>>>>        String  sFieldParam
35598>>>>        String  sValue
35598>>>>        String  sOption
35598>>>>        
35598>>>>        String  sRowid
35598>>>>        RowID   riFileNumber
35598>>>>    
35598>>>>        Integer iFieldType
35598>>>>        Integer iX
35598>>>>        Integer iNumColumns
35598>>>>        Integer iColumn
35598>>>>        Integer iFieldCount
35598>>>>        Integer iFieldParam
35598>>>>        Integer iSpacePos
35598>>>>        Integer iPos
35598>>>>        Integer icCount
35598>>>>
35598>>>>        Boolean bFOUND
35598>>>>        
35598>>>>        tFieldTypeofGrid[] FieldTypeofGrid
35598>>>>        tFieldTypeofGrid[] FieldTypeofGrid
35599>>>>        
35599>>>>        Get Main_DD   to hDD
35600>>>>        Get Main_File of hDD to hTable
35601>>>>
35601>>>>        //Header da Grid
35601>>>>        Send WriteHtml '<table class="table table-bordered table-striped table-hover">'
35602>>>>        Send WriteHtml '<thead>'
35603>>>>        Send WriteHtml '<tr>'
35604>>>>        
35604>>>>        
35604>>>>        //--- IDENTIFICAR OS PARAMETROS
35604>>>>            // Repeat as long as sText contains data
35604>>>>        Move (ResizeArray(FieldTypeofGrid, 0)) to FieldTypeofGrid             
35605>>>>        While (sFields <> "")
35609>>>>            // Find the first/next space
35609>>>>            Move (Pos ("|", sFields)) to iSpacePos
35610>>>>            Move "" to sFieldParam
35611>>>>            
35611>>>>            // If a space was found
35611>>>>            If (iSpacePos > 0) Begin
35613>>>>                // Take the left part
35613>>>>                Move (Left (sFields, iSpacePos - 1)) to sFieldParam
35614>>>>                // Move the remainder to the text variable
35614>>>>                Move (Right (sFields, Length (sFields) - iSpacePos)) to sFields
35615>>>>            End //(iSpacePos > 0)
35615>>>>>
35615>>>>            Else Move sFields to sFieldParam
35617>>>>            
35617>>>>            If (sFieldParam <> "") Begin
35619>>>>                Move 0 to iFieldParam
35620>>>>                
35620>>>>                While (sFieldParam <> "")
35624>>>>                    // Find the first/next space
35624>>>>                    Move (Pos (";", sFieldParam)) to iPos
35625>>>>                    
35625>>>>                    // If a space was found
35625>>>>                    If (iPos > 0) Begin
35627>>>>                        // Take the left part
35627>>>>                        Move (Left (sFieldParam, iPos - 1)) to sValue
35628>>>>                        // Move the remainder to the text variable
35628>>>>                        Move (Right (sFieldParam, Length (sFieldParam) - iPos)) to sFieldParam
35629>>>> 
35629>>>>                        If (iFieldParam = 0);                            Move sValue to FieldTypeofGrid[iFieldCount].igridFieldNum
35632>>>>                        If (iFieldParam = 1);                            Move sValue to FieldTypeofGrid[iFieldCount].sgridFieldType
35635>>>>
35635>>>>                    End //(iPos > 0)
35635>>>>>
35635>>>>                    Else Begin
35636>>>>                        Move sFieldParam to sValue
35637>>>>                        If (iFieldParam = 0);                            Move sValue to FieldTypeofGrid[iFieldCount].igridFieldNum
35640>>>>                        If (iFieldParam = 1);                            Move sValue to FieldTypeofGrid[iFieldCount].sgridFieldType
35643>>>>                        If (iFieldParam = 2);                            Move sValue to FieldTypeofGrid[iFieldCount].sgridFieldParam
35646>>>>                        // Empty text to stop the loop
35646>>>>                        Move "" to sFieldParam
35647>>>>                    End
35647>>>>>
35647>>>>                    Increment iFieldParam
35648>>>>                Loop
35649>>>>>
35649>>>>                
35649>>>>            End //(sFieldParam <> "")
35649>>>>>
35649>>>>            
35649>>>>            If (iSpacePos = 0) Move "" to sFields                
35652>>>>            Increment iFieldCount
35653>>>>        Loop
35654>>>>>
35654>>>>
35654>>>>        Get_Attribute DF_FILE_NUMBER_FIELDS of hTable to iNumColumns
35657>>>>        Get_Attribute DF_FILE_TABLE_NAME    of hTable to sTable
35660>>>>        
35660>>>>        Move (SizeOfArray(FieldTypeofGrid)) to icCount
35661>>>>        Move (Trim(sTable)) to sTable
35662>>>>        
35662>>>>        For iColumn from 1 to iNumColumns
35668>>>>>
35668>>>>            
35668>>>>            Get_Attribute DF_FIELD_NAME of hTable iColumn to sFieldName
35671>>>>            Get_Attribute DF_FIELD_TYPE of hTable iColumn to iFieldType
35674>>>>            
35674>>>>            Move (Trim(sFieldName)) to sFieldName
35675>>>>            Move (icCount = 0) to bFOUND
35676>>>>            If (not(bFOUND)) Begin
35678>>>>                For iFieldCount from 0 to (icCount - 1)
35684>>>>>
35684>>>>                    If (FieldTypeofGrid[iFieldCount].igridFieldNum = iColumn) Begin
35686>>>>                        Move FieldTypeofGrid[iFieldCount].sgridFieldType to sOption    
35687>>>>                        Move True to bFOUND
35688>>>>                        Move (icCount + 99) to iFieldCount
35689>>>>                    End //(FieldTypeofGrid[iFieldCount].igridFieldNum = iColumn)
35689>>>>>
35689>>>>                Loop
35690>>>>>
35690>>>>            End
35690>>>>>
35690>>>>
35690>>>>            If (bFOUND) Begin
35692>>>>                Get ddValueFieldlabel hDD (sTable+"."+sFieldName) to sColumnName  
35693>>>>                
35693>>>>                Move '' to sHTML
35694>>>>                If (sOption = 'DDEXTERNAL' or sOption = 'DDCOMBO' or sOption = 'DDRADIO' or sOption = 'DDCHECKBOX' or sOption = 'DDPWD') ;                    Move ('<th class="rptL">%1</th>') to sHTML
35697>>>>                    
35697>>>>                Move (Trim(sColumnName)) to sColumnName  
35698>>>>                Case Begin
35698>>>>                    Case (iFieldType = DF_BCD)   //Showln " - Numeric"
35700>>>>                          If (sHTML = '');                              Move ('<th class="rptR">%1</th>') to sHTML
35703>>>>                          Move (SFormat(sHTML, sColumnName)) to sHTML
35704>>>>                          Send WriteHtml sHTML
35705>>>>                        Case Break
35706>>>>                    Case (iFieldType = DF_DATE)  //Showln " - Date"
35709>>>>                          Move ('<th style="width: 20%;" class="rptC">%1</th>') to sHTML
35710>>>>                          Move (SFormat(sHTML, sColumnName)) to sHTML
35711>>>>                          Send WriteHtml sHTML
35712>>>>                        Case Break
35713>>>>                    Case Else 
35713>>>>                          //(iFieldType = DF_DATETIME)  //Showln " - DateTime"
35713>>>>                          //(iFieldType = DF_ASCII) //Showln " - Ascii"
35713>>>>                          //(iFieldType = DF_TEXT) //Showln " - Text"
35713>>>>                          Move ('<th class="rptL">%1</th>') to sHTML
35714>>>>                          Move (SFormat(sHTML, sColumnName)) to sHTML
35715>>>>                          Send WriteHtml sHTML
35716>>>>                        Case Break
35717>>>>                Case End
35717>>>>            End //(bFound)
35717>>>>>
35717>>>>        Loop
35718>>>>>
35718>>>>
35718>>>>        Send WriteHtml '<th style="width: 112px;"></th>'
35719>>>>        Send WriteHtml '</tr>'
35720>>>>        Send WriteHtml '</thead>'
35721>>>>        Send WriteHtml '<tbody>'
35722>>>>
35722>>>>        If (iNovo=1) Begin
35724>>>>        //--- Gera linha para Inclusao de um Novo Registro
35724>>>>            Move 0 to sRecNum
35725>>>>            Send GeraLinha sRowId FieldTypeofGrid sRecNum sTable hDD
35726>>>>        End
35726>>>>>
35726>>>>
35726>>>>        Move False to bFOUND
35727>>>>        
35727>>>>        If (sStartRowId<>'') Begin
35729>>>>        //--- Se sStartRowId<>'' posiciona o registro inicial pelo sStartRowId
35729>>>>            Move (DeserializeRowId(sStartRowId)) to riFileNumber
35730>>>>            If (not(IsNullRowId(riFileNumber))) Begin      
35732>>>>                Move (FindByRowId(hTable, riFileNumber)) to bFOUND
35733>>>>            End
35733>>>>>
35733>>>>        End
35733>>>>>
35733>>>>        
35733>>>>        If (bFOUND) Begin
35735>>>>            Send FindByRowId of hDD hTable riFileNumber
35736>>>>        End //(bFOUND)
35736>>>>>
35736>>>>        Else Begin
35737>>>>        //--- Senao busca pelo primeiro registro ou pelo ndice iIndex
35737>>>>            Send Clear of hDD
35738>>>>            Send Find  of hDD Gt iIndex
35739>>>>        End
35739>>>>>
35739>>>>        
35739>>>>        //--- Se encontrou o primeiro, prosseguir at, o nmero mx linhas ou final do arquivo
35739>>>>        While ((Found) and (iX<iMaximo))
35743>>>>            //--- Contador de linhas geradas
35743>>>>            Increment iX
35744>>>>
35744>>>>            //--- Recuperando valores dos campos a serem exibidos
35744>>>>            Move (GetRowID(hTable))             to riFileNumber
35745>>>>            Move (SerializeRowId(riFileNumber)) to sRowid
35746>>>>            
35746>>>>            //--- Gerando linhas da Grid
35746>>>>            Get Current_Record of hDD to sRecNum
35747>>>>            Send GeraLinha sRowid FieldTypeofGrid sRecNum sTable hDD
35748>>>>
35748>>>>            //--- Procurar proximo registro
35748>>>>            Send Find of hDD Gt iIndex
35749>>>>            
35749>>>>            //--- Guardar o proximo registro a ser lido
35749>>>>            Move (GetRowID(hTable))             to riFileNumber
35750>>>>            Move (SerializeRowId(riFileNumber)) to sRowid
35751>>>>        Loop
35752>>>>>
35752>>>>        
35752>>>>        //--- Se for fim de arquivo, limpar sRowid
35752>>>>        If (not(Found) or (iX<iMaximo)) Move "" to sRowid
35755>>>>        
35755>>>>        //--- Final da grid
35755>>>>        Send WriteHtml '</tbody>'
35756>>>>        Send WriteHtml '</table>'
35757>>>>        
35757>>>>        Function_Return sRowid
35758>>>>    End_Procedure // GeraTabela
35759>>>>
35759>>>
35759>>>End_Object // oPCGS200_03
35760>    Use PCGS210_01.wo  //- Cadastro de Produtos
Including file: PCGS210_01.wo    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\PCGS210_01.wo)
35760>>>//-2WA--
35760>>>// PCGS210_01.wo
35760>>>// PCGS210_01
35760>>>Use cWebBusinessProcess.pkg
35760>>>
35760>>>Use cCCGS210_DataDictionary.dd
Including file: cCCGS210_DataDictionary.dd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\cCCGS210_DataDictionary.dd)
35760>>>>>//-2WA
35760>>>>>Use CtrlData.PKG
35760>>>>>
35760>>>>>Open CCGS210
Including file: CCGS210.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS210.fd)
35762>>>>>Open HCGS2103
Including file: HCGS2103.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HCGS2103.fd)
35764>>>>>Open CCGS200
35766>>>>>Open CCGS201
Including file: CCGS201.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS201.fd)
35768>>>>>Open CCGS202
Including file: CCGS202.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS202.fd)
35770>>>>>Open CCGS203
Including file: CCGS203.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS203.fd)
35772>>>>>Open CCGS204
35774>>>>>Open CCGS205
Including file: CCGS205.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS205.fd)
35776>>>>>Open CCGS206
35778>>>>>Open CSAG336
35780>>>>>Open CCGS211
Including file: CCGS211.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS211.fd)
35782>>>>>
35782>>>>>Class cCCGS210_DataDictionary is a c_DataDictionary
35783>>>>>    
35783>>>>>    Procedure Construct_Object
35785>>>>>        Forward Send Construct_Object
35787>>>>>        Set Main_file to CCGS210.File_Number
35788>>>>>        Set Add_System_File to TSMG801.File_Number DD_Lock_On_All
35789>>>>>        Set Add_System_File to CCGS211.File_Number DD_Lock_On_New_Save
35790>>>>>
35790>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
35791>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
35792>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
35793>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
35794>>>>>
35794>>>>>        Set Field_Label_Long Field CCGS210.CODIGO to "CODIGO DO PRODUTO"
35795>>>>>        Set Field_Label_Short Field CCGS210.CODIGO to "CODIGO DO PRODUTO"
35796>>>>>
35796>>>>>        Set Field_Label_Long Field CCGS210.DESCRICAO to "DESCRICAO DO PRODUTO"
35797>>>>>        Set Field_Label_Short Field CCGS210.DESCRICAO to "DESCRICAO DO PRODUTO"
35798>>>>>        Set Field_Option Field CCGS210.DESCRICAO DD_CAPSLOCK to True
35799>>>>>
35799>>>>>        Set Field_Label_Long Field CCGS210.OPERACAO to "OPERACAO"
35800>>>>>        Set Field_Label_Short Field CCGS210.OPERACAO to "OPERACAO"
35801>>>>>        Set Field_Option Field CCGS210.OPERACAO DD_CAPSLOCK to True
35802>>>>>
35802>>>>>        Set Field_Label_Long Field CCGS210.CCGS215_ID to "MODAL"
35803>>>>>        Set Field_Label_Short Field CCGS210.CCGS215_ID to "MODAL"
35804>>>>>
35804>>>>>        Set Field_Label_Long Field CCGS210.CCGS216_ID to "MODAL DTL"
35805>>>>>        Set Field_Label_Short Field CCGS210.CCGS216_ID to "MODAL DTL"
35806>>>>>        Set Field_Option Field CCGS210.CCGS216_ID DD_CAPSLOCK to True
35807>>>>>
35807>>>>>        Set Field_Label_Long Field CCGS210.CSAG336_ID to "STATUS"
35808>>>>>
35808>>>>>        Set Field_Label_Long Field CCGS210.STATUS_DT_ATIVO to "ATIVO DESDE"
35809>>>>>        Set Field_Label_Short Field CCGS210.STATUS_DT_ATIVO to "ATIVO DESDE"
35810>>>>>        Set Field_Option Field CCGS210.STATUS_DT_ATIVO DD_NOENTER to True
35811>>>>>
35811>>>>>        Set Field_Label_Long Field CCGS210.STATUS_DT_INATIVO to "INATIVO DESDE"
35812>>>>>        Set Field_Label_Short Field CCGS210.STATUS_DT_INATIVO to "INATIVO DESDE"
35813>>>>>        Set Field_Option Field CCGS210.STATUS_DT_INATIVO DD_NOENTER to True
35814>>>>>
35814>>>>>        Set Field_Label_Long Field CCGS210.OBSERVACAO to "OBSERVACAO"
35815>>>>>        Set Field_Label_Short Field CCGS210.OBSERVACAO to "OBSERVACAO"
35816>>>>>
35816>>>>>        Set Field_Label_Long Field CCGS210.ANUAL_AWB to "Anual AWB"
35817>>>>>
35817>>>>>        Set Field_Label_Long Field CCGS210.ANUAL_TEUS to "Anual TEUS"
35818>>>>>
35818>>>>>        Set Field_Label_Long Field CCGS210.ANUAL_CBM to "Anual CBM"
35819>>>>>
35819>>>>>        Set Field_Label_Long Field CCGS210.ANUAL_HBL to "Anual HBL"
35820>>>>>
35820>>>>>        Set Field_Label_Long Field CCGS210.ANUAL_TON to "Anual TON"
35821>>>>>
35821>>>>>        Set Field_Label_Long Field CCGS210.FOLLOW_UP to "APARECE NO FUP?"
35822>>>>>
35822>>>>>        Set Field_Label_Long Field CCGS210.USUARIO_ID_C to "CRIADO POR"
35823>>>>>        Set Field_Label_Short Field CCGS210.USUARIO_ID_C to "CRIADO POR"
35824>>>>>        Set Field_Option Field CCGS210.USUARIO_ID_C DD_NOENTER to True
35825>>>>>
35825>>>>>        Set Field_Label_Long Field CCGS210.DATE_TIME_C to "DATA E HORA DE CRIACAO"
35826>>>>>        Set Field_Label_Short Field CCGS210.DATE_TIME_C to "DATA E HORA DE CRIACAO"
35827>>>>>        Set Field_Option Field CCGS210.DATE_TIME_C DD_NOENTER to True
35828>>>>>
35828>>>>>        Set Field_Label_Long Field CCGS210.USUARIO_ID_A to "ALTERADO POR"
35829>>>>>        Set Field_Label_Short Field CCGS210.USUARIO_ID_A to "ALTERADO POR"
35830>>>>>        Set Field_Option Field CCGS210.USUARIO_ID_A DD_NOENTER to True
35831>>>>>
35831>>>>>        Set Field_Label_Long Field CCGS210.DATE_TIME_A to "DATA E HORA DE ALTERACAO"
35832>>>>>        Set Field_Label_Short Field CCGS210.DATE_TIME_A to "DATA E HORA DE ALTERACAO"
35833>>>>>        Set Field_Option Field CCGS210.DATE_TIME_A DD_NOENTER to True
35834>>>>>
35834>>>>>    End_Procedure
35835>>>>>    
35835>>>>>    Procedure Creating_PCGS210_01
35837>>>>>        Forward Send Creating
35839>>>>>        DateTime dtCurrentDateTime
35839>>>>>        String sPessoas sPess
35839>>>>>        Integer iSpacePos
35839>>>>>        
35839>>>>>        //------------------------------------------------------------
35839>>>>>        //---Pesquisando Master Geral Codigos
35839>>>>>    
35839>>>>>             Clear   TSMG801
35840>>>>>             Smart_Find Ge TSMG801   by 0
35851>>>>>               If (Found)      Begin
35853>>>>>                  Add 1 to TSMG801.CCGS210_CODIGO
35854>>>>>                  SaveRecord TSMG801
35855>>>>>               End
35855>>>>>>
35855>>>>>    
35855>>>>>        //------------------------------------------------------------
35855>>>>>        //---Movimentando o Codigo AutoIncrementavel ao TSMG801
35855>>>>>    
35855>>>>>            Move TSMG801.CCGS210_CODIGO to CCGS210.CODIGO
35856>>>>>
35856>>>>>            If (CCGS210.CSAG336_ID = '1') Begin
35858>>>>>                Move (CurrentDateTime())       to CCGS210.STATUS_DT_ATIVO
35859>>>>>            End
35859>>>>>>
35859>>>>>             
35859>>>>>    
35859>>>>>        //------------------------------------------------------------
35859>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
35859>>>>>    
35859>>>>>            Clear   CSAG311
35860>>>>>            Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
35861>>>>>            Find Eq CSAG311                      by 1
35862>>>>>>
35862>>>>>              If (Found) Begin                   
35864>>>>>                  Send p_RegistraAcessoUsuario "CCGS210.USUARIO_ID_C" CSAG311.USUARIONUMERO
35865>>>>>              End
35865>>>>>>
35865>>>>>              
35865>>>>>              
35865>>>>>        //---- NOVO PRODUTO SERA INSERIDO PARA TODAS AS PESSOAS EXISTENTES NA CCGS211
35865>>>>>        SQL_FIND_BEGIN hStmt_pessoas "SELECT DISTINCT(CSAG320_ID) FROM DBO.CCGS211"
35884>>>>>>
35884>>>>>            If (sPessoas <> "") Move (sPessoas+','+SqlFindValue(hStmt_pessoas,1)) to sPessoas
35887>>>>>            Else Move (SqlFindValue(hStmt_pessoas,1)) to sPessoas
35889>>>>>        SQL_FIND_END hStmt_pessoas 
35896>>>>>>
35896>>>>>        While (sPessoas <> "")
35900>>>>>            Move (Pos (",", sPessoas))  to iSpacePos
35901>>>>>            If (iSpacePos > 0) Begin
35903>>>>>                Move (Left  (sPessoas, iSpacePos - 1))                 to sPess
35904>>>>>                Move (Right (sPessoas, Length (sPessoas) - iSpacePos))  to sPessoas
35905>>>>>            End
35905>>>>>>
35905>>>>>            Else Begin
35906>>>>>                Move sPessoas  to sPess
35907>>>>>                Move ""       to sPessoas
35908>>>>>            End
35908>>>>>>
35908>>>>>            
35908>>>>>            Clear CCGS211
35909>>>>>            Move (Number(sPess))                to CCGS211.CSAG320_ID     
35910>>>>>            Move CCGS210.CODIGO                 to CCGS211.CCGS210_ID     
35911>>>>>            Move "A"                            to CCGS211.STATUS         
35912>>>>>            Move (99999)                        to CCGS211.USUARIO_ID_A   //Sistema              
35913>>>>>            Move (CurrentDateTime())            to CCGS211.DATE_TIME_A    
35914>>>>>                        
35914>>>>>            SaveRecord CCGS211
35915>>>>>            Send p_FFOperationTable 2 CCGS211.File_Number
35916>>>>>        Loop           
35917>>>>>>
35917>>>>>    
35917>>>>>    End_Procedure // Creating_PCGS210_01
35918>>>>>    
35918>>>>>        Procedure Update_PCGS210_01
35920>>>>>            String  sNRDOCTO
35920>>>>>            Forward Send Update
35922>>>>>
35922>>>>>            //------------------------------------------------------------    
35922>>>>>            //--- CONFIGURANDO QUANDO ATIOVADO OU INATIVADO
35922>>>>>               If (CCGS210.CSAG336_ID = 2) Begin
35924>>>>>                   Move (CurrentDateTime())       to CCGS210.STATUS_DT_INATIVO
35925>>>>>               End
35925>>>>>>
35925>>>>>    
35925>>>>>               If (CCGS210.CSAG336_ID = 1 and CCGS210.STATUS_DT_INATIVO <> '01/01/1753 00:00:00') Begin
35927>>>>>                   Move '01/01/1753 00:00:00'     to CCGS210.STATUS_DT_INATIVO
35928>>>>>                   Move (CurrentDateTime())       to CCGS210.STATUS_DT_ATIVO
35929>>>>>               End
35929>>>>>>
35929>>>>>                   
35929>>>>>        
35929>>>>>            //------------------------------------------------------------
35929>>>>>            //---Configurando os dados do MODAL de acordo com o MODAL DTL
35929>>>>>               Clear CCGS216
Including file: CCGS216.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CCGS216.fd)
35930>>>>>               Move CCGS210.CCGS216_ID to CCGS216.CODIGO
35931>>>>>               Find Eq CCGS216 by 1
35932>>>>>>
35932>>>>>               
35932>>>>>               Move CCGS216.CCGS215_ID to CCGS210.CCGS215_ID
35933>>>>>
35933>>>>>        
35933>>>>>            //------------------------------------------------------------
35933>>>>>            //---Configurando os dados Usuario Que Esta Cadastrando
35933>>>>>        
35933>>>>>                 Clear   CSAG311
35934>>>>>                 Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
35935>>>>>                 Find Eq CSAG311                      by 1
35936>>>>>>
35936>>>>>                   If (Found) Begin
35938>>>>>                       Send p_RegistraAcessoUsuario "CCGS210.USUARIO_ID_A" CSAG311.USUARIONUMERO
35939>>>>>                   End
35939>>>>>>
35939>>>>>        
35939>>>>>        End_Procedure // Update_PCGS210_01
35940>>>>>
35940>>>>>        Procedure Deleting_PCGS210_01
35942>>>>>           String sQuery
35942>>>>>           Forward Send Deleting
35944>>>>>           
35944>>>>>           Move "delete from dbo.CCGS211 where CCGS210_ID = %1" to sQuery
35945>>>>>           Move (SFormat(sQuery, CCGS210.CODIGO)) to sQuery
35946>>>>>           SQL_EXECUTE hStmt_CCGS211_01 sQuery 
35965>>>>>>
35965>>>>>
35965>>>>>           Send p_FFOperation 3 
35966>>>>>        End_Procedure   // Deleting_PCGS210_01
35967>>>>>
35967>>>>>        Procedure Save_Main_File_PCGS210_01
35969>>>>>            Integer iRECNUM
35969>>>>>            Move CCGS210.RECNUM to iRECNUM
35970>>>>>            Forward Send Save_Main_File
35972>>>>>            If (iRECNUM=0) Begin
35974>>>>>                //--- NOVO REGISTRO
35974>>>>>                Send p_FFOperation 2
35975>>>>>            End // If (iRECNUM=0) Begin
35975>>>>>>
35975>>>>>            Else Begin
35976>>>>>              //--- REGISTRO ALTERADO
35976>>>>>                Send p_FFOperation 1 
35977>>>>>            End
35977>>>>>>
35977>>>>>                        
35977>>>>>        End_Procedure // Save_Main_File_PCGS210_01
35978>>>>>        
35978>>>>>        Procedure Backout_PCGS210_01
35980>>>>>            Forward Send Backout
35982>>>>>            Send p_FFOperation 0
35983>>>>>        End_Procedure   // Backout_PCGS210_01
35984>>>>>        
35984>>>>>        Function Validate_Save_PCGS210_01 Returns Integer
35986>>>>>            Integer iReturnval
35986>>>>>            Integer iError_Id
35986>>>>>            String  sError_Ds
35986>>>>>            String  sError_Tabela
35986>>>>>            Forward Get Validate_Save to iReturnval
35988>>>>>            If (not(iReturnval)) Begin
35990>>>>>                //Move 308002     to iError_Id
35990>>>>>                //Move 'CSAG308'  to sError_Tabela
35990>>>>>                // //--EMPRESA DO PROCESSO NAO CADASTRADO.
35990>>>>>                //Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
35990>>>>>                //Error iError_Id sError_Ds
35990>>>>>                //Move 1 to iReturnVal 
35990>>>>>            End 
35990>>>>>>
35990>>>>>            Function_Return iReturnval
35991>>>>>        End_Function // Validate_Save_PCGS210_01
35992>>>>>
35992>>>>>        Function Validate_Delete_PCGS210_01 Returns Integer
35994>>>>>            Integer iReturnVal
35994>>>>>            Integer iError_Id
35994>>>>>            String  sError_Ds
35994>>>>>            String  sError_Tabela
35994>>>>>            String sRecnum
35994>>>>>            
35994>>>>>            Forward Get Validate_Delete to iReturnVal
35996>>>>>            If not (iReturnVal) Begin
35998>>>>>                
35998>>>>>                SQL_FIND_BEGIN hStmt_hcgs2103 (SFORMAT("SELECT RECNUM FROM DBO.HCGS2103 WHERE CCGS210_ID = %1", CCGS210.CODIGO))
36017>>>>>>
36017>>>>>                    Move (SqlFindValue(hStmt_hcgs2103,1)) to sRecnum
36018>>>>>                SQL_FIND_END hStmt_hcgs2103 
36025>>>>>>
36025>>>>>                If (sRecnum <> "") Begin
36027>>>>>                   Move 2103000        to iError_Id
36028>>>>>                   Move 'HCGS2103'     to sError_Tabela
36029>>>>>                    //--PRODUTO EM USO NAO PODE SER EXCLUIDO, SOMENTE INATIVAR.
36029>>>>>                   Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
36030>>>>>                   Error iError_Id sError_Ds
36031>>>>>>
36031>>>>>                   Move 1 to iReturnVal 
36032>>>>>                End
36032>>>>>>
36032>>>>>                
36032>>>>>            End    
36032>>>>>>
36032>>>>>            Function_Return iReturnVal
36033>>>>>        End_Function // Validate_Delete_PCGS210_01
36034>>>>>        
Including file: p_FFOperation.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\p_FFOperation.inc)
36034>>>>>>//ANDERSON RODRIGUES - 02.02.2014 - 13:40
36034>>>>>>//-2WA    
36034>>>>>>    //PROCEDURE USADA PELA TABELA PRINCIPAL DO DICIONARIO DE DADOS
36034>>>>>>    Procedure p_FFOperation Integer iOper
36036>>>>>>
36036>>>>>>        //------------------------------------------------------------
36036>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
36036>>>>>>
36036>>>>>>        Clear   CSAG311
36037>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
36038>>>>>>        Find Eq CSAG311                      by 1
36039>>>>>>>
36039>>>>>>        If (Found) Begin
36041>>>>>>            Send p_FileFieldOperation ;                 iOper ;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
36042>>>>>>        End
36042>>>>>>>
36042>>>>>>    End_Procedure // p_FFOperation
36043>>>>>>
36043>>>>>>    
36043>>>>>>    //PROCEDURE USADA PELA(S) TABELA(S) SECUNDARIA(S) DO DICIONARIO DE DADOS
36043>>>>>>    //UTILIZE ESTA PROCEDURE PARA ARMAZENAR LOG(S) DA(S) TABELA(S) SECUNDARIA(S)
36043>>>>>>    //VIDE EXEMPLO cCSAG371DataDictionary.dd
36043>>>>>>    Procedure p_FFOperationTable Integer iOper Integer iTable
36045>>>>>>
36045>>>>>>        //------------------------------------------------------------
36045>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
36045>>>>>>
36045>>>>>>        Clear   CSAG311
36046>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
36047>>>>>>        Find Eq CSAG311                      by 1
36048>>>>>>>
36048>>>>>>        If (Found) Begin
36050>>>>>>            Send p_FileFieldOperationTable;                 iTable;                 iOper;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
36051>>>>>>        End
36051>>>>>>>
36051>>>>>>    End_Procedure // p_FFOperationTable
36052>>>>>>    
36052>>>>>>
36052>>>>>
36052>>>>>    Procedure Field_Defaults
36054>>>>>        Forward Send Field_Defaults
36056>>>>>        Set Field_Changed_Value Field CCGS210.ANUAL_AWB to "0"
36057>>>>>        Set Field_Changed_Value Field CCGS210.ANUAL_TEUS to "0"
36058>>>>>        Set Field_Changed_Value Field CCGS210.ANUAL_CBM to "0"
36059>>>>>        Set Field_Changed_Value Field CCGS210.ANUAL_HBL to "0"
36060>>>>>        Set Field_Changed_Value Field CCGS210.ANUAL_TON to "0"
36061>>>>>        Set Field_Changed_Value Field CCGS210.FOLLOW_UP to "1"
36062>>>>>    End_Procedure
36063>>>>>
36063>>>>>
36063>>>>>End_Class
36064>>>
36064>>>Object oPCGS210_01 Is A cWebBusinessProcess
36066>>>    Set psDescription To "PCGS210_01"
36067>>>    Set pbClearAfterSave to False
36068>>>    
Including file: USUARIOOPERACAO.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\USUARIOOPERACAO.inc)
36068>>>>//-2WA
36068>>>>//2014-01-20
36068>>>>    Procedure SetUsuariosessao String sStart
#REM SEND REGISTERINTERFACE |CI7301 "msg_SetUsuariosessao" "String sStart" ""
36072>>>>        Set psUsuarioSessao to sStart
36073>>>>        Set psPARAMETRO to ''
36074>>>>    End_Procedure // SetUsuariosessao
36075>>>>
36075>>>>    // Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:11
36075>>>>    Procedure SetPrograma String sStart
#REM SEND REGISTERINTERFACE |CI7302 "msg_SetPrograma" "String sStart" ""
36079>>>>        Set psPrograma to sStart
36080>>>>    End_Procedure // SetUsuariosessao
36081>>>>
36081>>>
36081>>>
36081>>>    Object oCCGS210_DD Is A cCCGS210_DataDictionary
36083>>>        Send DefineAllExtendedFields
36084>>>        
36084>>>        Set psProgramName to (psDescription(Self))
36085>>>        
Including file: FIELDLABEL.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABEL.INC)
36085>>>>// ANDERSON
36085>>>>// 13.06.2003 - 01:44
36085>>>>// ROTINA PARA SER INCLUIDA EM TODOS OS DDOS DE TODOS WBOS
36085>>>>// 
36085>>>>// PROCEDURE FIELD_DEFAULTS FOI MODIFICADA PARA LER CSAG310
36085>>>>// E EMITIR A LABEL DE CADA CAMPO NA LINGUA INDICADA.
36085>>>>//-2WA
36085>>>>Procedure Field_Defaults
36088>>>>    Forward Send Field_Defaults
36090>>>>
36090>>>>    Handle  hIdiomaFile
36090>>>>    String  sIdiomaFieldName
36090>>>>    String  sIdiomaLogicalName
36090>>>>    Integer iIdiomaNumFields
36090>>>>    Integer iIdiomaX
36090>>>>    
36090>>>>    Get Main_File                       To hIdiomaFile
36091>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  Of hIdiomaFile                To sIdiomaLogicalName
36094>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS Of hIdiomaFile                To iIdiomaNumFields
36097>>>>
36097>>>>    For iIdiomaX from 1 To iIdiomaNumFields
36103>>>>>
36103>>>>
36103>>>>        Get_Attribute DF_FIELD_NAME     Of hIdiomaFile iIdiomaX       To sIdiomaFieldName
36106>>>>
36106>>>>        Clear   CSAG310
36107>>>>        Move sIdiomaLogicalName                     To CSAG310.TABELA
36108>>>>        Move sIdiomaFieldName                       To CSAG310.CAMPO
36109>>>>        Move (piUsuarioIdioma(oPAG800_01(Self)))    To CSAG310.IDIOMA
36110>>>>        Find Eq CSAG310   By 1
36111>>>>>
36111>>>>
36111>>>>        If (CSAG310.APPEARANCE<>"")     Set Field_Label_Long iIdiomaX To (Trim(CSAG310.APPEARANCE))
36114>>>>
36114>>>>    Loop
36115>>>>>
36115>>>>
36115>>>>End_procedure // Field_Defaults
36116>>>>
36116>>>>
36116>>>        
36116>>>        Function Validate_Save  Returns Integer
36119>>>            Integer iReturnVal
36119>>>            Forward Get Validate_Save_PCGS210_01  to iReturnVal
36121>>>            If (not(iReturnVal)) Begin
36123>>>            End
36123>>>>
36123>>>            Function_Return iReturnVal
36124>>>        End_Function   // Validate_Save
36125>>>
36125>>>        Function Validate_Delete  Returns Integer
36128>>>            Integer iReturnVal
36128>>>            Forward Get Validate_Delete_PCGS210_01 to iReturnVal
36130>>>            If not (iReturnVal) Begin
36132>>>            End    
36132>>>>
36132>>>            Function_Return iReturnVal
36133>>>        End_Function // Validate_Delete
36134>>>        
36134>>>        Procedure Creating
36137>>>            Forward Send Creating_PCGS210_01
36139>>>        End_Procedure // Creating
36140>>>        
36140>>>        Procedure Update
36143>>>            Forward Send Update_PCGS210_01
36145>>>        End_Procedure // Update
36146>>>
36146>>>        Procedure Backout
36149>>>            Forward Send Backout_PCGS210_01
36151>>>        End_Procedure // Backout
36152>>>    
36152>>>        Procedure Deleting
36155>>>            Forward Send Deleting_PCGS210_01
36157>>>        End_Procedure // Deleting
36158>>>    
36158>>>        Procedure Save_Main_File
36161>>>            Forward Send Save_Main_File_PCGS210_01
36163>>>        End_Procedure // Save_Main_File
36164>>>    End_Object // oCCGS210_DD
36165>>>
36165>>>    Set Main_DD To oCCGS210_DD
36166>>>
36166>>>
36166>>>    Function fPCGS3029_05_CCGS210 String sNomeCombo String sPRODUTO Returns String
#REM SEND REGISTERINTERFACE |CI7347 "get_fPCGS3029_05_CCGS210" "String sNomeCombo String sPRODUTO Returns String" ""
36170>>>        String  sRETORNO
36170>>>        Boolean bFOUND
36170>>>        RowID   riROWID
36170>>>        String sQuery
36170>>>    
36170>>>        Integer   iContador
36170>>>        Move 0 to iContador
36171>>>    
36171>>>        Move "" to sRetorno
36172>>>        Move ('<select name="'+(Trim(sNomeCombo))+'" id="'+(Trim(sNomeCombo))+'" class="col-xs-6">') to sRetorno
36173>>>        Move (sRetorno+'<option value="'+(Trim('0'))+'">'+(Trim('Selecione Produto'))+'</option>') to sRetorno
36174>>>    
36174>>>        //---------------------------------------------------------------------------------------------------------------------------------------
36174>>>        //---< INICIO
36174>>>    
36174>>>               Case Begin
36174>>>    
36174>>>                   Case (sPRODUTO="")
36176>>>                       Move "SELECT DESCRICAO_EN, CODIGO FROM DBO.CCGS210 WHERE CSAG336_ID = 1 ORDER BY DESCRICAO_EN" to sQuery
36177>>>                       SQL_FIND_BEGIN hStmt_produtos sQuery
36196>>>>
36196>>>                           Move (sRetorno+'<option value="'+(Trim(SqlFindValue(hStmt_produtos,2)))+'">'+(Trim(SqlFindValue(hStmt_produtos,1)))+'</option>') to sRetorno
36197>>>                       SQL_FIND_END hStmt_produtos
36204>>>>
36204>>>                       
36204>>>                   Case Break
36205>>>    
36205>>>    
36205>>>                   Case (sPRODUTO<>"")
36208>>>    
36208>>>                       Clear CCGS210
36209>>>                       Move sPRODUTO to CCGS210.CODIGO
36210>>>                       Find Eq CCGS210  by 1
36211>>>>
36211>>>                       If not (Found) Clear   CCGS210
36214>>>                       Else Begin
36215>>>                           Move (sRetorno+'<option selected="selected" value="'+(Trim(CCGS210.CODIGO))+'">'+(Trim(CCGS210.DESCRICAO))+'</option>') to sRetorno
36216>>>                       End
36216>>>>
36216>>>    
36216>>>                       Move "SELECT DESCRICAO_EN, CODIGO FROM DBO.CCGS210 WHERE CSAG336_ID = 1 AND CODIGO <> %1 ORDER BY DESCRICAO_EN" to sQuery
36217>>>                       SQL_FIND_BEGIN hStmt_produtos (SFORMAT(sQuery, ToSqlInteger(sPRODUTO)))
36236>>>>
36236>>>                           Move (sRetorno+'<option value="'+(Trim(SqlFindValue(hStmt_produtos,2)))+'">'+(Trim(SqlFindValue(hStmt_produtos,1)))+'</option>') to sRetorno
36237>>>                       SQL_FIND_END hStmt_produtos
36244>>>>
36244>>>                       
36244>>>                   Case Break
36245>>>    
36245>>>               Case End
36245>>>    
36245>>>        //---< FIM
36245>>>        //---------------------------------------------------------------------------------------------------------------------------------------
36245>>>    
36245>>>        Move (sRetorno+'</select>') to sRetorno
36246>>>        Function_Return                sRetorno
36247>>>    
36247>>>    End_Function // fPAG390_01_CCGS210
36248>>>
36248>>>
36248>>>    Send RegisterStandardInterface
36249>>>    // Send RegisterDebugInterface
36249>>>    Send RegisterFullErrorInterface
36250>>>    // Send RegisterAutoEntryInterface
36250>>>
36250>>>    Set pbAllowSaveNew To True
36251>>>    Set pbAllowSaveEdit To True
36252>>>    Set pbAllowDelete To True
36253>>>    Set pbAllowClear To True
36254>>>    Set pbAllowFind To True
36255>>>    Set pbAllowDDUpdate To True
36256>>>
36256>>>    Use facCCGS210.pkg
Including file: facCCGS210.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\facCCGS210.pkg)
36256>>>>>//--- ABERTURA DO ARQUIVO
36256>>>>>
36256>>>>>Open CCGS210 //CCGS210.DEF
36258>>>>>
36258>>>>>Function f_pgCCGS210_DESCRICAO String sCODIGO Returns String
#REM SEND REGISTERINTERFACE |CI7348 "get_f_pgCCGS210_DESCRICAO" "String sCODIGO Returns String" "f_pgCCGS210_DESCRICAO"
36262>>>>>    Clear CCGS210
36263>>>>>    Move sCODIGO   to CCGS210.CODIGO
36264>>>>>    Find Eq CCGS210 by 1
36265>>>>>>
36265>>>>>    If (not(Found)) Function_Return 'REGISTRO NAO ENCONTRATO. VERIFIQUE!'
36268>>>>>    Else Function_Return (Trim(CCGS210.DESCRICAO))
36270>>>>>End_Function //f_pgCCGS210_DESCRICAO
36271>>>>>
36271>>>>>Function frCGS210_CODIGO String sNOMECOMBO String aUsuarioSessao Returns String
#REM SEND REGISTERINTERFACE |CI7349 "get_frCGS210_CODIGO" "String sNOMECOMBO String aUsuarioSessao Returns String" ""
36275>>>>>    String    sRetorno
36275>>>>>    String    sQuery
36275>>>>>    String    sCSAG308_NR
36275>>>>>    String    sCCGS210CODIGO
36275>>>>>    String    sCCGS210DESCRICAO 
36275>>>>>
36275>>>>>    Move ('<select name="'+(Trim(sNOMECOMBO))+'" id="'+(Trim(sNOMECOMBO))+'" class="col-xs-6">') to sRetorno
36276>>>>>    
36276>>>>>    Clear    CSAG311
36277>>>>>    Move (Trim(aUsuarioSessao) )  to CSAG311.USUARIOSESSAO
36278>>>>>    Find Eq  CSAG311              by 1
36279>>>>>>
36279>>>>>      If (not(Found)) Begin
36281>>>>>         Move (sRetorno+'<option value="">SESSAO INVALIDA. CONTATE ADMINISTRADOR.</option>') to sRetorno
36282>>>>>         Move (sRetorno+'</select>') to sRetorno
36283>>>>>         Function_Return                sRetorno
36284>>>>>      End
36284>>>>>>
36284>>>>>
36284>>>>>    //--- SE NAO VIER A EMPRESA TOMAR COMO BASE A EMPRESA DO USUARIO
36284>>>>>    Move CSAG311.USUARIOECODIGO to sCSAG308_NR
36285>>>>>
36285>>>>>    //--- TODAS AS OPERACAOES
36285>>>>>    Move (sRetorno+'<option value="">TODAS</option>') to sRetorno
36286>>>>>    
36286>>>>>        Move "" to sQuery
36287>>>>>    CREATE_MAIN_CONNECTION BYFILE CCGS210
36292>>>>>>
36292>>>>>    Move "SELECT CODIGO, DESCRICAO FROM dbo.CCGS210" to sQuery
36293>>>>>    SQL_FIND_BEGIN hStmt_CCGS210_01 sQuery
36312>>>>>>
36312>>>>>        //SqlFindValueByName
36312>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,1)) to sCCGS210CODIGO  
36313>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,2)) to sCCGS210DESCRICAO 
36314>>>>>        
36314>>>>>        Move (Trim(sCCGS210CODIGO))    to sCCGS210CODIGO 
36315>>>>>        Move (Trim(sCCGS210DESCRICAO)) to sCCGS210DESCRICAO
36316>>>>>        
36316>>>>>        Move (sRetorno+'<option value="'+sCCGS210CODIGO+'">'+sCCGS210DESCRICAO+'</option>') to sRetorno
36317>>>>>    SQL_FIND_END hStmt_CCGS210_01
36324>>>>>>
36324>>>>>
36324>>>>>    Move (sRetorno+'</select>') to sRetorno
36325>>>>>    Function_Return                sRetorno
36326>>>>>
36326>>>>>End_Function // frCGS210_CODIGO
36327>>>>>
36327>>>>>Function frCGS210_multi String sNOMECOMBO String aUsuarioSessao Returns String
#REM SEND REGISTERINTERFACE |CI7350 "get_frCGS210_multi" "String sNOMECOMBO String aUsuarioSessao Returns String" ""
36331>>>>>    String    sRetorno
36331>>>>>    String    sQuery
36331>>>>>    String    sCSAG308_NR
36331>>>>>    String    sCCGS210CODIGO
36331>>>>>    String    sCCGS210DESCRICAO 
36331>>>>>
36331>>>>>    Move ('<select name="'+(Trim(sNOMECOMBO))+'" id="'+(Trim(sNOMECOMBO))+'" class="col-xs-6"') to sRetorno
36332>>>>>    
36332>>>>>    Move (sRetorno*'multiple="true" tooltip-placement="bottom">') to sRetorno
36333>>>>>    
36333>>>>>    //<select
36333>>>>>//  uib-tooltip="{{textoAjuda}}"
36333>>>>>//  
36333>>>>>//  style="height: 225px;"
36333>>>>>//  ng-options="aux.ID as aux.DS for aux in lsFretes"
36333>>>>>//  ng-model="proposta.caracteristicasFrete"
36333>>>>>//  Class="form-control"
36333>>>>>//  
36333>>>>>//>
36333>>>>>    
36333>>>>>    
36333>>>>>    
36333>>>>>    Clear    CSAG311
36334>>>>>    Move (Trim(aUsuarioSessao) )  to CSAG311.USUARIOSESSAO
36335>>>>>    Find Eq  CSAG311              by 1
36336>>>>>>
36336>>>>>      If (not(Found)) Begin
36338>>>>>         Move (sRetorno+'<option value="">SESSAO INVALIDA. CONTATE ADMINISTRADOR.</option>') to sRetorno
36339>>>>>         Move (sRetorno+'</select>') to sRetorno
36340>>>>>         Function_Return                sRetorno
36341>>>>>      End
36341>>>>>>
36341>>>>>
36341>>>>>    //--- SE NAO VIER A EMPRESA TOMAR COMO BASE A EMPRESA DO USUARIO
36341>>>>>    Move CSAG311.USUARIOECODIGO to sCSAG308_NR
36342>>>>>
36342>>>>>        Move "" to sQuery
36343>>>>>    CREATE_MAIN_CONNECTION BYFILE CCGS210
36348>>>>>>
36348>>>>>    Move "SELECT CODIGO, DESCRICAO FROM dbo.CCGS210" to sQuery
36349>>>>>    SQL_FIND_BEGIN hStmt_CCGS210_01 sQuery
36368>>>>>>
36368>>>>>        //SqlFindValueByName
36368>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,1)) to sCCGS210CODIGO  
36369>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,2)) to sCCGS210DESCRICAO 
36370>>>>>        
36370>>>>>        Move (Trim(sCCGS210CODIGO))    to sCCGS210CODIGO 
36371>>>>>        Move (Trim(sCCGS210DESCRICAO)) to sCCGS210DESCRICAO
36372>>>>>        
36372>>>>>        Move (sRetorno+'<option value="'+sCCGS210CODIGO+'">'+sCCGS210DESCRICAO+'</option>') to sRetorno
36373>>>>>    SQL_FIND_END hStmt_CCGS210_01
36380>>>>>>
36380>>>>>
36380>>>>>    Move (sRetorno+'</select>') to sRetorno
36381>>>>>    Function_Return                sRetorno
36382>>>>>
36382>>>>>End_Function // frCGS210_multi
36383>>>>>
36383>>>>>Function fCGS210_CODIGO String sCONTEUDO String sNOMECOMBO String aUsuarioSessao Returns String
#REM SEND REGISTERINTERFACE |CI7351 "get_fCGS210_CODIGO" "String sCONTEUDO String sNOMECOMBO String aUsuarioSessao Returns String" ""
36387>>>>>    String    sRetorno
36387>>>>>    String    sQuery
36387>>>>>    String    sCCGS210CODIGO
36387>>>>>    String    sCCGS210DESCRICAO 
36387>>>>>
36387>>>>>    Move ('<select name="'+(Trim(sNOMECOMBO))+'" id="'+(Trim(sNOMECOMBO))+'" class="col-xs-6">') to sRetorno
36388>>>>>    
36388>>>>>    Clear    CSAG311
36389>>>>>    Move (Trim(aUsuarioSessao) )  to CSAG311.USUARIOSESSAO
36390>>>>>    Find Eq  CSAG311              by 1
36391>>>>>>
36391>>>>>    If (not(Found)) Begin
36393>>>>>       Move (sRetorno+'<option value="">SESSAO INVALIDA. CONTATE ADMINISTRADOR.</option>') to sRetorno
36394>>>>>       Move (sRetorno+'</select>') to sRetorno
36395>>>>>       Function_Return                sRetorno
36396>>>>>    End
36396>>>>>>
36396>>>>>    Else Move (sRetorno+'<option value="">SELECT.</option>') to sRetorno
36398>>>>>
36398>>>>>        Move "" to sQuery
36399>>>>>    CREATE_MAIN_CONNECTION BYFILE CCGS210
36404>>>>>>
36404>>>>>    Move "SELECT CODIGO, DESCRICAO FROM dbo.CCGS210 ORDER BY DESCRICAO" to sQuery
36405>>>>>    SQL_FIND_BEGIN hStmt_CCGS210_01 sQuery
36424>>>>>>
36424>>>>>        //SqlFindValueByName
36424>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,1)) to sCCGS210CODIGO  
36425>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,2)) to sCCGS210DESCRICAO 
36426>>>>>         
36426>>>>>        Move (Trim(sCCGS210CODIGO))    to sCCGS210CODIGO 
36427>>>>>        Move (Trim(sCCGS210DESCRICAO)) to sCCGS210DESCRICAO
36428>>>>>        
36428>>>>>        Move (sRetorno+'<option '+If(sCCGS210CODIGO=sCONTEUDO,'selected="selected"','')+' value="'+sCCGS210CODIGO+'">'+sCCGS210DESCRICAO+'</option>') to sRetorno
36429>>>>>    SQL_FIND_END hStmt_CCGS210_01
36436>>>>>>
36436>>>>>
36436>>>>>    Move (sRetorno+'</select>') to sRetorno
36437>>>>>    Function_Return                sRetorno
36438>>>>>
36438>>>>>End_Function // fCGS210_CODIGO
36439>>>>>
36439>>>>>Function f_bccgs210_descricao String sInicial String sSessionId Returns String
#REM SEND REGISTERINTERFACE |CI7352 "get_f_bccgs210_descricao" "String sInicial String sSessionId Returns String" "f_bccgs210_descricao"
36443>>>>>    String  sQuebraLinha
36443>>>>>    String  sQuery
36443>>>>>    String  sLinhaAutoComplete
36443>>>>>    
36443>>>>>    String  sListaAutoComplete
36443>>>>>    String  sCodigo
36443>>>>>    String  sExibeInformacao
36443>>>>>    String  sDescricao
36443>>>>>    String  sRecnum
36443>>>>>    String sCCGS210RECNUM      
36443>>>>>    String sCCGS210CODIGO
36443>>>>>    String sCCGS210DESCRICAO
36443>>>>>    String sCCGS210CCGS200_ID
36443>>>>>    String sCCGS210CCGS215_ID
36443>>>>>    String sCCGS210CCGS216_ID
36443>>>>>    String sCCGS210STATUS
36443>>>>>    String sCCGS210OBSERVACAO
36443>>>>>    
36443>>>>>    String sCCGS210ROWID
36443>>>>>    RowID  riCCGS210ROWID
36443>>>>>   
36443>>>>>    Move (Character(13)+Character(10)) to sQuebraLinha
36444>>>>>    
36444>>>>>    Move (Uppercase(sInicial)) to sInicial
36445>>>>>    Move (Trim(sInicial))      to sInicial
36446>>>>>        
36446>>>>>        
36446>>>>>        Move "" to sQuery
36447>>>>>    CREATE_MAIN_CONNECTION BYFILE CCGS210
36452>>>>>>
36452>>>>>    Move ("SELECT TOP 15 a.RECNUM, a.CODIGO, a.DESCRICAO, b.DESCRICAO, c.DESCRICAO, d.DESCRICAO, a.CSAG336_ID")   to sQuery
36453>>>>>    Move (sQuery*"From dbo.CCGS210 a INNER JOIN dbo.CCGS200 b on b.CODIGO = a.CCGS200_ID") to sQuery
36454>>>>>    Move (sQuery*"INNER JOIN dbo.CCGS215 c on c.CODIGO = a.CCGS215_ID") to sQuery
36455>>>>>    Move (sQuery*"INNER JOIN dbo.CCGS216 d on d.CODIGO = a.CCGS216_ID") to sQuery
36456>>>>>    Move (sQuery*"WHERE a.DESCRICAO LIKE '%1'") to sQuery
36457>>>>>    Move (sQuery*"ORDER BY a.DESCRICAO") to sQuery
36458>>>>>        Move (SFORMAT(sQuery, ('%'+sInicial+'%'))) to sQuery
36459>>>>>    SQL_FIND_BEGIN hStmt_CCGS210_01 sQuery
36478>>>>>>
36478>>>>>        //SqlFindValueByName
36478>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,1))                            to sCCGS210RECNUM
36479>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,2))                            to sCCGS210CODIGO
36480>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,3))                            to sCCGS210DESCRICAO
36481>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,4))                            to sCCGS210CCGS200_ID
36482>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,5))                            to sCCGS210CCGS215_ID
36483>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,6))                            to sCCGS210CCGS216_ID
36484>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,7))                            to sCCGS210STATUS
36485>>>>>                                                                           
36485>>>>>        //REMOVER ESPACOS EM BRANCO                                        
36485>>>>>        Move (Trim(sCCGS210DESCRICAO))                                      to sCCGS210DESCRICAO
36486>>>>>                                                                           
36486>>>>>        //IDENTIFICAR OS CAMPOS                                            
36486>>>>>        Move  sCCGS210RECNUM                                                to sRecnum
36487>>>>>        Move  sCCGS210CODIGO                                                to sCodigo
36488>>>>>        Move  sCCGS210DESCRICAO                                             to sDescricao
36489>>>>>        
36489>>>>>        Move (sCCGS210CODIGO*'-'*sCCGS210DESCRICAO*'- Oper.:'*sCCGS210CCGS200_ID) to sExibeInformacao
36490>>>>>        Move (sExibeInformacao*'- Modal:'*sCCGS210CCGS215_ID*'- dtl:'*sCCGS210CCGS216_ID)to sExibeInformacao
36491>>>>>        
36491>>>>>        //MONTAR O AUTOCOMPLETE
36491>>>>>        Move '{'                                                            to sLinhaAutoComplete
36492>>>>>        Move (sLinhaAutoComplete+'"id":"'+sCodigo+'"')                      to sLinhaAutoComplete
36493>>>>>        Move (sLinhaAutoComplete+',"label":"'+sExibeInformacao+'"')         to sLinhaAutoComplete
36494>>>>>        Move (sLinhaAutoComplete+',"value":"'+sDescricao+'"')               to sLinhaAutoComplete
36495>>>>>        Move (sLinhaAutoComplete+',"recnum":"'+sRecnum+'"')                 to sLinhaAutoComplete
36496>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
36497>>>>>        //                                                          
36497>>>>>        Move (sListaAutoComplete+If(sListaAutoComplete<>'',',','')+sLinhaAutoComplete) to sListaAutoComplete                    
36498>>>>>                        
36498>>>>>    SQL_FIND_END hStmt_CCGS210_01 
36505>>>>>>
36505>>>>>        
36505>>>>>        If (sListaAutoComplete='') Begin
36507>>>>>        Move '{'                                                            to sLinhaAutoComplete
36508>>>>>        Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
36509>>>>>        Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
36510>>>>>        Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
36511>>>>>        Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
36512>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
36513>>>>>        //
36513>>>>>        Move sLinhaAutoComplete to sListaAutoComplete
36514>>>>>        End
36514>>>>>>
36514>>>>>        
36514>>>>>    Function_Return ('['+sListaAutoComplete+']')
36515>>>>>        
36515>>>>>End_Function // f_bccgs210_descricao
36516>>>>>
36516>>>>>Function fCGS210_PRODUTOS_VENDEDOR String sCONTEUDO String sNOMECOMBO String aUsuarioSessao String aHCGS2104Id Returns String
#REM SEND REGISTERINTERFACE |CI7353 "get_fCGS210_PRODUTOS_VENDEDOR" "String sCONTEUDO String sNOMECOMBO String aUsuarioSessao String aHCGS2104Id Returns String" "fCGS210_PRODUTOS_VENDEDOR"
36520>>>>>    String    sRetorno
36520>>>>>    String    sQuery
36520>>>>>    String    sCCGS210CODIGO
36520>>>>>    String    sCCGS210DESCRICAO 
36520>>>>>
36520>>>>>    Move ('<select name="'+(Trim(sNOMECOMBO))+'" id="'+(Trim(sNOMECOMBO))+'" class="col-xs-6">') to sRetorno
36521>>>>>    
36521>>>>>    Clear    CSAG311
36522>>>>>    Move (Trim(aUsuarioSessao) )  to CSAG311.USUARIOSESSAO
36523>>>>>    Find Eq  CSAG311              by 1
36524>>>>>>
36524>>>>>    If (not(Found)) Begin
36526>>>>>        Move (sRetorno+'<option value="">SESSAO INVALIDA. CONTATE ADMINISTRADOR.</option>') to sRetorno
36527>>>>>        Move (sRetorno+'</select>') to sRetorno
36528>>>>>        Function_Return                sRetorno
36529>>>>>    End
36529>>>>>>
36529>>>>>      
36529>>>>>//    Clear HCGS2104
36529>>>>>//    Move aHCGS2104Id to HCGS2104.CODIGO
36529>>>>>//    Find eq HCGS2104 by 1
36529>>>>>    
36529>>>>>//    Clear HCGS2102
36529>>>>>//    Move HCGS2104.HCGS2102_ID to HCGS2102.CODIGO
36529>>>>>//    Find Eq HCGS2102 by 1
36529>>>>>    
36529>>>>>    Clear HCGS2101
Including file: HCGS2101.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HCGS2101.fd)
36530>>>>>//    Move HCGS2102.HCGS2101_ID to HCGS2101.CODIGO
36530>>>>>    Find EQ HCGS2101 by 1
36531>>>>>>
36531>>>>>
36531>>>>>        Move "" to sQuery
36532>>>>>    CREATE_MAIN_CONNECTION BYFILE CCGS210
36537>>>>>>
36537>>>>>    Move "SELECT p.CODIGO, p.DESCRICAO FROM dbo.CCGS210 p INNER JOIN dbo.CCGS211 v on v.CCGS210_ID=p.CODIGO WHERE v.CSAG320_ID = %1 AND p.CSAG336_ID = 1 AND v.STATUS = 'A' ORDER BY p.DESCRICAO" to sQuery
36538>>>>>    Move (SFormat(sQuery, ToSQLNumber(HCGS2101.CSAG341_ID))) to sQuery
36539>>>>>    SQL_FIND_BEGIN hStmt_CCGS210_01 sQuery
36558>>>>>>
36558>>>>>        //SqlFindValueByName
36558>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,1)) to sCCGS210CODIGO  
36559>>>>>        Move (SqlFindValue(hStmt_CCGS210_01,2)) to sCCGS210DESCRICAO 
36560>>>>>        
36560>>>>>        Move (Trim(sCCGS210CODIGO))    to sCCGS210CODIGO 
36561>>>>>        Move (Trim(sCCGS210DESCRICAO)) to sCCGS210DESCRICAO
36562>>>>>        
36562>>>>>        Move (sRetorno+'<option '+If(sCCGS210CODIGO=sCONTEUDO,'selected="selected"','')+' value="'+sCCGS210CODIGO+'">'+sCCGS210DESCRICAO+'</option>') to sRetorno
36563>>>>>    SQL_FIND_END hStmt_CCGS210_01
36570>>>>>>
36570>>>>>
36570>>>>>    Move (sRetorno+'</select>') to sRetorno
36571>>>>>    Function_Return                sRetorno
36572>>>>>
36572>>>>>End_Function // fCGS210_PRODUTOS_VENDEDOR
36573>>>    
36573>>>End_Object // oPCGS210_01
36574>    Use PCGS211_01.wo  //- Pessoas por Produto
Including file: PCGS211_01.wo    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\PCGS211_01.wo)
36574>>>//-2WA--
36574>>>// PCGS211_01.wo
36574>>>// PCGS211_01
36574>>>Use cWebBusinessProcess.pkg
36574>>>
36574>>>Use cCCGS211_DataDictionary.dd
Including file: cCCGS211_DataDictionary.dd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\cCCGS211_DataDictionary.dd)
36574>>>>>//-2WA
36574>>>>>Use CtrlData.PKG
36574>>>>>
36574>>>>>Open CCGS211
36576>>>>>
36576>>>>>Class cCCGS211_DataDictionary is a c_DataDictionary
36577>>>>>    
36577>>>>>    Procedure Construct_Object
36579>>>>>        Forward Send Construct_Object
36581>>>>>        Set Main_file to CCGS211.File_Number
36582>>>>>        Set Add_System_File to TSMG801.File_Number DD_Lock_On_All
36583>>>>>
36583>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
36584>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
36585>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
36586>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
36587>>>>>
36587>>>>>        Set Field_Label_Long Field CCGS211.CSAG320_ID to "EXECUTIVO DE CONTAS"
36588>>>>>        Set Field_Label_Short Field CCGS211.CSAG320_ID to "EXECUTIVO DE CONTAS"
36589>>>>>
36589>>>>>        Set Field_Label_Long Field CCGS211.CCGS210_ID to "PRODUTO"
36590>>>>>        Set Field_Label_Short Field CCGS211.CCGS210_ID to "PRODUTO"
36591>>>>>
36591>>>>>        Set Field_Label_Long Field CCGS211.STATUS to "STATUS"
36592>>>>>        Set Field_Label_Short Field CCGS211.STATUS to "STATUS"
36593>>>>>        Set Field_Checkbox_Values Field CCGS211.STATUS to "A" "I"
36594>>>>>        Set Field_Option Field CCGS211.STATUS DD_CAPSLOCK to True
36595>>>>>
36595>>>>>        Set Field_Label_Long Field CCGS211.STATUS_DT_ATIVO to "ATIVO DESDE"
36596>>>>>        Set Field_Label_Short Field CCGS211.STATUS_DT_ATIVO to "ATIVO DESDE"
36597>>>>>
36597>>>>>        Set Field_Label_Long Field CCGS211.STATUS_DT_INATIVO to "INATIVO DESDE"
36598>>>>>        Set Field_Label_Short Field CCGS211.STATUS_DT_INATIVO to "INATIVO DESDE"
36599>>>>>
36599>>>>>        Set Field_Label_Long Field CCGS211.OBSERVACAO to "OBSERVACAO"
36600>>>>>        Set Field_Label_Short Field CCGS211.OBSERVACAO to "OBSERVACAO"
36601>>>>>
36601>>>>>        Set Field_Label_Long Field CCGS211.BASE_DE_CALCULO_COM to "BASE DE CALCULO PARA COMISSAO"
36602>>>>>        Set Field_Label_Short Field CCGS211.BASE_DE_CALCULO_COM to "BASE DE CALCULO PARA COMISSAO"
36603>>>>>
36603>>>>>        Set Field_Label_Short Field CCGS211.USUARIO_ID_C to "CRIADO POR"
36604>>>>>        Set Field_Label_Long Field CCGS211.USUARIO_ID_C to "CRIADO POR"
36605>>>>>        Set Field_Option Field CCGS211.USUARIO_ID_C DD_NOENTER to True
36606>>>>>
36606>>>>>        Set Field_Label_Short Field CCGS211.DATE_TIME_C to "DATA E HORA DE CRIACAO"
36607>>>>>        Set Field_Label_Long Field CCGS211.DATE_TIME_C to "DATA E HORA DE CRIACAO"
36608>>>>>        Set Field_Option Field CCGS211.DATE_TIME_C DD_NOENTER to True
36609>>>>>
36609>>>>>        Set Field_Label_Short Field CCGS211.USUARIO_ID_A to "ALTERADO POR"
36610>>>>>        Set Field_Label_Long Field CCGS211.USUARIO_ID_A to "ALTERADO POR"
36611>>>>>        Set Field_Option Field CCGS211.USUARIO_ID_A DD_NOENTER to True
36612>>>>>
36612>>>>>        Set Field_Label_Short Field CCGS211.DATE_TIME_A to "DATA E HORA DE ALTERACAO"
36613>>>>>        Set Field_Label_Long Field CCGS211.DATE_TIME_A to "DATA E HORA DE ALTERACAO"
36614>>>>>        Set Field_Option Field CCGS211.DATE_TIME_A DD_NOENTER to True
36615>>>>>
36615>>>>>    End_Procedure
36616>>>>>    
36616>>>>>    Procedure Creating_PCGS211_01
36618>>>>>        Forward Send Creating
36620>>>>>        DateTime dtCurrentDateTime
36620>>>>>        //CCGS211.DEF
36620>>>>>        
36620>>>>>        //------------------------------------------------------------
36620>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
36620>>>>>    
36620>>>>>            Clear   CSAG311
36621>>>>>            Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
36622>>>>>            Find Eq CSAG311                      by 1
36623>>>>>>
36623>>>>>              If (Found) Begin                   
36625>>>>>                  Send p_RegistraAcessoUsuario "CCGS211.USUARIO_ID_C" CSAG311.USUARIONUMERO
36626>>>>>              End
36626>>>>>>
36626>>>>>    
36626>>>>>    End_Procedure // Creating_PCGS211_01
36627>>>>>
36627>>>>>        Procedure Update_PCGS211_01
36629>>>>>            String  sNRDOCTO
36629>>>>>            Forward Send Update
36631>>>>>        
36631>>>>>            //------------------------------------------------------------
36631>>>>>            //---Configurando os dados Usuario Que Esta Cadastrando
36631>>>>>        
36631>>>>>                 Clear   CSAG311
36632>>>>>                 Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
36633>>>>>                 Find Eq CSAG311                      by 1
36634>>>>>>
36634>>>>>                   If (Found) Begin
36636>>>>>                       Send p_RegistraAcessoUsuario "CCGS211.USUARIO_ID_A" CSAG311.USUARIONUMERO
36637>>>>>                   End
36637>>>>>>
36637>>>>>        
36637>>>>>        End_Procedure // Update_PCGS211_01
36638>>>>>
36638>>>>>        Procedure Deleting_PCGS211_01
36640>>>>>           Forward Send Deleting
36642>>>>>            Send p_FFOperation 3 
36643>>>>>        End_Procedure   // Deleting_PCGS211_01
36644>>>>>
36644>>>>>        Procedure Save_Main_File_PCGS211_01
36646>>>>>            Integer iRECNUM
36646>>>>>            Move CCGS211.RECNUM to iRECNUM
36647>>>>>            Forward Send Save_Main_File
36649>>>>>            If (iRECNUM=0) Begin
36651>>>>>                //--- NOVO REGISTRO
36651>>>>>                Send p_FFOperation 2
36652>>>>>            End // If (iRECNUM=0) Begin
36652>>>>>>
36652>>>>>            Else Begin
36653>>>>>              //--- REGISTRO ALTERADO
36653>>>>>                Send p_FFOperation 1 
36654>>>>>            End
36654>>>>>>
36654>>>>>                        
36654>>>>>        End_Procedure // Save_Main_File_PCGS211_01
36655>>>>>        
36655>>>>>        Procedure Backout_PCGS211_01
36657>>>>>            Forward Send Backout
36659>>>>>            Send p_FFOperation 0
36660>>>>>        End_Procedure   // Backout_PCGS211_01
36661>>>>>        
36661>>>>>        Function Validate_Save_PCGS211_01 Returns Integer
36663>>>>>            Integer iReturnval
36663>>>>>            Integer iError_Id
36663>>>>>            String  sError_Ds
36663>>>>>            String  sError_Tabela
36663>>>>>            Forward Get Validate_Save to iReturnval
36665>>>>>            If (not(iReturnval)) Begin
36667>>>>>                //Move 308002     to iError_Id
36667>>>>>                //Move 'CSAG308'  to sError_Tabela
36667>>>>>                // //--EMPRESA DO PROCESSO NAO CADASTRADO.
36667>>>>>                //Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
36667>>>>>                //Error iError_Id sError_Ds
36667>>>>>                //Move 1 to iReturnVal 
36667>>>>>            End 
36667>>>>>>
36667>>>>>            Function_Return iReturnval
36668>>>>>        End_Function // Validate_Save_PCGS211_01
36669>>>>>
36669>>>>>        Function Validate_Delete_PCGS211_01 Returns Integer
36671>>>>>            Integer iReturnVal
36671>>>>>            Integer iError_Id
36671>>>>>            String  sError_Ds
36671>>>>>            String  sError_Tabela
36671>>>>>            
36671>>>>>            Forward Get Validate_Delete to iReturnVal
36673>>>>>            If not (iReturnVal) Begin
36675>>>>>                //Move 308003     to iError_Id
36675>>>>>                //Move 'CSAG308'  to sError_Tabela
36675>>>>>                // //--EMPRESA DO PROCESSO NAO PODE SER EXCLUIDO.
36675>>>>>                //Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
36675>>>>>                //Error iError_Id sError_Ds
36675>>>>>                //Move 1 to iReturnVal 
36675>>>>>            End    
36675>>>>>>
36675>>>>>            Function_Return iReturnVal
36676>>>>>        End_Function // Validate_Delete_PCGS211_01
36677>>>>>        
Including file: p_FFOperation.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\p_FFOperation.inc)
36677>>>>>>//ANDERSON RODRIGUES - 02.02.2014 - 13:40
36677>>>>>>//-2WA    
36677>>>>>>    //PROCEDURE USADA PELA TABELA PRINCIPAL DO DICIONARIO DE DADOS
36677>>>>>>    Procedure p_FFOperation Integer iOper
36679>>>>>>
36679>>>>>>        //------------------------------------------------------------
36679>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
36679>>>>>>
36679>>>>>>        Clear   CSAG311
36680>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
36681>>>>>>        Find Eq CSAG311                      by 1
36682>>>>>>>
36682>>>>>>        If (Found) Begin
36684>>>>>>            Send p_FileFieldOperation ;                 iOper ;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
36685>>>>>>        End
36685>>>>>>>
36685>>>>>>    End_Procedure // p_FFOperation
36686>>>>>>
36686>>>>>>    
36686>>>>>>    //PROCEDURE USADA PELA(S) TABELA(S) SECUNDARIA(S) DO DICIONARIO DE DADOS
36686>>>>>>    //UTILIZE ESTA PROCEDURE PARA ARMAZENAR LOG(S) DA(S) TABELA(S) SECUNDARIA(S)
36686>>>>>>    //VIDE EXEMPLO cCSAG371DataDictionary.dd
36686>>>>>>    Procedure p_FFOperationTable Integer iOper Integer iTable
36688>>>>>>
36688>>>>>>        //------------------------------------------------------------
36688>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
36688>>>>>>
36688>>>>>>        Clear   CSAG311
36689>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
36690>>>>>>        Find Eq CSAG311                      by 1
36691>>>>>>>
36691>>>>>>        If (Found) Begin
36693>>>>>>            Send p_FileFieldOperationTable;                 iTable;                 iOper;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
36694>>>>>>        End
36694>>>>>>>
36694>>>>>>    End_Procedure // p_FFOperationTable
36695>>>>>>    
36695>>>>>>
36695>>>>>
36695>>>>>End_Class
36696>>>
36696>>>Object oPCGS211_01 Is A cWebBusinessProcess
36698>>>    Set psDescription To "PCGS211_01"
36699>>>    Set pbClearAfterSave to False
36700>>>    
Including file: USUARIOOPERACAO.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\USUARIOOPERACAO.inc)
36700>>>>//-2WA
36700>>>>//2014-01-20
36700>>>>    Procedure SetUsuariosessao String sStart
#REM SEND REGISTERINTERFACE |CI7301 "msg_SetUsuariosessao" "String sStart" ""
36704>>>>        Set psUsuarioSessao to sStart
36705>>>>        Set psPARAMETRO to ''
36706>>>>    End_Procedure // SetUsuariosessao
36707>>>>
36707>>>>    // Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:11
36707>>>>    Procedure SetPrograma String sStart
#REM SEND REGISTERINTERFACE |CI7302 "msg_SetPrograma" "String sStart" ""
36711>>>>        Set psPrograma to sStart
36712>>>>    End_Procedure // SetUsuariosessao
36713>>>>
36713>>>
36713>>>    Object oCCGS211_DD Is A cCCGS211_DataDictionary
36715>>>        Send DefineAllExtendedFields
36716>>>        Set psProgramName to (psDescription(Self))
36717>>>        
Including file: FIELDLABEL.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABEL.INC)
36717>>>>// ANDERSON
36717>>>>// 13.06.2003 - 01:44
36717>>>>// ROTINA PARA SER INCLUIDA EM TODOS OS DDOS DE TODOS WBOS
36717>>>>// 
36717>>>>// PROCEDURE FIELD_DEFAULTS FOI MODIFICADA PARA LER CSAG310
36717>>>>// E EMITIR A LABEL DE CADA CAMPO NA LINGUA INDICADA.
36717>>>>//-2WA
36717>>>>Procedure Field_Defaults
36720>>>>    Forward Send Field_Defaults
36722>>>>
36722>>>>    Handle  hIdiomaFile
36722>>>>    String  sIdiomaFieldName
36722>>>>    String  sIdiomaLogicalName
36722>>>>    Integer iIdiomaNumFields
36722>>>>    Integer iIdiomaX
36722>>>>    
36722>>>>    Get Main_File                       To hIdiomaFile
36723>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  Of hIdiomaFile                To sIdiomaLogicalName
36726>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS Of hIdiomaFile                To iIdiomaNumFields
36729>>>>
36729>>>>    For iIdiomaX from 1 To iIdiomaNumFields
36735>>>>>
36735>>>>
36735>>>>        Get_Attribute DF_FIELD_NAME     Of hIdiomaFile iIdiomaX       To sIdiomaFieldName
36738>>>>
36738>>>>        Clear   CSAG310
36739>>>>        Move sIdiomaLogicalName                     To CSAG310.TABELA
36740>>>>        Move sIdiomaFieldName                       To CSAG310.CAMPO
36741>>>>        Move (piUsuarioIdioma(oPAG800_01(Self)))    To CSAG310.IDIOMA
36742>>>>        Find Eq CSAG310   By 1
36743>>>>>
36743>>>>
36743>>>>        If (CSAG310.APPEARANCE<>"")     Set Field_Label_Long iIdiomaX To (Trim(CSAG310.APPEARANCE))
36746>>>>
36746>>>>    Loop
36747>>>>>
36747>>>>
36747>>>>End_procedure // Field_Defaults
36748>>>>
36748>>>>
36748>>>        
36748>>>        Function Validate_Save  Returns Integer
36751>>>            Integer iReturnVal
36751>>>            Forward Get Validate_Save_PCGS211_01  to iReturnVal
36753>>>            If (not(iReturnVal)) Begin
36755>>>            End
36755>>>>
36755>>>            Function_Return iReturnVal
36756>>>        End_Function   // Validate_Save
36757>>>
36757>>>        Function Validate_Delete  Returns Integer
36760>>>            Integer iReturnVal
36760>>>            Forward Get Validate_Delete_PCGS211_01 to iReturnVal
36762>>>            If not (iReturnVal) Begin
36764>>>            End    
36764>>>>
36764>>>            Function_Return iReturnVal
36765>>>        End_Function // Validate_Delete
36766>>>        
36766>>>        Procedure Creating
36769>>>            Forward Send Creating_PCGS211_01
36771>>>        End_Procedure // Creating
36772>>>        
36772>>>        Procedure Update
36775>>>            Forward Send Update_PCGS211_01
36777>>>        End_Procedure // Update
36778>>>
36778>>>        Procedure Backout
36781>>>            Forward Send Backout_PCGS211_01
36783>>>        End_Procedure // Backout
36784>>>    
36784>>>        Procedure Deleting
36787>>>            Forward Send Deleting_PCGS211_01
36789>>>        End_Procedure // Deleting
36790>>>    
36790>>>        Procedure Save_Main_File
36793>>>            Forward Send Save_Main_File_PCGS211_01
36795>>>        End_Procedure // Save_Main_File
36796>>>    End_Object // oCCGS211_DD
36797>>>
36797>>>    Set Main_DD to oCCGS211_DD
36798>>>    
36798>>>    // Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:08
36798>>>    Function fPCGS211_01_CSAG320 String sRowid String sNomeCombo String sPESSOA Returns String
#REM SEND REGISTERINTERFACE |CI7361 "get_fPCGS211_01_CSAG320" "String sRowid String sNomeCombo String sPESSOA Returns String" ""
36802>>>        String  sRETORNO
36802>>>        Boolean bFOUND
36802>>>        RowID   riROWID
36802>>>        String sQuery
36802>>>    
36802>>>        Integer   iContador
36802>>>        Move 0 to iContador
36803>>>    
36803>>>        Move ""                                                                                                         to sRetorno
36804>>>        Move ('<select name="'+(Trim(sNomeCombo))+'" id="'+(Trim(sNomeCombo))+'" class="col-xs-6">')                    to sRetorno
36805>>>        If   (sRowid="") Move (sRetorno+'<option value="'+(Trim('0'))+'">'+(Trim('Selecione Pessoa'))+'</option>')      to sRetorno
36808>>>    
36808>>>        //---------------------------------------------------------------------------------------------------------------------------------------
36808>>>        //---< INICIO
36808>>>    
36808>>>               Case Begin
36808>>>    
36808>>>                   Case (sRowid="" and sPESSOA="0")
36810>>>                       Move "SELECT FANTASIA, CODIGO FROM DBO.CSAG320 WHERE CSAG336_ID = 1 ORDER BY FANTASIA" to sQuery
36811>>>                       SQL_FIND_BEGIN hStmt_pessoas sQuery
36830>>>>
36830>>>                           Move (sRetorno+'<option value="'+(Trim(SqlFindValue(hStmt_pessoas,2)))+'">'+(Trim(SqlFindValue(hStmt_pessoas,1)))+'</option>') to sRetorno
36831>>>                       SQL_FIND_END hStmt_pessoas
36838>>>>
36838>>>                       
36838>>>                   Case Break
36839>>>    
36839>>>    
36839>>>                   Case (sRowid="" and sPESSOA<>"0")
36842>>>    
36842>>>                       Clear CSAG320
Including file: CSAG320.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG320.fd)
36843>>>                       Move sPESSOA    to CSAG320.CODIGO
36844>>>                       Find Eq CSAG320  by 1
36845>>>>
36845>>>                       If not (Found) Clear   CSAG320
36848>>>                       Else Begin
36849>>>                           Move (sRetorno+'<option selected="selected" value="'+(Trim(CSAG320.CODIGO))+'">'+(Trim(CSAG320.FANTASIA))+'</option>') to sRetorno
36850>>>                       End
36850>>>>
36850>>>    
36850>>>                       Move "SELECT FANTASIA, CODIGO FROM DBO.CSAG320 WHERE CSAG336_ID = 1 AND CODIGO <> %1 ORDER BY FANTASIA" to sQuery
36851>>>                       SQL_FIND_BEGIN hStmt_pessoas (SFORMAT(sQuery, ToSqlInteger(sPESSOA)))
36870>>>>
36870>>>                           Move (sRetorno+'<option value="'+(Trim(SqlFindValue(hStmt_pessoas,2)))+'">'+(Trim(SqlFindValue(hStmt_pessoas,1)))+'</option>') to sRetorno
36871>>>                       SQL_FIND_END hStmt_pessoas
36878>>>>
36878>>>                       
36878>>>                   Case Break
36879>>>    
36879>>>    
36879>>>                   Case (sRowid<>"")
36882>>>    
36882>>>                       Move (DeserializeRowId(sRowId))                  to riRowId
36883>>>                       Move (FindByRowId(CCGS211.File_Number, riRowId)) to bFound
36884>>>    
36884>>>                       If (bFound) Begin
36886>>>    
36886>>>                           Clear CSAG320
36887>>>                           Move CCGS211.CSAG320_ID     to CSAG320.CODIGO
36888>>>                           Find Eq CSAG320 by 1
36889>>>>
36889>>>                             If not (Found) Clear   CSAG320
36892>>>                             Else    Move (sRetorno+'<option selected="selected" value="'+(Trim(CSAG320.CODIGO))+'">'+(Trim(CSAG320.FANTASIA))+'</option>') to sRetorno
36894>>>    
36894>>>                           Move "SELECT FANTASIA, CODIGO FROM DBO.CSAG320 WHERE CSAG336_ID = 1 AND CODIGO <> %1 ORDER BY FANTASIA" to sQuery
36895>>>                           SQL_FIND_BEGIN hStmt_pessoas (SFORMAT(sQuery, ToSqlInteger(sPESSOA)))
36914>>>>
36914>>>                               Move (sRetorno+'<option value="'+(Trim(SqlFindValue(hStmt_pessoas,2)))+'">'+(Trim(SqlFindValue(hStmt_pessoas,1)))+'</option>') to sRetorno
36915>>>                           SQL_FIND_END hStmt_pessoas
36922>>>>
36922>>>                           
36922>>>                       End
36922>>>>
36922>>>                   Case Break
36923>>>    
36923>>>               Case End
36923>>>    
36923>>>        //---< FIM
36923>>>        //---------------------------------------------------------------------------------------------------------------------------------------
36923>>>    
36923>>>        Move (sRetorno+'</select>') to sRetorno
36924>>>        Function_Return                sRetorno
36925>>>    
36925>>>    End_Function // fPCGS211_01_CSAG320
36926>>>
36926>>>
36926>>>    Send RegisterStandardInterface
36927>>>    // Send RegisterDebugInterface
36927>>>    Send RegisterFullErrorInterface
36928>>>    // Send RegisterAutoEntryInterface
36928>>>
36928>>>    Set pbAllowSaveNew To True
36929>>>    Set pbAllowSaveEdit To True
36930>>>    Set pbAllowDelete To True
36931>>>    Set pbAllowClear To True
36932>>>    Set pbAllowFind To True
36933>>>    Set pbAllowDDUpdate To True
36934>>>
36934>>>End_Object // oPCGS211_01
36935>    Use PCGS211_02.wo  //- Relatorio de Pessoas por Produto.
Including file: PCGS211_02.wo    (C:\DataFlex Projects\CROSS\WVDF_CAC\AppSrc\PCGS211_02.wo)
36935>>>//-2WA--
36935>>>// PCGS211_02.wo
36935>>>// PCGS211_02
36935>>>Use cWebBusinessProcess.pkg
36935>>>Use cWebReport.pkg
36935>>>
36935>>>Use facCSAG341.pkg
Including file: facCSAG341.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\facCSAG341.pkg)
36935>>>>>//--- ABERTURA DO ARQUIVO
36935>>>>>//-2WA
36935>>>>>Open CSAG320
36937>>>>>Open CSAG341
Including file: CSAG341.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG341.fd)
36939>>>>>
36939>>>>>Use facCSAG320.pkg
Including file: facCSAG320.pkg    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\facCSAG320.pkg)
36939>>>>>>>//--- ABERTURA DO ARQUIVO
36939>>>>>>>//-2WA
36939>>>>>>>Open CSAG320
36941>>>>>>>Open CSAG371
Including file: CSAG371.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG371.fd)
36943>>>>>>>Open CSAG372
Including file: CSAG372.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG372.fd)
36945>>>>>>>
36945>>>>>>>Use cCSAG320_DataDictionary.dd
Including file: cCSAG320_DataDictionary.dd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\cCSAG320_DataDictionary.dd)
36945>>>>>>>>>//-2WA
36945>>>>>>>>>Use CtrlData.PKG
36945>>>>>>>>>
36945>>>>>>>>>Open CSAG320
36947>>>>>>>>>Open CSAG329
36949>>>>>>>>>Open CSAG340
Including file: CSAG340.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG340.fd)
36951>>>>>>>>>Open TSMG801
36953>>>>>>>>>Open HSAG340
Including file: HSAG340.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\HSAG340.fd)
36955>>>>>>>>>Open CSAG374
36957>>>>>>>>>Open CSAG369
36959>>>>>>>>>Open HCGS2101
36961>>>>>>>>>Open CSAG390
Including file: CSAG390.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG390.fd)
36963>>>>>>>>>Open CSAG397
Including file: CSAG397.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG397.fd)
36965>>>>>>>>>
36965>>>>>>>>>Use TabelasdeValidacao.pkg
36965>>>>>>>>>
36965>>>>>>>>>Object oTPDOCTO_VT is a DescriptionValidationTable
36967>>>>>>>>>    Procedure Fill_List
36970>>>>>>>>>        Forward Send Fill_List
36972>>>>>>>>>        Send Add_Table_Value "00" "CNPJ"
36973>>>>>>>>>        Send Add_Table_Value "01" "CPF"
36974>>>>>>>>>        Send Add_Table_Value "02" "RG"
36975>>>>>>>>>        Send Add_Table_Value "03" "PASSAPORTE"
36976>>>>>>>>>        Send Add_Table_Value "04" "RUC"
36977>>>>>>>>>        Send Add_Table_Value "05" "SOCIAL SECURITY NUMBER"
36978>>>>>>>>>        Send Add_Table_Value "99" "OUTROS"
36979>>>>>>>>>    End_Procedure
36980>>>>>>>>>End_Object
36981>>>>>>>>>
36981>>>>>>>>>Object oTPPESSOA_VT is a DescriptionValidationTable
36983>>>>>>>>>    Procedure Fill_List
36986>>>>>>>>>        Forward Send Fill_List
36988>>>>>>>>>        Send Add_Table_Value "F" "FISICA"
36989>>>>>>>>>        Send Add_Table_Value "J" "JURIDICA"
36990>>>>>>>>>    End_Procedure
36991>>>>>>>>>End_Object
36992>>>>>>>>>
36992>>>>>>>>>Class cCSAG320_DataDictionary is a c_DataDictionary
36993>>>>>>>>>    
36993>>>>>>>>>    Procedure Construct_Object
36995>>>>>>>>>        Forward Send Construct_Object
36997>>>>>>>>>        Set Main_file to CSAG320.File_Number
36998>>>>>>>>>
36998>>>>>>>>>        Set Add_System_File to CSAG340.File_Number DD_Lock_On_New_Save
36999>>>>>>>>>        Set Add_System_File to TSMG801.File_Number DD_Lock_On_New_Save
37000>>>>>>>>>        Set Add_System_File to HSAG340.File_Number DD_Lock_On_All
37001>>>>>>>>>        Set Add_System_File to CSAG374.File_Number DD_Lock_On_New_Save
37002>>>>>>>>>        Set Add_System_File to CSAG369.File_Number DD_Lock_On_New_Save
37003>>>>>>>>>        Set Add_System_File to CSAG390.File_Number DD_Lock_On_New_Save
37004>>>>>>>>>        Set Add_System_File to CSAG397.File_Number DD_Lock_On_New_Save
37005>>>>>>>>>
37005>>>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
37006>>>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
37007>>>>>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
37008>>>>>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
37009>>>>>>>>>
37009>>>>>>>>>        Set Field_Label_Long Field CSAG320.CODIGO to "CODIGO"
37010>>>>>>>>>        Set Field_Label_Short Field CSAG320.CODIGO to "CODIGO"
37011>>>>>>>>>        Set Field_Option Field CSAG320.CODIGO DD_NOENTER to True
37012>>>>>>>>>
37012>>>>>>>>>        Set Field_Label_Long Field CSAG320.TPDOCTO to "TIPO DOCUMENTO"
37013>>>>>>>>>        Set Field_Label_Short Field CSAG320.TPDOCTO to "TIPO DOCUMENTO"
37014>>>>>>>>>        Set Field_Option Field CSAG320.TPDOCTO DD_CAPSLOCK to True
37015>>>>>>>>>        Set Field_Value_Table Field CSAG320.TPDOCTO to oTPDOCTO_VT
37016>>>>>>>>>
37016>>>>>>>>>        Set Field_Label_Long Field CSAG320.NRDOCTO to "NR DOCUMENTO"
37017>>>>>>>>>        Set Field_Label_Short Field CSAG320.NRDOCTO to "NR DOCUMENTO"
37018>>>>>>>>>        Set Field_Option Field CSAG320.NRDOCTO DD_CAPSLOCK to True
37019>>>>>>>>>
37019>>>>>>>>>        Set Field_Label_Long Field CSAG320.NRDOCTO_ED to "NR DOCUMENTO EDITADO"
37020>>>>>>>>>        Set Field_Label_Short Field CSAG320.NRDOCTO_ED to "NR DOCUMENTO EDITADO"
37021>>>>>>>>>        Set Field_Option Field CSAG320.NRDOCTO_ED DD_NOENTER to True
37022>>>>>>>>>
37022>>>>>>>>>        Set Field_Label_Long Field CSAG320.DATA_NASCFUND to "DATA NASCTO/FUNDACAO"
37023>>>>>>>>>        Set Field_Label_Short Field CSAG320.DATA_NASCFUND to "DATA NASCTO/FUNDACAO"
37024>>>>>>>>>
37024>>>>>>>>>        Set Field_Label_Long Field CSAG320.TPPESSOA to "TIPO PESSOA"
37025>>>>>>>>>        Set Field_Label_Short Field CSAG320.TPPESSOA to "TIPO PESSOA"
37026>>>>>>>>>        Set Field_Value_Table Field CSAG320.TPPESSOA to oTPPESSOA_VT
37027>>>>>>>>>        Set Field_Option Field CSAG320.TPPESSOA DD_CAPSLOCK to True
37028>>>>>>>>>
37028>>>>>>>>>        Set Field_Label_Long Field CSAG320.NOME to "NOME/RAZAO SOCIAL"
37029>>>>>>>>>        Set Field_Label_Short Field CSAG320.NOME to "NOME/RAZAO SOCIAL"
37030>>>>>>>>>        Set Field_Option Field CSAG320.NOME DD_CAPSLOCK to True
37031>>>>>>>>>
37031>>>>>>>>>        Set Field_Label_Long Field CSAG320.FANTASIA to "FANTASIA/APELIDO"
37032>>>>>>>>>        Set Field_Label_Short Field CSAG320.FANTASIA to "FANTASIA/APELIDO"
37033>>>>>>>>>        Set Field_Option Field CSAG320.FANTASIA DD_CAPSLOCK to True
37034>>>>>>>>>
37034>>>>>>>>>        Set Field_Label_Long Field CSAG320.CSAG336_ID to "STATUS"
37035>>>>>>>>>        Set Field_Label_Short Field CSAG320.CSAG336_ID to "STATUS"
37036>>>>>>>>>        Set Field_Option Field CSAG320.CSAG336_ID DD_CAPSLOCK to True
37037>>>>>>>>>
37037>>>>>>>>>        Set Field_Label_Long Field CSAG320.STATUS_DT_ATIVO to "ATIVO DESDE"
37038>>>>>>>>>        Set Field_Label_Short Field CSAG320.STATUS_DT_ATIVO to "ATIVO DESDE"
37039>>>>>>>>>        Set Field_Option Field CSAG320.STATUS_DT_ATIVO DD_NOENTER to True
37040>>>>>>>>>
37040>>>>>>>>>        Set Field_Label_Long Field CSAG320.STATUS_DT_INATIVO to "INATIVO DESDE"
37041>>>>>>>>>        Set Field_Label_Short Field CSAG320.STATUS_DT_INATIVO to "INATIVO DESDE"
37042>>>>>>>>>        Set Field_Option Field CSAG320.STATUS_DT_INATIVO DD_NOENTER to True
37043>>>>>>>>>
37043>>>>>>>>>        Set Field_Label_Long Field CSAG320.PAIS to "PAIS"
37044>>>>>>>>>        Set Field_Label_Short Field CSAG320.PAIS to "PAIS"
37045>>>>>>>>>        Set Field_Option Field CSAG320.PAIS DD_CAPSLOCK to True
37046>>>>>>>>>        Set Field_Value_Table Field CSAG320.PAIS to oPAISES_FVT
37047>>>>>>>>>
37047>>>>>>>>>        Set Field_Label_Long Field CSAG320.OBSERVACAO to "OBSERVACAO"
37048>>>>>>>>>        Set Field_Label_Short Field CSAG320.OBSERVACAO to "OBSERVACAO"
37049>>>>>>>>>
37049>>>>>>>>>        Set Field_Label_Long Field CSAG320.USUARIO_ID_C to "CRIADO POR"
37050>>>>>>>>>        Set Field_Label_Short Field CSAG320.USUARIO_ID_C to "CRIADO POR"
37051>>>>>>>>>        Set Field_Option Field CSAG320.USUARIO_ID_C DD_NOENTER to True
37052>>>>>>>>>
37052>>>>>>>>>        Set Field_Label_Long Field CSAG320.DATE_TIME_C to "DATA/HORA CRIACAO"
37053>>>>>>>>>        Set Field_Label_Short Field CSAG320.DATE_TIME_C to "DATA/HORA CRIACAO"
37054>>>>>>>>>        Set Field_Option Field CSAG320.DATE_TIME_C DD_NOENTER to True
37055>>>>>>>>>
37055>>>>>>>>>        Set Field_Label_Long Field CSAG320.USUARIO_ID_A to "ALTERADO POR"
37056>>>>>>>>>        Set Field_Label_Short Field CSAG320.USUARIO_ID_A to "ALTERADO POR"
37057>>>>>>>>>        Set Field_Option Field CSAG320.USUARIO_ID_A DD_NOENTER to True
37058>>>>>>>>>
37058>>>>>>>>>        Set Field_Label_Long Field CSAG320.DATE_TIME_A to "DATA/HORA ALTERACAO"
37059>>>>>>>>>        Set Field_Label_Short Field CSAG320.DATE_TIME_A to "DATA/HORA ALTERACAO"
37060>>>>>>>>>        Set Field_Option Field CSAG320.DATE_TIME_A DD_NOENTER to True
37061>>>>>>>>>
37061>>>>>>>>>    End_Procedure
37062>>>>>>>>>
37062>>>>>>>>>    Procedure Creating_PAG320_01
37064>>>>>>>>>        Forward Send Creating
37066>>>>>>>>>        DateTime dtCurrentDateTime
37066>>>>>>>>>        
37066>>>>>>>>>        String sQuery
37066>>>>>>>>>        String sAdmin sUsuAdmin
37066>>>>>>>>>        Integer iSpacePos 
37066>>>>>>>>>    
37066>>>>>>>>>        //------------------------------------------------------------
37066>>>>>>>>>        //---Pesquisando Master Geral Codigos
37066>>>>>>>>>        Clear   TSMG801
37067>>>>>>>>>        Smart_Find Ge TSMG801   by 0
37078>>>>>>>>>        If (Found) Begin
37080>>>>>>>>>           Add 1 to TSMG801.CSAG320_CODIGO
37081>>>>>>>>>           SaveRecord TSMG801
37082>>>>>>>>>        End
37082>>>>>>>>>>
37082>>>>>>>>>    
37082>>>>>>>>>        //------------------------------------------------------------
37082>>>>>>>>>        //---Movimentando o Codigo AutoIncrementavel ao CSAG308
37082>>>>>>>>>        Move TSMG801.CSAG320_CODIGO to CSAG320.CODIGO
37083>>>>>>>>>        
37083>>>>>>>>>        If (CSAG320.CSAG336_ID = 1) Begin
37085>>>>>>>>>            Move (CurrentDateTime())       to CSAG320.STATUS_DT_ATIVO
37086>>>>>>>>>        End
37086>>>>>>>>>>
37086>>>>>>>>>        
37086>>>>>>>>>        //------------------------------------------------------------
37086>>>>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
37086>>>>>>>>>        Clear   CSAG311
37087>>>>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
37088>>>>>>>>>        Find Eq CSAG311                      by 1
37089>>>>>>>>>>
37089>>>>>>>>>        If (Found) Begin                   
37091>>>>>>>>>            Send p_RegistraAcessoUsuario "CSAG320.USUARIO_ID_C" CSAG311.USUARIONUMERO
37092>>>>>>>>>        End
37092>>>>>>>>>>
37092>>>>>>>>>              
37092>>>>>>>>>        //--- AO CADASTRAR UMA NOVA PESSOA, CADASTRAR AUTOMATICAMENTE NESTA PESSOA A MARCA PRINCIPAL(MARCA USADA AO SE CADASTRAR) DO USUARIO.
37092>>>>>>>>>                Clear TSMG801
37093>>>>>>>>>        Smart_Find Ge TSMG801   by 0
37104>>>>>>>>>        If (Found)      Begin
37106>>>>>>>>>            Add 1 to TSMG801.CSAG374_CODIGO
37107>>>>>>>>>            SaveRecord TSMG801
37108>>>>>>>>>        End
37108>>>>>>>>>>
37108>>>>>>>>>        
37108>>>>>>>>>                Clear CSAG311
37109>>>>>>>>>                Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
37110>>>>>>>>>                Find Eq CSAG311 by 1
37111>>>>>>>>>>
37111>>>>>>>>>                
37111>>>>>>>>>                Clear CSAG300 
37112>>>>>>>>>                Move CSAG311.USUARIONUMERO to CSAG300.USUARIONUMERO
37113>>>>>>>>>                Find EQ CSAG300 by 3
37114>>>>>>>>>>
37114>>>>>>>>>                
37114>>>>>>>>>                                            
37114>>>>>>>>>                Clear CSAG374
37115>>>>>>>>>                Move TSMG801.CSAG374_CODIGO         to CSAG374.CODIGO
37116>>>>>>>>>                Move CSAG320.CODIGO                 to CSAG374.CSAG320_ID
37117>>>>>>>>>                Move CSAG300.USUARIOECODIGO         to CSAG374.CSAG308_ID
37118>>>>>>>>>                Send p_RegistraAcessoUsuario "CSAG374.USUARIO_ID_C" CSAG311.USUARIONUMERO
37119>>>>>>>>>                
37119>>>>>>>>>                SaveRecord CSAG374
37120>>>>>>>>>                Send p_FFOperationTable 2  CSAG374.File_Number
37121>>>>>>>>>                            
37121>>>>>>>>>                //--- AO CADASTRAR UMA NOVA PESSOA, O USUARIO PASSA A TER ACESSO NA REDE NEURAL.
37121>>>>>>>>>                Clear CSAG369
37122>>>>>>>>>                Move CSAG311.USUARIONUMERO   to CSAG369.CSAG300_NRHD  
37123>>>>>>>>>                Move CSAG320.CODIGO          to CSAG369.CSAG320_NR
37124>>>>>>>>>                Move CSAG320.CSAG336_ID      to CSAG369.STATUS  
37125>>>>>>>>>                Send p_RegistraAcessoUsuario "CSAG369.USUARIO_ID_C" CSAG311.USUARIONUMERO               
37126>>>>>>>>>                
37126>>>>>>>>>                SaveRecord CSAG369
37127>>>>>>>>>                Send p_FFOperationTable 2 CSAG369.File_Number
37128>>>>>>>>>                
37128>>>>>>>>>            //--- TODOS OS USUARIOS PRESENTES NA TABELA CSAG398 - PRIVILEGIOS RECEBEM PERMISSAO SOBRE A PESSOA CRIADA
37128>>>>>>>>>            Move "SELECT CSAG300_ID FROM DBO.CSAG398" to sQuery
37129>>>>>>>>>        CREATE_MAIN_CONNECTION BYFILE CSAG398
37134>>>>>>>>>>
37134>>>>>>>>>        SQL_FIND_BEGIN hStmt_csag398 sQuery
37153>>>>>>>>>>
37153>>>>>>>>>           If (sUsuAdmin <> "") Move (sUsuAdmin+','+SqlFindValue(hStmt_csag398,1)) to sUsuAdmin
37156>>>>>>>>>           Else Move (SqlFindValue(hStmt_csag398,1)) to sUsuAdmin
37158>>>>>>>>>        SQL_FIND_END hStmt_csag398
37165>>>>>>>>>>
37165>>>>>>>>>        
37165>>>>>>>>>        While (sUsuAdmin <> "")
37169>>>>>>>>>            Move (Pos (",", sUsuAdmin))  to iSpacePos
37170>>>>>>>>>            If (iSpacePos > 0) Begin
37172>>>>>>>>>                Move (Left  (sUsuAdmin, iSpacePos - 1)) to sAdmin
37173>>>>>>>>>                Move (Right (sUsuAdmin, Length (sUsuAdmin) - iSpacePos)) to sUsuAdmin
37174>>>>>>>>>            End
37174>>>>>>>>>>
37174>>>>>>>>>            Else Begin
37175>>>>>>>>>                Move sUsuAdmin  to sAdmin
37176>>>>>>>>>                Move ""         to sUsuAdmin
37177>>>>>>>>>            End
37177>>>>>>>>>>
37177>>>>>>>>>            
37177>>>>>>>>>            Clear CSAG369
37178>>>>>>>>>            Move CSAG320.CODIGO to CSAG369.CSAG320_NR
37179>>>>>>>>>            Move (Number(sAdmin)) to CSAG369.CSAG300_NRHD
37180>>>>>>>>>            Find EQ CSAG369 by 1
37181>>>>>>>>>>
37181>>>>>>>>>            If (not(Found)) Begin   
37183>>>>>>>>>               Clear CSAG369
37184>>>>>>>>>                       Move (Number(sAdmin))        to CSAG369.CSAG300_NRHD  
37185>>>>>>>>>                       Move CSAG320.CODIGO          to CSAG369.CSAG320_NR
37186>>>>>>>>>                       Move CSAG320.CSAG336_ID      to CSAG369.STATUS  
37187>>>>>>>>>                       Send p_RegistraAcessoUsuario "CSAG369.USUARIO_ID_C" CSAG311.USUARIONUMERO               
37188>>>>>>>>>                       
37188>>>>>>>>>                       SaveRecord CSAG369
37189>>>>>>>>>                       Send p_FFOperationTable 2 CSAG369.File_Number
37190>>>>>>>>>            End
37190>>>>>>>>>>
37190>>>>>>>>>        Loop        
37191>>>>>>>>>>
37191>>>>>>>>>                            
37191>>>>>>>>>    End_Procedure // Creating_PAG320_01
37192>>>>>>>>>
37192>>>>>>>>>    Procedure Update_PAG320_01
37194>>>>>>>>>        String  sNRDOCTO
37194>>>>>>>>>        Forward Send Update
37196>>>>>>>>>    
37196>>>>>>>>>        //------------------------------------------------------------
37196>>>>>>>>>        //---REMOVE OS CARACTERES NAO NUMERICOS
37196>>>>>>>>>        Move (Replaces(".", CSAG320.NRDOCTO, '')) to CSAG320.NRDOCTO
37197>>>>>>>>>        Move (Replaces("/", CSAG320.NRDOCTO, '')) to CSAG320.NRDOCTO
37198>>>>>>>>>        Move (Replaces("-", CSAG320.NRDOCTO, '')) to CSAG320.NRDOCTO
37199>>>>>>>>>        //---Edita o CNPJ/CPF
37199>>>>>>>>>        If (CSAG320.TPDOCTO <> '99') Begin 
37201>>>>>>>>>            //---Coloca Zeros a Esqueda do CPF
37201>>>>>>>>>            Move (ColocaZerosEsquerda(CSAG320.NRDOCTO,14)) to CSAG320.NRDOCTO
37202>>>>>>>>>        
37202>>>>>>>>>            Move (Trim (CSAG320.NRDOCTO)) to sNRDOCTO
37203>>>>>>>>>            REMOVE_CHAR   sNRDOCTO
37212>>>>>>>>>        
37212>>>>>>>>>            If (Length (sNRDOCTO)<14) Begin
37214>>>>>>>>>                Move (ColocaZerosEsquerda(sNRDOCTO,14)) to sNRDOCTO
37215>>>>>>>>>                Move sNRDOCTO to CSAG320.NRDOCTO  
37216>>>>>>>>>            End
37216>>>>>>>>>>
37216>>>>>>>>>        
37216>>>>>>>>>            If (CSAG320.PAIS='BRA') Begin
37218>>>>>>>>>                If (CSAG320.TPPESSOA='J') Begin
37220>>>>>>>>>                    Move (Right (sNRDOCTO, 14)) to sNRDOCTO 
37221>>>>>>>>>                    Move (EditaCpfCnpj(sNRDOCTO,14,CSAG320.TPPESSOA))   to CSAG320.NRDOCTO_ED
37222>>>>>>>>>                End // (CSAG320.TPPESSOA='J')
37222>>>>>>>>>>
37222>>>>>>>>>                If (CSAG320.TPPESSOA='F') Begin
37224>>>>>>>>>                    Move (Right (sNRDOCTO, 11)) to sNRDOCTO 
37225>>>>>>>>>                    Move (EditaCpfCnpj(sNRDOCTO,11,CSAG320.TPPESSOA))   to CSAG320.NRDOCTO_ED
37226>>>>>>>>>                End // (CSAG320.TPPESSOA='F')
37226>>>>>>>>>>
37226>>>>>>>>>                
37226>>>>>>>>>            End // (CSAG320.PAIS='BRA')
37226>>>>>>>>>>
37226>>>>>>>>>            Else Begin
37227>>>>>>>>>                Move (Trim (CSAG320.NRDOCTO)) to CSAG320.NRDOCTO_ED                    
37228>>>>>>>>>            End // (CSAG320.PAIS<>'BRA')
37228>>>>>>>>>>
37228>>>>>>>>>        End
37228>>>>>>>>>>
37228>>>>>>>>>        Else Begin
37229>>>>>>>>>            Move CSAG320.CODIGO to CSAG320.NRDOCTO
37230>>>>>>>>>            Move (ColocaZerosEsquerda(CSAG320.NRDOCTO,14)) to CSAG320.NRDOCTO
37231>>>>>>>>>        End
37231>>>>>>>>>>
37231>>>>>>>>>
37231>>>>>>>>>        //------------------------------------------------------------
37231>>>>>>>>>        //---Configurando o nome fantasia
37231>>>>>>>>>            If (Trim (CSAG320.FANTASIA)='') ;                Move (Trim (CSAG320.NOME)) to CSAG320.FANTASIA
37234>>>>>>>>>    
37234>>>>>>>>>            If (CSAG320.CSAG336_ID = 2) Begin
37236>>>>>>>>>                Move (CurrentDateTime())       to CSAG320.STATUS_DT_INATIVO
37237>>>>>>>>>            End
37237>>>>>>>>>>
37237>>>>>>>>>    
37237>>>>>>>>>            If (CSAG320.CSAG336_ID = 1 and CSAG320.STATUS_DT_INATIVO <> '01/01/1753 00:00:00') Begin
37239>>>>>>>>>                Move '01/01/1753 00:00:00'     to CSAG320.STATUS_DT_INATIVO
37240>>>>>>>>>                Move (CurrentDateTime())       to CSAG320.STATUS_DT_ATIVO
37241>>>>>>>>>            End
37241>>>>>>>>>>
37241>>>>>>>>>                
37241>>>>>>>>>        //------------------------------------------------------------
37241>>>>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
37241>>>>>>>>>    
37241>>>>>>>>>             Clear   CSAG311
37242>>>>>>>>>             Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
37243>>>>>>>>>             Find Eq CSAG311                      by 1
37244>>>>>>>>>>
37244>>>>>>>>>               If (Found) Begin
37246>>>>>>>>>                   Send p_RegistraAcessoUsuario "CSAG320.USUARIO_ID_A" CSAG311.USUARIONUMERO
37247>>>>>>>>>               End
37247>>>>>>>>>>
37247>>>>>>>>>    
37247>>>>>>>>>    End_Procedure // Update_PAG320_01
37248>>>>>>>>>
37248>>>>>>>>>    Procedure Deleting_PAG320_01
37250>>>>>>>>>       String sQuery
37250>>>>>>>>>       
37250>>>>>>>>>       Forward Send Deleting
37252>>>>>>>>>       
37252>>>>>>>>>        Move "delete from dbo.CSAG369 where CSAG320_NR = %1" to sQuery
37253>>>>>>>>>        Move (SFormat(sQuery, CSAG320.CODIGO)) to sQuery
37254>>>>>>>>>        SQL_EXECUTE hStmt_CSAG369_01 sQuery 
37273>>>>>>>>>>
37273>>>>>>>>>       
37273>>>>>>>>>        Send p_FFOperation 3 
37274>>>>>>>>>    End_Procedure   // Deleting_PAG320_01
37275>>>>>>>>>
37275>>>>>>>>>    Procedure Save_Main_File_PAG320_01
37277>>>>>>>>>        Integer iRECNUM
37277>>>>>>>>>        Integer iPOS
37277>>>>>>>>>        String  sNAME
37277>>>>>>>>>        String  sNRDOCTO
37277>>>>>>>>>        Move CSAG320.RECNUM to iRECNUM
37278>>>>>>>>>        Forward Send Save_Main_File
37280>>>>>>>>>        If (iRECNUM=0) Begin
37282>>>>>>>>>            //--- NOVO REGISTRO
37282>>>>>>>>>            Send p_FFOperation 2
37283>>>>>>>>>        End // If (iRECNUM=0) Begin
37283>>>>>>>>>>
37283>>>>>>>>>        Else Begin
37284>>>>>>>>>          //--- REGISTRO ALTERADO
37284>>>>>>>>>            Send p_FFOperation 1 
37285>>>>>>>>>        End
37285>>>>>>>>>>
37285>>>>>>>>>//        
37285>>>>>>>>>//        Clear CSAG340
37285>>>>>>>>>//        Move CSAG320.CODIGO to CSAG340.CSAG320_ID
37285>>>>>>>>>//        Find Eq CSAG340 by 2
37285>>>>>>>>>//        If (Found) Begin
37285>>>>>>>>>//            Clear HSAG340
37285>>>>>>>>>//            Move CSAG320.CODIGO to HSAG340.CSAG320_ID
37285>>>>>>>>>//            Find Eq HSAG340 by 1
37285>>>>>>>>>//
37285>>>>>>>>>//            Move HSAG340.Recnum     to iRECNUM
37285>>>>>>>>>//
37285>>>>>>>>>//            If (not(Found)) Begin
37285>>>>>>>>>//                Clear HSAG340
37285>>>>>>>>>//                Move CSAG340.CSAG320_ID to HSAG340.CSAG320_ID
37285>>>>>>>>>//            End
37285>>>>>>>>>//            Else Begin
37285>>>>>>>>>//                Send p_FFOperationTable 0 HSAG340.File_Number
37285>>>>>>>>>//            End
37285>>>>>>>>>//            
37285>>>>>>>>>//                Move (Trim(CSAG320.NRDOCTO)) to HSAG340.NRDOCTO
37285>>>>>>>>>//                Move (Trim(CSAG320.NOME))    to sNAME
37285>>>>>>>>>//                Move (Mid(sNAME, 50, 1))     to sNAME
37285>>>>>>>>>//                
37285>>>>>>>>>//                Move (Pos (" ", sNAME)) to iPOS
37285>>>>>>>>>//                If (iPOS > 0) Begin
37285>>>>>>>>>//                    Move (Left (sNAME, iPOS - 1)) to HSAG340.GRUPO_DESCR
37285>>>>>>>>>//                End
37285>>>>>>>>>//                Else Move sNAME to HSAG340.GRUPO_DESCR
37285>>>>>>>>>//                
37285>>>>>>>>>//                Move CSAG320.NRDOCTO_ED to sNRDOCTO
37285>>>>>>>>>//                
37285>>>>>>>>>//                If (CSAG320.TPPESSOA = 'J') Begin
37285>>>>>>>>>//                    Move (Pos ("/", sNRDOCTO)) to iPOS
37285>>>>>>>>>//                    If (iPOS > 0) Begin
37285>>>>>>>>>//                        Move (Left (sNRDOCTO, iPOS - 1)) to sNRDOCTO
37285>>>>>>>>>//                    End
37285>>>>>>>>>//                End
37285>>>>>>>>>//                
37285>>>>>>>>>//                If (CSAG320.TPPESSOA = 'F') Begin
37285>>>>>>>>>//                    Move (Pos ("-", sNRDOCTO)) to iPOS
37285>>>>>>>>>//                    If (iPOS > 0) Begin
37285>>>>>>>>>//                        Move (Left (sNRDOCTO, iPOS - 1)) to sNRDOCTO
37285>>>>>>>>>//                    End
37285>>>>>>>>>//                End
37285>>>>>>>>>//                
37285>>>>>>>>>//                REMOVE_CHAR   sNRDOCTO
37285>>>>>>>>>//                
37285>>>>>>>>>//                Move sNRDOCTO to HSAG340.NRDOCTO_RAIZ
37285>>>>>>>>>//                Move CSAG320.TPPESSOA to HSAG340.TPPESSOA
37285>>>>>>>>>
37285>>>>>>>>>            //------------------------------------------------------------
37285>>>>>>>>>            //---Configurando os dados Usuario Que Esta Cadastrando
37285>>>>>>>>>//        
37285>>>>>>>>>//                Clear   CSAG311
37285>>>>>>>>>//                Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
37285>>>>>>>>>//                Find Eq CSAG311                      by 1
37285>>>>>>>>>//                  If (Found) Begin                   
37285>>>>>>>>>//                      Send p_RegistraAcessoUsuario "HSAG340.USUARIO_ID_C" CSAG311.USUARIONUMERO
37285>>>>>>>>>//                      Send p_RegistraAcessoUsuario "HSAG340.USUARIO_ID_A" CSAG311.USUARIONUMERO
37285>>>>>>>>>//                  End
37285>>>>>>>>>//                 
37285>>>>>>>>>//                SaveRecord HSAG340
37285>>>>>>>>>//                
37285>>>>>>>>>//                If (iRECNUM = 0) Begin
37285>>>>>>>>>//                    Send p_FFOperationTable 2 HSAG340.File_Number
37285>>>>>>>>>//                End
37285>>>>>>>>>//                Else Begin
37285>>>>>>>>>//                    Send p_FFOperationTable 1 HSAG340.File_Number 
37285>>>>>>>>>//                End
37285>>>>>>>>>//                
37285>>>>>>>>>//        End // FOUND CSAG340
37285>>>>>>>>>                    
37285>>>>>>>>>    End_Procedure // Save_Main_File_PAG320_01
37286>>>>>>>>>    
37286>>>>>>>>>    Procedure Backout_PAG320_01
37288>>>>>>>>>        Forward Send Backout
37290>>>>>>>>>        Send p_FFOperation 0
37291>>>>>>>>>    End_Procedure   // Backout_PAG320_01
37292>>>>>>>>>    
37292>>>>>>>>>    Function Validate_Save_PAG320_01 Returns Integer
37294>>>>>>>>>        Integer iReturnval
37294>>>>>>>>>        String  sCSAG320NRDOCTO_ED
37294>>>>>>>>>        Forward Get Validate_Save to iReturnval
37296>>>>>>>>>        If (not(iReturnval)) Begin
37298>>>>>>>>>            If (CSAG320.PAIS='BRA' and CSAG320.TPDOCTO <> '99') Begin
37300>>>>>>>>>                Move (Trim(CSAG320.NRDOCTO_ED)) to sCSAG320NRDOCTO_ED
37301>>>>>>>>>                Get Validate_CNPJ_CPF sCSAG320NRDOCTO_ED to iReturnval
37302>>>>>>>>>            End
37302>>>>>>>>>>
37302>>>>>>>>>        End 
37302>>>>>>>>>>
37302>>>>>>>>>        Function_Return iReturnval
37303>>>>>>>>>    End_Function // Validate_Save_PAG320_01
37304>>>>>>>>>
37304>>>>>>>>>    Function Validate_Delete_PAG320_01 Returns Integer
37306>>>>>>>>>        Integer iReturnVal
37306>>>>>>>>>        Integer iQtdeRec
37306>>>>>>>>>        Integer iError_Id
37306>>>>>>>>>        String  sError_Ds
37306>>>>>>>>>        String  sError_Tabela
37306>>>>>>>>>        String  sQuery
37306>>>>>>>>>        Boolean bFound
37306>>>>>>>>>        
37306>>>>>>>>>        Forward Get Validate_Delete to iReturnVal
37308>>>>>>>>>        If not (iReturnVal) Begin
37310>>>>>>>>>            
37310>>>>>>>>>            // VERIFICA SE NAO POSSUI TIPO ATRELADOS
37310>>>>>>>>>            Move False to bFound
37311>>>>>>>>>            Move "SELECT TOP 1 RECNUM FROM DBO.CSAG366 WHERE CSAG320_ID = %1" to sQuery
37312>>>>>>>>>            Move (SFormat(sQuery, (CSAG320.CODIGO))) to sQuery
37313>>>>>>>>>            SQL_FIND_BEGIN hStmt_csag366 sQuery
37332>>>>>>>>>>
37332>>>>>>>>>                Move True to bFound
37333>>>>>>>>>            SQL_FIND_END hStmt_csag366 
37340>>>>>>>>>>
37340>>>>>>>>>            If (bFound) Begin
37342>>>>>>>>>                Move 366002     to iError_Id
37343>>>>>>>>>                Move 'CSAG366'  to sError_Tabela
37344>>>>>>>>>                //--PESSOA NAO PODE SER EXCLUIDA. TIPOS ATRELADOS.
37344>>>>>>>>>                Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
37345>>>>>>>>>                Error iError_Id sError_Ds
37346>>>>>>>>>>
37346>>>>>>>>>                Move 1 to iReturnVal 
37347>>>>>>>>>            End
37347>>>>>>>>>>
37347>>>>>>>>>            
37347>>>>>>>>>            // VERIFICA SE NAO POSSUI MARCA
37347>>>>>>>>>            Move False to bFound
37348>>>>>>>>>            Move "SELECT TOP 1 RECNUM FROM DBO.CSAG374 WHERE CSAG320_ID = %1" to sQuery
37349>>>>>>>>>            Move (SFormat(sQuery, (CSAG320.CODIGO))) to sQuery
37350>>>>>>>>>            SQL_FIND_BEGIN hStmt_csag374 sQuery
37369>>>>>>>>>>
37369>>>>>>>>>                Move True to bFound
37370>>>>>>>>>            SQL_FIND_END hStmt_csag374 
37377>>>>>>>>>>
37377>>>>>>>>>            If (bFound) Begin
37379>>>>>>>>>                Move 374001     to iError_Id
37380>>>>>>>>>                Move 'CSAG374'  to sError_Tabela
37381>>>>>>>>>                //--PESSOA NAO PODE SER EXCLUIDA. MARCAS ATRELADAS.
37381>>>>>>>>>                Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
37382>>>>>>>>>                Error iError_Id sError_Ds
37383>>>>>>>>>>
37383>>>>>>>>>                Move 1 to iReturnVal 
37384>>>>>>>>>            End
37384>>>>>>>>>>
37384>>>>>>>>>            
37384>>>>>>>>>            // VERIFICA SE A PESSOA NAO ESTA SENDO UTILIZADA
37384>>>>>>>>>            Move False to bFound
37385>>>>>>>>>            Move "SELECT TOP 1 RECNUM FROM DBO.HCGS2101 WHERE CSAG340_ID = %1" to sQuery
37386>>>>>>>>>            Move (SFormat(sQuery, (CSAG320.CODIGO))) to sQuery
37387>>>>>>>>>            SQL_FIND_BEGIN hStmt_hcgs2101_01 sQuery
37406>>>>>>>>>>
37406>>>>>>>>>                Move True to bFound
37407>>>>>>>>>            SQL_FIND_END hStmt_hcgs2101_01 
37414>>>>>>>>>>
37414>>>>>>>>>            If (bFound) Begin
37416>>>>>>>>>                Move 2101007     to iError_Id
37417>>>>>>>>>                Move 'HCGS2101'  to sError_Tabela
37418>>>>>>>>>                //--PESSOA NAO PODE SER EXCLUIDA, SOMENTE INATIVADA. FUP ATRELADO COMO CLIENTE.
37418>>>>>>>>>                Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
37419>>>>>>>>>                Error iError_Id sError_Ds
37420>>>>>>>>>>
37420>>>>>>>>>                Move 1 to iReturnVal  
37421>>>>>>>>>            End
37421>>>>>>>>>>
37421>>>>>>>>>               
37421>>>>>>>>>            Move False to bFound
37422>>>>>>>>>            Move "SELECT TOP 1 RECNUM FROM DBO.HCGS2101 WHERE CSAG341_ID = %1" to sQuery
37423>>>>>>>>>            Move (SFormat(sQuery, (CSAG320.CODIGO))) to sQuery
37424>>>>>>>>>            SQL_FIND_BEGIN hStmt_hcgs2101_02 sQuery
37443>>>>>>>>>>
37443>>>>>>>>>                Move True to bFound
37444>>>>>>>>>            SQL_FIND_END hStmt_hcgs2101_02 
37451>>>>>>>>>>
37451>>>>>>>>>            If (bFound) Begin
37453>>>>>>>>>                Move 2101008     to iError_Id
37454>>>>>>>>>                Move 'HCGS2101'  to sError_Tabela
37455>>>>>>>>>                //--PESSOA NAO PODE SER EXCLUIDA, SOMENTE INATIVADA. FUP ATRELADO COMO VENDEDOR.
37455>>>>>>>>>                Get fgRetErroDescricao iError_Id sError_Tabela to sError_Ds
37456>>>>>>>>>                Error iError_Id sError_Ds
37457>>>>>>>>>>
37457>>>>>>>>>                Move 1 to iReturnVal  
37458>>>>>>>>>            End
37458>>>>>>>>>>
37458>>>>>>>>>                            
37458>>>>>>>>>        End    
37458>>>>>>>>>>
37458>>>>>>>>>        Function_Return iReturnVal
37459>>>>>>>>>    End_Function // Validate_Delete_PAG320_01
37460>>>>>>>>>
Including file: p_FFOperation.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\p_FFOperation.inc)
37460>>>>>>>>>>//ANDERSON RODRIGUES - 02.02.2014 - 13:40
37460>>>>>>>>>>//-2WA    
37460>>>>>>>>>>    //PROCEDURE USADA PELA TABELA PRINCIPAL DO DICIONARIO DE DADOS
37460>>>>>>>>>>    Procedure p_FFOperation Integer iOper
37462>>>>>>>>>>
37462>>>>>>>>>>        //------------------------------------------------------------
37462>>>>>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
37462>>>>>>>>>>
37462>>>>>>>>>>        Clear   CSAG311
37463>>>>>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
37464>>>>>>>>>>        Find Eq CSAG311                      by 1
37465>>>>>>>>>>>
37465>>>>>>>>>>        If (Found) Begin
37467>>>>>>>>>>            Send p_FileFieldOperation ;                 iOper ;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
37468>>>>>>>>>>        End
37468>>>>>>>>>>>
37468>>>>>>>>>>    End_Procedure // p_FFOperation
37469>>>>>>>>>>
37469>>>>>>>>>>    
37469>>>>>>>>>>    //PROCEDURE USADA PELA(S) TABELA(S) SECUNDARIA(S) DO DICIONARIO DE DADOS
37469>>>>>>>>>>    //UTILIZE ESTA PROCEDURE PARA ARMAZENAR LOG(S) DA(S) TABELA(S) SECUNDARIA(S)
37469>>>>>>>>>>    //VIDE EXEMPLO cCSAG371DataDictionary.dd
37469>>>>>>>>>>    Procedure p_FFOperationTable Integer iOper Integer iTable
37471>>>>>>>>>>
37471>>>>>>>>>>        //------------------------------------------------------------
37471>>>>>>>>>>        //---Configurando os dados Usuario Que Esta Cadastrando
37471>>>>>>>>>>
37471>>>>>>>>>>        Clear   CSAG311
37472>>>>>>>>>>        Move (psUsuarioSessao(Self))         to CSAG311.USUARIOSESSAO
37473>>>>>>>>>>        Find Eq CSAG311                      by 1
37474>>>>>>>>>>>
37474>>>>>>>>>>        If (Found) Begin
37476>>>>>>>>>>            Send p_FileFieldOperationTable;                 iTable;                 iOper;                (psProgramName(Self));                 CSAG311.USUARIOECODIGO;                (Trim(CSAG311.USUARIOEMPRESA));                  CSAG311.USUARIONUMERO;                (Trim(CSAG311.USUARIONOME));                (Trim(CSAG311.USUARIOSESSAO));                (Trim(CSAG311.USUARIOIP))
37477>>>>>>>>>>        End
37477>>>>>>>>>>>
37477>>>>>>>>>>    End_Procedure // p_FFOperationTable
37478>>>>>>>>>>    
37478>>>>>>>>>>
37478>>>>>>>>>
37478>>>>>>>>>End_Class
37479>>>>>>>
37479>>>>>>>Function f_pegaDescricao String sCodigo Returns String
#REM SEND REGISTERINTERFACE |CI7369 "get_f_pegaDescricao" "String sCodigo Returns String" "f_pegaDescricao"
37483>>>>>>>    String sCSAG320CLIENTENOME
37483>>>>>>>    
37483>>>>>>>    Move 'ERR#CODIGO INVALIDO' to sCSAG320CLIENTENOME
37484>>>>>>>    
37484>>>>>>>    Clear CSAG320
37485>>>>>>>    Move sCodigo     to CSAG320.CODIGO
37486>>>>>>>    Find Eq CSAG320 by 1
37487>>>>>>>>
37487>>>>>>>    If (Found) Begin
37489>>>>>>>        Move (Trim(CSAG320.NOME)) to sCSAG320CLIENTENOME    
37490>>>>>>>    End
37490>>>>>>>>
37490>>>>>>>    
37490>>>>>>>    Function_Return sCSAG320CLIENTENOME
37491>>>>>>>    
37491>>>>>>>End_Function //f_pegaDescricao
37492>>>>>>>
37492>>>>>>>Function f_pegaDescricao_Trade String sCodigo Returns String
#REM SEND REGISTERINTERFACE |CI7370 "get_f_pegaDescricao_Trade" "String sCodigo Returns String" "f_pegaDescricao"
37496>>>>>>>    String sCSAG320CLIENTENOME
37496>>>>>>>    
37496>>>>>>>    Move 'ERR#CODIGO INVALIDO' to sCSAG320CLIENTENOME
37497>>>>>>>    
37497>>>>>>>    Clear TSMG800
37498>>>>>>>    Smart_Find Ge TSMG800 by 0
37509>>>>>>>    
37509>>>>>>>    Clear CSAG320
37510>>>>>>>    Move sCodigo     to CSAG320.CODIGO
37511>>>>>>>    Find Eq CSAG320 by 1
37512>>>>>>>>
37512>>>>>>>    If (Found) Begin
37514>>>>>>>        Clear CSAG366
Including file: CSAG366.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG366.fd)
37515>>>>>>>        Move sCodigo          to CSAG366.CSAG320_ID
37516>>>>>>>        Move TSMG800.TRADE_ID to CSAG366.CSAG319_ID
37517>>>>>>>        Find EQ CSAG366 by 1
37518>>>>>>>>
37518>>>>>>>        If Found Move (Trim(CSAG320.NOME)) to sCSAG320CLIENTENOME  
37521>>>>>>>        Else Move ("ERR#CODIGO INVALIDO, NAO E TRADE") to sCSAG320CLIENTENOME  
37523>>>>>>>    End
37523>>>>>>>>
37523>>>>>>>    
37523>>>>>>>    Function_Return sCSAG320CLIENTENOME
37524>>>>>>>    
37524>>>>>>>End_Function //f_pegaDescricao_Trade
37525>>>>>>>
37525>>>>>>>Function f_pegaDescricao_Conc String sCodigo Returns String
#REM SEND REGISTERINTERFACE |CI7371 "get_f_pegaDescricao_Conc" "String sCodigo Returns String" "f_pegaDescricao"
37529>>>>>>>    String sCSAG320CLIENTENOME
37529>>>>>>>    
37529>>>>>>>    Move 'ERR#CODIGO INVALIDO' to sCSAG320CLIENTENOME
37530>>>>>>>
37530>>>>>>>    Clear TSMG800
37531>>>>>>>    Smart_Find Ge TSMG800 by 0
37542>>>>>>>    
37542>>>>>>>    Clear CSAG320
37543>>>>>>>    Move sCodigo     to CSAG320.CODIGO
37544>>>>>>>    Find Eq CSAG320 by 1
37545>>>>>>>>
37545>>>>>>>    If (Found) Begin
37547>>>>>>>        Clear CSAG366
37548>>>>>>>        Move sCodigo                 to CSAG366.CSAG320_ID
37549>>>>>>>        Move TSMG800.CONCORRENCIA_ID to CSAG366.CSAG319_ID
37550>>>>>>>        Find EQ CSAG366 by 1
37551>>>>>>>>
37551>>>>>>>        If Found Move (Trim(CSAG320.NOME)) to sCSAG320CLIENTENOME  
37554>>>>>>>        Else Move ("ERR#CODIGO INVALIDO, NAO E CONCORRENTE") to sCSAG320CLIENTENOME  
37556>>>>>>>    End
37556>>>>>>>>
37556>>>>>>>    
37556>>>>>>>    Function_Return sCSAG320CLIENTENOME
37557>>>>>>>    
37557>>>>>>>End_Function //f_pegaDescricao_Conc
37558>>>>>>>
37558>>>>>>>Function f_pegaFantasia String sCodigo Returns String
#REM SEND REGISTERINTERFACE |CI7372 "get_f_pegaFantasia" "String sCodigo Returns String" "f_pegaFantasia"
37562>>>>>>>    String sCSAG320CLIENTEFANTASIA
37562>>>>>>>    
37562>>>>>>>    Move 'ERR#CODIGO INVALIDO' to sCSAG320CLIENTEFANTASIA
37563>>>>>>>    
37563>>>>>>>    Clear CSAG320
37564>>>>>>>    Move sCodigo to CSAG320.CODIGO
37565>>>>>>>    Find Eq CSAG320 by 1
37566>>>>>>>>
37566>>>>>>>    If (Found) Begin
37568>>>>>>>        Move (Trim(CSAG320.FANTASIA)) to sCSAG320CLIENTEFANTASIA    
37569>>>>>>>    End
37569>>>>>>>>
37569>>>>>>>    
37569>>>>>>>    Function_Return sCSAG320CLIENTEFANTASIA
37570>>>>>>>    
37570>>>>>>>End_Function //f_pegaFantasia
37571>>>>>>>
37571>>>>>>>Function f_pegaFantasia_2101_05 String sCodigo Returns String
#REM SEND REGISTERINTERFACE |CI7373 "get_f_pegaFantasia_2101_05" "String sCodigo Returns String" "f_pegaFantasia"
37575>>>>>>>    String sCSAG320CLIENTEFANTASIA
37575>>>>>>>    
37575>>>>>>>    Move 'NAO ENCONTRADO' to sCSAG320CLIENTEFANTASIA
37576>>>>>>>    
37576>>>>>>>    Clear CSAG320
37577>>>>>>>    Move sCodigo to CSAG320.CODIGO
37578>>>>>>>    Find Eq CSAG320 by 1
37579>>>>>>>>
37579>>>>>>>    If (Found) Begin
37581>>>>>>>        Move (Trim(CSAG320.FANTASIA)) to sCSAG320CLIENTEFANTASIA    
37582>>>>>>>    End
37582>>>>>>>>
37582>>>>>>>    
37582>>>>>>>    Function_Return sCSAG320CLIENTEFANTASIA
37583>>>>>>>    
37583>>>>>>>End_Function //f_pegaFantasia
37584>>>>>>>
37584>>>>>>>Function f_bCSAG320_clientenome String sInicial String sSessionId Returns String
#REM SEND REGISTERINTERFACE |CI7374 "get_f_bCSAG320_clientenome" "String sInicial String sSessionId Returns String" ""
37588>>>>>>>    String  sQuebraLinha
37588>>>>>>>    String  sQuery
37588>>>>>>>    String  sLinhaAutoComplete
37588>>>>>>>    String  sListaAutoComplete
37588>>>>>>>    String  sCodigo
37588>>>>>>>    String  sExibeInformacao
37588>>>>>>>    String  sDescricao
37588>>>>>>>    String  sRecnum
37588>>>>>>>    String sCSAG320RECNUM       
37588>>>>>>>    String sCSAG320CODIGO       
37588>>>>>>>    String sCSAG320NOME         
37588>>>>>>>    String sCSAG320FANTASIA
37588>>>>>>>    String sCSAG320DATA_NASCFUND
37588>>>>>>>    String sCSAG320PAIS         
37588>>>>>>>    String sCSAG320STATUS       
37588>>>>>>>    String sCSAG320TPPESSOA     
37588>>>>>>>    String sCSAG320NRDOCTO  
37588>>>>>>>    String sCSAG320TPDOCTO 
37588>>>>>>>    
37588>>>>>>>    Move '{'                                                            to sLinhaAutoComplete
37589>>>>>>>    Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
37590>>>>>>>    Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37591>>>>>>>    Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37592>>>>>>>    Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
37593>>>>>>>    Move (sLinhaAutoComplete+',"cpfcnpj":""')                           to sLinhaAutoComplete
37594>>>>>>>    Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37595>>>>>>>    //
37595>>>>>>>    Move sLinhaAutoComplete to sListaAutoComplete
37596>>>>>>>
37596>>>>>>>    Clear CSAG311
37597>>>>>>>    Move sSessionId to CSAG311.USUARIOSESSAO
37598>>>>>>>    Find Eq CSAG311 by 1
37599>>>>>>>>
37599>>>>>>>    If (not(Found)) Begin
37601>>>>>>>        Function_Return ('['+sListaAutoComplete+']')
37602>>>>>>>    End
37602>>>>>>>>
37602>>>>>>>    
37602>>>>>>>    Clear CSAG300
37603>>>>>>>    Move CSAG311.USUARIONUMERO to CSAG300.USUARIONUMERO
37604>>>>>>>    Find Eq CSAG300 by 3
37605>>>>>>>>
37605>>>>>>>    If (not(Found)) Begin
37607>>>>>>>        Function_Return ('['+sListaAutoComplete+']')
37608>>>>>>>    End
37608>>>>>>>>
37608>>>>>>>   
37608>>>>>>>   
37608>>>>>>>    Move (Character(13)+Character(10)) to sQuebraLinha
37609>>>>>>>    
37609>>>>>>>    Move (ToANSI(sInicial)) to sInicial
37610>>>>>>>    Move (Trim(sInicial))   to sInicial
37611>>>>>>>    Move (Replaces("'",sInicial,"''")) to sInicial //-Quando existe apstrofe no nome   
37612>>>>>>>        
37612>>>>>>>        Move "" to sLinhaAutoComplete
37613>>>>>>>        Move "" to sListaAutoComplete
37614>>>>>>>        Move "" to sQuery
37615>>>>>>>        //-
37615>>>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG320
37620>>>>>>>>
37620>>>>>>>    Move "SELECT TOP 15 c.RECNUM, c.CODIGO, c.NOME, c.FANTASIA, c.DATA_NASCFUND, c.PAIS, c.CSAG336_ID, c.TPPESSOA," to sQuery
37621>>>>>>>    If (CSAG300.USUARIOCLASSE = TSMG800.CLASSEGUEST) Begin
37623>>>>>>>         Move (sQuery*"c.NRDOCTO, c.TPDOCTO From dbo.CSAG320 c") to sQuery
37624>>>>>>>         Move (sQuery*"INNER JOIN dbo.CSAG369 x on (x.CSAG320_NR = c.CODIGO and x.CSAG300_NRHD = %1)") to sQuery
37625>>>>>>>         Move (SFormat(sQuery, CSAG300.USUARIONUMERO)) to sQuery
37626>>>>>>>         //-
37626>>>>>>>         Move (sQuery*"WHERE c.FANTASIA collate Latin1_General_CI_AI LIKE '%1' AND c.CSAG336_ID = 1") to sQuery
37627>>>>>>>         Move (sQuery*"ORDER BY c.FANTASIA") to sQuery
37628>>>>>>>    End
37628>>>>>>>>
37628>>>>>>>    Else Move (sQuery*"c.NRDOCTO, c.TPDOCTO From dbo.CSAG320 c WHERE c.FANTASIA collate Latin1_General_CI_AI LIKE  '%1' AND c.CSAG336_ID = 1 ORDER BY c.FANTASIA") to sQuery
37630>>>>>>>        Move (SFORMAT(sQuery, ('%'+sInicial+'%'))) to sQuery
37631>>>>>>>    SQL_FIND_BEGIN hStmt_CSAG320_01 sQuery
37650>>>>>>>>
37650>>>>>>>        //SqlFindValueByName
37650>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,1))                             to sCSAG320RECNUM
37651>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,2))                             to sCSAG320CODIGO
37652>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,3))                             to sCSAG320NOME
37653>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,4))                             to sCSAG320FANTASIA
37654>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,5))                             to sCSAG320DATA_NASCFUND
37655>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,6))                             to sCSAG320PAIS
37656>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,7))                             to sCSAG320STATUS
37657>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,8))                             to sCSAG320TPPESSOA
37658>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,9))                             to sCSAG320NRDOCTO
37659>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,10))                            to sCSAG320TPDOCTO
37660>>>>>>>                                                                            
37660>>>>>>>        //REMOVER ESPACOS EM BRANCO                                         
37660>>>>>>>        Move (Trim(sCSAG320NOME))                                           to sCSAG320NOME
37661>>>>>>>        Move (Trim(sCSAG320FANTASIA))                                       to sCSAG320FANTASIA
37662>>>>>>>        Move (Trim(sCSAG320PAIS))                                           to sCSAG320PAIS
37663>>>>>>>        Move (Trim(sCSAG320NRDOCTO))                                        to sCSAG320NRDOCTO
37664>>>>>>>        
37664>>>>>>>        //IDENTIFICAR OS CAMPOS
37664>>>>>>>        Move  sCSAG320RECNUM                                                to sRecnum
37665>>>>>>>        Move  sCSAG320CODIGO                                                to sCodigo
37666>>>>>>>        Move  sCSAG320FANTASIA                                              to sDescricao
37667>>>>>>>                                                                            
37667>>>>>>>        Move (sCSAG320FANTASIA)                              to sExibeInformacao
37668>>>>>>>
37668>>>>>>>        Get Find_Code_Description of oTPDOCTO_VT sCSAG320TPDOCTO to sCSAG320TPDOCTO
37669>>>>>>>        Move (sExibeInformacao*Trim(sCSAG320TPDOCTO)+':'+sCSAG320NRDOCTO)     to sExibeInformacao 
37670>>>>>>>
37670>>>>>>>        //MONTAR O AUTOCOMPLETE
37670>>>>>>>        Move '{'                                                            to sLinhaAutoComplete
37671>>>>>>>        Move (sLinhaAutoComplete+'"id":"'+sCodigo+'"')                      to sLinhaAutoComplete
37672>>>>>>>        Move (sLinhaAutoComplete+',"label":"'+sExibeInformacao+'"')         to sLinhaAutoComplete
37673>>>>>>>        Move (sLinhaAutoComplete+',"value":"'+sDescricao+'"')               to sLinhaAutoComplete
37674>>>>>>>        Move (sLinhaAutoComplete+',"recnum":"'+sRecnum+'"')                 to sLinhaAutoComplete
37675>>>>>>>        Move (sLinhaAutoComplete+',"cpfcnpj":"'+sCSAG320NRDOCTO+'"')        to sLinhaAutoComplete
37676>>>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37677>>>>>>>        //                                                          
37677>>>>>>>        Move (sListaAutoComplete+If(sListaAutoComplete<>'',',','')+sLinhaAutoComplete) to sListaAutoComplete                    
37678>>>>>>>                        
37678>>>>>>>    SQL_FIND_END hStmt_CSAG320_01 
37685>>>>>>>>
37685>>>>>>>        
37685>>>>>>>        If (sListaAutoComplete='') Begin
37687>>>>>>>        Move '{'                                                            to sLinhaAutoComplete
37688>>>>>>>        Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
37689>>>>>>>        Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37690>>>>>>>        Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37691>>>>>>>        Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
37692>>>>>>>        Move (sLinhaAutoComplete+',"cpfcnpj":""')                           to sLinhaAutoComplete
37693>>>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37694>>>>>>>        //
37694>>>>>>>        Move sLinhaAutoComplete to sListaAutoComplete
37695>>>>>>>        End
37695>>>>>>>>
37695>>>>>>>        
37695>>>>>>>    Function_Return ('['+sListaAutoComplete+']')
37696>>>>>>>    
37696>>>>>>>End_Function // f_bCSAG320_clientenome
37697>>>>>>>
37697>>>>>>>Function f_bCSAG320_clientenome_trade String sInicial String sSessionId Returns String
#REM SEND REGISTERINTERFACE |CI7375 "get_f_bCSAG320_clientenome_trade" "String sInicial String sSessionId Returns String" ""
37701>>>>>>>    String  sQuebraLinha
37701>>>>>>>    String  sQuery
37701>>>>>>>    String  sLinhaAutoComplete
37701>>>>>>>    String  sListaAutoComplete
37701>>>>>>>    String  sCodigo
37701>>>>>>>    String  sExibeInformacao
37701>>>>>>>    String  sDescricao
37701>>>>>>>    String  sRecnum
37701>>>>>>>    String sCSAG320RECNUM       
37701>>>>>>>    String sCSAG320CODIGO       
37701>>>>>>>    String sCSAG320NOME         
37701>>>>>>>    String sCSAG320FANTASIA
37701>>>>>>>    String sCSAG320DATA_NASCFUND
37701>>>>>>>    String sCSAG320PAIS         
37701>>>>>>>    String sCSAG320STATUS       
37701>>>>>>>    String sCSAG320TPPESSOA     
37701>>>>>>>    String sCSAG320NRDOCTO  
37701>>>>>>>    String sCSAG320TPDOCTO 
37701>>>>>>>
37701>>>>>>>    Move '{'                                                            to sLinhaAutoComplete
37702>>>>>>>    Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
37703>>>>>>>    Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37704>>>>>>>    Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37705>>>>>>>    Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
37706>>>>>>>    Move (sLinhaAutoComplete+',"cpfcnpj":""')                           to sLinhaAutoComplete
37707>>>>>>>    Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37708>>>>>>>    //
37708>>>>>>>    Move sLinhaAutoComplete to sListaAutoComplete
37709>>>>>>>
37709>>>>>>>    Clear CSAG311
37710>>>>>>>    Move sSessionId to CSAG311.USUARIOSESSAO
37711>>>>>>>    Find Eq CSAG311 by 1
37712>>>>>>>>
37712>>>>>>>    If (not(Found)) Begin
37714>>>>>>>        Function_Return ('['+sListaAutoComplete+']')
37715>>>>>>>    End
37715>>>>>>>>
37715>>>>>>>    
37715>>>>>>>    Clear CSAG300
37716>>>>>>>    Move CSAG311.USUARIONUMERO to CSAG300.USUARIONUMERO
37717>>>>>>>    Find Eq CSAG300 by 3
37718>>>>>>>>
37718>>>>>>>    If (not(Found)) Begin
37720>>>>>>>        Function_Return ('['+sListaAutoComplete+']')
37721>>>>>>>    End
37721>>>>>>>>
37721>>>>>>>   
37721>>>>>>>    Move (Character(13)+Character(10)) to sQuebraLinha
37722>>>>>>>    
37722>>>>>>>    Move (ToANSI(sInicial)) to sInicial
37723>>>>>>>    Move (Trim(sInicial))   to sInicial
37724>>>>>>>    Move (Replaces("'",sInicial,"''")) to sInicial //-Quando existe apstrofe no nome
37725>>>>>>>    
37725>>>>>>>    Clear TSMG800
37726>>>>>>>    Smart_Find Ge TSMG800 by 0
37737>>>>>>>
37737>>>>>>>        Move "" to sLinhaAutoComplete
37738>>>>>>>        Move "" to sListaAutoComplete
37739>>>>>>>        Move "" to sQuery
37740>>>>>>>        //-
37740>>>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG320
37745>>>>>>>>
37745>>>>>>> 
37745>>>>>>>    Move "SELECT TOP 15 a.RECNUM, a.CODIGO, a.NOME, a.FANTASIA, a.DATA_NASCFUND, a.PAIS, a.CSAG336_ID, a.TPPESSOA," to sQuery
37746>>>>>>>    If (CSAG300.USUARIOCLASSE = TSMG800.CLASSEGUEST) Begin
37748>>>>>>>         Move (sQuery*"a.NRDOCTO, a.TPDOCTO From dbo.CSAG320 a") to sQuery 
37749>>>>>>>         Move (sQuery*"INNER JOIN DBO.CSAG366 b (ON a.CODIGO=b.CSAG320_ID)") to sQuery 
37750>>>>>>>         Move (sQuery*"INNER JOIN DBO.CSAG369 x (ON x.CSAG320_NR=a.CODIGO AND x.CSAG300_NRHD = %1)") to sQuery 
37751>>>>>>>         Move (SFormat(sQuery, CSAG300.USUARIONUMERO)) to sQuery
37752>>>>>>>         //-
37752>>>>>>>         Move (sQuery*"WHERE a.FANTASIA collate Latin1_General_CI_AI LIKE '%1' AND b.CSAG319_ID = %2 ORDER BY a.FANTASIA") to sQuery 
37753>>>>>>>    End
37753>>>>>>>>
37753>>>>>>>    Else Move (sQuery*"a.NRDOCTO, a.TPDOCTO From dbo.CSAG320 a INNER JOIN DBO.CSAG366 b ON (a.CODIGO=b.CSAG320_ID) WHERE a.FANTASIA collate Latin1_General_CI_AI LIKE '%1' AND b.CSAG319_ID = %2 ORDER BY a.FANTASIA") to sQuery
37755>>>>>>>        Move (SFORMAT(sQuery, ('%'+sInicial+'%'), ToSQLNumber(TSMG800.TRADE_ID))) to sQuery
37756>>>>>>> 
37756>>>>>>>    SQL_FIND_BEGIN hStmt_CSAG320_01 sQuery
37775>>>>>>>>
37775>>>>>>>        //SqlFindValueByName
37775>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,1))                             to sCSAG320RECNUM
37776>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,2))                             to sCSAG320CODIGO
37777>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,3))                             to sCSAG320NOME
37778>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,4))                             to sCSAG320FANTASIA
37779>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,5))                             to sCSAG320DATA_NASCFUND
37780>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,6))                             to sCSAG320PAIS
37781>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,7))                             to sCSAG320STATUS
37782>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,8))                             to sCSAG320TPPESSOA
37783>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,9))                             to sCSAG320NRDOCTO
37784>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,10))                            to sCSAG320TPDOCTO
37785>>>>>>>                                                                            
37785>>>>>>>        //REMOVER ESPACOS EM BRANCO                                         
37785>>>>>>>        Move (Trim(sCSAG320NOME))                                           to sCSAG320NOME
37786>>>>>>>        Move (Trim(sCSAG320FANTASIA))                                       to sCSAG320FANTASIA
37787>>>>>>>        Move (Trim(sCSAG320PAIS))                                           to sCSAG320PAIS
37788>>>>>>>        Move (Trim(sCSAG320NRDOCTO))                                        to sCSAG320NRDOCTO
37789>>>>>>>        
37789>>>>>>>        //IDENTIFICAR OS CAMPOS
37789>>>>>>>        Move  sCSAG320RECNUM                                                to sRecnum
37790>>>>>>>        Move  sCSAG320CODIGO                                                to sCodigo
37791>>>>>>>        Move  sCSAG320FANTASIA                                              to sDescricao
37792>>>>>>>                                                                            
37792>>>>>>>        Move (sCSAG320CODIGO*'-'*sCSAG320NOME)                              to sExibeInformacao
37793>>>>>>>        If (sCSAG320FANTASIA <> "" and sCSAG320FANTASIA <> sCSAG320NOME) Begin                           
37795>>>>>>>            Move (sExibeInformacao*If(sCSAG320TPPESSOA='J','Fantasia:', 'Apelido:')*sCSAG320FANTASIA) to sExibeInformacao
37796>>>>>>>        End                                                                 
37796>>>>>>>>
37796>>>>>>>            Move (sExibeInformacao*If(sCSAG320TPPESSOA='J','Juridica', 'Fisica')) to sExibeInformacao
37797>>>>>>>            Move (sExibeInformacao*'Pais:'*sCSAG320PAIS)                          to sExibeInformacao 
37798>>>>>>>            
37798>>>>>>>            Get Find_Code_Description of oTPDOCTO_VT sCSAG320TPDOCTO to sCSAG320TPDOCTO
37799>>>>>>>            Move (sExibeInformacao*Trim(sCSAG320TPDOCTO)+':'+sCSAG320NRDOCTO)     to sExibeInformacao 
37800>>>>>>>
37800>>>>>>>            Move (sExibeInformacao*If(sCSAG320STATUS='1','( Ativo )', '( Inativo )')) to sExibeInformacao
37801>>>>>>>        
37801>>>>>>>        //MONTAR O AUTOCOMPLETE
37801>>>>>>>        Move '{'                                                            to sLinhaAutoComplete
37802>>>>>>>        Move (sLinhaAutoComplete+'"id":"'+sCodigo+'"')                      to sLinhaAutoComplete
37803>>>>>>>        Move (sLinhaAutoComplete+',"label":"'+sExibeInformacao+'"')         to sLinhaAutoComplete
37804>>>>>>>        Move (sLinhaAutoComplete+',"value":"'+sDescricao+'"')               to sLinhaAutoComplete
37805>>>>>>>        Move (sLinhaAutoComplete+',"recnum":"'+sRecnum+'"')                 to sLinhaAutoComplete
37806>>>>>>>        Move (sLinhaAutoComplete+',"cpfcnpj":"'+sCSAG320NRDOCTO+'"')        to sLinhaAutoComplete
37807>>>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37808>>>>>>>        //                                                          
37808>>>>>>>        Move (sListaAutoComplete+If(sListaAutoComplete<>'',',','')+sLinhaAutoComplete) to sListaAutoComplete                    
37809>>>>>>>                        
37809>>>>>>>    SQL_FIND_END hStmt_CSAG320_01 
37816>>>>>>>>
37816>>>>>>>        
37816>>>>>>>        If (sListaAutoComplete='') Begin
37818>>>>>>>        Move '{'                                                            to sLinhaAutoComplete
37819>>>>>>>        Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
37820>>>>>>>        Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37821>>>>>>>        Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37822>>>>>>>        Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
37823>>>>>>>        Move (sLinhaAutoComplete+',"cpfcnpj":""')                           to sLinhaAutoComplete
37824>>>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37825>>>>>>>        //
37825>>>>>>>        Move sLinhaAutoComplete to sListaAutoComplete
37826>>>>>>>        End
37826>>>>>>>>
37826>>>>>>>        
37826>>>>>>>    Function_Return ('['+sListaAutoComplete+']')
37827>>>>>>>    
37827>>>>>>>End_Function // f_bCSAG320_clientenome_trade
37828>>>>>>>
37828>>>>>>>Function f_bCSAG320_clientenome_conc String sInicial String sSessionId Returns String
#REM SEND REGISTERINTERFACE |CI7376 "get_f_bCSAG320_clientenome_conc" "String sInicial String sSessionId Returns String" ""
37832>>>>>>>    String  sQuebraLinha
37832>>>>>>>    String  sQuery
37832>>>>>>>    String  sLinhaAutoComplete
37832>>>>>>>    String  sListaAutoComplete
37832>>>>>>>    String  sCodigo
37832>>>>>>>    String  sExibeInformacao
37832>>>>>>>    String  sDescricao
37832>>>>>>>    String  sRecnum
37832>>>>>>>    String sCSAG320RECNUM       
37832>>>>>>>    String sCSAG320CODIGO       
37832>>>>>>>    String sCSAG320NOME         
37832>>>>>>>    String sCSAG320FANTASIA
37832>>>>>>>    String sCSAG320DATA_NASCFUND
37832>>>>>>>    String sCSAG320PAIS         
37832>>>>>>>    String sCSAG320STATUS       
37832>>>>>>>    String sCSAG320TPPESSOA     
37832>>>>>>>    String sCSAG320NRDOCTO  
37832>>>>>>>    String sCSAG320TPDOCTO 
37832>>>>>>>
37832>>>>>>>    Move '{'                                                            to sLinhaAutoComplete
37833>>>>>>>    Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
37834>>>>>>>    Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37835>>>>>>>    Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37836>>>>>>>    Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
37837>>>>>>>    Move (sLinhaAutoComplete+',"cpfcnpj":""')                           to sLinhaAutoComplete
37838>>>>>>>    Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37839>>>>>>>    //
37839>>>>>>>    Move sLinhaAutoComplete to sListaAutoComplete
37840>>>>>>>
37840>>>>>>>    Clear CSAG311
37841>>>>>>>    Move sSessionId to CSAG311.USUARIOSESSAO
37842>>>>>>>    Find Eq CSAG311 by 1
37843>>>>>>>>
37843>>>>>>>    If (not(Found)) Begin
37845>>>>>>>        Function_Return ('['+sListaAutoComplete+']')
37846>>>>>>>    End
37846>>>>>>>>
37846>>>>>>>    
37846>>>>>>>    Clear CSAG300
37847>>>>>>>    Move CSAG311.USUARIONUMERO to CSAG300.USUARIONUMERO
37848>>>>>>>    Find Eq CSAG300 by 3
37849>>>>>>>>
37849>>>>>>>    If (not(Found)) Begin
37851>>>>>>>        Function_Return ('['+sListaAutoComplete+']')
37852>>>>>>>    End
37852>>>>>>>>
37852>>>>>>>   
37852>>>>>>>    Move (Character(13)+Character(10)) to sQuebraLinha
37853>>>>>>>    
37853>>>>>>>    Move (ToANSI(sInicial)) to sInicial
37854>>>>>>>    Move (Trim(sInicial))   to sInicial
37855>>>>>>>    Move (Replaces("'",sInicial,"''")) to sInicial //-Quando existe apstrofe no nome
37856>>>>>>>    
37856>>>>>>>    Clear TSMG800
37857>>>>>>>    Smart_Find Ge TSMG800 by 0
37868>>>>>>>        
37868>>>>>>>
37868>>>>>>>        Move "" to sLinhaAutoComplete
37869>>>>>>>        Move "" to sListaAutoComplete
37870>>>>>>>        Move "" to sQuery
37871>>>>>>>        //-
37871>>>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG320
37876>>>>>>>>
37876>>>>>>>
37876>>>>>>>    Move "SELECT TOP 15 a.RECNUM, a.CODIGO, a.NOME, a.FANTASIA, a.DATA_NASCFUND, a.PAIS, a.CSAG336_ID, a.TPPESSOA," to sQuery
37877>>>>>>>    If (CSAG300.USUARIOCLASSE = TSMG800.CLASSEGUEST) Begin
37879>>>>>>>         Move (sQuery*"a.NRDOCTO_ED, a.TPDOCTO From dbo.CSAG320 a") to sQuery 
37880>>>>>>>         Move (sQuery*"INNER JOIN DBO.CSAG366 b ON (a.CODIGO=b.CSAG320_ID)") to sQuery 
37881>>>>>>>         Move (sQuery*"INNER JOIN DBO.CSAG369 x ON (x.CSAG320_NR=a.CODIGO and x.CSAG300_NRHD=%1)") to sQuery 
37882>>>>>>>         Move (SFormat(sQuery, CSAG300.USUARIONUMERO)) to sQuery
37883>>>>>>>         //-
37883>>>>>>>         Move (sQuery*"WHERE a.FANTASIA collate Latin1_General_CI_AI LIKE '%1' AND b.CSAG319_ID = %2 ORDER BY a.FANTASIA") to sQuery 
37884>>>>>>>    End
37884>>>>>>>>
37884>>>>>>>    Else Move (sQuery*"a.NRDOCTO_ED, a.TPDOCTO From dbo.CSAG320 a INNER JOIN DBO.CSAG366 b ON (a.CODIGO=b.CSAG320_ID) WHERE a.FANTASIA collate Latin1_General_CI_AI LIKE '%1' AND b.CSAG319_ID = %2 ORDER BY a.FANTASIA") to sQuery
37886>>>>>>>    //-
37886>>>>>>>        Move (SFORMAT(sQuery, ('%'+sInicial+'%'), ToSQLNumber(TSMG800.CONCORRENCIA_ID))) to sQuery
37887>>>>>>>
37887>>>>>>>    SQL_FIND_BEGIN hStmt_CSAG320_01 sQuery
37906>>>>>>>>
37906>>>>>>>        //SqlFindValueByName
37906>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,1))                             to sCSAG320RECNUM
37907>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,2))                             to sCSAG320CODIGO
37908>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,3))                             to sCSAG320NOME
37909>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,4))                             to sCSAG320FANTASIA
37910>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,5))                             to sCSAG320DATA_NASCFUND
37911>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,6))                             to sCSAG320PAIS
37912>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,7))                             to sCSAG320STATUS
37913>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,8))                             to sCSAG320TPPESSOA
37914>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,9))                             to sCSAG320NRDOCTO
37915>>>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,10))                            to sCSAG320TPDOCTO
37916>>>>>>>                                                                            
37916>>>>>>>        //REMOVER ESPACOS EM BRANCO                                         
37916>>>>>>>        Move (Trim(sCSAG320NOME))                                           to sCSAG320NOME
37917>>>>>>>        Move (Trim(sCSAG320FANTASIA))                                       to sCSAG320FANTASIA
37918>>>>>>>        Move (Trim(sCSAG320PAIS))                                           to sCSAG320PAIS
37919>>>>>>>        Move (Trim(sCSAG320NRDOCTO))                                        to sCSAG320NRDOCTO
37920>>>>>>>        
37920>>>>>>>        //IDENTIFICAR OS CAMPOS
37920>>>>>>>        Move  sCSAG320RECNUM                                                to sRecnum
37921>>>>>>>        Move  sCSAG320CODIGO                                                to sCodigo
37922>>>>>>>        Move  sCSAG320FANTASIA                                              to sDescricao
37923>>>>>>>                                                                            
37923>>>>>>>        Move (sCSAG320FANTASIA+',')                                         to sExibeInformacao
37924>>>>>>>        Move (sExibeInformacao*sCSAG320PAIS+',')                            to sExibeInformacao 
37925>>>>>>>        
37925>>>>>>>        Get Find_Code_Description of oTPDOCTO_VT sCSAG320TPDOCTO to sCSAG320TPDOCTO
37926>>>>>>>        Move (sExibeInformacao*Trim(sCSAG320TPDOCTO)+':'+sCSAG320NRDOCTO)     to sExibeInformacao 
37927>>>>>>>
37927>>>>>>>        //MONTAR O AUTOCOMPLETE
37927>>>>>>>        Move '{'                                                            to sLinhaAutoComplete
37928>>>>>>>        Move (sLinhaAutoComplete+'"id":"'+sCodigo+'"')                      to sLinhaAutoComplete
37929>>>>>>>        Move (sLinhaAutoComplete+',"label":"'+sExibeInformacao+'"')         to sLinhaAutoComplete
37930>>>>>>>        Move (sLinhaAutoComplete+',"value":"'+sDescricao+'"')               to sLinhaAutoComplete
37931>>>>>>>        Move (sLinhaAutoComplete+',"recnum":"'+sRecnum+'"')                 to sLinhaAutoComplete
37932>>>>>>>        Move (sLinhaAutoComplete+',"cpfcnpj":"'+sCSAG320NRDOCTO+'"')        to sLinhaAutoComplete
37933>>>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37934>>>>>>>        //                                                          
37934>>>>>>>        Move (sListaAutoComplete+If(sListaAutoComplete<>'',',','')+sLinhaAutoComplete) to sListaAutoComplete                    
37935>>>>>>>                        
37935>>>>>>>    SQL_FIND_END hStmt_CSAG320_01 
37942>>>>>>>>
37942>>>>>>>        
37942>>>>>>>        If (sListaAutoComplete='') Begin
37944>>>>>>>        Move '{'                                                            to sLinhaAutoComplete
37945>>>>>>>        Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
37946>>>>>>>        Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37947>>>>>>>        Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
37948>>>>>>>        Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
37949>>>>>>>        Move (sLinhaAutoComplete+',"cpfcnpj":""')                           to sLinhaAutoComplete
37950>>>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
37951>>>>>>>        //
37951>>>>>>>        Move sLinhaAutoComplete to sListaAutoComplete
37952>>>>>>>        End
37952>>>>>>>>
37952>>>>>>>        
37952>>>>>>>    Function_Return ('['+sListaAutoComplete+']')
37953>>>>>>>    
37953>>>>>>>End_Function // f_bCSAG320_clientenome_conc
37954>>>>>>>
37954>>>>>>>Function f_AtualizaTabs String sCSAG320_ID String aUsuarioSessao Returns String
#REM SEND REGISTERINTERFACE |CI7377 "get_f_AtualizaTabs" "String sCSAG320_ID String aUsuarioSessao Returns String" ""
37958>>>>>>>    String sRetorno
37958>>>>>>>    String sQuery
37958>>>>>>>    String sMontajSonFalse
37958>>>>>>>    String sMontajSonTrue
37958>>>>>>>    String sValueTrue
37958>>>>>>>    String sValueFalse
37958>>>>>>>    String sCSAG319TIPO
37958>>>>>>>    
37958>>>>>>>    Move '"%1": false'  to sValueFalse
37959>>>>>>>    Move '"%1": true'   to sValueTrue
37960>>>>>>>
37960>>>>>>>        Move "" to sQuery
37961>>>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG319
Including file: CSAG319.fd    (C:\DataFlex Projects\CROSS\WVDF_CAC\DDSrc\CSAG319.fd)
37966>>>>>>>>
37966>>>>>>>    Move ("SELECT TIPO From dbo.CSAG319 ORDER BY TIPO") to sQuery
37967>>>>>>>    SQL_FIND_BEGIN hStmt_CSAG319_01 sQuery
37986>>>>>>>>
37986>>>>>>>        //SqlFindValueByName
37986>>>>>>>        Move (SqlFindValue(hStmt_CSAG319_01,1)) to sCSAG319TIPO
37987>>>>>>>        
37987>>>>>>>        Move (Trim(sCSAG319TIPO)) to sCSAG319TIPO
37988>>>>>>>        
37988>>>>>>>        If (sCSAG319TIPO<>'') Begin
37990>>>>>>>            
37990>>>>>>>            If (sMontajSonFalse<>'') ;                Move (sMontajSonFalse +','+ SFormat(sValueFalse, sCSAG319TIPO)) to sMontajSonFalse
37993>>>>>>>            Else ;                Move (SFormat(sValueFalse, sCSAG319TIPO)) to sMontajSonFalse
37995>>>>>>>                
37995>>>>>>>        End
37995>>>>>>>>
37995>>>>>>>    SQL_FIND_END hStmt_CSAG319_01 
38002>>>>>>>>
38002>>>>>>>
38002>>>>>>>    Move ('{' + sMontajSonFalse + '}') to sRetorno    
38003>>>>>>>
38003>>>>>>>    Clear    CSAG311
38004>>>>>>>    Move (Trim(aUsuarioSessao) )  to CSAG311.USUARIOSESSAO
38005>>>>>>>    Find Eq  CSAG311              by 1
38006>>>>>>>>
38006>>>>>>>    If (not(Found)) Begin
38008>>>>>>>        Function_Return sRetorno
38009>>>>>>>    End
38009>>>>>>>>
38009>>>>>>>    
38009>>>>>>>        Move "" to sQuery
38010>>>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG366
38015>>>>>>>>
38015>>>>>>>    Move ("select a.TIPO from dbo.CSAG366 b inner join dbo.CSAG319 a on b.CSAG319_ID = a.CODIGO where b.CSAG320_ID = %1 order by b.CSAG319_ID") to sQuery
38016>>>>>>>        Move (SFORMAT(sQuery, toSqlNumber(sCSAG320_ID))) to sQuery
38017>>>>>>>    SQL_FIND_BEGIN hStmt_CSAG366_01 sQuery
38036>>>>>>>>
38036>>>>>>>        //SqlFindValueByName
38036>>>>>>>        Move (SqlFindValue(hStmt_CSAG366_01,1))     to sCSAG319TIPO
38037>>>>>>>        Move (Trim(sCSAG319TIPO))                   to sCSAG319TIPO
38038>>>>>>>
38038>>>>>>>        //MONTAR O AUTOCOMPLETE
38038>>>>>>>        If (sCSAG319TIPO<>'') Begin
38040>>>>>>>            Move (SFormat(sValueFalse, sCSAG319TIPO)) to sMontajSonFalse
38041>>>>>>>            Move (SFormat(sValueTrue, sCSAG319TIPO))  to sMontajSonTrue
38042>>>>>>>            Move (Replace(sMontajSonFalse, sRetorno, sMontajSonTrue)) to sRetorno
38043>>>>>>>        End
38043>>>>>>>>
38043>>>>>>>                        
38043>>>>>>>    SQL_FIND_END hStmt_CSAG366_01 
38050>>>>>>>>
38050>>>>>>>        
38050>>>>>>>    Function_Return sRetorno
38051>>>>>>>    
38051>>>>>>>    
38051>>>>>>>End_Function //f_AtualizaTabs
38052>>>>>>>
38052>>>>>
38052>>>>>Function fCSAG341_EXEC_CONTAS String sCONTEUDO String sNOMECOMBO String aUsuarioSessao Returns String
#REM SEND REGISTERINTERFACE |CI7378 "get_fCSAG341_EXEC_CONTAS" "String sCONTEUDO String sNOMECOMBO String aUsuarioSessao Returns String" "fCSAG341_EXEC_CONTAS"
38056>>>>>    String    sRetorno
38056>>>>>    String    sQuery
38056>>>>>    String    sPESSOA
38056>>>>>    String    sDESCRICAO
38056>>>>>    String    sResult  
38056>>>>>
38056>>>>>    Move ('<select name="'+(Trim(sNOMECOMBO))+'" id="'+(Trim(sNOMECOMBO))+'" class="col-xs-6">') to sRetorno
38057>>>>>    
38057>>>>>    Clear CSAG311
38058>>>>>    Move (Trim(aUsuarioSessao) )  to CSAG311.USUARIOSESSAO
38059>>>>>    Find Eq  CSAG311              by 1
38060>>>>>>
38060>>>>>      If (not(Found)) Begin
38062>>>>>         Move (sRetorno+'<option value="">SESSAO INVALIDA. CONTATE ADMINISTRADOR.</option>') to sRetorno
38063>>>>>         Move (sRetorno+'</select>') to sRetorno
38064>>>>>         Function_Return                sRetorno
38065>>>>>      End
38065>>>>>>
38065>>>>>
38065>>>>>        Move "" to sQuery
38066>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG341
38071>>>>>>
38071>>>>>    Move "SELECT a.CODIGO, b.FANTASIA FROM dbo.CSAG341 a INNER JOIN dbo.CSAG320 b ON a.CSAG320_ID = b.CODIGO ORDER BY b.FANTASIA" to sQuery
38072>>>>>    SQL_FIND_BEGIN hStmt_CSAG341_01 sQuery
38091>>>>>>
38091>>>>>        //SqlFindValueByName
38091>>>>>        Move (SqlFindValue(hStmt_CSAG341_01,1)) to sPESSOA 
38092>>>>>        Move (SqlFindValue(hStmt_CSAG341_01,2)) to sDESCRICAO
38093>>>>>        
38093>>>>>        Move (Trim(sDESCRICAO))           to sDESCRICAO
38094>>>>>        Move (sPESSOA*"-"*sDESCRICAO)     to sResult
38095>>>>>        
38095>>>>>        Move (sRetorno+'<option '+If(sPESSOA=sCONTEUDO,'selected="selected"','')+' value="'+sPESSOA+'">'+sResult+'</option>') to sRetorno
38096>>>>>    SQL_FIND_END hStmt_CSAG341_01
38103>>>>>>
38103>>>>>
38103>>>>>    Move (sRetorno+'</select>') to sRetorno
38104>>>>>    Function_Return                sRetorno
38105>>>>>
38105>>>>>End_Function // fCSAG341_EXEC_CONTAS
38106>>>>>
38106>>>>>Function f_pegaDescricao String sCODIGO Returns String
#REM SEND REGISTERINTERFACE |CI7369 "get_f_pegaDescricao" "String sCODIGO Returns String" "f_pegaDescricao"
38110>>>>>    String sDESCRICAO
38110>>>>>    
38110>>>>>    Clear CSAG341
38111>>>>>    Move sCODIGO to CSAG341.CSAG320_ID
38112>>>>>    Find Eq CSAG341 by 2
38113>>>>>>
38113>>>>>    Move CSAG341.APELIDO to sDESCRICAO
38114>>>>>    If (sDESCRICAO = "") Begin
38116>>>>>        Get f_pegaFantasia CSAG341.CSAG320_ID to sDESCRICAO
38117>>>>>    End
38117>>>>>>
38117>>>>>    
38117>>>>>    Function_Return sDESCRICAO
38118>>>>>End_Function //f_pegaDescricao
38119>>>>>
38119>>>>>Function f_pegaCSAG341_desc String sCODIGO Returns String
#REM SEND REGISTERINTERFACE |CI7379 "get_f_pegaCSAG341_desc" "String sCODIGO Returns String" "f_pegaDescricao"
38123>>>>>    String sDESCRICAO
38123>>>>>    
38123>>>>>    Clear CSAG341
38124>>>>>    Move sCODIGO to CSAG341.CODIGO
38125>>>>>    Find Eq CSAG341 by 1
38126>>>>>>
38126>>>>>    Get f_pegaFantasia_2101_05 CSAG341.CSAG320_ID to sDESCRICAO
38127>>>>>    
38127>>>>>    Function_Return sDESCRICAO
38128>>>>>End_Function //f_pegaDescricao
38129>>>>>
38129>>>>>Function f_bCSAG341_vendedor String sInicial String sSessionId Returns String
#REM SEND REGISTERINTERFACE |CI7380 "get_f_bCSAG341_vendedor" "String sInicial String sSessionId Returns String" ""
38133>>>>>    String  sQuebraLinha
38133>>>>>    String  sQuery
38133>>>>>    String  sLinhaAutoComplete
38133>>>>>    String  sListaAutoComplete
38133>>>>>    String  sCodigo
38133>>>>>    String  sExibeInformacao
38133>>>>>    String  sDescricao
38133>>>>>    String  sRecnum
38133>>>>>    String sCSAG320RECNUM       
38133>>>>>    String sCSAG320CODIGO       
38133>>>>>    String sCSAG320NOME         
38133>>>>>    String sCSAG320FANTASIA
38133>>>>>    String sCSAG320DATA_NASCFUND
38133>>>>>    String sCSAG320PAIS         
38133>>>>>    String sCSAG320STATUS       
38133>>>>>    String sCSAG320TPPESSOA     
38133>>>>>    String sCSAG320NRDOCTO  
38133>>>>>    String sCSAG320TPDOCTO 
38133>>>>>    String sCSAG341APELIDO
38133>>>>>   
38133>>>>>    Move (Character(13)+Character(10)) to sQuebraLinha
38134>>>>>    
38134>>>>>    Move (Uppercase(sInicial)) to sInicial
38135>>>>>    Move (Trim(sInicial))      to sInicial
38136>>>>>        
38136>>>>>        Move "" to sQuery
38137>>>>>    CREATE_MAIN_CONNECTION BYFILE CSAG320
38142>>>>>>
38142>>>>>    Move "SELECT TOP 15 B.RECNUM, A.CODIGO, A.NOME, A.FANTASIA, B.APELIDO" to sQuery
38143>>>>>    Move (sQuery*"From dbo.CSAG320 A INNER JOIN dbo.CSAG341 B ON B.CSAG320_ID = A.CODIGO WHERE A.NOME LIKE '%1' ORDER BY NOME") to sQuery
38144>>>>>        Move (SFORMAT(sQuery, ('%'+Trim(sInicial)+'%'))) to sQuery
38145>>>>>    SQL_FIND_BEGIN hStmt_CSAG320_01 sQuery
38164>>>>>>
38164>>>>>        //SqlFindValueByName
38164>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,1))                             to sCSAG320RECNUM
38165>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,2))                             to sCSAG320CODIGO
38166>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,3))                             to sCSAG320NOME
38167>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,4))                             to sCSAG320FANTASIA
38168>>>>>        Move (SqlFindValue(hStmt_CSAG320_01,5))                             to sCSAG341APELIDO
38169>>>>>                                                                            
38169>>>>>        //REMOVER ESPACOS EM BRANCO                                         
38169>>>>>        Move (Trim(sCSAG320NOME))                                           to sCSAG320NOME
38170>>>>>        Move (Trim(sCSAG320FANTASIA))                                       to sCSAG320FANTASIA
38171>>>>>        Move (Trim(sCSAG341APELIDO))                                        to sCSAG341APELIDO
38172>>>>>        
38172>>>>>        //IDENTIFICAR OS CAMPOS
38172>>>>>        Move  sCSAG320RECNUM                                                to sRecnum
38173>>>>>        Move  sCSAG320CODIGO                                                to sCodigo
38174>>>>>        If (sCSAG341APELIDO <> "") Move  sCSAG341APELIDO                    to sDescricao
38177>>>>>        Else Move  sCSAG320FANTASIA                                         to sDescricao
38179>>>>>                                                                            
38179>>>>>        Move (sDescricao)                                                   to sExibeInformacao
38180>>>>>        
38180>>>>>        //MONTAR O AUTOCOMPLETE
38180>>>>>        Move '{'                                                            to sLinhaAutoComplete
38181>>>>>        Move (sLinhaAutoComplete+'"id":"'+sCodigo+'"')                      to sLinhaAutoComplete
38182>>>>>        Move (sLinhaAutoComplete+',"label":"'+sExibeInformacao+'"')         to sLinhaAutoComplete
38183>>>>>        Move (sLinhaAutoComplete+',"value":"'+sDescricao+'"')               to sLinhaAutoComplete
38184>>>>>        Move (sLinhaAutoComplete+',"recnum":"'+sRecnum+'"')                 to sLinhaAutoComplete
38185>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
38186>>>>>        //                                                          
38186>>>>>        Move (sListaAutoComplete+If(sListaAutoComplete<>'',',','')+sLinhaAutoComplete) to sListaAutoComplete                    
38187>>>>>                        
38187>>>>>    SQL_FIND_END hStmt_CSAG320_01 
38194>>>>>>
38194>>>>>        
38194>>>>>        If (sListaAutoComplete='') Begin
38196>>>>>        Move '{'                                                            to sLinhaAutoComplete
38197>>>>>        Move (sLinhaAutoComplete+'"id":"0"')                                to sLinhaAutoComplete
38198>>>>>        Move (sLinhaAutoComplete+',"label":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
38199>>>>>        Move (sLinhaAutoComplete+',"value":"NENHUM REGISTRO ENCONTRADO"')   to sLinhaAutoComplete
38200>>>>>        Move (sLinhaAutoComplete+',"recnum":"0"')                           to sLinhaAutoComplete
38201>>>>>        Move (sLinhaAutoComplete+'}')                                       to sLinhaAutoComplete
38202>>>>>        //
38202>>>>>        Move sLinhaAutoComplete to sListaAutoComplete
38203>>>>>        End
38203>>>>>>
38203>>>>>        
38203>>>>>    Function_Return ('['+sListaAutoComplete+']')
38204>>>>>    
38204>>>>>End_Function // f_bCSAG341_vendedor
38205>>>>>
38205>>>>>// --------------- VERIFICA QUANTOS VENDEDORES O USUARIO POSSUI, CASO SEJA UM RETORNA ELE
38205>>>>>Function f_Verifica_Vendedor String sUsuSession Returns Integer
#REM SEND REGISTERINTERFACE |CI7381 "get_f_Verifica_Vendedor" "String sUsuSession Returns Integer" ""
38209>>>>>    String sQuery
38209>>>>>    Integer iCount
38209>>>>>    Integer iVendedor
38209>>>>>    
38209>>>>>    Clear CSAG311
38210>>>>>    Move sUsuSession to CSAG311.USUARIOSESSAO
38211>>>>>    Find EQ CSAG311 by 1
38212>>>>>>
38212>>>>>    
38212>>>>>    Move "SELECT COUNT(a.RECNUM) FROM DBO.CSAG369 a INNER JOIN DBO.CSAG341 v ON a.CSAG320_NR = v.CSAG320_ID" to sQuery
38213>>>>>    Move (sQuery*"WHERE a.CSAG300_NRHD = %1") to sQuery
38214>>>>>    
38214>>>>>    SQL_FIND_BEGIN hStmt_contavendedor (SFORMAT(sQuery, (CSAG311.USUARIONUMERO)))
38233>>>>>>
38233>>>>>        Move (SqlFindValue(hStmt_contavendedor,1)) to iCount
38234>>>>>    SQL_FIND_END hStmt_contavendedor
38241>>>>>>
38241>>>>>    
38241>>>>>    If (iCount = 1) Begin
38243>>>>>       
38243>>>>>       Move "SELECT a.CSAG320_NR FROM DBO.CSAG369 a INNER JOIN DBO.CSAG341 v ON a.CSAG320_NR = v.CSAG320_ID" to sQuery
38244>>>>>       Move (sQuery*"WHERE a.CSAG300_NRHD = %1") to sQuery
38245>>>>>       
38245>>>>>       SQL_FIND_BEGIN hStmt_vendedorunico (SFORMAT(sQuery, (CSAG311.USUARIONUMERO)))
38264>>>>>>
38264>>>>>           Move (SqlFindValue(hStmt_vendedorunico ,1)) to iVendedor
38265>>>>>       SQL_FIND_END hStmt_vendedorunico 
38272>>>>>>
38272>>>>>       
38272>>>>>       Clear CSAG341
38273>>>>>       Move iVendedor to CSAG341.CSAG320_ID
38274>>>>>       Find EQ CSAG341 by 2
38275>>>>>>
38275>>>>>       
38275>>>>>       Move CSAG341.CSAG320_ID to iVendedor
38276>>>>>       
38276>>>>>       If (Found and CSAG341.CSAG336_ID = 1) Function_Return iVendedor
38279>>>>>       Else Function_Return 0
38281>>>>>    
38281>>>>>    End     
38281>>>>>>
38281>>>>>    Else Function_Return 0
38283>>>>>    
38283>>>>>End_Function //f_Verifica_Vendedor
38284>>>>>
38284>>>
38284>>>Use cCCGS211_DataDictionary.dd
38284>>>
38284>>>Register_Object oPCGS210_01
38284>>>
38284>>>Object oPCGS211_02 is a cWebBusinessProcess
38286>>>    Set psDescription to "PCGS211_02"
38287>>>    
Including file: VerifyRecs.inc    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\VerifyRecs.inc)
38287>>>>// ESTA PROCEDURE PODE SER USADA PARA EXIBIR UMA MENSAGEM PADRAO
38287>>>>// ONDE O RELATORIO ENCONTROU REGISTROS, POREM SE O REPORT NAO EMITIU NADA
38287>>>>// VAMOS INFOMAR AO USUARIO.
38287>>>>//-2WA
38287>>>>Property String   psUsuarioSessao
38289>>>>Property String   psPrograma
38291>>>>
38291>>>>Procedure NaoPossuiRegistro String sMsg String sClasse
38294>>>>    Send WriteHtmlTableBegin 'border="0" width="95%" class="ReportTable" align="center"'
38295>>>>         Send WriteHtml '<tbody>'    
38296>>>>         Send WriteHtmlRowBegin
38297>>>>               Send WriteHtml '<br />'
38298>>>>         Send WriteHtmlRowEnd
38299>>>>    
38299>>>>         Send WriteHtmlRowBegin
38300>>>>             Send WriteHtmlCellHeader  sMsg  ('class="'+sClasse+'"  align="center"')
38301>>>>         Send WriteHtmlRowEnd
38302>>>>    
38302>>>>         Send WriteHtmlRowBegin
38303>>>>               Send WriteHtml '<br />'
38304>>>>         Send WriteHtmlRowEnd
38305>>>>         Send WriteHtml '</tbody>'    
38306>>>>    
38306>>>>    Send WriteHtmlTableEnd
38307>>>>End_Procedure // NaoPossuiRegistro
38308>>>>
38308>>>>
38308>>>>// Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:08
38308>>>>Procedure SetUsuariosessao String sStart
#REM SEND REGISTERINTERFACE |CI7301 "msg_SetUsuariosessao" "String sStart" ""
38312>>>>    Set psUsuarioSessao to sStart
38313>>>>End_Procedure // SetUsuariosessao
38314>>>>
38314>>>>
38314>>>>// Visual DataFlex 16.1 Migration Utility, added July 28, 2013: 19:16:11
38314>>>>Procedure SetPrograma String sStart
#REM SEND REGISTERINTERFACE |CI7302 "msg_SetPrograma" "String sStart" ""
38318>>>>    Set psPrograma to sStart
38319>>>>End_Procedure // SetUsuariosessao
38320>>>>
38320>>>
38320>>>
38320>>>    Object oCCGS211_DD is a cCCGS211_DataDictionary
38322>>>        Send DefineAllExtendedFields
38323>>>        
Including file: FIELDLABEL.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABEL.INC)
38323>>>>// ANDERSON
38323>>>>// 13.06.2003 - 01:44
38323>>>>// ROTINA PARA SER INCLUIDA EM TODOS OS DDOS DE TODOS WBOS
38323>>>>// 
38323>>>>// PROCEDURE FIELD_DEFAULTS FOI MODIFICADA PARA LER CSAG310
38323>>>>// E EMITIR A LABEL DE CADA CAMPO NA LINGUA INDICADA.
38323>>>>//-2WA
38323>>>>Procedure Field_Defaults
38326>>>>    Forward Send Field_Defaults
38328>>>>
38328>>>>    Handle  hIdiomaFile
38328>>>>    String  sIdiomaFieldName
38328>>>>    String  sIdiomaLogicalName
38328>>>>    Integer iIdiomaNumFields
38328>>>>    Integer iIdiomaX
38328>>>>    
38328>>>>    Get Main_File                       To hIdiomaFile
38329>>>>    Get_Attribute DF_FILE_LOGICAL_NAME  Of hIdiomaFile                To sIdiomaLogicalName
38332>>>>    Get_Attribute DF_FILE_NUMBER_FIELDS Of hIdiomaFile                To iIdiomaNumFields
38335>>>>
38335>>>>    For iIdiomaX from 1 To iIdiomaNumFields
38341>>>>>
38341>>>>
38341>>>>        Get_Attribute DF_FIELD_NAME     Of hIdiomaFile iIdiomaX       To sIdiomaFieldName
38344>>>>
38344>>>>        Clear   CSAG310
38345>>>>        Move sIdiomaLogicalName                     To CSAG310.TABELA
38346>>>>        Move sIdiomaFieldName                       To CSAG310.CAMPO
38347>>>>        Move (piUsuarioIdioma(oPAG800_01(Self)))    To CSAG310.IDIOMA
38348>>>>        Find Eq CSAG310   By 1
38349>>>>>
38349>>>>
38349>>>>        If (CSAG310.APPEARANCE<>"")     Set Field_Label_Long iIdiomaX To (Trim(CSAG310.APPEARANCE))
38352>>>>
38352>>>>    Loop
38353>>>>>
38353>>>>
38353>>>>End_procedure // Field_Defaults
38354>>>>
38354>>>>
38354>>>        
38354>>>        Property Number pnStartCSAG341_ID
38356>>>        Property Number pnStopCSAG341_ID
38358>>>        Property Number pnStartCCGS210_ID
38360>>>        Property Number pnStopCCGS210_ID
38362>>>        
38362>>>        FILTER_PREPARE
38423>>>>
38423>>>
38423>>>        Procedure OnFilterConstrain // OnConstrain 
38426>>>            Number nStart nStop
38426>>>
38426>>>            Get pnStartCSAG341_ID to nStart
38427>>>            //Get pnStopCSAG341_ID To nStop
38427>>>
38427>>>            If (nStart <> 0) Begin
38429>>>                Filter_Constrain (sFormat("CSAG320_ID = %1",toSqlNumber(nStart)))
38433>>>            End
38433>>>>
38433>>>            
38433>>>
38433>>>            Get pnStartCCGS210_ID to nStart
38434>>>            //Get pnStopCCGS210_ID To nStop
38434>>>
38434>>>            If (nStart <> 0) Begin
38436>>>                Filter_Constrain (sFormat("CCGS210_ID = %1",toSqlNumber(nStart)))
38440>>>            End
38440>>>>
38440>>>            
38440>>>        End_Procedure // OnConstrain
38441>>>    End_Object // oCCGS211_DD
38442>>>
38442>>>    Set Main_DD to oCCGS211_DD
38443>>>
38443>>>
38443>>>    Object oReport is a cWebReport_Filter
Including file: FIELDLABELRPT.INC    (C:\DataFlex Projects\CROSS\WVDF_CAC\PkgSrc\FIELDLABELRPT.INC)
38445>>>>// Anderson
38445>>>>// 13.06.2003 - 11:33
38445>>>>// FUNCAO USADA PARA ESCREVER A LABEL DE CADA COLUNA DO RELATORIO
38445>>>>//
38445>>>>// PARA QUE ESTA FUNCAO TRAGA A LABEL CORRESPONDENTE NO IDIOMA
38445>>>>// EH PRECISO QUE NO DDO DO WBO ESTEJA O PACOTE FIELDLABEL.INC
38445>>>>//-2WA
38445>>>>Function ddValueFieldLabel Integer iDDO String sField Returns String 
38448>>>>    Integer iFile 
38448>>>>    Integer iField
38448>>>>    String  sVal
38448>>>>    String  sLabel
38448>>>>    Handle  hFile
38448>>>>    
38448>>>>    Move (Left(sField,(Pos(".",sField)))+"File_Number")      to sVal
38449>>>>    Move (Replace(Left(sField,(Pos(".",sField))),sField,"")) to sField
38450>>>>    
38450>>>>    Move (Eval(sVal)) to hFile
38451>>>>    //Pegar o numero do arquivo
38451>>>>    Get_Attribute DF_FILE_NUMBER Of hFile to iFile
38454>>>>
38454>>>>    //Pegar o numero do campo no arquivo
38454>>>>    Field_Map iFile sField to iField      
38456>>>>    
38456>>>>    Get Field_Label_Long of iDDO iField To sLabel
38457>>>>    Function_Return (HtmlEncode(sLabel))
38458>>>>    
38458>>>>End_Function // ddValueFieldLabel
38459>>>>
38459>>>>
38459>>>        
38459>>>        Procedure OnPageTop
38462>>>            String sText
38462>>>            String sCCGS211CSAG341_ID
38462>>>            String sCCGS211CCGS210_ID
38462>>>            String sCCGS211STATUS
38462>>>            String sCCGS211STATUS_DT_ATIVO
38462>>>            String sCCGS211STATUS_DT_INATIVO
38462>>>            String sCCGS211OBSERVACAO
38462>>>            String sCCGS211BASE_DE_CALCULO_COM
38462>>>            String sCCGS211USUARIO_ID_C
38462>>>            String sCCGS211DATE_TIME_C
38462>>>            String sCCGS211USUARIO_ID_A
38462>>>            String sCCGS211DATE_TIME_A
38462>>>            
38462>>>            Handle         hDD
38462>>>            Get Main_DD to hDD
38463>>>            
38463>>>            Get ddValueFieldlabel hDD "CCGS211.CSAG320_ID" to sCCGS211CSAG341_ID
38464>>>            Get ddValueFieldlabel hDD "CCGS211.CCGS210_ID" to sCCGS211CCGS210_ID
38465>>>            Get ddValueFieldlabel hDD "CCGS211.STATUS" to sCCGS211STATUS
38466>>>            Get ddValueFieldlabel hDD "CCGS211.STATUS_DT_ATIVO" to sCCGS211STATUS_DT_ATIVO
38467>>>            Get ddValueFieldlabel hDD "CCGS211.STATUS_DT_INATIVO" to sCCGS211STATUS_DT_INATIVO
38468>>>            Get ddValueFieldlabel hDD "CCGS211.OBSERVACAO" to sCCGS211OBSERVACAO
38469>>>            Get ddValueFieldlabel hDD "CCGS211.BASE_DE_CALCULO_COM" to sCCGS211BASE_DE_CALCULO_COM
38470>>>            Get ddValueFieldlabel hDD "CCGS211.USUARIO_ID_C" to sCCGS211USUARIO_ID_C
38471>>>            Get ddValueFieldlabel hDD "CCGS211.DATE_TIME_C" to sCCGS211DATE_TIME_C
38472>>>            Get ddValueFieldlabel hDD "CCGS211.USUARIO_ID_A" to sCCGS211USUARIO_ID_A
38473>>>            Get ddValueFieldlabel hDD "CCGS211.DATE_TIME_A" to sCCGS211DATE_TIME_A
38474>>>            
38474>>>            Send WriteHtmlTableBegin 'class="table table-bordered table-striped table-hover"'
38475>>>                Send WriteHtml '<thead>'
38476>>>
38476>>>            Send WriteHtmlRowBegin
38477>>>                Send WriteHtmlCellHeader sCCGS211CSAG341_ID             'class="rptL" colspan="2"'
38478>>>                Send WriteHtmlCellHeader sCCGS211CCGS210_ID             'class="rptL" colspan="2"'
38479>>>                Send WriteHtmlCellHeader sCCGS211STATUS                 'class="rptL"'
38480>>>                Send WriteHtmlCellHeader sCCGS211BASE_DE_CALCULO_COM    'class="rptR"'
38481>>>            Send WriteHtmlRowEnd
38482>>>            Send WriteHtml '</thead>'
38483>>>            Send WriteHtml '<tbody>'
38484>>>        End_Procedure // OnPageTop
38485>>>        
38485>>>        Function OnSelection Returns Integer
38488>>>            Boolean bSELECT
38488>>>            
38488>>>            Move True to bSELECT
38489>>>        
38489>>>            //--------------------------------------------------------------------------------------------------------//
38489>>>            //--- Checagem Rede Neural
38489>>>        
38489>>>                  //Get fCAC_RedeNeural_UsuarioVsMarca (Trim(psUsuarioSessao(Self))) CCIM201.Csag308_Nr to bSELECT
38489>>>        
38489>>>            //--------------------------------------------------------------------------------------------------------//
38489>>>        
38489>>>            If (bSELECT) Function_Return RPT_OK
38492>>>            Else         Function_Return RPT_NOT_SELECT
38494>>>        
38494>>>        End_Function  // OnSelection
38495>>>
38495>>>        Procedure OnBody 
38498>>>            String sText
38498>>>            String sCCGS211CSAG341_ID
38498>>>            String sCCGS211CCGS210_ID
38498>>>            String sCCGS211STATUS
38498>>>            String sCCGS211STATUS_DT_ATIVO
38498>>>            String sCCGS211STATUS_DT_INATIVO
38498>>>            String sCCGS211OBSERVACAO
38498>>>            String sCCGS211BASE_DE_CALCULO_COM
38498>>>            String sCCGS211USUARIO_ID_C
38498>>>            String sCCGS211DATE_TIME_C
38498>>>            String sCCGS211USUARIO_ID_A
38498>>>            String sCCGS211DATE_TIME_A
38498>>>
38498>>>            Get ddValueEncode "CCGS211.CSAG320_ID" to sCCGS211CSAG341_ID
38499>>>            Get ddValueEncode "CCGS211.CCGS210_ID" to sCCGS211CCGS210_ID
38500>>>            Get ddValueEncode "CCGS211.STATUS" to sCCGS211STATUS
38501>>>            Get ddValueEncode "CCGS211.STATUS_DT_ATIVO" to sCCGS211STATUS_DT_ATIVO
38502>>>            Get ddValueEncode "CCGS211.STATUS_DT_INATIVO" to sCCGS211STATUS_DT_INATIVO
38503>>>            Get ddValueEncode "CCGS211.OBSERVACAO" to sCCGS211OBSERVACAO
38504>>>            Get ddValueEncode "CCGS211.BASE_DE_CALCULO_COM" to sCCGS211BASE_DE_CALCULO_COM
38505>>>            Get ddValueEncode "CCGS211.USUARIO_ID_C" to sCCGS211USUARIO_ID_C
38506>>>            Get ddValueEncode "CCGS211.DATE_TIME_C" to sCCGS211DATE_TIME_C
38507>>>            Get ddValueEncode "CCGS211.USUARIO_ID_A" to sCCGS211USUARIO_ID_A
38508>>>            Get ddValueEncode "CCGS211.DATE_TIME_A" to sCCGS211DATE_TIME_A
38509>>>
38509>>>            String  sRowid
38509>>>            RowID   rFileNumber
38509>>>        
38509>>>            Move (GetRowID(CCGS211.File_Number))       to rFileNumber
38510>>>            Move (SerializeRowId(rFileNumber))         to sRowid
38511>>>
38511>>>                Send WriteHtml '<tr RowId="'
38512>>>                Send WriteHtml sRowid
38513>>>                Send WriteHtml '"'
38514>>>        
38514>>>                Send WriteHtml ' style="cursor:pointer"'
38515>>>                Send WriteHtml ' onclick="RowClick(this);"'
38516>>>                Send WriteHtml '>'
38517>>>                
38517>>>                
38517>>>                Send WriteHtmlCell (FormatNumber (sCCGS211CSAG341_ID,0)) 'class="rptR"'
38518>>>                Get f_pegaDescricao sCCGS211CSAG341_ID to sText
38519>>>                Send WriteHtmlCell  sText 'class="rptL"'
38520>>>                
38520>>>                Send WriteHtmlCell (FormatNumber (sCCGS211CCGS210_ID,0)) 'class="rptR"'
38521>>>                Get f_pgCCGS210_DESCRICAO of oPCGS210_01 sCCGS211CCGS210_ID to sText
38522>>>                Send WriteHtmlCell  sText 'class="rptL"'
38523>>>                
38523>>>                If (sCCGS211STATUS = 'I') Move '<i class="fa fa-square-o"></i>' to sCCGS211STATUS
38526>>>                If (sCCGS211STATUS = 'A') Move '<i class="fa fa-check-square-o"></i>' to sCCGS211STATUS
38529>>>                Send WriteHtmlCell sCCGS211STATUS 'class="rptC"'
38530>>>                
38530>>>                Send WriteHtmlCell (FormatNumber (sCCGS211BASE_DE_CALCULO_COM,4)) 'class=rptR"'
38531>>>
38531>>>            Send WriteHtmlRowEnd
38532>>>        End_Procedure // OnBody
38533>>>
38533>>>        Procedure OnPageBottom
38536>>>            Send WriteHtml '</tbody>'  
38537>>>            Send WriteHtmlTableEnd
38538>>>        End_Procedure // OnPageBottom
38539>>>
38539>>>        Function RunPCGS211_02 Integer iIndex RowID riStartRowId Integer iMaxCount Returns RowID
38542>>>            RowID   riLastRowId
38542>>>            Integer eStatus
38542>>>
38542>>>            Set piOrdering to iIndex
38543>>>            Set piMaxCount to iMaxCount
38544>>>            Set piMaxCountBreakLevel to 0
38545>>>            Set priStartRowId to riStartRowId
38546>>>
38546>>>            Get DoRunReport to eStatus
38547>>>
38547>>>            Get priLastRowId to riLastRowId
38548>>>
38548>>>            Function_Return riLastRowId
38549>>>        End_Function // RunPCGS211_02
38550>>>    End_Object // oReport
38551>>>
38551>>>    Procedure SetHRefName String sName
#REM SEND REGISTERINTERFACE |CI7325 "msg_SetHRefName" "String sName" "Name to link for drill down report"
38555>>>        Set psHRefname of oReport to sName
38556>>>    End_Procedure // SetHRefName
38557>>>
38557>>>    Procedure SetCCGS211_CSAG341_ID String sStart
#REM SEND REGISTERINTERFACE |CI7391 "msg_SetCCGS211_CSAG341_ID" "String sStart" "Sets the reports selection criteria"
38561>>>        Set pnStartCSAG341_ID of oCCGS211_DD to sStart
38562>>>    End_Procedure // SetCCGS211_CSAG341_ID
38563>>>
38563>>>    Procedure SetCCGS211_CCGS210_ID String sStart
#REM SEND REGISTERINTERFACE |CI7392 "msg_SetCCGS211_CCGS210_ID" "String sStart" "Sets the reports selection criteria"
38567>>>        Set pnStartCCGS210_ID of oCCGS211_DD to sStart
38568>>>    End_Procedure // SetCCGS211_CCGS210_ID
38569>>>
38569>>>    Function RunPCGS211_02 Integer iIndex String sStartRowId Integer iMaxCount Returns String
#REM SEND REGISTERINTERFACE |CI7390 "get_RunPCGS211_02" "Integer iIndex String sStartRowId Integer iMaxCount Returns String" "Run Report"
38573>>>        RowID  riStartRowId riEndRowId
38573>>>        String sEndRowId
38573>>>        Integer iRecordCount
38573>>>
38573>>>        Move (DeserializeRowId(sStartRowId)) to riStartRowId
38574>>>        Get RunPCGS211_02 of oReport iIndex riStartRowId iMaxCount to riEndRowId
38575>>>        Move (SerializeRowId(riEndRowId)) to sEndRowId
38576>>>        
38576>>>        Get piRecordCount of oReport to iRecordCount 
38577>>>        If (iRecordCount=0) Send NaoPossuiRegistro "::NENHUM REGISTRO FOI ENCONTRADO." "Vermelho12"
38580>>>
38580>>>        Function_Return sEndRowId
38581>>>    End_Function // RunPCGS211_02
38582>>>
38582>>>    // This must be manually coded because CreateFindIndexCombo is found in a super-class and not this WO
38582>>>    Send RegisterInterface Get_CreateFindIndexCombo "Get_CreateFindIndexCombo" "string sComboName string sTable integer iIndex returns string" "Create an Index combo form"
38583>>>
38583>>>
38583>>>    Set pbAllowSaveNew to False
38584>>>    Set pbAllowSaveEdit to False
38585>>>    Set pbAllowDelete to False
38586>>>
38586>>>End_Object // oPCGS211_02
38587>    
38587>    Procedure StartWebApp //************************** MELHOR LUGAR AQUI
38590>        Send CreateComObject to oParser
38591>        
38591>        If (IsNullComObject(pvComObject(oParser(Self)))) Begin
38593>            Error 255 "Unable to create Parser"
38594>        End
38594>        Forward Send StartWebApp
38596>        CREATE_MAIN_CONNECTION BYFILE CSAG300
38601>    End_Procedure // StartWebApp    
38602>
38602>    Send InitPassword
38603>    
38603>End_Object    // oWebApp
38604>
38604>Send StartWebApp of oWebApp
38605>
Summary
Memory Available: 2147483646
Total Warnings : 0
Total Errors   : 0
Total Symbols  : 24687
Total Resources: 0
Total Commands : 38604
Total Windows  : 1
Total Pages    : 1
Static Data    : 405063
Message area   : 232957
Total Blocks   : 15738
