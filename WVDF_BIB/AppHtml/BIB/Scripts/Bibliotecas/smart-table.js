!function(a,b){"use strict";a.module("smart-table",[]).run(["$templateCache",function(a){a.put("template/smart-table/pagination.html",'<div class="pagination" ng-if="pages.length >=2"> <ul class="pagination"> <li> <a ng-click="selectPage(1)" aria-label="First"> <span aria-hidden="true">First</span> </a> </li><li> <a ng-click="selectPage(currentPage-1)" aria-label="Previous"> <span aria-hidden="true">&larr;</span> </a> </li><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li><li> <a ng-click="selectPage(currentPage+1)" aria-label="Next"> <span aria-hidden="true">&rarr;</span> </a> </li><li> <a href="" ng-click="selectPage(numPages)" aria-label="Last"> <span aria-hidden="true">Last</span> </a> </li></ul></div>')}]),a.module("smart-table").constant("stConfig",{pagination:{template:"template/smart-table/pagination.html",itemsByPage:10,displayedPages:5},search:{delay:400,inputEvent:"input"},select:{mode:"single",selectedClass:"st-selected"},sort:{defaultClass:"st-sort-default",ascentClass:"st-sort-ascent",descentClass:"st-sort-descent",descendingFirst:!1,skipNatural:!1,delay:300},pipe:{delay:100}}),a.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(d,e,f,g){function t(a){return a?[].concat(a):[]}function u(){n=t(k(d)),q===!0&&r.pipe()}function v(a,b){if(b.indexOf(".")!=-1){var c=b.split("."),d=c.pop(),f=c.join("."),g=e(f)(a);delete g[d],0==Object.keys(g).length&&v(a,f)}else delete a[b]}var k,p,s,h=g.stTable,i=e(h),j=i.assign,l=f("orderBy"),m=f("filter"),n=t(i(d)),o={sort:{},search:{},pagination:{start:0,totalItemCount:0}},q=!0,r=this;g.stSafeSrc&&(k=e(g.stSafeSrc),d.$watch(function(){var a=k(d);return a&&a.length?a[0]:b},function(a,b){a!==b&&u()}),d.$watch(function(){var a=k(d);return a?a.length:0},function(a,b){a!==n.length&&u()}),d.$watch(function(){return k(d)},function(a,b){a!==b&&(o.pagination.start=0,u())})),this.sortBy=function(c,d){return o.sort.predicate=c,o.sort.reverse=d===!0,a.isFunction(c)?o.sort.functionName=c.name:delete o.sort.functionName,o.pagination.start=0,this.pipe()},this.search=function(c,d){var f=o.search.predicateObject||{},g=d?d:"$";return c=a.isString(c)?c.trim():c,e(g).assign(f,c),c||v(f,g),o.search.predicateObject=f,o.pagination.start=0,this.pipe()},this.pipe=function(){var e,c=o.pagination;p=o.search.predicateObject?m(n,o.search.predicateObject):n,o.sort.predicate&&(p=l(p,o.sort.predicate,o.sort.reverse)),c.totalItemCount=p.length,c.number!==b&&(c.numberOfPages=p.length>0?Math.ceil(p.length/c.number):1,c.start=c.start>=p.length?(c.numberOfPages-1)*c.number:c.start,e=p.slice(c.start,c.start+parseInt(c.number))),j(d,e||p)},this.select=function(c,e){var f=t(i(d)),g=f.indexOf(c);g!==-1&&("single"===e?(c.isSelected=c.isSelected!==!0,s&&(s.isSelected=!1),s=c.isSelected===!0?c:b):f[g].isSelected=!f[g].isSelected)},this.slice=function(b,c){return o.pagination.start=b,o.pagination.number=c,this.pipe()},this.tableState=function(){return o},this.getFilteredCollection=function(){return p||n},this.setFilterFunction=function(b){m=f(b)},this.setSortFunction=function(b){l=f(b)},this.preventPipeOnWatch=function(){q=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(a,b,c,d){c.stSetFilter&&d.setFilterFunction(c.stSetFilter),c.stSetSort&&d.setSortFunction(c.stSetSort)}}}),a.module("smart-table").directive("stSearch",["stConfig","$timeout","$parse",function(a,b,c){return{require:"^stTable",link:function(d,e,f,g){var h=g,i=null,j=f.stDelay||a.search.delay,k=f.stInputEvent||a.search.inputEvent;f.$observe("stSearch",function(a,b){var c=e[0].value;a!==b&&c&&(g.tableState().search={},h.search(c,a))}),d.$watch(function(){return g.tableState().search},function(a,b){var d=f.stSearch||"$";a.predicateObject&&c(d)(a.predicateObject)!==e[0].value&&(e[0].value=c(d)(a.predicateObject)||"")},!0),e.bind(k,function(a){a=a.originalEvent||a,null!==i&&b.cancel(i),i=b(function(){h.search(a.target.value,f.stSearch||""),i=null},j)})}}}]),a.module("smart-table").directive("stSelectRow",["stConfig",function(a){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(b,c,d,e){var f=d.stSelectMode||a.select.mode;c.bind("click",function(){b.$apply(function(){e.select(b.row,f)})}),b.$watch("row.isSelected",function(b){b===!0?c.addClass(a.select.selectedClass):c.removeClass(a.select.selectedClass)})}}}]),a.module("smart-table").directive("stSort",["stConfig","$parse","$timeout",function(c,d,e){return{restrict:"A",require:"^stTable",link:function(f,g,h,i){function v(){s?l=0===l?2:l-1:l++;var b;j=a.isFunction(k(f))||a.isArray(k(f))?k(f):h.stSort,l%3===0&&!!r!=!0?(l=0,i.tableState().sort={},i.tableState().pagination.start=0,b=i.pipe.bind(i)):b=i.sortBy.bind(i,j,l%2===0),null!==t&&e.cancel(t),u<0?b():t=e(b,u)}var q,j=h.stSort,k=d(j),l=0,m=h.stClassDefault||c.sort.defaultClass,n=h.stClassAscent||c.sort.ascentClass,o=h.stClassDescent||c.sort.descentClass,p=[n,o],r=h.stSkipNatural!==b?h.stSkipNatural:c.sort.skipNatural,s=h.stDescendingFirst!==b?h.stDescendingFirst:c.sort.descendingFirst,t=null,u=h.stDelay||c.sort.delay;h.stSortDefault&&(q=f.$eval(h.stSortDefault)!==b?f.$eval(h.stSortDefault):h.stSortDefault),g.bind("click",function(){j&&f.$apply(v)}),q&&(l="reverse"===q?1:0,v()),f.$watch(function(){return i.tableState().sort},function(a){a.predicate!==j?(l=0,g.removeClass(n).removeClass(o).addClass(m)):(l=a.reverse===!0?2:1,g.removeClass(m).removeClass(p[l%2]).addClass(p[l-1]))},!0)}}}]),a.module("smart-table").directive("stPagination",["stConfig",function(a){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(b,c){return c.stTemplate?c.stTemplate:a.pagination.template},link:function(b,c,d,e){function f(){var d,f,a=e.tableState().pagination,c=1,g=b.currentPage;for(b.totalItemCount=a.totalItemCount,b.currentPage=Math.floor(a.start/a.number)+1,c=Math.max(c,b.currentPage-Math.abs(Math.floor(b.stDisplayedPages/2))),d=c+b.stDisplayedPages,d>a.numberOfPages&&(d=a.numberOfPages+1,c=Math.max(1,d-b.stDisplayedPages)),b.pages=[],b.numPages=a.numberOfPages,f=c;f<d;f++)b.pages.push(f);g!==b.currentPage&&b.stPageChange({newPage:b.currentPage})}b.stItemsByPage=b.stItemsByPage?+b.stItemsByPage:a.pagination.itemsByPage,b.stDisplayedPages=b.stDisplayedPages?+b.stDisplayedPages:a.pagination.displayedPages,b.currentPage=1,b.pages=[],b.$watch(function(){return e.tableState().pagination},f,!0),b.$watch("stItemsByPage",function(a,c){a!==c&&b.selectPage(1)}),b.$watch("stDisplayedPages",f),b.selectPage=function(a){a>0&&a<=b.numPages&&e.slice((a-1)*b.stItemsByPage,b.stItemsByPage)},e.tableState().pagination.number||e.slice(0,b.stItemsByPage)}}}]),a.module("smart-table").directive("stPipe",["stConfig","$timeout",function(b,c){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(d,e,f,g){var h=null;a.isFunction(d.stPipe)&&(g.preventPipeOnWatch(),g.pipe=function(){return null!==h&&c.cancel(h),h=c(function(){d.stPipe(g.tableState(),g)},b.pipe.delay)})},post:function(a,b,c,d){d.pipe()}}}}])}(angular);